<!DOCTYPE html><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title> C/C++ IO</title><meta name="description" content=" 你可能聽說 iostream (cout/cin) 比 cstdio (printf/scanf) 慢，但實際上關閉同步後，前者比後者快上不少。還有，以 &#39;\n&#39; 取代 endl 也會使速度大幅加快。 You might have heard that iostream (cout/cin) is slower ... "><link rel="stylesheet" href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/assets/main.css"><link rel="canonical" href="http://127.0.0.1:43110/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/07/30/c-c-io.html"><link rel="alternate" type="application/rss+xml" title="Nerde Nolzda" href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/feed.xml"><header role="banner"> <a class="site-title" href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/">Nerde Nolzda</a><nav> <a href="#" class="menu-icon">&#9776;</a><div class="trigger"> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/about/">About</a> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/keys/">Keys</a> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/mirrors/">Mirrors</a> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/tag/">Tags</a> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/feed.xml">RSS</a></div></nav></header><main><article itemscope itemtype="http://schema.org/BlogPosting"><header><h1 itemprop="name headline"> <a itemprop="mainEntityOfPage url" href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/07/30/c-c-io.html"> C/C++ IO </a></h1><p class="post-meta"> <time datetime="2016-07-30T08:30:51+08:00" itemprop="datePublished"> Jul 30, 2016 </time> • <time datetime="2018-06-02T22:24:29+08:00" itemprop="dateModified"> Jun 2, 2018 </time> • <span itemprop="author publisher" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">WillyPillow</span> </span> • <span itemprop="keywords"> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/tag/zh.html" rel="tag">zh</a>, <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/tag/en.html" rel="tag">en</a>, <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/tag/cpp.html" rel="tag">cpp</a>, <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/tag/competitive-coding.html" rel="tag">competitive-coding</a></span> • <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/sigs/posts/2016-07-30-c-c-io.md.asc"> Signature </a></p></header><div itemprop="articleBody text"><p>你可能聽說 <code>iostream</code> (cout/cin) 比 <code>cstdio</code> (printf/scanf) 慢，但實際上關閉同步後，前者比後者快上不少。還有，以 <code>'\n'</code> 取代 endl 也會使速度大幅加快。<br /> You might have heard that <code>iostream</code> (cout/cin) is slower than <code>cstdio</code> (printf/scanf). However, once you disable synchronization, the former is actually quite faster. Replacing <code>endl</code> with <code>'\n'</code> also increases the speed.</p><pre><code class="language-cpp">std::cin.tie(0);
std::ios_base::sync_with_stdio(0);
</code></pre><h2 id="詳細解釋-explanation">詳細解釋 Explanation</h2><h3 id="cintie">cin.tie</h3><p>一般來說，為了確保使用者在輸入資料時看見 prompt，會在呼叫 <code>cin</code> 前清除 <code>cout</code> 的 buffer。但對於解題來說，這樣反而會降低速度。因此，便可以使用此函式 untie 這兩者的關係。<br /> Normally, to ensure that the user sees the prompt before entering data, the buffer of <code>cout</code> is cleared before calling <code>cin</code>. However, for competitive programming, this makes the program slower. Thus, this function can be used to untie the two.</p><h3 id="sync_with_stdio">sync_with_stdio</h3><p>在預設設定下，為了避免 <code>iostream</code> 和 <code>cstdio</code> 發生 <a href="https://zh.wikipedia.org/zh-tw/%E7%AB%B6%E7%88%AD%E5%8D%B1%E5%AE%B3">race condition (Zh)</a>，會將 stream 設為同步。若不需要同時使用這二者，也可以將其關閉，以換取執行效率。<br /> With the default settings, to stop <a href="https://en.wikipedia.org/wiki/Race_condition">race conditions (En)</a> between <code>iostream</code> and <code>cstdio</code> from occurring, the streams are set as synchronized. If you don’t need to use the two in the same program, you can disable it to get better performance.</p><h3 id="endl">endl</h3><p>很多人會把 <code>endl</code> 作為 <code>'\n'</code> 的替代品，但實際上前者會強制清除 buffer，而這種行為是很少需要的。因此，用後者取代也會帶來不小的效能進步。<br /> Many take <code>endl</code> as an alternative to <code>'\n'</code>, but the former flushes the buffer, which is seldom needed. Thus, replacing it with the latter also brings a decent boost in performance.</p><h2 id="benchmark">Benchmark</h2><p>詳細 benchmark 請看：<br /> <a href="https://bitbucket.org/snippets/WillyPillow/My4qd">Link to benchmark</a></p><p>除此之外，也附上極度優化版的比較：<br /> <a href="https://bitbucket.org/snippets/WillyPillow/7KGXn">Link to extremely optimized version</a></p><p>以上程式 compile flags 與 UVa C++11 相同。<br /> The code above is compiled with the same flags as UVa C++11.</p></div><div><h1>Related Posts</h1><ul><li> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/08/12/uva108-maximum-sum.html"> UVa108: Maximum Sum </a><li> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/08/12/uva10696-f91.html"> UVa10696: f91 </a><li> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/08/12/uva10298-power-strings.html"> UVa10298: Power Strings </a><li> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/08/12/uva455-periodic-strings.html"> UVa455: Periodic Strings </a><li> <a href="/1ncvmoP187AuEQkBsJHqEq8qcK1zcL2A9/2016/08/09/uva299-train-swapping.html"> UVa299: Train Swapping </a></ul></div><div><h1><span itemprop="commentCount">0</span> comments</h1><h2>Post a comment</h2><p> Send an email to <a href="mailto:comment@nerde.pw">comment@nerde.pw</a>.</p></div></article></main><footer itemscope itemtype="http://schema.org/Person"><ul><li itemprop="name">WillyPillow<li><a itemprop="email" href="mailto:wp@nerde.pw">wp@nerde.pw</a><li> Gitlab: <a href="https://gitlab.com/willypillow">WillyPillow</a><li> BitBucket: <a href="https://bitbucket.org/WillyPillow">WillyPillow</a><li> Github: <a href="https://github.com/WillyPillow">WillyPillow</a><li> Diaspora*: <a href="https://diasporing.ch/people/7abf8850bce50134011e7a163e59d8f4">WillyPillow</a><li> Reddit: <a href="https://www.reddit.com/user/WillyPillow/">WillyPillow</a><li>Bitcoin: 15ii2SMbgZSyzKxVSYwim7KtT2uqdSdjVm<li>Namecoin: NES89UkGDutphGbVYNUkGkQuRGs6vFQk6h</ul></footer>
