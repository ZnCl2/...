{"next_paste_id":27,"next_comment_id":0,"paste":[{"paste_id":1,"description":"提问的智慧md源码","body":"#提问的智慧\n\n**How To Ask Questions The Smart Way**\n\nCopyright © 2001,2006,2014 Eric S. Raymond, Rick Moen\n\n本指南英文版版权为 Eric S. Raymond, Rick Moen 所有。\n\n原文网址:[http://www.catb.org/~esr/faqs/smart-questions.html](http://www.catb.org/~esr/faqs/smart-questions.html)\n\nCopyleft 2001 by D.H.Grand(nOBODY/Ginux), 2010 by Gasolin, 2015 by Ryan Wu\n\n本中文指南是基于原文 3.10 版以及 2010 年由 [Gasolin](https://github.com/gasolin) 所翻译版本的最新翻译；\n\n协助指出翻译问题，__请[发Issue](https://github.com/ryanhanwu/smartquestions/issues/new)，或直接[发Pull Request](https://github.com/ryanhanwu/smartquestions/compare/)给我。__\n\n项目地址： https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way\n\n本文另有简体中文版: [https://github.com/FredWe/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md](https://github.com/FredWe/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md)\n\n## [原文版本历史](https://github.com/ryanhanwu/smartquestions/blob/master/history.md)\n\n（本文ZeroNet版目录化由markdown-pp工具生成，具体看[这篇帖子](http://127.0.0.1:43110/gfwtalk.bit/?Topic:34_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ)，markdown源码在[这里](http://127.0.0.1:43110/17iF64gTLycSohUSJsFyq7FMYsQfMqghJa/?13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ_1)）\n##目录\n* [1\\. 声明](#1-)\n* [2\\. 简介](#2-)\n* [3\\. 在提问之前](#3-)\n* [4\\. 当你提问时](#4-)\n  * [4.1\\. 慎选提问的论坛](#4-1-)\n  * [4.2\\. Stack Overflow](#4-2-stack-overflow)\n  * [4.3\\. 网站和IRC论坛](#4-3-irc-)\n  * [4.4\\. 第二步，使用项目邮件列表](#4-4-)\n  * [4.5\\. 使用有意义且描述明确的标题](#4-5-)\n  * [4.6\\. 使问题容易回复](#4-6-)\n  * [4.7\\. 用清晰、正确、精准并语法正确的语句](#4-7-)\n  * [4.8\\. 使用易于读取且标准的文件格式发送问题](#4-8-)\n  * [4.9\\. 精确的描述问题并言之有物](#4-9-)\n  * [4.10\\. 话不在多而在精](#4-10-)\n  * [4.11\\. 别动辄声称找到Bug](#4-11-bug)\n  * [4.12\\. 可以低声下气，但还是要先做功课](#4-12-)\n  * [4.13\\. 描述问题症状而非猜测](#4-13-)\n  * [4.14\\. 按发生时间先后列出问题症状](#4-14-)\n  * [4.15\\. 描述目标而不是过程](#4-15-)\n  * [4.16\\. 别要求使用私人电邮回复](#4-16-)\n  * [4.17\\. 清楚明确的表达你的问题以及需求](#4-17-)\n  * [4.18\\. 询问有关代码的问题时](#4-18-)\n  * [4.19\\. 别把自己家庭作业的问题贴上来](#4-19-)\n  * [4.20\\. 去掉无意义的提问句](#4-20-)\n  * [4.21\\. 即使你很急也不要在标题写```紧急```](#4-21-)\n  * [4.22\\. 礼多人不怪，而且有时还很有帮助](#4-22-)\n  * [4.23\\. 问题解决后，加个简短的补充说明](#4-23-)\n* [5\\. 如何解读答案](#5-)\n  * [5.1\\. RTFM和STFW：如何知道你已完全搞砸了](#5-1-rtfm-stfw-)\n  * [5.2\\. 如果还是搞不懂](#5-2-)\n  * [5.3\\. 处理无礼的回应](#5-3-)\n* [6\\. 如何避免扮演失败者](#6-)\n* [7\\. 不该问的问题](#7-)\n* [8\\. 好问题与蠢问题](#8-)\n* [9\\. 如果得不到回答](#9-)\n* [10\\. 如何更好地回答问题](#10-)\n* [11\\. 相关资源](#11-)\n* [12\\. 鸣谢](#12-)\n\n\n\n# 1\\. 声明\n\n许多项目在他们的使用协助/说明网页中链接了本指南，这么做很好，我们也鼓励大家都这么做。但如果你是负责管理这个项目网页的人，请在超链接附近的显着位置上注明：\n\n__本指南不提供此项目的实际支持服务！__\n\n我们已经深刻领教到少了上述声明所带来的痛苦。因为少了这点声明，我们不停地被一些白痴纠缠。这些白痴认为既然我们发布了这本指南，那么我们就有责任解决世上所有的技术问题。\n\n如果你是因为需要某些协助而正在阅读这本指南，并且最后离开是因为发现从本指南作者们身上得不到直接的协助，那么你就是我们所说的那些白痴之一。别问我们问题，我们只会忽略你。我们在这本指南中是教你如何从那些真正懂得你所遇到软件或硬件问题的人取得协助，而99%的情况下那不会是我们。除非你确定本指南的作者之一刚好是你所遇到的问题领域的专家，否则请不要打扰我们，这样大家都会开心一点。\n\n# 2\\. 简介\n\n在[黑客](http://www.catb.org/~esr/faqs/hacker-howto.html)的世界里，当你拋出一个技术问题时，最终是否能得到有用的回答，往往取决于你所提问和追问的方式。本指南将教你如何正确的提问以获得你满意的答案。\n\n不只是黑客，现在开放源代码（Open Source）软件已经相当盛行，你常常也可以由其他有经验的使用者身上得到好答案，这是件**_好事_**；使用者比起黑客来，往往对那些新手常遇到的问题更宽容一些。然而，将有经验的使用者视为黑客，并采用本指南所提的方法与他们沟通，同样也是能从他们身上得到满意回答的最有效方式。\n\n首先你应该明白，黑客们喜爱有挑战性的问题，或者能激发我们思维的好问题。如果我们并非如此，那我们也不会成为你想询问的对象。如果你给了我们一个值得反复咀嚼玩味的好问题，我们自会对你感激不尽。好问题是激励，是厚礼。好问题可以提高我们的理解力，而且通常会暴露我们以前从没意识到或者思考过的问题。对黑客而言，\"好问题！\"是诚挚的大力称赞。\n\n尽管如此，黑客们有着蔑视或傲慢面对简单问题的坏名声，这有时让我们看起来对新手、无知者似乎较有敌意，但其实不是那样的。\n\n我们不讳言我们对那些不愿思考、或者在发问前不做他们该做的事的人的蔑视。那些人是时间杀手 -– 他们只想索取，从不付出，消耗我们可用在更有趣的问题或更值得回答的人身上的时间。我们称这样的人为 ```失败者（撸瑟）``` （由于历史原因，我们有时把它拼作 ```lusers```）。\n\n我们意识到许多人只是想使用我们写的软件，他们对学习技术细节没有兴趣。对大多数人而言，电脑只是种工具，是种达到目的的手段而已。他们有自己的生活并且有更要紧的事要做。我们了解这点，也从不指望每个人都对这些让我们着迷的技术问题感兴趣。尽管如此，我们回答问题的风格是指向那些真正对此有兴趣并愿意主动参与解决问题的人，这一点不会变，也不该变。如果连这都变了，我们就是在降低做自己最擅长的事情上的效率。\n\n我们（在很大程度上）是自愿的，从繁忙的生活中抽出时间来解答疑惑，而且时常被提问淹没。所以我们无情的滤掉一些话题，特别是拋弃那些看起来像失败者的家伙，以便更高效的利用时间来回答```赢家（winner）```的问题。\n\n如果你厌恶我们的态度，高高在上，或过于傲慢，不妨也设身处地想想。我们并没有要求你向我们屈服 -- 事实上，我们大多数人非常乐意与你平等地交流，只要你付出小小努力来满足基本要求，我们就会欢迎你加入我们的文化。但让我们帮助那些不愿意帮助自己的人是没有效率的。无知没有关系，但装白痴就是不行。\n\n所以，你不必在技术上很在行才能吸引我们的注意，但你必须表现出能引导你变得在行的特质 -- 机敏、有想法、善于观察、乐于主动参与解决问题。如果你做不到这些使你与众不同的事情，我们建议你花点钱找家商业公司签个技术支持服务合同，而不是要求黑客个人无偿地帮助你。\n\n如果你决定向我们求助，当然你也不希望被视为失败者，更不愿成为失败者中的一员。能立刻得到快速并有效答案的最好方法，就是像赢家那样提问 -- 聪明、自信、有解决问题的思路，只是偶尔在特定的问题上需要获得一点帮助。\n\n（欢迎对本指南提出改进意见。你可以 email 你的建议至 [esr@thyrsus.com](esr@thyrsus.com) 或 [respond-auto@linuxmafia.com](respond-auto@linuxmafia.com)。然而请注意，本文并非[网络礼节](http://www.ietf.org/rfc/rfc1855.txt)的通用指南，而我们通常会拒绝无助于在技术论坛得到有用答案的建议。）\n\n# 3\\. 在提问之前\n\n在你准备要通过电子邮件、新闻群组或者聊天室提出技术问题前，请先做到以下事情：\n\n1. 尝试在你准备提问的论坛的旧文章中搜索答案。\n2. 尝试上网搜索以找到答案。\n3. 尝试阅读手册以找到答案。\n4. 尝试阅读常见问题文件（FAQ）以找到答案。\n5. 尝试自己检查或试验以找到答案\n6. 向你身边的强者朋友打听以找到答案。\n7. 如果你是程序开发者，请尝试阅读源代码以找到答案\n\n当你提出问题的时候，请先表明你已经做了上述的努力；这将有助于树立你并不是一个不劳而获且浪费别人的时间的提问者。如果你能一并表达在做了上述努力的过程中所**_学到_**的东西会更好，因为我们更乐于回答那些表现出能从答案中学习的人的问题。\n\n运用某些策略，比如先用Google搜索你所遇到的各种错误信息（既搜索[Google论坛](http://groups.google.com/)，也搜索网页），这样很可能直接就找到了能解决问题的文件或邮件列表线索。即使没有结果，在邮件列表或新闻组寻求帮助时加上一句 ```我在Google中搜过下列句子但没有找到什么有用的东西``` 也是件好事，即使它只是表明了搜索引擎不能提供哪些帮助。这么做（加上搜索过的字串）也让遇到相似问题的其他人能被搜索引擎引导到你的提问来。\n\n别着急，不要指望几秒钟的Google搜索就能解决一个复杂的问题。在向专家求助之前，再阅读一下常见问题文件（FAQ）、放轻松、坐舒服一些，再花点时间思考一下这个问题。相信我们，他们能从你的提问看出你做了多少阅读与思考，如果你是有备而来，将更有可能得到解答。不要将所有问题一股脑拋出，只因你的第一次搜索没有找到答案（或者找到太多答案）。\n\n准备好你的问题，再将问题仔细的思考过一遍，因为草率的发问只能得到草率的回答，或者根本得不到任何答案。越是能表现出在寻求帮助前你为解决问题所付出的努力，你越有可能得到实质性的帮助。\n\n小心别问错了问题。如果你的问题基于错误的假设，某个普通黑客（J. Random Hacker）多半会一边在心里想着```蠢问题…```， 一边用无意义的字面解释来答复你，希望着你会从问题的回答（而非你想得到的答案）中汲取教训。\n\n绝不要自以为**_够格_**得到答案，你没有；你并没有。毕竟你没有为这种服务支付任何报酬。你将会是自己去**_挣到_**一个答案，靠提出有内涵的、有趣的、有思维激励作用的问题 --一个有潜力能贡献社区经验的问题，而不仅仅是被动的从他人处索取知识。\n\n另一方面，表明你愿意在找答案的过程中做点什么是一个非常好的开端。```谁能给点提示？```、```我的这个例子里缺了什么？```以及```我应该检查什么地方```比```请把我需要的确切的过程贴出来```更容易得到答复。因为你表现出只要有人能指个正确方向，你就有完成它的能力和决心。\n\n# 4\\. 当你提问时\n\n## 4.1\\. 慎选提问的论坛\n\n小心选择你要提问的场合。如果你做了下述的事情，你很可能被忽略掉或者被看作失败者：\n\n* 在与主题不合的论坛上贴出你的问题\n* 在探讨进阶技术问题的论坛张贴非常初级的问题；反之亦然\n* 在太多的不同新闻群组上重复转贴同样的问题（cross-post）\n* 向既非熟人也没有义务解决你问题的人发送私人电邮\n\n黑客会剔除掉那些搞错场合的问题，以保护他们沟通的渠道不被无关的东西淹没。你不会想让这种事发生在自己身上的。\n\n因此，第一步是找到对的论坛。再说一次，Google和其它搜索引擎还是你的朋友，用它们来找到与你遭遇到困难的软硬件问题最相关的网站。通常那儿都有常见问题（FAQ）、邮件列表及相关说明文件的链接。如果你的努力（包括**_阅读_**FAQ）都没有结果，网站上也许还有报告Bug（Bug-reporting）的流程或链接，如果是这样，连过去看看。\n\n向陌生的人或论坛发送邮件最可能是风险最大的事情。举例来说，别假设一个提供丰富内容的网页的作者会想充当你的免费顾问。不要对你的问题是否会受到欢迎做太乐观的估计 -- 如果你不确定，那就向别处发送，或者压根别发。\n\n在选择论坛、新闻群组或邮件列表时，别太相信名字，先看看FAQ或者许可书以弄清楚你的问题是否切题。发文前先翻翻已有的话题，这样可以让你感受一下那里的文化。事实上，事先在新闻组或邮件列表的历史记录中搜索与你问题相关的关键词是个极好的主意，也许这样就找到答案了。即使没有，也能帮助你归纳出更好的问题。\n\n别像机关枪似的一次\"扫射\"所有的帮助渠道，这就像大喊大叫一样会使人不快。要一个一个地来。\n\n搞清楚你的主题！最典型的错误之一是在某种致力于跨平台可移植的语言、套件或工具的论坛中提关于Unix或Windows操作系统程序界面的问题。如果你不明白为什么这是大错，最好在搞清楚这之间差异之前什么也别问。\n\n一般来说，在仔细挑选的公共论坛中提问，会比在私有论坛中提同样的问题更容易得到有用的回答。有几个理由可以支持这点，一是看潜在的回复者有多少，二是看观众有多少。黑客较愿意回答那些能帮助到许多人的问题。\n\n可以理解的是，老练的黑客和一些热门软件的作者正在接受过多的错发信息。就像那根最后压垮骆驼背的稻草一样，你的加入也有可能使情况走向极端 -- 已经好几次了，一些热门软件的作者从自己软件的支持中抽身出来，因为伴随而来涌入其私人邮箱的无用邮件变得无法忍受。\n\n## 4.2\\. Stack Overflow\n\n搜索，**_然后_** 在 Stack Exchange 问。\n\n近年来，Stack Exchange community 社区已经成为回答技术及其他问题的主要渠道，尤其是那些开放源码的项目。\n\n因为 Google 索引是即时的，在看 Stack Exchange 之前先在 Google 搜索。有很高的机率某人已经问了一个类似的问题，而且 Stack Exchange 网站们往往会是搜索结果中最前面几个。如果你在 Google 上没有找到任何答案，你再到特定相关主题的网站去找。用标签（Tag）搜索能让你更缩小你的搜索结果。\n\nStack Exchange 已经成长到[超过一百个网站](http://stackexchange.com/sites)，以下是最常用的几个站：\n\n* Super User 是问一些通用的电脑问题，如果你的问题跟代码或是写程序无关，只是一些网络连线之类的，请到这里。\n* Stack Overflow 是问写程序有关的问题。\n* Server Fault 是问服务器和网管相关的问题。\n\n## 4.3\\. 网站和IRC论坛\n\n本地的使用者群组（user group），或者你所用的 Linux 发行版本也许正在宣传他们的网页论坛或 IRC 频道，并提供新手帮助（在一些非英语国家，新手论坛很可能还是邮件列表）， 这些地方是开始提问的好首选，特别是当你觉得遇到的也许只是相对简单或者很普通的问题时。经过宣传的 IRC 频道是公开欢迎提问的地方，通常可以即时得到回应。\n\n事实上，如果程序出的问题只发生在特定 Linux 发行版提供的版本（这很常见），最好先去该发行版的论坛或邮件列表中提问，再到程序本身的论坛或邮件列表提问。（否则）该项目的黑客可能仅仅回复 \"用**_我们的_**版本\"。\n\n在任何论坛发文以前，先确认一下有没有搜索功能。如果有，就试着搜索一下问题的几个关键词，也许这会有帮助。如果在此之前你已做过通用的网页搜索（你也该这样做），还是再搜索一下论坛，搜索引擎有可能没来得及索引此论坛的全部内容。\n\n通过论坛或 IRC 频道来提供使用者支持服务有增长的趋势，电子邮件则大多为项目开发者间的交流而保留。所以最好先在论坛或 IRC 中寻求与该项目相关的协助。\n\n## 4.4\\. 第二步，使用项目邮件列表\n\n当某个项目提供开发者邮件列表时，要向列表而不是其中的个别成员提问，即使你确信他能最好地回答你的问题。查一查项目的文件和首页，找到项目的邮件列表并使用它。有几个很好的理由支持我们采用这种办法：\n\n* 任何好到需要向个别开发者提出的问题，也将对整个项目群组有益。反之，如果你认为自己的问题对整个项目群组来说太愚蠢，也不能成为骚扰个别开发者的理由。\n* 向列表提问可以分散开发者的负担，个别开发者（尤其是项目领导人）也许太忙以至于没法回答你的问题。\n* 大多数邮件列表都会被存档，那些被存档的内容将被搜索引擎索引。如果你向列表提问并得到解答，将来其它人可以通过网页搜索找到你的问题和答案，也就不用再次发问了。\n* 如果某些问题经常被问到，开发者可以利用此信息来改进说明文件或软件本身，以使其更清楚。如果只是私下提问，就没有人能看到最常见问题的完整场景。\n\n如果一个项目既有\"使用者\" 也有\"开发者\"（或\"黑客\"）邮件列表或论坛，而你又不会动到那些源代码，那么就向\"使用者\"列表或论坛提问。不要假设自己会在开发者列表中受到欢迎，那些人多半会将你的提问视为干扰他们开发的噪音。\n\n然而，如果你**_确信_**你的问题很特别，而且在\"使用者\" 列表或论坛中几天都没有回复，可以试试前往\"开发者\"列表或论坛发问。建议你在张贴前最好先暗地里观察几天以了解那里的行事方式（事实上这是参与任何私有或半私有列表的好主意）\n\n如果你找不到一个项目的邮件列表，而只能查到项目维护者的电子邮件地址，尽管向他发信。即使是在这种情况下，也别假设（项目）邮件列表不存在。在你的电子邮件中，请陈述你已经试过但没有找到合适的邮件列表，也提及你不反对将自己的邮件转发给他人（许多人认为，即使没什么秘密，私人电子邮件也不应该被公开。通过允许将你的电子邮件转发他人，你给了相应人员处置你邮件的选择）。\n\n## 4.5\\. 使用有意义且描述明确的标题\n\n在邮件列表、新闻群组或论坛中，大约50字以内的标题是抓住资深专家注意力的好机会。别用喋喋不休的```帮帮忙```、```跪求```、```急```（更别说```救命啊！！！！```这样让人反感的话，用这种标题会被条件反射式地忽略）来浪费这个机会。不要妄想用你的痛苦程度来打动我们，而是在这点空间中使用极简单扼要的描述方式来提出问题。\n\n一个好标题范例是```目标 -- 差异```式的描述，许多技术支持组织就是这样做的。在```目标```部分指出是哪一个或哪一组东西有问题，在```差异```部分则描述与期望的行为不一致的地方。\n\n\n> 蠢问题：救命啊！我的笔电不能正常显示了！\n\n> 聪明问题：X.org 6.8.1的鼠标游标会变形，某牌显卡 MV1005 芯片组。\n\n> 更聪明问题：X.org 6.8.1的鼠标游标，在某牌显卡 MV1005 芯片组环境下 - 会变形。\n\n编写```目标 -- 差异``` 式描述的过程有助于你组织对问题的细緻思考。是什么被影响了？ 仅仅是鼠标游标或者还有其它图形？只在 X.org 的 X 版中出现？或只是出现在6.8.1版中？ 是针对某牌显卡芯片组？或者只是其中的 MV1005 型号？ 一个黑客只需瞄一眼就能够立即明白你的环境**_和_**你遇到的问题。\n\n总而言之，请想像一下你正在一个只显示标题的存档讨论串（Thread）索引中查寻。让你的标题更好地反映问题，可使下一个搜索类似问题的人能够关注这个讨论串，而不用再次提问相同的问题。\n\n如果你想在回复中提出问题，记得要修改内容标题，以表明你是在问一个问题， 一个看起来像 ```Re: 测试``` 或者 ```Re: 新bug``` 的标题很难引起足够重视。另外，在不影响连贯性之下，适当引用并删减前文的内容，能给新来的读者留下线索。\n\n对于讨论串，不要直接点击回复来开始一个全新的讨论串，这将限制你的观众。因为有些邮件阅读程序，比如 mutt ，允许使用者按讨论串排序并通过折叠讨论串来隐藏消息，这样做的人永远看不到你发的消息。\n\n仅仅改变标题还不够。mutt 和其它一些邮件阅读程序还会检查邮件标题以外的其它信息，以便为其指定讨论串。所以宁可发一个全新的邮件。\n\n在网页论坛上，好的提问方式稍有不同，因为讨论串与特定的信息紧密结合，并且通常在讨论串外就看不到里面的内容，故通过回复提问，而非改变标题是可接受的。不是所有论坛都允许在回复中出现分离的标题，而且这样做了基本上没有人会去看。不过，通过回复提问，这本身就是暧昧的做法，因为它们只会被正在查看该标题的人读到。所以，除非你**_只想_**在该讨论串当前活跃的人群中提问，不然还是另起炉灶比较好。\n\n## 4.6\\. 使问题容易回复\n\n以```请将你的回复寄到……```来结束你的问题多半会使你得不到回答。如果你觉得花几秒钟在邮件客户端设置一下回复地址都麻烦，我们也觉得花几秒钟思考你的问题更麻烦。如果你的邮件程序不支持这样做，[换个好点的](http://linuxmafia.com/faq/Mail/muas.html)；如果是操作系统不支持这种邮件程序，也换个好点的。\n\n在论坛，要求通过电子邮件回复是非常无礼的，除非你相信回复的信息可能比较敏感（而且有人会为了某些未知的原因，只让你而不是整个论坛知道答案）。如果你只是想在有人回复讨论串时得到电子邮件提醒，可以要求网页论坛发送给你。几乎所有论坛都支持诸如```追踪此讨论串```、```有回复时发送邮件提醒```等功能。\n\n## 4.7\\. 用清晰、正确、精准并语法正确的语句\n\n我们从经验中发现，粗心的提问者通常也会粗心的写程序与思考（我敢打包票）。回答粗心大意者的问题很不值得，我们宁愿把时间耗在别处。\n\n正确的拼字、标点符号和大小写是很重要的。一般来说，如果你觉得这样做很麻烦，不想在乎这些，那我们也觉得麻烦，不想在乎你的提问。花点额外的精力斟酌一下字句，用不着太僵硬与正式 -- 事实上，黑客文化很看重能准确地使用非正式、俚语和幽默的语句。但它**_必须很_**准确，而且有迹象表明你是在思考和关注问题。\n\n正确地拼写、使用标点和大小写，不要将```its```混淆为```it's```，```loose```搞成```lose```或者将```discrete```弄成```discreet```。不要**全部用大写**，这会被视为无礼的大声嚷嚷（全部小写也好不到哪去，因为不易阅读。[Alan Cox](http://en.wikipedia.org/wiki/Alan_Cox)也许可以这样做，但你不行。）\n\n更白话的说，如果你写得像是个半文盲[译注：[小白](http://zh.wikipedia.org/zh-tw/小白)]），那多半得不到理睬。也不要使用即时通讯中的简写或[火星文](http://zh.wikipedia.org/zh-tw/火星文)，如将```的```简化为```ㄉ```会使你看起来像一个为了少打几个键而省字的小白。更糟的是，如果像个小孩似地鬼画符那绝对是在找死，可以肯定没人会理你（或者最多是给你一大堆指责与挖苦）。\n\n如果在使用非母语的论坛提问，你可以犯点拼写和语法上的小错，但决不能在思考上马虎（没错，我们通常能弄清两者的分别）。同时，除非你知道回复者使用的语言，否则请使用英语书写。繁忙的黑客一般会直接删除用他们看不懂语言写的消息。在网络上英语是通用语言，用英语书写可以将你的问题在尚未被阅读就被直接删除的可能性降到最低。\n\n如果英文是你的外语（Second language），提示潜在回复者你有潜在的语言困难是很好的：\n[译注：以下附上原文以供使用]\n\n> English is not my native language; please excuse typing errors.\n\n* 英文不是我的母语，请原谅我的错字或语法\n\n\n> If you speak $LANGUAGE, please email/PM me;\n> I may need assistance translating my question.\n\n* 如果你说**某语言**，请寄信/私讯给我；我需要有人协助我翻译我的问题\n\n\n> I am familiar with the technical terms,\n> but some slang expressions and idioms are difficult for me.\n\n* 我对技术名词很熟悉，但对于俗语或是特别用法比较不甚了解。\n\n\n> I've posted my question in $LANGUAGE and English.\n> I'll be glad to translate responses, if you only use one or the other.\n\n* 我把我的问题用**某语言**和英文写出来，如果你只用一种语言回答，我会乐意将其翻译成另一种。\n\n## 4.8\\. 使用易于读取且标准的文件格式发送问题\n\n如果你人为地将问题搞得难以阅读，它多半会被忽略，人们更愿读易懂的问题，所以：\n\n* 使用纯文字而不是HTML ([关闭HTML](http://archive.birdhouse.org/etc/evilmail.html)并不难）\n* 使用MIME附件通常是可以的，前提是真正有内容（譬如附带的源代码或patch），而不仅仅是邮件程序生成的模板（譬如只是信件内容的拷贝）。\n* 不要发送一段文字只是单行句子但多次断行的邮件（这使得回复部分内容非常困难）。设想你的读者是在80个字符宽的终端机上阅读邮件，最好设置你的断行点小于80字。\n* 但是，也**_不要_**用任何固定断行资料（譬如日志档案拷贝或会话记录）。档案应该原样包含，让回复者有信心他们看到的是和你看到的一样的东西。\n* 在英语论坛中，不要使用```Quoted-Printable``` MIME编码发送消息。这种编码对于张贴非ASCII语言可能是必须的，但很多邮件程序并不支持这种编码。当它们分断时，那些文本中四处散布的```=20```符号既难看也分散注意力，甚至有可能破坏内容的语意。\n* 绝对，**_永远_**不要指望黑客们阅读使用封闭格式编写的文档，像是微软公司的Word或Excel文件等。大多数黑客对此的反应就像有人将还在冒热气的猪粪倒在你门口阶梯上时你的反应一样。即便他们能够处理，他们也很厌恶这么做。\n* 如果你从使用Windows的电脑发送电子邮件，关闭微软愚蠢的```智能引号```功能 （从[选项] > [校订] > [自动校正选项], 按掉```智能引号```单选框），以免在你的邮件中到处散布垃圾字符。\n* 在论坛，勿滥用```表情符号```和```HTML```功能（当它们提供时）。一两个表情符号通常没有问题，但花哨的彩色文本倾向于使人认为你是个无能之辈。过滥地使用表情符号、色彩和字体会使你看来像个傻笑的小姑娘。这通常不是个好主意，除非你只是对sex而不是有用的回复更有兴趣。\n\n如果你使用图形用户界面的邮件程序（如微软公司的Outlook或者其它类似的），注意它们的默认设置不一定满足这些要求。大多数这类程序有基于选单的```查看源代码```命令，用它来检查发送文件夹中的消息，以确保发送的是没有多餘杂质的纯文本文件。\n\n## 4.9\\. 精确的描述问题并言之有物\n\n* 仔细、清楚地描述你的问题或Bug的症状。\n* 描述问题发生的环境（机器配置、操作系统、应用程序、以及相关的信息），提供经销商的发行版和版本号（如：```Fedora Core 4```、```Slackware 9.1```等）。\n* 描述在提问前你是怎样去研究和理解这个问题的。\n* 描述在提问前为确定问题而采取的诊断步骤。\n* 描述最近做过什么可能相关的硬件或软件变更。\n* 尽可能的提供一个可以```重现这个问题的既定环境```的方法\n\n尽量去揣测一个黑客会怎样反问你，在他提问的时候预先给他答案。\n\n以上几点中，当你报告的是你认为可能在代码中的问题时，给黑客一个可以重现你的问题的环境尤其重要。当你这么做时，你得到有效的回答的机会和速度都会大大的提升。\n\n[Simon Tatham](http://www.chiark.greenend.org.uk/~sgtatham/)写过一篇名为《[如何有效的报告Bug](http://www.chiark.greenend.org.uk/~sgtatham/bugs-tw.html)》的出色文章。强力推荐你也读一读。\n\n## 4.10\\. 话不在多而在精\n\n你需要提供精确有内容的信息。这并不是要求你简单的把成堆的出错代码或者资料完全转录到你的提问中。如果你有庞大而复杂的测试样例能重现程序挂掉的情境，尽量将它剪裁得越小越好。\n\n这样做的用处至少有三点。\n第一，表现出你为简化问题付出了努力，这可以使你得到回答的机会增加；\n第二，简化问题使你更有可能得到**_有用_**的答案；\n第三，在精炼你的bug报告的过程中，你很可能就自己找到了解决方法或权宜之计。\n\n## 4.11\\. 别动辄声称找到Bug\n\n当你在使用软件中遇到问题，除非你非常、**_非常_**的有根据，不要动辄声称找到了Bug。提示：除非你能提供解决问题的源代码补丁，或者对前一版本的回归测试表现出不正确的行为，否则你都多半不够完全确信。这同样适用在网页和文件，如果你（声称）发现了文件的```Bug```，你应该能提供相应位置的修正或替代文件。\n\n请记得，还有许多其它使用者没遇到你发现的问题，否则你在阅读文件或搜索网页时就应该发现了（你在抱怨前[已经做了这些，是吧](#12-)？）。这也意味着很有可能是你弄错了而不是软件本身有问题。\n\n编写软件的人总是非常辛苦地使它尽可能完美。如果你声称找到了Bug，也就是在质疑他们的能力，即使你是对的，也有可能会冒犯到其中某部分人。这尤其严重当你在标题中嚷嚷着有```Bug```。\n\n提问时，即使你私下非常确信已经发现一个真正的Bug，最好写得像是**_你_**做错了什么。如果真的有Bug，你会在回复中看到这点。这样做的话，如果真有Bug，维护者就会向你道歉，这总比你惹恼别人然后欠别人一个道歉要好一点。\n\n## 4.12\\. 可以低声下气，但还是要先做功课\n\n有些人明白他们不该粗鲁或傲慢的提问并要求得到答复，但他们选择另一个极端 -- 低声下气：```我知道我只是个可悲的新手，一个撸瑟，但...```。这既使人困扰，也没有用，尤其是伴随着与实际问题含糊不清的描述时更令人反感。\n\n别用原始灵长类动物的把戏来浪费你我的时间。取而代之的是，尽可能清楚地描述背景条件和你的问题情况。这比低声下气更好地定位了你的位置。\n\n有时网页论坛会设有专为新手提问的版面，如果你真的认为遇到了初学者的问题，到那去就是了，但一样别那么低声下气。\n\n## 4.13\\. 描述问题症状而非猜测\n\n告诉黑客们你认为问题是怎样造成的并没什么帮助。（如果你的推断如此有效，还用向别人求助吗？），因此要确信你原原本本告诉了他们问题的症状，而不是你的解释和理论；让黑客们来推测和诊断。如果你认为陈述自己的猜测很重要，清楚地说明这只是你的猜测，并描述为什么它们不起作用。\n\n***蠢问题***\n\n> 我在编译内核时接连遇到 SIG11 错误，\n> 我怀疑某条飞线搭在主板的走线上了，这种情况应该怎样检查最好？\n\n***聪明问题***\n> 我的组装电脑是 FIC-PA2007 主机板搭载 AMD K6/233 CPU（威盛 Apollo VP2芯片组），\n> 256MB Corsair PC133 SDRAM内存，在编译内核时，从开机20分钟以后就频频产生 SIG11 错误，\n> 但是在头20分钟内从没发生过相同的问题。重新启动也没有用，但是关机一晚上就又能工作20分钟。\n> 所有内存都换过了，没有效果。相关部分的标准编译记录如下…。\n\n由于以上这点似乎让许多人觉得难以配合，这里有句话可以提醒你：```所有的诊断专家都来自密苏里州。``` 美国国务院的官方座右铭则是：```让我看看```（出自国会议员 Willard D. Vandiver 在1899年时的讲话：```我来自一个出产玉米，棉花，牛蒡和民主党人的国家，滔滔雄辩既不能说服我，也不会让我满意。我来自密苏里州，你必须让我看看。```） 针对诊断者而言，这并不是一种怀疑，而只是一种真实而有用的需求，以便让他们看到的是与你看到的原始证据尽可能一致的东西，而不是你的猜测与归纳的结论。所以，大方的展示给我们看吧！\n\n## 4.14\\. 按发生时间先后列出问题症状\n\n问题发生前的一系列操作，往往就是对找出问题最有帮助的线索。因此，你的说明里应该包含你的操作步骤，以及机器和软件的反应，直到问题发生。在命令行处理的情况下，提供一段操作记录（例如运行脚本工具所生成的），并引用相关的若干行（如20行）记录会非常有帮助。\n\n如果挂掉的程序有诊断选项（如 -v 的详述开关），试着选择这些能在记录中增加调试信息的选项。记住，```多```不等于```好```。试着选取适当的调试级别以便提供有用的信息而不是让读者淹没在垃圾中。\n\n如果你的说明很长（如超过四个段落），在开头简述问题，接下来再按时间顺序详述会有所帮助。这样黑客们在读你的记录时就知道该注意哪些内容了。\n\n## 4.15\\. 描述目标而不是过程\n\n如果你想弄清楚如何做某事（而不是报告一个Bug），在开头就描述你的目标，然后才陈述重现你所卡住的特定步骤。\n\n经常寻求技术帮助的人在心中有个更高层次的目标，而他们在自以为能达到目标的特定道路上被卡住了，然后跑来问该怎么走，但没有意识到这条路本身就有问题。结果要费很大的劲才能搞定。\n\n**蠢问题**\n> 我怎样才能从某绘图程序的颜色选择器中取得十六进制的的RGB值？\n\n\n**聪明问题**\n> 我正试着用替换一幅图片的色码成自己选定的色码，我现在知道的唯一方法是编辑每个色码区块，\n> 但却无法从某绘图程序的颜色选择器取得十六进制的的RGB值。\n\n\n第二种提问法比较聪明，你可能得到像是```建议采用另一个更合适的工具```的回复。\n\n## 4.16\\. 别要求使用私人电邮回复\n\n黑客们认为问题的解决过程应该公开、透明，此过程中如果更有经验的人注意到不完整或者不当之处，最初的回复才能够、也应该被纠正。同时，作为提供帮助者也能因为能力和学识被其它同行看到而得到某种奖励。\n\n当你要求私下回复时，这个过程和奖励都被中止。别这样做，让**_回复者_**来决定是否私下回答 -- 如果他真这么做了，通常是因为他认为问题编写太差或者太肤浅，以至于对其它人没有兴趣。\n\n这条规则存在一条有限的例外，如果你确信提问可能会引来大量雷同的回复时，那么这个神奇的提问句会是```向我发电邮，我将为论坛归纳这些回复```。试着将邮件列表或新闻群组从洪水般的雷同回复中解救出来是非常有礼貌的 -- 但你必须信守诺言。\n\n## 4.17\\. 清楚明确的表达你的问题以及需求\n\n漫无边际的提问近乎无休无止的时间黑洞。最有可能给你有用答案的人通常也正是最忙的人（他们忙是因为要亲自完成大部分工作）。这样的人对无节制的时间黑洞相当厌恶，所以他们也倾向于厌恶那些漫无边际的提问。\n\n如果你明确表述需要回答者做什么（如提供指点、发送一段代码、检查你的补丁、或是其他等等），就最有可能得到有用的答案。因为这会定出一个时间和精力的上限，便于回答者能集中精力来帮你。这么做很棒。\n\n要理解专家们所处的世界，请把专业技能想像为充裕的资源，而回复的时间则是稀缺的资源。你要求他们奉献的时间越少，你越有可能从真正专业而且很忙的专家那里得到解答。\n\n所以，界定一下你的问题，使专家花在辨识你的问题和回答所需要付出的时间减到最少，这技巧对你有用答案相当有帮助 -- 但这技巧通常和简化问题有所区别。因此，问```我想更好的理解X，可否指点一下哪有好一点说明？```通常比问```你能解释一下X吗？```更好。如果你的代码不能运作，通常请别人看看哪里有问题，比要求别人替你改正要明智得多。\n\n## 4.18\\. 询问有关代码的问题时\n\n别要求他人帮你有问题的代码调试而不提示一下应该从何入手。张贴几百行的代码，然后说一声：```它不会动```会让你完全被忽略。只贴几十行代码，然后说一句：```在第七行以后，我期待它显示 <x>，但实际出现的是 <y>```比较有可能让你得到回应。\n\n最有效描述程序问题的方法是提供最精简的Bug展示测试示例（bug-demonstrating test case）。什么是最精简的测试示例? 那是问题的缩影；一小个程序片段能**刚好**展示出程序的异常行为，而不包含其他令人分散注意力的内容。怎么制作最精简的测试示例？如果你知道哪一行或哪一段代码会造成异常的行为，复制下来并加入足够重现这个状况的代码（例如，足以让这段代码能被编译/直译/被应用程序处理）。如果你无法将问题缩减到一个特定区块，就复制一份代码并移除不影响产生问题行为的部分。总之，测试示例越小越好（查看[话不在多而在精](#12-)一节）。\n\n一般而言，要得到一段相当精简的测试示例并不太容易，但永远先尝试这样做的是种好习惯。这种方式可以帮助你了解如何自行解决这个问题 —- 而且即使你的尝试不成功，黑客们也会看到你在尝试取得答案的过程中付出了努力，这可以让他们更愿意与你合作。\n\n如果你只是想让别人帮忙审查（Review）一下代码，在信的开头就要说出来，并且一定要提到你认为哪一部分特别需要关注以及为什么。\n\n## 4.19\\. 别把自己家庭作业的问题贴上来\n\n黑客们很擅长分辨哪些问题是家庭作业式的问题；因为我们中的大多数都曾自己解决这类问题。同样，这些问题得由**_你_**来搞定，你会从中学到东西。你可以要求给点提示，但别要求得到完整的解决方案。\n\n如果你怀疑自己碰到了一个家庭作业式的问题，但仍然无法解决，试试在使用者群组，论坛或（最后一招）在项目的**使用者**邮件列表或论坛中提问。尽管黑客们**_会_**看出来，但一些有经验的使用者也许仍会给你一些提示。\n\n## 4.20\\. 去掉无意义的提问句\n\n避免用无意义的话结束提问，例如```有人能帮我吗？```或者```这有答案吗？```。\n\n首先：如果你对问题的描述不是很好，这样问更是画蛇添足。\n\n其次：由于这样问是画蛇添足，黑客们会很厌烦你 -- 而且通常会用逻辑上正确，但毫无意义的回答来表示他们的蔑视， 例如：```没错，有人能帮你```或者```不，没答案```。\n\n一般来说，避免用 ```是或否```、```对或错```、```有或没有```类型的问句，除非你想得到[是或否类型的回答](http://homepage.ntlworld.com./jonathan.deboynepollard/FGA/questions-with-yes-or-no-answers.html)。\n\n## 4.21\\. 即使你很急也不要在标题写```紧急```\n\n这是你的问题，不是我们的。宣称```紧急```极有可能事与愿违：大多数黑客会直接删除无礼和自私地企图即时引起关注的问题。更严重的是，```紧急```这个字（或是其他企图引起关注的标题）通常会被垃圾信过滤器过滤掉 -- 你希望能看到你问题的人可能永远也看不到。\n\n有半个例外的情况是，如果你是在一些很高调，会使黑客们兴奋的地方，也许值得这样去做。在这种情况下，如果你有时间压力，也很有礼貌地提到这点，人们也许会有兴趣回答快一点。\n\n当然，这风险很大，因为黑客们兴奋的点多半与你的不同。譬如从 NASA 国际空间站（International Space Station）发这样的标题没有问题，但用自我感觉良好的慈善行为或政治原因发肯定不行。事实上，张贴诸如```紧急：帮我救救这个毛绒绒的小海豹！```肯定让你被黑客忽略或惹恼他们，即使他们认为毛绒绒的小海豹很重要。\n\n如果你觉得这点很不可思议，最好再把这份指南剩下的内容多读几遍，直到你弄懂了再发文。\n\n## 4.22\\. 礼多人不怪，而且有时还很有帮助\n\n彬彬有礼，多用```请```和```谢谢您的关注```，或```谢谢你的关照```。让大家都知道你对他们花时间免费提供帮助心存感激。\n\n坦白说，这一点并没有比清晰、正确、精准并合法语法和避免使用专用格式重要（也不能取而代之）。黑客们一般宁可读有点唐突但技术上鲜明的Bug报告，而不是那种有礼但含糊的报告。（如果这点让你不解，记住我们是按问题能教我们什么来评价问题的价值的）\n\n然而，如果你有一串的问题待解决，客气一点肯定会增加你得到有用回应的机会。\n\n（我们注意到，自从本指南发布后，从资深黑客那里得到的唯一严重缺陷反馈，就是对预先道谢这一条。一些黑客觉得```先谢了```意味着事后就不用再感谢任何人的暗示。我们的建议是要么先说```先谢了```，**_然后_**事后再对回复者表示感谢，或者换种方式表达感激，譬如用```谢谢你的关注```或```谢谢你的关照```。）\n\n## 4.23\\. 问题解决后，加个简短的补充说明\n\n问题解决后，向所有帮助过你的人发个说明，让他们知道问题是怎样解决的，并再一次向他们表示感谢。如果问题在新闻组或者邮件列表中引起了广泛关注，应该在那里贴一个说明比较恰当。\n\n最理想的方式是向最初提问的话题回复此消息，并在标题中包含```已修正```，```已解决```或其它同等含义的明显标记。在人来人往的邮件列表里，一个看见讨论串```问题 X```和```问题的X - 已解决```的潜在回复者就明白不用再浪费时间了（除非他个人觉得```问题 X```的有趣），因此可以利用此时间去解决其它问题。\n\n补充说明不必很长或是很深入；简单的一句```你好，原来是网线出了问题！谢谢大家 – Bill```比什么也不说要来的好。事实上，除非结论真的很有技术含量，否则简短可爱的小结比长篇大论更好。说明问题是怎样解决的，但大可不必将解决问题的过程复述一遍。\n\n对于有深度的问题，张贴调试记录的摘要是有帮助的。描述问题的最终状态，说明是什么解决了问题，在此**_之后_**才指明可以避免的盲点。避免盲点的部分应放在正确的解决方案和其它总结材料之后，而不要将此信息搞成侦探推理小说。列出那些帮助过你的名字，会让你交到更多朋友。\n\n除了有礼貌和有内涵以外，这种类型的补充也有助于他人在邮件列表/新闻群组/论坛中搜索到真正解决你问题的方案，让他们也从中受益。\n\n至少，这种补充有助于让每位参与协助的人因问题的解决而从中得到满足感。如果你自己不是技术专家或者黑客，那就相信我们，这种感觉对于那些你向他们求助的大师或者专家而言，是非常重要的。问题悬而未决会让人灰心；黑客们渴望看到问题被解决。好人有好报，满足他们的渴望，你会在下次提问时尝到甜头。\n\n思考一下怎样才能避免他人将来也遇到类似的问题，自问写一份文件或加个常见问题（FAQ）会不会有帮助。如果是的话就将它们发给维护者。\n\n在黑客中，这种良好的后继行动实际上比传统的礼节更为重要，也是你如何透过善待他人而赢得声誉的方式，这是非常有价值的资产。\n\n# 5\\. 如何解读答案\n\n\n## 5.1\\. RTFM和STFW：如何知道你已完全搞砸了\n\n有一个古老而神圣的传统：如果你收到```RTFM （Read The Fucking Manual）```的回应，回答者认为你**应该去读他妈的手册**。当然，基本上他是对的，你应该去读一读。\n\nRTFM 有一个年轻的亲戚。如果你收到```STFW（Search The Fucking Web）```的回应，回答者认为你**应该到他妈的网上搜索**过了。那人多半也是对的，去搜索一下吧。（更温和一点的说法是 **[Google是你的朋友](http://lmgtfy.com/)**！）\n\n在论坛，你也可能被要求去爬爬论坛的旧文。事实上，有人甚至可能热心地为你提供以前解决此问题的讨论串。但不要依赖这种关照，提问前应该先搜索一下旧文。\n\n通常，用这两句之一回答你的人会给你一份包含你需要内容的手册或者一个网址，而且他们打这些字的时候也正在读着。这些答复意味着回答者认为\n\n* **你需要的信息非常容易获得**；\n* **你自己去搜索这些信息比灌给你能让你学到更多**。\n\n你不应该因此不爽；**依照黑客的标准，他已经表示了对你一定程度的关注，而没有对你的要求视而不见**。你应该对他祖母般的慈祥表示感谢。\n\n## 5.2\\. 如果还是搞不懂\n\n如果你看不懂回应，别立刻要求对方解释。像你以前试着自己解决问题时那样（利用手册，FAQ，网络，身边的高手），先试着去搞懂他的回应。如果你真的需要对方解释，记得表现出你已经从中学到了点什么。\n\n比方说，如果我回答你：```看来似乎是 zentry 卡住了；你应该先清除它。```，然后，这是一个**_很糟的_**后续问题回应：```zentry是什么？``` **_好_**的问法应该是这样：```哦~~~我看过说明了但是只有 -z 和 -p 两个参数中提到了 zentries，而且还都没有清楚的解释如何清除它。你是指这两个中的哪一个吗？还是我看漏了什么？```\n\n## 5.3\\. 处理无礼的回应\n\n很多黑客圈子中看似无礼的行为并不是存心冒犯。相反，它是直接了当，一针见血式的交流风格，这种风格更注重解决问题，而不是使人感觉舒服而却模模糊糊。\n\n如果你觉得被冒犯了，试着平静地反应。如果有人真的做了出格的事，邮件列表、新闻群组或论坛中的前辈多半会招呼他。如果这**_没有_**发生而你却发火了，那么你发火对象的言语可能在黑客社区中看起来是正常的，而**_你_**将被视为有错的一方，这将伤害到你获取信息或帮助的机会。\n\n另一方面，你偶而真的会碰到无礼和无聊的言行。与上述相反，对真正的冒犯者狠狠地打击，用犀利的语言将其驳得体无完肤都是可以接受的。然而，在行事之前一定要非常非常的有根据。纠正无礼的言论与开始一场毫无意义的口水战仅一线之隔，黑客们自己莽撞地越线的情况并不鲜见。如果你是新手或外人，避开这种莽撞的机会并不高。如果你想得到的是信息而不是消磨时光，这时最好不要把手放在键盘上以免冒险。\n\n（有些人断言很多黑客都有轻度的自闭症或亚斯伯格综合症，缺少用于润滑人类社会**正常**交往所需的神经。这既可能是真也可能是假的。如果你自己不是黑客，兴许你认为我们脑袋有问题还能帮助你应付我们的古怪行为。只管这么干好了，我们不在乎。我们**_喜欢_**我们现在这个样子，并且通常对病患标记都有站得住脚的怀疑。）\n\n在下一节，我们会谈到另一个问题，当**_你_**行为不当时所会受到的```冒犯```。\n\n# 6\\. 如何避免扮演失败者\n\n在黑客社区的论坛中有那么几次你可能会搞砸 -- 以本指南所描述到的或类似的方式。而你会在公开场合中被告知你是如何搞砸的，也许攻击的言语中还会带点夹七夹八的颜色。\n\n这种事发生以后，你能做的最糟糕的事莫过于哀嚎你的遭遇、宣称被口头攻击、要求道歉、高声尖叫、憋闷气、威胁诉诸法律、向其雇主报怨、忘了关马桶盖等等。相反地，你该这么做：\n\n熬过去，这很正常。事实上，它是有益健康且合理的。\n\n社区的标准不会自行维持，它们是通过参与者积极而**_公开地_**执行来维持的。不要哭嚎所有的批评都应该通过私下的邮件传送，它不是这样运作的。当有人评论你的一个说法有误或者提出不同看法时，坚持声称受到个人攻击也毫无益处，这些都是失败者的态度。\n\n也有其它的黑客论坛，受过高礼节要求的误导，禁止参与者张贴任何对别人帖子挑毛病的消息，并声称```如果你不想帮助用户就闭嘴。``` 结果造成有想法的参与者纷纷离开，这么做只会使它们沦为毫无意义的嘮叨与无用的技术论坛。\n\n夸张的讲法是：你要的是**友善**（以上述方式）还是有用？两个里面挑一个。\n\n记着：当黑客说你搞砸了，并且（无论多么刺耳）告诉你别再这样做时，他正在为关心**你**和**他的社区**而行动。对他而言，不理你并将你从他的生活中滤掉更简单。如果你无法做到感谢，至少要表现地有点尊严，别大声哀嚎，也别因为自己是个有戏剧性超级敏感的灵魂和自以为有资格的新来者，就指望别人像对待脆弱的洋娃娃那样对你。\n\n有时候，即使你没有搞砸（或者只是在他的想像中你搞砸了），有些人也会无缘无故地攻击你本人。在这种情况下，抱怨倒是**_真的_**会把问题搞砸。\n\n这些来找麻烦的人要么是毫无办法但自以为是专家的不中用家伙，要么就是测试你是否真会搞砸的心理专家。其它读者要么不理睬，要么用自己的方式对付他们。这些来找麻烦的人在给他们自己找麻烦，这点你不用操心。\n\n也别让自己卷入口水战，最好不要理睬大多数的口水战 -- 当然，是在你检验它们只是口水战，而并未指出你有搞砸的地方，且也没有巧妙地将问题真正的答案藏于其后（这也是有可能的）。\n\n# 7\\. 不该问的问题\n\n以下是几个经典蠢问题，以及黑客没回答时心中所想的：\n\n\n---\n\n\n> 问题：我能在哪找到 X 程序或 X 资源？\n\n回答：就在我找到它的地方啊，白痴 -- 搜索引擎的那一头。天哪！难道还有人不会用 [Google](http://www.google.com) 吗？\n\n\n> 问题：我怎样用 X 做 Y？\n\n回答：如果你想解决的是 Y ，提问时别给出可能并不恰当的方法。这种问题说明提问者不但对 X 完全无知，也对 Y 要解决的问题糊涂，还被特定形势禁锢了思维。最好忽略这种人，等他们把问题搞清楚了再说。\n\n\n> 问题：如何设定我的 shell 提示？？\n\n\n回答：如果你有足够的智慧提这个问题，你也该有足够的智慧去 [RTFM](#RTFM)，然后自己去找出来。\n\n> 问题：我可以用 Bass-o-matic 文件转换工具将 AcmeCorp 档案转换为 TeX 格式吗？\n\n\n回答：试试看就知道了。如果你试过，你既知道了答案，就不用浪费我的时间了。\n\n\n> 问题：我的程序/设定/SQL语句没有用\n\n\n回答：这不算是问题吧，我对要我问你二十个问题才找得出你真正问题的问题没兴趣 -- 我有更有意思的事要做呢。在看到这类问题的时候，我的反应通常不外如下三种\n\n* 你还有什么要补充的吗？\n* 真糟糕，希望你能搞定。\n* 这关我有什么屁事？\n\n> 问题：我的 Windows 电脑有问题，你能帮我吗？\n\n回答：能啊，扔掉萎软的垃圾，换个像 Linux 或 BSD 的开放源代码操作系统吧。\n\n注意：如果程序有官方版 Windows 或者与 Windows 有互动（如Samba），你**_可以_**问与Windows相关的问题， 只是别对问题是由 Windows 操作系统而不是程序本身造成的回复感到惊讶， 因为 Windows 一般来说实在太烂，这种说法通常都是对的。\n\n\n> 问题：我的程序不会动了，我认为系统工具 X 有问题\n\n回答：你完全有可能是第一个注意到被成千上万用户反复使用的系统调用与函数库档案有明显缺陷的人，更有可能的是你完全没有根据。不同凡响的说法需要不同凡响的证据，当你这样声称时，你必须有清楚而详尽的缺陷说明文件作后盾。\n\n\n> 问题：我在安装 Linux（或者 X ）时有问题，你能帮我吗？\n\n回答：不能，我只有亲自在你的电脑上动手才能找到毛病。还是去找你当地的 Linux 使用群组者寻求实际的指导吧（你能在[这儿](http://www.linux.org/groups/index.html)找到使用者群组的清单）。\n\n注意：如果安装问题与某 Linux 的发行版有关，在它的邮件列表、论坛或本地使用者群组中提问也许是恰当的。此时，应描述问题的准确细节。在此之前，先用 ```Linux``` 和**_所有_**被怀疑的硬件作关键词仔细搜索。\n\n\n> 问题：我怎么才能破解 root 帐号/窃取 OP 特权/读别人的邮件呢？\n\n回答：想要这样做，说明了你是个卑鄙小人；想找个黑客帮你，说明你是个白痴！\n\n# 8\\. 好问题与蠢问题\n\n最后，我将透过举一些例子，来说明怎样聪明的提问；同一个问题的两种问法被放在一起，一种是愚蠢的，另一种才是明智的。\n\n\n**_蠢问题_**：\n\n> 我可以在哪儿找到关于 Foonly Flurbamatic 的资料？\n\n这种问法无非想得到 [STFW](#RTFM) 这样的回答。\n\n**_聪明问题_**：\n\n> 我用Google搜索过 \"Foonly Flurbamatic 2600\"，但是没找到有用的结果。谁知道上哪儿去找对这种设备编程的资料？\n\n这个问题已经 STFW 过了，看起来他真的遇到了麻烦。\n\n\n**_蠢问题_**\n\n> 我从 foo 项目找来的源码没法编译。它怎么这么烂？\n\n他觉得都是别人的错，这个傲慢自大的提问者\n\n**_聪明问题_**\n\n> foo 项目代码在 Nulix 6.2 版下无法编译通过。我读过了 FAQ，但里面没有提到跟 Nulix 有关的问题。这是我编译过程的记录，我有什么做的不对的地方吗？\n\n提问者已经指明了环境，也读过了FAQ，还列出了错误，并且他没有把问题的责任推到别人头上，他的问题值得被关注。\n\n\n**_蠢问题_**\n\n> 我的主机板有问题了，谁来帮我？\n\n某黑客对这类问题的回答通常是：```好的，还要帮你拍拍背和换尿布吗？```，然后按下删除键。\n\n**_聪明问题_**\n\n> 我在 S2464 主机板上试过了 X 、 Y 和 Z ，但没什么作用，我又试了 A 、 B 和 C 。请注意当我尝试 C 时的奇怪现象。显然 florbish 正在 grommicking，但结果出人意料。通常在 Athlon MP 主机板上引起 grommicking 的原因是什么？有谁知道接下来我该做些什么测试才能找出问题？\n\n这个家伙，从另一个角度来看，值得去回答他。他表现出了解决问题的能力，而不是坐等天上掉答案。\n\n在最后一个问题中，注意```告诉我答案```和```给我启示，指出我还应该做什么诊断工作```之间微妙而又重要的区别。\n\n事实上，后一个问题源自于 2001 年 8 月在 Linux 内核邮件列表（lkml）上的一个真实的提问。我（Eric）就是那个提出问题的人。我在 Tyan S2464 主板上观察到了这种无法解释的锁定现象，列表成员们提供了解决这一问题的重要信息。\n\n通过我的提问方法，我给了别人可以咀嚼玩味的东西；我设法让人们很容易参与并且被吸引进来。我显示了自己具备和他们同等的能力，并邀请他们与我共同探讨。通过告诉他们我所走过的弯路，以避免他们再浪费时间，我也表明了对他们宝贵时间的尊重。\n\n事后，当我向每个人表示感谢，并且讚赏这次良好的讨论经歷的时候， 一个 Linux 内核邮件列表的成员表示，他觉得我的问题得到解决并非由于我是这个列表中的**_名人_**，而是因为我用了正确的方式来提问。\n\n黑客从某种角度来说是拥有丰富知识但缺乏人情味的家伙；我相信他是对的，如果我**_像_**个乞讨者那样提问，不论我是谁，一定会惹恼某些人或者被他们忽视。他建议我记下这件事，这直接导致了本指南的出现。\n\n# 9\\. 如果得不到回答\n\n如果仍得不到回答，请不要以为我们觉得无法帮助你。有时只是看到你问题的人不知道答案罢了。没有回应不代表你被忽视，虽然不可否认这种差别很难区分。\n\n总的来说，简单的重复张贴问题是个很糟的点子。这将被视为无意义的喧闹。有点耐心，知道你问题答案的人可能生活在不同的时区，可能正在睡觉，也有可能你的问题一开始就没有组织好。\n\n你可以通过其他渠道获得帮助，这些渠道通常更适合初学者的需要。\n\n有许多网上的以及本地的使用者群组，由热情的软件爱好者（即使他们可能从没亲自写过任何软件）组成。通常人们组建这样的团体来互相帮助并帮助新手。\n\n另外，你可以向很多商业公司寻求帮助，不论公司大还是小。别为要付费才能获得帮助而感到沮丧！毕竟，假使你的汽车发动机汽缸密封圈爆掉了-- 完全可能如此 --你还得把它送到修车铺，并且为维修付费。就算软件没花费你一分钱，你也不能强求技术支持总是免费的。\n\n对像是 Linux 这种大众化的软件，每个开发者至少会对应到上万名使用者。根本不可能由一个人来处理来自上万名使用者的求助电话。要知道，即使你要为这些协助付费，和你所购买的同类软件相比，你所付出的也是微不足道的（通常封闭源代码软件的技术支持费用比开放源代码软件的要高得多，且内容也没那么丰富）。\n\n# 10\\. 如何更好地回答问题\n\n**_态度和善一点_**。问题带来的压力常使人显得无礼或愚蠢，其实并不是这样。\n\n**_对初犯者私下回复_**。对那些坦诚犯错之人没有必要当众羞辱，一个真正的新手也许连怎么搜索或在哪找常见问题都不知道。\n\n**_如果你不确定，一定要说出来_**！一个听起来权威的错误回复比没有还要糟，别因为听起来像个专家很好玩，就给别人乱指路。要谦虚和诚实，给提问者与同行都树个好榜样。\n\n**_如果帮不了忙，也别妨碍他_**。不要在实际步骤上开玩笑，那样也许会毁了使用者的设置 --有些可怜的呆瓜会把它当成真的指令。\n\n**_试探性的反问以引出更多的细节_**。如果你做得好，提问者可以学到点东西 --你也可以。试试将蠢问题转变成好问题，别忘了我们都曾是新手。\n\n尽管对那些懒虫抱怨一声 RTFM 是正当的，能指出文件的位置（即使只是建议个 Google 搜索关键词）会更好。\n\n**_如果你决定回答，就请给出好的答案_**。当别人正在用错误的工具或方法时别建议笨拙的权宜之计（wordaround），应推荐更好的工具，重新界定问题。\n\n**_正面的回答问题_**！如果这个提问者已经很深入的研究而且也表明已经试过 X 、 Y 、 Z 、 A 、 B 、 C 但没得到结果，回答 ```试试看 A 或是 B``` 或者 ```试试X 、 Y 、 Z 、 A 、 B 、 C``` 并附上一个链接一点用都没有。\n\n**_帮助你的社区从问题中学习_**。当回复一个好问题时，问问自己```如何修改相关文件或常见问题文件以免再次解答同样的问题？```，接着再向文件维护者发一份补丁。\n\n如果你是在研究一番后才做出的回答，**_展现你的技巧而不是直接端出结果_**。毕竟```授人以鱼不如授人以渔```。\n\n# 11\\. 相关资源\n\n如果你需要个人电脑、Unix 系统和网络如何运作的基础知识，参阅[Unix系统和网络基本原理](http://en.tldp.org/HOWTO/Unix-and-Internet-Fundamentals-HOWTO/)。\n\n当你发布软件或补丁时，试着按[软件发布实践](http://en.tldp.org/HOWTO/Software-Release-Practice-HOWTO/index.html)操作。\n\n# 12\\. 鸣谢\nEvelyn Mitchel贡献了一些愚蠢问题例子并启发了编写```如何更好地回答问题```这一节， Mikhail Ramendik贡献了一些特别有价值的建议和改进。","language":"text/plain","encrypted":false,"added":1463117036},{"paste_id":2,"description":"FAQ的md源码","body":"论坛内很多提问是重复的，有必要整理一份FAQ，给新人看，同时也给其他人参考，让大伙的讨论能够更深入，而不是重复讨论、回答这些已经滥了的问题。整理这份FAQ可谓呕心沥血，先是碰到自动生成目录的技术问题，具体看[这篇帖子](http://127.0.0.1:43110/gfwtalk.bit/?Topic:34_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ)，然后内容十分繁杂，耗费时间。所以请大伙不要姑父我的努力，尽量浏览一遍目录再提问。\n使用方法：通过浏览目录，发现感兴趣的问题点击，会自动跳到对应问题，每个问题完毕后有**⇈**符号，点击后自动__**回到目录**__。（阅读FAQ之前你应该先仔细看论坛置顶贴，包括建站子贴和匿名子贴，提问前还应看[提问的智慧](http://127.0.0.1:43110/gfwtalk.bit/?Topic:36_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/)和[中文wiki](http://127.0.0.1:43110/1NCezLP8aXjABVreBB1CKGPub2tKTtyhWU)）\n我计划把本FAQ放入论坛首页，大伙滋补滋磁？如果你觉得有其他问题需要加入，欢迎留言补充：）\n本文markdown源码在[这里](http://127.0.0.1:43110/17iF64gTLycSohUSJsFyq7FMYsQfMqghJa/?13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ_2)\n# 0 目录\n* [1\\. ZeroNet与GFW的较量](#1-zeronet-gfw-)\n  * [1.1\\. GFW要怎么把ZeroNet给屏蔽掉?](#1-1-gfw-zeronet-)\n  * [1.2\\. 像屏蔽Tor和磁力链接一样，伪造大量恶意的正常节点传错误信息，该怎么办？](#1-2-tor-)\n  * [1.3\\. ZeorNet搭配google的卫星全球wifi怎样？](#1-3-zeornet-google-wifi-)\n  * [1.4\\. 封p2p并不难，尤其现在这个版本端口都还是固定的，会不会容易被封？](#1-4-p2p-)\n  * [1.5\\. 据说要搞域名白名单了，BT协议会不会受这种限制之影响？](#1-5-bt-)\n  * [1.6\\. 疯狂时切断国际互联网无法同步怎么办？](#1-6-)\n  * [1.7\\. 你说的那些办法，也可以被严查，像半个世纪前偷听敌台罪那样，怎么办？](#1-7-)\n* [2\\. ZeroNet与匿名](#2-zeronet-)\n  * [2.1\\. 还是第一次用ZeorNet，安全性怎么样？](#2-1-zeornet-)\n  * [2.2\\. 在天朝使用tor是不是有点麻烦？](#2-2-tor-)\n  * [2.3\\. 如果匿名的话还需要设置Tor就太费劲了。自带加密最好了。比如FreeNet。](#2-3-tor-freenet-)\n  * [2.4\\. 配置Tor以后peers的数量全都是0是什么原因？](#2-4-tor-peers-0-)\n  * [2.5\\. 浏览一些ZeroNet网站时，看到浏览器在加载外网资源，会泄露IP吗？怎么避免？](#2-5-zeronet-ip-)\n  * [2.6\\. 觉得Tor always实在太慢了，我想问的其实是OK模式下，浏览127.0.0.1/43100 的内容时，哪部分是经过TOR，哪部分不经过？](#2-6-tor-always-ok-127-0-0-1-43100-tor-)\n  * [2.7\\. 界面上显示绿色always了，但还是无法更新网站，怎么办？](#2-7-always-)\n  * [2.8\\. ZeroNet的私密性如何？路由器和网络上的设备能看到我访问了哪些网站吗？](#2-8-zeronet-)\n* [3\\. ZeroNet的内容](#3-zeronet-)\n  * [3.1\\. 可以发布色情内容吗？会不会被封号？](#3-1-)\n  * [3.2\\. 用色情内容来吸引用户，会不会导致用户质量不高？](#3-2-)\n  * [3.3\\. ZeroNet中文社区对色情内容是支持还是反对？](#3-3-zeronet-)\n  * [3.4\\. ZeroNet内的色情内容会不会导致容易被污名化而被封锁？](#3-4-zeronet-)\n  * [3.5\\. 讨论色情内容会违法吗？ZeroNet浏览即存储的模式，会在硬盘上存着，而且还上传做钟，有风险吗？](#3-5-zeronet-)\n  * [3.6\\. 我还是有些担忧，毕竟ZeroNet存储在本地硬盘是没有加密的，另外还会有隐私风险吧？](#3-6-zeronet-)\n* [4\\. ZeroNet的论坛](#4-zeronet-)\n  * [4.1\\. 能不能给本论坛增加贴图功能？](#4-1-)\n  * [4.2\\. 这个论坛能私信吗？](#4-2-)\n  * [4.3\\. 为什么我回复别人的文字格式跟其他人的看上去不一样？怪怪的](#4-3-)\n  * [4.4\\. ZeroNet纯JS无服务端的模式没办法使用传统的验证码，论坛怎么解决机器大规模灌水问题？](#4-4-zeronet-js-)\n  * [4.5\\. ZeroNet论坛有没办法拉黑某个用户？](#4-5-zeronet-)\n  * [4.6\\. 某贴子被移动出版块，出现在论坛首页，怎么回事？](#4-6-)\n* [5\\. ZeroNet其他问题](#5-zeronet-)\n  * [5.1\\. 为什么注册ZeroID失败？](#5-1-zeroid-)\n  * [5.2\\. ZeroNet的作者是谁？](#5-2-zeronet-)\n  * [5.3\\. ZeroID.bit和ZeroVerse.bit有什么关系？](#5-3-zeroid-bit-zeroverse-bit-)\n  * [5.4\\. ZeroNet是怎么做到去中心化的帐号验证的？注册帐号有什么注意事项？](#5-4-zeronet-)\n  * [5.5\\. 我的ZeroID会不会被删除？删除后有什么影响？](#5-5-zeroid-)\n  * [5.6\\. 我是菜鸟，无法看清这个东西的价值，能给自己带来什么收益](#5-6-)\n  * [5.7\\. 为什么ZeroNet注册ID不使用区块链技术？](#5-7-zeronet-id-)\n  * [5.8\\. 能不能把ZeroNet界面翻译成中文啊？](#5-8-zeronet-)\n  * [5.9\\. 如果github被墙，ZeroNet安装包的有官方镜像地址吗？](#5-9-github-zeronet-)\n  * [5.10\\. ZeroNet私钥需要像比特币钱包那样定期备份吗？](#5-10-zeronet-)\n  * [5.11\\. 这东西怎么连个密码都没有？](#5-11-)\n  * [5.12\\. ZeroNet网站真的没有办法被关闭吗？](#5-12-zeronet-)\n  * [5.13\\. ZeroNet有出口节点吗？能实现翻墙吗？](#5-13-zeronet-)\n  * [5.14\\. 太笨重了，镜像打开主页都要很长时间，里面的链接基本点不动](#5-14-)\n  * [5.15\\. SS或者obf4搭配Tor的加密程度够吗？ZeroNet的节点传输加密如何？](#5-15-ss-obf4-tor-zeronet-)\n  * [5.16\\. This function is disabled on this proxy这是什么意思？](#5-16-this-function-is-disabled-on-this-proxy-)\n  * [5.17\\. 在哪里找到我创建的博客，我找不到了。我手机上有ID，在电脑上怎么登陆？](#5-17-id-)\n  * [5.18\\. 一定要安装ZeroNet才能浏览吗？公用开放代理是什么？](#5-18-zeronet-)\n  * [5.19\\. 同步网站好慢啊，论坛很久才能打开](#5-19-)\n  * [5.20\\. ZeroNet界面上有些按钮点击后没反应。可能会是什么问题？](#5-20-zeronet-)\n  * [5.21\\. ZeroNet的网址的前面一串好长啊，有办法弄短吗？](#5-21-zeronet-)\n  * [5.22\\. 有办法运行ZeroNet而不打开默认浏览器吗？](#5-22-zeronet-)\n  * [5.23\\. 为什么我的zeromail一直更新失败？别的站点都能正常更新。](#5-23-zeromail-)\n  * [5.24\\. 怎么用tsocks，proxychains等工具把ZeroNet定向到ssr？](#5-24-tsocks-proxychains-zeronet-ssr-)\n* [6\\. ZeroNet建站](#6-zeronet-)\n  * [6.1\\. ZeroNet支持数据库吗？做一个权限管理的wiki可以吗？这些决定了ZeroNet的前端发展极限，我有必要先问一下。](#6-1-zeronet-wiki-zeronet-)\n  * [6.2\\. 我发现如果不推广自己的网站，根本没人来看(・`ω´・)就很难过](#6-2-)\n  * [6.3\\. 网站文件夹内路径和文件名含有中文时，签名发布并不生效，什么原因？](#6-3-)\n  * [6.4\\. 我的备份了，换了台电脑把备份的users.json覆盖回去，发现可以登录，但是没有站点的编辑权限了，怎么回事 ？](#6-4-users-json-)\n  * [6.5\\. 听说没有分布式的数据库是目前的局限，真的吗？](#6-5-)\n  * [6.6\\. 提示Your network connection is restricted. Please, open 15441 port，但是我的路由器并没有限制15441端口，怎么回事？](#6-6-your-network-connection-is-restricted-please-open-15441-port-15441-)\n  * [6.7\\. 没开端口发布不了吗？](#6-7-)\n  * [6.8\\. clone网站后,我的private key是什么呢?](#6-8-clone-private-key-)\n  * [6.9\\. 10M大小限制ZeroNet注定只能做做很轻量的网站？而且没有隐私可言？](#6-9-10m-zeronet-)\n  * [6.10\\. 如果一个网站很大，打开同步要很久，谁会去用？如果站里设置了某些文件是optional files，就不是一股脑全部下载所有文件。浏览器请求后才下载optional files。⇈](#6-10-optional-files-optional-files-0-)\n  * [6.11\\. 网站太大了超出限制提示改限额？](#6-11-)\n  * [6.12\\. 网站同步是用BT协议么？域名是什么原理？](#6-12-bt-)\n  * [6.13\\. Zeronet支持PHP吗？](#6-13-zeronet-php-)\n  * [6.14\\. 怎么样同步WWW的网站？支持RSS吗？](#6-14-www-rss-)\n  * [6.15\\. 我是github上直接拉代码建站的，不行啊，怎么回事？](#6-15-github-)\n  * [6.16\\. 官方站点的地址怎么这么牛？那一串东西不是随机的吗？](#6-16-)\n  * [6.17\\. 自己的博客点Add new Post添加文章，没有反应。删除文章的时候也没反应。可能会是什么问题？](#6-17-add-new-post-)\n* [7\\. 其他软件问题](#7-)\n  * [7.1\\. ZeroNet结合IPFS吼不吼啊？](#7-1-zeronet-ipfs-)\n  * [7.2\\. 安装目录里面被国内安防软件破坏不能登录，删除后重新打开压缩包安装，恢复使用，请问一下怎么找回原来注册的id？](#7-2-id-)\n  * [7.3\\. 比特币匿名吗？交易记录都是公开的，不是能一路追查出来吗？](#7-3-)\n* [8\\. 翻墙相关问题](#8-)\n  * [8.1\\. 有什么好的翻墙软件推荐？](#8-1-)\n  * [8.2\\. 听说lantern 需要你的google帳號，需要你的email。根本做不到安全？](#8-2-lantern-google-email-)\n  * [8.3\\. 翻墙软件用一段时间就不稳定了，怎么办？](#8-3-)\n  * [8.4\\. 虚拟机安装vpngate后选择任何一个中继连接，都是瞬间就报错不能连接](#8-4-vpngate-)\n* [9\\. 政治讨论相关问题和建议](#9-)\n  * [9.1\\. 这样的呐喊对大陆p民作用真不大， 没有信仰是很可怕的](#9-1-p-)\n  * [9.2\\. 赞同取消政治讨论板块，大部分人既不懂政治也不懂讨论，实在不想看这些没水准的讨论](#9-2-)\n  * [9.3\\. 对政治讨论方式有什么建议？如何进行有效的讨论，避免骂战、口水仗？](#9-3-)\n\n\n# 1\\. ZeroNet与GFW的较量\n\n---\n\n## 1.1\\. GFW要怎么把ZeroNet给屏蔽掉?\n1. 封了github，使得ZeroNet下载、更新失败-》用其他同类网站镜像下载（目前已经内置2个镜像，见下文）\n2. 封了ZeroNet的初始节点-》换其他tracker（启动时加一个启动参数，就可以指定其他的tracker；让作者通过github推送升级，就是自动换tracker）、发动国外网友建更多的bootstrapper（每个拥有公网IP的ZeroNet节点都能通过简单配置成为bootstrapper） \n\n总之，基于python开源的ZeroNet非常灵活，可以让GFW疲于应付。[⇈](#0-)\n\n---\n\n## 1.2\\. 像屏蔽Tor和磁力链接一样，伪造大量恶意的正常节点传错误信息，该怎么办？\n有一招是用BT Sync来同步ZeroNet的网站文件。BT Sync上面已经有大量不和谐内容，但是至今未屏蔽。一个原因是有很多企业在用BT Sync来同步数据，另一个原因是BT Sync的传播方式比较隐蔽。[⇈](#0-)\n\n---\n\n## 1.3\\. ZeorNet搭配google的卫星全球wifi怎样？\n13年纽西兰开始试验的是google LOON项目，是用热气球搞的。google还有一招是无人机。但是这两招在中国显然会被干掉（以领空为借口）。至于卫星的项目，是跟spaceX合作的，刚开始搞，效果如何还不知道。[⇈](#0-)\n\n---\n\n## 1.4\\. 封p2p并不难，尤其现在这个版本端口都还是固定的，会不会容易被封？\n想要端口随机很简单，跟ZeroNet作者说一声就行。现在就怕GFW不来封，搞得作者懒得改网络传输的代码。[⇈](#0-)\n\n---\n\n## 1.5\\. 据说要搞域名白名单了，BT协议会不会受这种限制之影响？\nBT不一定非得用域名。[⇈](#0-)\n\n---\n\n## 1.6\\. 疯狂时切断国际互联网无法同步怎么办？\n国际长途拨号上网、卫星上网、港澳wifi信号、大使馆附近wifi信号、人肉U盘带入境……只要墙内有一个节点有办法获得墙外信息，就能把信息传到大局域网各个角落。[⇈](#0-)\n\n---\n\n## 1.7\\. 你说的那些办法，也可以被严查，像半个世纪前偷听敌台罪那样，怎么办？\n你太高估政权后期的效率了。就是因为整个体系效率太低，才会岌岌可危，才会出台疯狂措施。但是这些措施能否有效率地执行，要打一个大问号。这跟政权初期的效率没有可比性。政权初期，很多人自觉去举报偷听敌台的人；政权后期，就算有人上门来查，给包烟就睁一只眼闭一只眼了。[⇈](#0-)\n\n---\n\n# 2\\. ZeroNet与匿名\n\n---\n\n## 2.1\\. 还是第一次用ZeorNet，安全性怎么样？\n想安全的话要用tor always 模式，以及用Tor浏览器来浏览。具体设置请看论坛置顶贴的匿名部分。[⇈](#0-)\n\n---\n\n## 2.2\\. 在天朝使用tor是不是有点麻烦？\n有需要的话就不会觉得麻烦。\n是否有需要，要看你发布什么东西，你懂的。[⇈](#0-)\n\n---\n\n## 2.3\\. 如果匿名的话还需要设置Tor就太费劲了。自带加密最好了。比如FreeNet。\n如果没有墙的话，ZeroNet在win下是自动下载并设置tor的。但在墙国，你懂的。[⇈](#0-)\n\n---\n\n## 2.4\\. 配置Tor以后peers的数量全都是0是什么原因？\n实际上就是你的TOR没有配置成功（没有给tor配置前置代理的缘故）。[⇈](#0-)\n\n---\n\n## 2.5\\. 浏览一些ZeroNet网站时，看到浏览器在加载外网资源，会泄露IP吗？怎么避免？\n从安全角度，一种浏览器设置方法，俗称“浏览器阉割法”，避免你说的问题：\nhttp://127.0.0.1:43110/zeroblog.bit/?Post:60:protect+yourselves:+set+a+non-working+proxy\n还有一招是用tor browser，设置方法见置顶帖。[⇈](#0-)\n\n---\n\n## 2.6\\. 觉得Tor always实在太慢了，我想问的其实是OK模式下，浏览127.0.0.1/43100 的内容时，哪部分是经过TOR，哪部分不经过？\n\nOK模式下连接明网IP是直连的（不经过Tor），连接.onion才走Tor。如果你看不懂，也没必要了解了。反正你就记着，always模式才是匿名。至于你说慢，如果你真的有匿名需求，我借用tor开发者的一句话：你想死得多快？[⇈](#0-)\n\n---\n\n## 2.7\\. 界面上显示绿色always了，但还是无法更新网站，怎么办？\n显示绿色always只是说明成功进入tor always模式，也就是说ZeroNet跟tor勾搭上了。但是tor是否能成功连接外网，与ZeroNet无关。所以你现在要做的是使tor通过网桥或前置代理的方法成功连接外网。具体方法请看置顶帖匿名部分。[⇈](#0-)\n\n---\n\n## 2.8\\. ZeroNet的私密性如何？路由器和网络上的设备能看到我访问了哪些网站吗？\nZeroNet节点之间连接默认是SSL加密的，如果只是在路由器上看，看不出你访问的网站，只能看到你连接了哪些节点。但是如果那个网站只有一个节点，你访问那个节点，就能猜测出你**可能**访问了那个网站，可能性的大小跟那个节点保存的网站数量成反比。所以如果非常在意私密性，请用tor，具体方法请看置顶帖匿名部分。[⇈](#0-)\n\n---\n\n# 3\\. ZeroNet的内容\n\n---\n\n## 3.1\\. 可以发布色情内容吗？会不会被封号？\nZeroNet作者对言论自由是很支持的，老外有个站专门发黄图在[这里](http://127.0.0.1:43110/1NZNtZQZHQRJXafvJpmY5jgqwRaCEZMsUc/)，堂而皇之用ZeroID来发图，没听说有删除帐号这种事情。[⇈](#0-)\n\n---\n\n## 3.2\\. 用色情内容来吸引用户，会不会导致用户质量不高？\n用户质量不高的问题，从另一个角度看：\n用户数够多，开发者和内容提供者的信心更足、热情更高，形成正反馈，同时会有更多的高质量开发者和内容提供者加入，不见得一直是低质量的。[⇈](#0-)\n\n---\n\n## 3.3\\. ZeroNet中文社区对色情内容是支持还是反对？\n我（@p2p）的个人观点是既不支持也不反对，况且也没有办法真正反对（因为去中心化、抗审查的特性）。我们作为ZeroNet的早期用户，需要做的是帮助优化ZeroNet体验，保持开放包容的社区氛围，至于之后用户拿ZeroNet建什么、来ZeroNet看什么说什么，我们无权干涉，也不可能干涉。[⇈](#0-)\n\n---\n\n## 3.4\\. ZeroNet内的色情内容会不会导致容易被污名化而被封锁？\n我（@p2p）个人觉得不需要操心这方面。当年CCAV怎么搞google的还记得吗？哪怕你没有色情内容，只要想扣屎盆子，都能创造出色情内容往你头上扣。但只要ZeroNet抗封锁能力够强，扣不扣无所谓。[⇈](#0-)\n\n---\n\n## 3.5\\. 讨论色情内容会违法吗？ZeroNet浏览即存储的模式，会在硬盘上存着，而且还上传做钟，有风险吗？\n这么多人用BT电驴迅雷下片，没事啊。下完后存储了，也做种了，也没事啊。\n你以为警察没事干管这种鸡毛蒜皮的事？比这大得多的事都管不过来啊。\n当然，资源的发布者就另当别论了，特别是大量发的，可以考虑置顶帖的匿名措施。[⇈](#0-)\n\n---\n\n## 3.6\\. 我还是有些担忧，毕竟ZeroNet存储在本地硬盘是没有加密的，另外还会有隐私风险吧？\n你用专门软件可以做到你的硬盘加密，比如开源的veracrypt，教程：\nhttp://127.0.0.1:43110/15gfg6DUVkp7ApLSMQvC2ig5qy8j91jXeW/2015/10/VeraCrypt.html\n使用上的一些注意事项，请翻墙看原博客评论。[⇈](#0-)\n\n---\n\n# 4\\. ZeroNet的论坛\n\n---\n\n## 4.1\\. 能不能给本论坛增加贴图功能？\n论坛贴图的讨论见这里：\nhttp://127.0.0.1:43110/gfwtalk.bit/?Topic:4_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ [⇈](#0-)\n\n---\n\n## 4.2\\. 这个论坛能私信吗？\n私聊不就是ZeroMail吗？请看置顶贴教程激活ZeroMail。[⇈](#0-)\n\n---\n\n## 4.3\\. 为什么我回复别人的文字格式跟其他人的看上去不一样？怪怪的\nSafari里点`回复`不能自动把光标定到回复框最后，需要手动把光标放到最下面。[⇈](#0-)\n\n---\n\n## 4.4\\. ZeroNet纯JS无服务端的模式没办法使用传统的验证码，论坛怎么解决机器大规模灌水问题？\n用类似FB/G+这种社交的方式，每个人可以自己fo用户，灌水、垃圾的自然就没市场。社交功能预计下一个版本会出来。本来早应该出来的，因为作者去搞差分同步优化传输了，就跳票了。（最新的消息是还需一两个月）[⇈](#0-)\n\n---\n\n## 4.5\\. ZeroNet论坛有没办法拉黑某个用户？\n站长、版主可以拉黑某用户，打开这个文件你就知道了：\nhttp://127.0.0.1:43110/Talk.ZeroNetwork.bit/data/users/content.json\n不仅能拉黑，还能设置某些帐号有更大的发贴限额。另外请参考这个帖子[ZeroNet网站管理权限分发和多重签名初探，兼谈论坛管理问题的解决思路](http://127.0.0.1:43110/gfwtalk.bit/?Topic:31_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ)[⇈](#0-)\n\n---\n\n## 4.6\\. 某贴子被移动出版块，出现在论坛首页，怎么回事？\n我（@p2p）目前没有权限移动他的帖子。xiaolan没有上线。\n唯一的可能就是他自己的问题。我猜测，@oredoc上线时没有同步到xiaolan改过的@oredoc的data.json，@oredoc自己马上发了帖子，就把自己的data.json给覆盖了，并同步到全网，帖子就移动出来了。[⇈](#0-)\n\n---\n\n# 5\\. ZeroNet其他问题\n\n---\n\n## 5.1\\. 为什么注册ZeroID失败？\n可能是注册服务器防滥用机制启动了，请过一会再试试。有些网友反馈，需要翻墙才能注册ZeroID，可以尝试一下翻墙。[⇈](#0-)\n\n---\n\n## 5.2\\. ZeroNet的作者是谁？\n一位匈牙利人，他的ZeroID是@nofish，官方博客是 http://127.0.0.1:43110/Blog.ZeroNetwork.bit [⇈](#0-)\n\n---\n\n## 5.3\\. ZeroID.bit和ZeroVerse.bit有什么关系？\nZeroID.bit是作者@nofish的。ZeroVerse.bit是德国人@erkan搞的另一个注册ID的站（即ID Provider），作为ZeroNet去中心化的一个实践。前者是所有ZeroNet克隆站默认支持的，后者是需要站长设置过才能支持的，具体见[@erkan的博文](http://127.0.0.1:43110/zeroblog.bit/?Post:19:sites+which+support:+ID+@+ZeroVerse.bit)。[⇈](#0-)\n\n---\n\n## 5.4\\. ZeroNet是怎么做到去中心化的帐号验证的？注册帐号有什么注意事项？\n你第一次运行ZeroNet时本地生成一个主私钥，这个主私钥存在本地/ZeroNet/data/users.json里。注册时访问ZeroID.bit，就会由主私钥生成那个网站的auth_address和auth_privatekey作为你在那个网站的唯一身份凭证，同样存在本地/ZeroNet/data/users.json里（auth_address和auth_privatekey访问网站后由主私钥自动重新生成，不用担心丢失）。目前需要有个服务器，向你的auth_address颁发证书并写入到P2P网络，之后你使用证书验证就不关那个服务器的事了，不需要跟它通信，也就是说只在第一次注册时才会跟那个服务器有通信。目前注册时向那个服务器通信有两种方式，一种是浏览器发送http请求，另一种是比特信。如果有匿名需求的话，注册时要用Tor。[⇈](#0-)\n\n---\n\n## 5.5\\. 我的ZeroID会不会被删除？删除后有什么影响？\nID Provider的所有者能不能删除你的帐号，删除后对之前和之后的帖子有什么影响（注意站与站之间是独立的，这个论坛站所有者是@xiaolan65535，具体见他博客xiaolan.me），这一点中文圈还没有人深入研究，有机会向作者问一下，也欢迎大家从技术角度来讨论这个问题。（用户信息在这两个文件里：\nhttp://127.0.0.1:43110/zeroid.bit/data/users.json\nhttp://127.0.0.1:43110/zeroid.bit/data/users_archive.json\n比如你的帐号在上面被删除了，你在这发的贴会有什么影响，还能不能发贴，希望能深入研究网站是怎么信任ID Provider的。）[⇈](#0-)\n\n---\n\n## 5.6\\. 我是菜鸟，无法看清这个东西的价值，能给自己带来什么收益\n- 获取无审查的信息\n- 自由发表观点[⇈](#0-)\n\n---\n\n## 5.7\\. 为什么ZeroNet注册ID不使用区块链技术？\nblockchain注册有一定缺点：\n- 新用户需要等待区块链下载完成后才能注册\n- 需要块被确认后才能使用ID，大约要等几分钟，有时候更长\n- 很难防spam[⇈](#0-)\n\n---\n\n## 5.8\\. 能不能把ZeroNet界面翻译成中文啊？\n翻译等ZeroNet作者发起，已经在github issues有讨论。[⇈](#0-)\n\n---\n\n## 5.9\\. 如果github被墙，ZeroNet安装包的有官方镜像地址吗？\nhttps://github.com/HelloZeroNet/ZeroBundle/raw/master/dist/ZeroBundle-win.zip\nhttps://gitlab.com/HelloZeroNet/ZeroBundle/raw/master/dist/ZeroBundle-win.zip\nhttps://try.gogs.io/ZeroNet/ZeroBundle/raw/master/dist/ZeroBundle-win.zip\n\n其他操作系统的安装包只需把以上地址的末尾替换成如下即可：\nZeroBundle-linux32.tar.gz\nZeroBundle-linux64.tar.gz\nZeroBundle-mac-osx-10.8.zip\nZeroBundle-mac-osx.zip\n所有地址在[这篇](http://127.0.0.1:43110/Blog.ZeroNetwork.bit/?Post:80#Comments)官方博客的作者本人留言里提到，原汁原味。[⇈](#0-)\n\n---\n\n## 5.10\\. ZeroNet私钥需要像比特币钱包那样定期备份吗？\n请看帖子 http://127.0.0.1:43110/gfwtalk.bit/?Topic:28_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ \nZeroID也是可以通过主私钥恢复的，见[作者解答](http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:1_1M6scJRBJiCnXTM4wPKK6gAGHzs9HMbf4V)\n> Visit ZeroID and your ZeroID cert should be recovered[⇈](#0-)\n\n---\n\n## 5.11\\. 这东西怎么连个密码都没有？\n私钥比密码安全，关于私钥请看置顶贴贴关于备份那一段。[⇈](#0-)\n\n---\n\n## 5.12\\. ZeroNet网站真的没有办法被关闭吗？\n请参考：[通用的自动快照脚本来创建一系列ZeroNet网站快照，实现真正不可能关闭的网站！](http://127.0.0.1:43110/gfwtalk.bit/?Topic:31_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ) [⇈](#0-)\n\n---\n\n## 5.13\\. ZeroNet有出口节点吗？能实现翻墙吗？\n没有出口。但是可以把墙外网站做镜像到ZeroNet，一些已经存在的镜像站请到[0Net123中文导航](http://127.0.0.1:43110/0net123.bit)里找。\n这里有个老外帮建立的VOA镜像，优化得很不错，按照镜像的深度分3种，推荐： http://127.0.0.1:43110/gfwtalk.bit/?Topic:13_1GtJqyJRsuZhmxVtw5USgvqGbUmVH7EmBD\n请有意做种的朋友（特别是海外朋友），到镜像站后拖拽右上角圆形按钮打开隐藏菜单，把DOWNLOAD AND HELP DISTRIBUTE ALL FILES选项打开，下载全部页面和图片来做种。做种时要想办法使ZeorHello页面上部的PORT状态为OPEN（路由器端口映射的概念和方法，请自行google）[⇈](#0-)\n\n---\n\n## 5.14\\. 太笨重了，镜像打开主页都要很长时间，里面的链接基本点不动\n等全部同步好，就很快了。\n记得在隐藏菜单里打开Download and help distribute all files，这样才会全部下载，看的时候才会嗖嗖滴[⇈](#0-)\n\n---\n\n## 5.15\\. SS或者obf4搭配Tor的加密程度够吗？ZeroNet的节点传输加密如何？\nSS的加密只要不是用table、rc4这两种，基本上就是安全的。\ntor最好用前置代理。obf4这种是网桥，跟tor自身加密没有关系。tor自身加密的强度绝对够，不用过多担心。\nZeroNet现在默认加密所有p2p节点之间的传输数据，这方面无需担心。[⇈](#0-)\n\n---\n\n## 5.16\\. This function is disabled on this proxy这是什么意思？\n你是在公共proxy浏览这里的吧？公共proxy网站有些操作是禁止的，因为会把网站搞乱。[⇈](#0-)\n\n---\n\n## 5.17\\. 在哪里找到我创建的博客，我找不到了。我手机上有ID，在电脑上怎么登陆？\n你手机上用公用proxy浏览ZeroNet吗？你的ID也是在公用proxy节点申请的吧？建议你还是到电脑上重新申请一个ID，因为在公用proxy节点申请的ID不安全。[⇈](#0-)\n\n---\n\n## 5.18\\. 一定要安装ZeroNet才能浏览吗？公用开放代理是什么？\n不安装ZeroNet的话可以通过公用开放代理（proxy）来访问ZeroNet内网站，这里收集了一些：\nhttp://127.0.0.1:43110/zeroproxies.bit 。[⇈](#0-)\n\n---\n\n## 5.19\\. 同步网站好慢啊，论坛很久才能打开\n你访问过的网站才会存到本地。如果你经常上来，总保持同步状态，就不会慢，因为访问本地数据的时间小到可以忽略。如果你很久没来，刚开始时需要一定时间同步，同步完成后还是一样快。[⇈](#0-)\n\n---\n\n## 5.20\\. ZeroNet界面上有些按钮点击后没反应。可能会是什么问题？\n换浏览器试试，推荐chrome、firefox，请远离IE。另外请检查一下有没有什么扩展阻挡了JS。[⇈](#0-)\n\n---\n\n## 5.21\\. ZeroNet的网址的前面一串好长啊，有办法弄短吗？\nchrome上有个[浏览器插件](https://chrome.google.com/webstore/detail/ZeroNet-protocol/cpkpdcdljfbnepgfejplkhdnopniieop)，可以把127.0.0.1:43110弄短。[⇈](#0-)\n\n---\n\n## 5.22\\. 有办法运行ZeroNet而不打开默认浏览器吗？\n其实懂点技术的不需要zerobundle。用类似这样的方法不会打开默认浏览器：\n```\ncd ZeroNet\npython ./ZeroNet.py  --tor always --tor_proxy 127.0.0.1:9150 --tor_controller 127.0.0.1:9151\n```\n这样子就不会打开默认浏览器了：）[⇈](#0-)\n\n---\n\n## 5.23\\. 为什么我的zeromail一直更新失败？别的站点都能正常更新。\n以zeromail举例，在ZeroHello左侧栏找到zeromail，点zeromail一栏右边⋮，再点Update来强制更新\n如果实在有某些文件更新失败，请不要纠结，那是因为某人的网络问题，导致他自己的文件上传失败，全网节点都无法更新他的文件。[⇈](#0-)\n\n---\n\n## 5.24\\. 怎么用tsocks，proxychains等工具把ZeroNet定向到ssr？\n为什么要把ZeroNet定向到ssr？直接配置ZeroNet走代理不就完了吗？\n添加参数`--proxy 127.0.0.1:1080 --disable_udp`（端口设成自己的）来启动ZeroNet，添加方法见置顶帖。[⇈](#0-)\n\n---\n\n# 6\\. ZeroNet建站\n\n---\n\n## 6.1\\. ZeroNet支持数据库吗？做一个权限管理的wiki可以吗？这些决定了ZeroNet的前端发展极限，我有必要先问一下。\n支持数据库，请看官方文档。作者的计划是，社交-》P2P版的github-》P2P版的交易平台。P2P版的github应该会有权限管理的功能。目前所支持的一些权限管理功能，请参考这个帖子[ZeroNet网站管理权限分发和多重签名初探，兼谈论坛管理问题的解决思路](http://127.0.0.1:43110/gfwtalk.bit/?Topic:31_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ) [⇈](#0-)\n\n---\n\n## 6.2\\. 我发现如果不推广自己的网站，根本没人来看(・`ω´・)就很难过\n\n你在明网不告诉别人你的网站，同样也没人看 [⇈](#0-)\n\n---\n\n## 6.3\\. 网站文件夹内路径和文件名含有中文时，签名发布并不生效，什么原因？\n作者说因为网站里非ascii码的路径、文件名在某些系统、浏览器会有兼容性问题，所以不会支持。\n可以考虑URL编码中文名来解决。[⇈](#0-)\n\n---\n\n## 6.4\\. 我的备份了，换了台电脑把备份的users.json覆盖回去，发现可以登录，但是没有站点的编辑权限了，怎么回事 ？\n我如何找回我的管理权？？\n\n打开置顶贴第2点提到的隐藏菜单，点This is my site按钮。[⇈](#0-)\n\n---\n\n## 6.5\\. 听说没有分布式的数据库是目前的局限，真的吗？\n\n哪里看到说不支持分布式的数据库？官方建站教程（数据库）：\nhttp://127.0.0.1:43110/Blog.ZeroNetwork.bit/?Post:46:ZeroNet+site+development+tutorial+2\n示例站（基于数据库的分布式聊天室——ZeroChat）：\nhttp://127.0.0.1:43110/1AvF5TpcaamRNtqvN1cnDEWzNmUtD47Npg [⇈](#0-)\n\n---\n\n## 6.6\\. 提示Your network connection is restricted. Please, open 15441 port，但是我的路由器并没有限制15441端口，怎么回事？\n端口被限制也无所谓，按照置顶帖的方法来发布网站即可。[⇈](#0-)\n\n---\n\n## 6.7\\. 没开端口发布不了吗？\n请严格按照置顶帖的方法来发布。tor下都可以发布，何况普通没开端口的网络。[⇈](#0-)\n\n---\n\n## 6.8\\. clone网站后,我的private key是什么呢?\n存在users.json里，以后签名发布用隐藏菜单操作并不需要你输入密钥。\nusers.json备份方法见置顶帖。[⇈](#0-)\n\n---\n\n## 6.9\\. 10M大小限制ZeroNet注定只能做做很轻量的网站？而且没有隐私可言？\n用optional files可以做很大的站，详见：\nhttp://127.0.0.1:43110/Blog.ZeroNetwork.bit/?Post:61:Changelog,+November+9,+2015\nZeroMail是加密的。[⇈](#0-)\n\n---\n\n## 6.10\\. 如果一个网站很大，打开同步要很久，谁会去用？如果站里设置了某些文件是optional files，就不是一股脑全部下载所有文件。浏览器请求后才下载optional files。[⇈](#0-)\n\n---\n\n## 6.11\\. 网站太大了超出限制提示改限额？\n确实要改限额，而且有时要多按几次F5。[⇈](#0-)\n\n---\n\n## 6.12\\. 网站同步是用BT协议么？域名是什么原理？\n网站内容的同步是通过BT来发现节点，但传输不是BT协议。域名是namecoin。[⇈](#0-)\n\n---\n\n## 6.13\\. Zeronet支持PHP吗？\n不支持PHP，但是可以用其他方法建立动态网站，就像本论坛一样。[⇈](#0-)\n\n---\n\n## 6.14\\. 怎么样同步WWW的网站？支持RSS吗？\n已经有转换RSS到ZERONET的程序了，请看\nhttps://github.com/ZeroNetscript/news_sync\n示例站：\nhttp://127.0.0.1:43110/1MpKFgUUAPd9ZxTQjhixCXkzqEGYuozq4y/\n这位ZeroNetscript在他github的其他repo里还有些程序，你们也可以参考，他还给原作者PR了ZeroBlog代码，增加了博文排序、标签等功能，感谢！\n他的博客（同时也是演示站）： http://127.0.0.1:43110/1LcQTyUYkq3n458rkHVQxhHyvUdmSYFURd [⇈](#0-)\n\n---\n\n## 6.15\\. 我是github上直接拉代码建站的，不行啊，怎么回事？\nclone的时候其实自动化了好多工作，直接拉代码缺少很多工作，所以是不行的。博客无法评论的问题，提供一个可能的解决方法：data/users/content.json必须用特殊sign方法，见\nhttp://127.0.0.1:43110/gfwtalk.bit/?Topic:3_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\n也可参考官方教程的 manual method部分：\nhttp://127.0.0.1:43110/Blog.ZeroNetwork.bit/?Post:3:How+to+have+a+blog+like+this [⇈](#0-)\n\n---\n\n## 6.16\\. 官方站点的地址怎么这么牛？那一串东西不是随机的吗？\n站点地址其实是比特币地址。地址是一组由经过特殊数学运算产生的随机数字组成。这个过程并不需要接入比特币网络，也不需要任何注册，地址产生后就会在比特币客户端里显示出来。系统1分钟内能产生成千上万个地址(包含个人地址)和密匙，例如使用快速虚荣地址生成器(Vanitygen)。虚荣地址生成器也能够生成具有个性的地址。用ZeroHello上的搜索功能找到了**创建个性地址**的教程，在这里\nhttp://127.0.0.1:43110/13x71nc7fju6afMqpEPfcu3Gx9Z5hNhH48/?Post:5:How+To:+custom+ZeroNet+addresses+using+Vanitygen+ [⇈](#0-)\n\n---\n\n## 6.17\\. 自己的博客点Add new Post添加文章，没有反应。删除文章的时候也没反应。可能会是什么问题？\n换浏览器试试，推荐chrome、firefox，请远离IE。另外请检查一下有没有什么扩展阻挡了JS。[⇈](#0-)\n\n---\n\n# 7\\. 其他软件问题\n\n---\n\n## 7.1\\. ZeroNet结合IPFS吼不吼啊？\nipfs的概念不错，但目前主要有两个问题限制在中国普及：\n- 不支持tor，不能在天朝匿名发布、浏览，结果你懂的（通过gateway能不能匿名发布、浏览、能支持到什么程度，我不确定，但是过于依赖gateway有悖于P2P的初衷）\n- 易用性目前还不够，连官网的演示、介绍基本上都是命令行，对小白来说几乎是不可能搞定的。\n现在有一些讨论，可以结合webtorrent来实现大文件传输、共享，以及视频直播等。[⇈](#0-)\n\n---\n\n## 7.2\\. 安装目录里面被国内安防软件破坏不能登录，删除后重新打开压缩包安装，恢复使用，请问一下怎么找回原来注册的id？\n请看置顶帖`备份你的ZeroNet帐号/私钥`一段\n不建议使用任何“国内安防软件”\n在淘宝搜NOD32，一块钱左右的序列号，即可享受国际著名杀毒软件NOD32半年的官方更新服务\n换用Linux更好。[⇈](#0-)\n\n---\n\n## 7.3\\. 比特币匿名吗？交易记录都是公开的，不是能一路追查出来吗？\n用一种东西叫洗比特币服务，请google:\n- btc laundry\n- btc wash\n- btc mixing\n\n上面三种都是同义词\n多找几家多洗几次就很难追踪。当然其他层面的匿名措施也要做好才行。[⇈](#0-)\n\n---\n\n# 8\\. 翻墙相关问题\n\n---\n\n## 8.1\\. 有什么好的翻墙软件推荐？\nLantern蓝灯，下载地址见东先生的Blog：\nhttp://127.0.0.1:43110/1A2zwx1maY1fZv18vaEFFaCuiS88xqWvzV/?Post:7:Lantern\n或者从[官方github repo](https://github.com/getlantern/lantern)提供的下载地址（免翻墙下载）：\n- [Android](https://raw.githubusercontent.com/getlantern/lantern-binaries/master/lantern-installer-beta.apk)\n- [Windows XP SP 3 and above](https://raw.githubusercontent.com/getlantern/lantern-binaries/master/lantern-installer-beta.exe)\n- [OSX 10.8 and above](https://raw.githubusercontent.com/getlantern/lantern-binaries/master/lantern-installer-beta.dmg)\n- [Ubuntu 14.04 32 bit](https://raw.githubusercontent.com/getlantern/lantern-binaries/master/lantern-installer-beta-32-bit.deb)\n- [Ubuntu 14.04 64 bit](https://raw.githubusercontent.com/getlantern/lantern-binaries/master/lantern-installer-beta-64-bit.deb)\n- [Arch Linux](https://aur.archlinux.org/packages/lantern)\n\n另外这里还收集了一些其他的翻墙软件： http://127.0.0.1:43110/bber.bit\n编程随想提供的翻墙工具BT Sync同步密钥BTLZ4A4UD3PEWKPLLWEOKH3W7OQJKFPLG [⇈](#0-)\n\n---\n\n## 8.2\\. 听说lantern 需要你的google帳號，需要你的email。根本做不到安全？\n你太out了！lantern早就改版，不需要google帐号了，用法和赛风差不多。[⇈](#0-)\n\n---\n\n## 8.3\\. 翻墙软件用一段时间就不稳定了，怎么办？\n请看翻墙人士必备小技巧——切换你的公网IP： http://127.0.0.1:43110/gfwtalk.bit/?Topic:27_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ [⇈](#0-)\n\n---\n\n## 8.4\\. 虚拟机安装vpngate后选择任何一个中继连接，都是瞬间就报错不能连接\n你是不是以前装过vpngate，要彻底卸载旧的vpngate虚拟网卡驱动才行。\n最好是恢复到干净的虚拟机快照，全新安装vpngate试试。\n当然，选server不可能一蹴而就，需要有点耐心。[⇈](#0-)\n\n---\n\n# 9\\. 政治讨论相关问题和建议\n\n---\n\n## 9.1\\. 这样的呐喊对大陆p民作用真不大， 没有信仰是很可怕的\n（以下为@p2p个人观点，供参考）\n信仰是必须的吗？台湾人的信仰怎样？如果说的是宗教的话，宗教必然会有洗脑，用一种洗脑代替另一种洗脑，真的好吗？另外从基督教在大陆被严厉打压来看，宗教是否能在大陆广泛传播要打个问号？\n完全相信科技的话有沦为工业党的趋向，也是不好的。完全相信科技跟具有科学素养（尤其是批判性思维）是两码事。\n重点还是要传播政治常识、人文素养这些，培养公民意识、批判性思维等等。\n（以下为香港人@missy个人观点，供参考）\n不過最重要的還是要消除現在中國那種二元唯物辦證法 ，把奴才變得更頭腦混亂 根本狗屁不通!你跟他說牛扒比屎進步 ，他跟你說屎是美食的對立 ，再配合中共式的「中庸」屎非屎屎不一定是屎 屎可以有另一種風味 等等等 看得淚流滿面[⇈](#0-)\n\n---\n\n## 9.2\\. 赞同取消政治讨论板块，大部分人既不懂政治也不懂讨论，实在不想看这些没水准的讨论\n（以下为@p2p个人观点，供参考）\n正因为不懂才要学，而且学也是有个过程的，要有耐心。\n人类连最基本的走路，都不是天生的，而是后天学的。“实在不想看这些没水准的讨论”，岂不是等于说不想看到人学走路时踉踉跄跄的样子？[⇈](#0-)\n\n---\n\n## 9.3\\. 对政治讨论方式有什么建议？如何进行有效的讨论，避免骂战、口水仗？\n（以下为@p2p个人观点，供参考）\n+ 对事不对人，保持就事论事。\n - 不要贴标签：目前来看，ZeroNet上还没有职业五毛，但是已经有几位的言论跟五毛很像。那几位只不过是因为某种因素导致有“自干五”思维罢了，大家如能心平气和交流，是能够达成一定共识的。如果随意给对方贴标签（五毛、奴才、理中客、小粉红……），显然会误伤，导致对方心理防卫机制启动，讨论可能就沦为骂战。就算将来有真的五毛来了，也不要贴标签，因为无法避免误伤。大家完全可以参照 [编程随想](http://127.0.0.1:43110/15gfg6DUVkp7ApLSMQvC2ig5qy8j91jXeW/2011/03/logical-fallacies.html) 对付五毛的方法，指出其逻辑错误，让其变成反面教材。\n - 不要质疑、指责对方的人品、能力、身份、动机……以及给对方抽象的负面评价，否则会脱离“事”的讨论而变成互相指责对方的“人”，毫无意义。\n+ 明确各自观点：讨论前先要和对方在观点的关键词的定义、含义、范围上达成一致。如果不一致就不要开始讨论，否则就是浪费时间，还容易导致争吵。很多情况下，所谓关键词几乎是每一个词，不要怕麻烦，磨刀不误砍柴工。\n+ 注意自己的表达方式，包括语气、用词等。表达同一个意思，不同的表达方式，效果有天壤之别。如果气氛不友好，别人的心理防卫机制启动，就算你说的全是理，别人也听不进去。尝试站在对方角度思考，然后在斟酌你的语句。\n+ 请经过一定思考后，再回复，放慢节奏。在网上经常可以看到双方激烈对话，但过段时间冷静下来后，一些人发现自己当时的言论不妥，回来修改、删除自己原回复。其实只要当时稍微缓一缓，放慢节奏，思考后再发言，或者起身离开电脑倒杯水，情况就完全不同了。\n+ 用逻辑来讨论。国人太缺乏逻辑，必须要学会用逻辑来思考、讨论。建立逻辑思维后，很多谎言不功自破，很多偏见也会消除。对方有逻辑错误要及时提醒对方，否则你容易被对方带偏，甚至被对方牵着鼻子走。关于如何发现逻辑错误，推荐[《学会提问——批判性思维指南》](http://127.0.0.1:43110/15gfg6DUVkp7ApLSMQvC2ig5qy8j91jXeW/2010/10/book-review-asking-right-questions.html)这本书。\n\n更多注意事项，请参考[怎样避免“中国式辩论”](http://127.0.0.1:43110/gfwtalk.bit/?Topic:35_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ)\n本论坛上目前有两个经典的讨论帖子，里面正反面教材都有，可以去观摩一下，不仅看热闹，还要看出点门道来：\nhttp://127.0.0.1:43110/gfwtalk.bit/?Topic:8_1DzpF7398yNGjFwHQqHAu9fRkbE3WZ6dZA\nhttp://127.0.0.1:43110/gfwtalk.bit/?Topic:1_121nbwrxZZz6PJ1WQ324jojCnRE96xUnRr [⇈](#0-)\n","language":"text/plain","encrypted":false,"added":1463151303},{"paste_id":7,"description":"ContentManager.py Line 550, 744~748, 774~786 ","body":"import json\nimport time\nimport re\nimport os\nimport copy\n\nimport gevent\n\nfrom Debug import Debug\nfrom Crypt import CryptHash\nfrom Config import config\nfrom util import helper\nfrom util import Diff\nfrom Peer import PeerHashfield\nfrom ContentDbDict import ContentDbDict\n\n\nclass ContentManager(object):\n\n    def __init__(self, site):\n        self.site = site\n        self.log = self.site.log\n        self.contents = ContentDbDict(site)\n        self.hashfield = PeerHashfield()\n        self.has_optional_files = False\n\n    # Load all content.json files\n    def loadContents(self):\n        if len(self.contents) == 0:\n            self.log.debug(\"ContentDb not initialized, load files from filesystem\")\n            self.loadContent(add_bad_files=False, delete_removed_files=False)\n        self.site.settings[\"size\"] = self.getTotalSize()\n\n        # Load hashfield cache\n        if \"hashfield\" in self.site.settings.get(\"cache\", {}):\n            self.hashfield.fromstring(self.site.settings[\"cache\"][\"hashfield\"].decode(\"base64\"))\n            del self.site.settings[\"cache\"][\"hashfield\"]\n        elif self.contents.get(\"content.json\") and self.getOptionalSize() > 0:\n            self.site.storage.updateBadFiles()  # No hashfield cache created yet\n        self.has_optional_files = bool(self.hashfield)\n\n        self.contents.db.initSite(self.site)\n\n    # Load content.json to self.content\n    # Return: Changed files [\"index.html\", \"data/messages.json\"], Deleted files [\"old.jpg\"]\n    def loadContent(self, content_inner_path=\"content.json\", add_bad_files=True, delete_removed_files=True, load_includes=True, force=False):\n        content_inner_path = content_inner_path.strip(\"/\")  # Remove / from beginning\n        old_content = self.contents.get(content_inner_path)\n        content_path = self.site.storage.getPath(content_inner_path)\n        content_dir = helper.getDirname(self.site.storage.getPath(content_inner_path))\n        content_inner_dir = helper.getDirname(content_inner_path)\n\n        if os.path.isfile(content_path):\n            try:\n                # Check if file is newer than what we have\n                if not force and old_content and not self.site.settings.get(\"own\"):\n                    for line in open(content_path):\n                        if '\"modified\"' not in line:\n                            continue\n                        match = re.search(\"([0-9\\.]+),$\", line.strip(\" \\r\\n\"))\n                        if match and float(match.group(1)) <= old_content.get(\"modified\", 0):\n                            self.log.debug(\"%s loadContent same json file, skipping\" % content_inner_path)\n                            return [], []\n\n                new_content = json.load(open(content_path))\n            except Exception, err:\n                self.log.warning(\"%s load error: %s\" % (content_path, Debug.formatException(err)))\n                return [], []\n        else:\n            self.log.warning(\"Content.json not exist: %s\" % content_path)\n            return [], []  # Content.json not exist\n\n        try:\n            # Get the files where the sha512 changed\n            changed = []\n            deleted = []\n            # Check changed\n            for relative_path, info in new_content.get(\"files\", {}).iteritems():\n                if \"sha512\" in info:\n                    hash_type = \"sha512\"\n                else:  # Backward compatibility\n                    hash_type = \"sha1\"\n\n                new_hash = info[hash_type]\n                if old_content and old_content[\"files\"].get(relative_path):  # We have the file in the old content\n                    old_hash = old_content[\"files\"][relative_path].get(hash_type)\n                else:  # The file is not in the old content\n                    old_hash = None\n                if old_hash != new_hash:\n                    changed.append(content_inner_dir + relative_path)\n\n            # Check changed optional files\n            for relative_path, info in new_content.get(\"files_optional\", {}).iteritems():\n                file_inner_path = content_inner_dir + relative_path\n                new_hash = info[\"sha512\"]\n                if old_content and old_content.get(\"files_optional\", {}).get(relative_path):\n                    # We have the file in the old content\n                    old_hash = old_content[\"files_optional\"][relative_path].get(\"sha512\")\n                    if old_hash != new_hash and self.site.isDownloadable(file_inner_path):\n                        changed.append(file_inner_path)  # Download new file\n                    elif old_hash != new_hash and self.hashfield.hasHash(old_hash) and not self.site.settings.get(\"own\"):\n                        try:\n                            self.optionalRemove(file_inner_path, old_hash, old_content[\"files_optional\"][relative_path][\"size\"])\n                            self.site.storage.delete(file_inner_path)\n                            self.log.debug(\"Deleted changed optional file: %s\" % file_inner_path)\n                        except Exception, err:\n                            self.log.debug(\"Error deleting file %s: %s\" % (file_inner_path, err))\n                else:  # The file is not in the old content\n                    if self.site.isDownloadable(file_inner_path):\n                        changed.append(file_inner_path)  # Download new file\n\n            # Check deleted\n            if old_content:\n                old_files = dict(\n                    old_content.get(\"files\", {}),\n                    **old_content.get(\"files_optional\", {})\n                )\n\n                new_files = dict(\n                    new_content.get(\"files\", {}),\n                    **new_content.get(\"files_optional\", {})\n                )\n\n                deleted = [key for key in old_files if key not in new_files]\n                if deleted and not self.site.settings.get(\"own\"):\n                    # Deleting files that no longer in content.json\n                    for file_relative_path in deleted:\n                        file_inner_path = content_inner_dir + file_relative_path\n                        try:\n                            self.site.storage.delete(file_inner_path)\n\n                            # Check if the deleted file is optional\n                            if old_content.get(\"files_optional\") and old_content[\"files_optional\"].get(file_relative_path):\n                                old_hash = old_content[\"files_optional\"][file_relative_path].get(\"sha512\")\n                                if self.hashfield.hasHash(old_hash):\n                                    self.optionalRemove(file_inner_path, old_hash, old_content[\"files_optional\"][file_relative_path][\"size\"])\n\n                            self.log.debug(\"Deleted file: %s\" % file_inner_path)\n                        except Exception, err:\n                            self.log.debug(\"Error deleting file %s: %s\" % (file_inner_path, err))\n\n                    # Cleanup empty dirs\n                    tree = {root: [dirs, files] for root, dirs, files in os.walk(self.site.storage.getPath(content_inner_dir))}\n                    for root in sorted(tree, key=len, reverse=True):\n                        dirs, files = tree[root]\n                        if dirs == [] and files == []:\n                            root_inner_path = self.site.storage.getInnerPath(root.replace(\"\\\\\", \"/\"))\n                            self.log.debug(\"Empty directory: %s, cleaning up.\" % root_inner_path)\n                            try:\n                                self.site.storage.deleteDir(root_inner_path)\n                                # Remove from tree dict to reflect changed state\n                                tree[os.path.dirname(root)][0].remove(os.path.basename(root))\n                            except Exception, err:\n                                self.log.debug(\"Error deleting empty directory %s: %s\" % (root_inner_path, err))\n\n            # Check archived\n            if old_content and \"user_contents\" in new_content and \"archived\" in new_content[\"user_contents\"]:\n                old_archived = old_content.get(\"user_contents\", {}).get(\"archived\", {})\n                new_archived = new_content.get(\"user_contents\", {}).get(\"archived\", {})\n                self.log.debug(\"old archived: %s, new archived: %s\" % (len(old_archived), len(new_archived)))\n                archived_changed = {\n                    key: date_archived\n                    for key, date_archived in new_archived.iteritems()\n                    if old_archived.get(key) != new_archived[key]\n                }\n                if archived_changed:\n                    self.log.debug(\"Archived changed: %s\" % archived_changed)\n                    for archived_dirname, date_archived in archived_changed.iteritems():\n                        archived_inner_path = content_inner_dir + archived_dirname + \"/content.json\"\n                        if self.contents.get(archived_inner_path, {}).get(\"modified\", 0) < date_archived:\n                            self.removeContent(archived_inner_path)\n                    self.site.settings[\"size\"] = self.getTotalSize()\n\n            # Load includes\n            if load_includes and \"includes\" in new_content:\n                for relative_path, info in new_content[\"includes\"].items():\n                    include_inner_path = content_inner_dir + relative_path\n                    if self.site.storage.isFile(include_inner_path):  # Content.json exists, load it\n                        include_changed, include_deleted = self.loadContent(\n                            include_inner_path, add_bad_files=add_bad_files, delete_removed_files=delete_removed_files\n                        )\n                        if include_changed:\n                            changed += include_changed  # Add changed files\n                        if include_deleted:\n                            deleted += include_deleted  # Add changed files\n                    else:  # Content.json not exist, add to changed files\n                        self.log.debug(\"Missing include: %s\" % include_inner_path)\n                        changed += [include_inner_path]\n\n            # Load blind user includes (all subdir)\n            if load_includes and \"user_contents\" in new_content:\n                for relative_dir in os.listdir(content_dir):\n                    include_inner_path = content_inner_dir + relative_dir + \"/content.json\"\n                    if not self.site.storage.isFile(include_inner_path):\n                        continue  # Content.json not exist\n                    include_changed, include_deleted = self.loadContent(\n                        include_inner_path, add_bad_files=add_bad_files, delete_removed_files=delete_removed_files,\n                        load_includes=False\n                    )\n                    if include_changed:\n                        changed += include_changed  # Add changed files\n                    if include_deleted:\n                        deleted += include_deleted  # Add changed files\n\n            # Save some memory\n            new_content[\"signs\"] = None\n            if \"cert_sign\" in new_content:\n                new_content[\"cert_sign\"] = None\n\n            if new_content.get(\"files_optional\"):\n                self.has_optional_files = True\n            # Update the content\n            self.contents[content_inner_path] = new_content\n        except Exception, err:\n            self.log.warning(\"Content.json parse error: %s\" % Debug.formatException(err))\n            return [], []  # Content.json parse error\n\n        # Add changed files to bad files\n        if add_bad_files:\n            for inner_path in changed:\n                self.site.bad_files[inner_path] = self.site.bad_files.get(inner_path, 0) + 1\n            for inner_path in deleted:\n                if inner_path in self.site.bad_files:\n                    del self.site.bad_files[inner_path]\n\n        if new_content.get(\"modified\", 0) > self.site.settings.get(\"modified\", 0):\n            # Dont store modifications in the far future (more than 10 minute)\n            self.site.settings[\"modified\"] = min(time.time() + 60 * 10, new_content[\"modified\"])\n\n        return changed, deleted\n\n    def removeContent(self, inner_path):\n        inner_dir = helper.getDirname(inner_path)\n        try:\n            content = self.contents[inner_path]\n            files = dict(\n                content.get(\"files\", {}),\n                **content.get(\"files_optional\", {})\n            )\n        except Exception, err:\n            self.log.debug(\"Error loading %s for removeContent: %s\" % (inner_path, Debug.formatException(err)))\n            files = {}\n        files[\"content.json\"] = True\n        # Deleting files that no longer in content.json\n        for file_relative_path in files:\n            file_inner_path = inner_dir + file_relative_path\n            try:\n                self.site.storage.delete(file_inner_path)\n                self.log.debug(\"Deleted file: %s\" % file_inner_path)\n            except Exception, err:\n                self.log.debug(\"Error deleting file %s: %s\" % (file_inner_path, err))\n        try:\n            self.site.storage.deleteDir(inner_dir)\n        except Exception, err:\n            self.log.debug(\"Error deleting dir %s: %s\" % (inner_dir, err))\n\n        try:\n            del self.contents[inner_path]\n        except Exception, err:\n            self.log.debug(\"Error key from contents: %s\" % inner_path)\n\n    # Get total size of site\n    # Return: 32819 (size of files in kb)\n    def getTotalSize(self, ignore=None):\n        size = self.contents.db.getTotalSize(self.site, ignore)\n        if size:\n            return size\n        else:\n            return 0\n\n    def getOptionalSize(self):\n        size = self.contents.db.getOptionalSize(self.site)\n        if size:\n            return size\n        else:\n            return 0\n\n    def listModified(self, since):\n        return self.contents.db.listModified(self.site, since)\n\n    def listContents(self, inner_path=\"content.json\", user_files=False):\n        if inner_path not in self.contents:\n            return []\n        back = [inner_path]\n        content_inner_dir = helper.getDirname(inner_path)\n        for relative_path in self.contents[inner_path].get(\"includes\", {}).keys():\n            include_inner_path = content_inner_dir + relative_path\n            back += self.listContents(include_inner_path)\n        return back\n\n    # Returns if file with the given modification date is archived or not\n    def isArchived(self, inner_path, modified):\n        file_info = self.getFileInfo(inner_path)\n        match = re.match(\".*/(.*?)/\", inner_path)\n        if not match:\n            return False\n        relative_directory = match.group(1)\n        if file_info and file_info.get(\"archived\", {}).get(relative_directory) >= modified:\n            return True\n        else:\n            return False\n\n    # Find the file info line from self.contents\n    # Return: { \"sha512\": \"c29d73d...21f518\", \"size\": 41 , \"content_inner_path\": \"content.json\"}\n    def getFileInfo(self, inner_path):\n        dirs = inner_path.split(\"/\")  # Parent dirs of content.json\n        inner_path_parts = [dirs.pop()]  # Filename relative to content.json\n        while True:\n            content_inner_path = \"%s/content.json\" % \"/\".join(dirs)\n            content = self.contents.get(content_inner_path.strip(\"/\"))\n\n            # Check in files\n            if content and \"files\" in content:\n                back = content[\"files\"].get(\"/\".join(inner_path_parts))\n                if back:\n                    back[\"content_inner_path\"] = content_inner_path\n                    back[\"optional\"] = False\n                    return back\n\n            # Check in optional files\n            if content and \"files_optional\" in content:  # Check if file in this content.json\n                back = content[\"files_optional\"].get(\"/\".join(inner_path_parts))\n                if back:\n                    back[\"content_inner_path\"] = content_inner_path\n                    back[\"optional\"] = True\n                    return back\n\n            # Return the rules if user dir\n            if content and \"user_contents\" in content:\n                back = content[\"user_contents\"]\n                # Content.json is in the users dir\n                back[\"content_inner_path\"] = re.sub(\"(.*)/.*?$\", \"\\\\1/content.json\", inner_path)\n                back[\"optional\"] = None\n                return back\n\n            # No inner path in this dir, lets try the parent dir\n            if dirs:\n                inner_path_parts.insert(0, dirs.pop())\n            else:  # No more parent dirs\n                break\n\n        # Not found\n        return False\n\n    # Get rules for the file\n    # Return: The rules for the file or False if not allowed\n    def getRules(self, inner_path, content=None):\n        if not inner_path.endswith(\"content.json\"):  # Find the files content.json first\n            file_info = self.getFileInfo(inner_path)\n            if not file_info:\n                return False  # File not found\n            inner_path = file_info[\"content_inner_path\"]\n        dirs = inner_path.split(\"/\")  # Parent dirs of content.json\n        inner_path_parts = [dirs.pop()]  # Filename relative to content.json\n        inner_path_parts.insert(0, dirs.pop())  # Dont check in self dir\n        while True:\n            content_inner_path = \"%s/content.json\" % \"/\".join(dirs)\n            parent_content = self.contents.get(content_inner_path.strip(\"/\"))\n            if parent_content and \"includes\" in parent_content:\n                return parent_content[\"includes\"].get(\"/\".join(inner_path_parts))\n            elif parent_content and \"user_contents\" in parent_content:\n                return self.getUserContentRules(parent_content, inner_path, content)\n            else:  # No inner path in this dir, lets try the parent dir\n                if dirs:\n                    inner_path_parts.insert(0, dirs.pop())\n                else:  # No more parent dirs\n                    break\n\n        return False\n\n    # Get rules for a user file\n    # Return: The rules of the file or False if not allowed\n    def getUserContentRules(self, parent_content, inner_path, content):\n        user_contents = parent_content[\"user_contents\"]\n        user_address = re.match(\".*/([A-Za-z0-9]*?)/.*?$\", inner_path).group(1)  # Delivered for directory\n\n        try:\n            if not content:\n                content = self.site.storage.loadJson(inner_path)  # Read the file if no content specified\n            user_urn = \"%s/%s\" % (content[\"cert_auth_type\"], content[\"cert_user_id\"])  # web/nofish@zeroid.bit\n            cert_user_id = content[\"cert_user_id\"]\n        except Exception:  # Content.json not exist\n            user_urn = \"n-a/n-a\"\n            cert_user_id = \"n-a\"\n\n        rules = copy.copy(user_contents[\"permissions\"].get(cert_user_id, {}))  # Default rules by username\n        if rules is False:\n            banned = True\n            rules = {}\n        else:\n            banned = False\n        if \"signers\" in rules:\n            rules[\"signers\"] = rules[\"signers\"][:]  # Make copy of the signers\n        for permission_pattern, permission_rules in user_contents[\"permission_rules\"].items():  # Regexp rules\n            if not re.match(permission_pattern, user_urn):\n                continue  # Rule is not valid for user\n            # Update rules if its better than current recorded ones\n            for key, val in permission_rules.iteritems():\n                if key not in rules:\n                    if type(val) is list:\n                        rules[key] = val[:]  # Make copy\n                    else:\n                        rules[key] = val\n                elif type(val) is int:  # Int, update if larger\n                    if val > rules[key]:\n                        rules[key] = val\n                elif hasattr(val, \"startswith\"):  # String, update if longer\n                    if len(val) > len(rules[key]):\n                        rules[key] = val\n                elif type(val) is list:  # List, append\n                    rules[key] += val\n\n        rules[\"cert_signers\"] = user_contents[\"cert_signers\"]  # Add valid cert signers\n        if \"signers\" not in rules:\n            rules[\"signers\"] = []\n\n        if not banned:\n            rules[\"signers\"].append(user_address)  # Add user as valid signer\n        rules[\"user_address\"] = user_address\n        rules[\"includes_allowed\"] = False\n\n        return rules\n\n    # Get diffs for changed files\n    def getDiffs(self, inner_path, limit=30 * 1024, update_files=True):\n        if inner_path not in self.contents:\n            return {}\n        diffs = {}\n        content_inner_path_dir = helper.getDirname(inner_path)\n        for file_relative_path in self.contents[inner_path].get(\"files\", {}):\n            file_inner_path = content_inner_path_dir + file_relative_path\n            if self.site.storage.isFile(file_inner_path + \"-new\"):  # New version present\n                diffs[file_relative_path] = Diff.diff(\n                    list(self.site.storage.open(file_inner_path)),\n                    list(self.site.storage.open(file_inner_path + \"-new\")),\n                    limit=limit\n                )\n                if update_files:\n                    self.site.storage.delete(file_inner_path)\n                    self.site.storage.rename(file_inner_path + \"-new\", file_inner_path)\n            if self.site.storage.isFile(file_inner_path + \"-old\"):  # Old version present\n                diffs[file_relative_path] = Diff.diff(\n                    list(self.site.storage.open(file_inner_path + \"-old\")),\n                    list(self.site.storage.open(file_inner_path)),\n                    limit=limit\n                )\n                if update_files:\n                    self.site.storage.delete(file_inner_path + \"-old\")\n        return diffs\n\n    # Hash files in directory\n    def hashFiles(self, dir_inner_path, ignore_pattern=None, optional_pattern=None):\n        files_node = {}\n        files_optional_node = {}\n        if not re.match(\"^[a-zA-Z0-9_@=\\.\\+-/]*$\", dir_inner_path):\n            ignored = True\n            self.log.error(\"- [ERROR] Only ascii encoded directories allowed: %s\" % dir_inner_path)\n\n        for file_relative_path in self.site.storage.list(dir_inner_path):\n            file_name = helper.getFilename(file_relative_path)\n\n            ignored = optional = False\n            if file_name == \"content.json\":\n                ignored = True\n            elif ignore_pattern and re.match(ignore_pattern, file_relative_path):\n                ignored = True\n            elif file_name.startswith(\".\") or file_name.endswith(\"-old\") or file_name.endswith(\"-new\"):\n                ignored = True\n            elif not re.match(\"^[a-zA-Z0-9_@=\\.\\+\\-/]+$\", file_relative_path):\n                ignored = True\n                self.log.error(\"- [ERROR] Only ascii encoded filenames allowed: %s\" % file_relative_path)\n            elif optional_pattern and re.match(optional_pattern, file_relative_path):\n                optional = True\n\n            if ignored:  # Ignore content.json, defined regexp and files starting with .\n                self.log.info(\"- [SKIPPED] %s\" % file_relative_path)\n            else:\n                file_inner_path = dir_inner_path + \"/\" + file_relative_path\n                file_path = self.site.storage.getPath(file_inner_path)\n                sha512sum = CryptHash.sha512sum(file_path)  # Calculate sha512 sum of file\n                if optional:\n                    self.log.info(\"- [OPTIONAL] %s (SHA512: %s)\" % (file_relative_path, sha512sum))\n                    file_size = os.path.getsize(file_path)\n                    files_optional_node[file_relative_path] = {\"sha512\": sha512sum, \"size\": file_size}\n                    if not self.hashfield.hasHash(sha512sum):\n                        self.optionalDownloaded(file_inner_path, sha512sum, file_size, own=True)\n                else:\n                    self.log.info(\"- %s (SHA512: %s)\" % (file_relative_path, sha512sum))\n                    files_node[file_relative_path] = {\"sha512\": sha512sum, \"size\": os.path.getsize(file_path)}\n        return files_node, files_optional_node\n\n    # Create and sign a content.json\n    # Return: The new content if filewrite = False\n    def sign(self, inner_path=\"content.json\", privatekey=None, filewrite=True, update_changed_files=False, extend=None):\n        if inner_path in self.contents:\n            content = self.contents[inner_path]\n            if self.contents[inner_path].get(\"cert_sign\", False) is None and self.site.storage.isFile(inner_path):\n                # Recover cert_sign from file\n                content[\"cert_sign\"] = self.site.storage.loadJson(inner_path).get(\"cert_sign\")\n        else:\n            content = None\n        if not content:  # Content not exist yet, load default one\n            self.log.info(\"File %s not exist yet, loading default values...\" % inner_path)\n            content = {\"files\": {}, \"signs\": {}}  # Default content.json\n            if inner_path == \"content.json\":  # It's the root content.json, add some more fields\n                content[\"title\"] = \"%s - ZeroNet_\" % self.site.address\n                content[\"description\"] = \"\"\n                content[\"signs_required\"] = 1\n                content[\"ignore\"] = \"\"\n\n        if extend:\n            # Add extend keys if not exists\n            for key, val in extend.items():\n                if key not in content:\n                    content[key] = val\n\n        directory = helper.getDirname(self.site.storage.getPath(inner_path))\n        inner_directory = helper.getDirname(inner_path)\n        self.log.info(\"Opening site data directory: %s...\" % directory)\n\n        changed_files = [inner_path]\n        files_node, files_optional_node = self.hashFiles(\n            helper.getDirname(inner_path), content.get(\"ignore\"), content.get(\"optional\")\n        )\n\n        # Find changed files\n        files_merged = files_node.copy()\n        files_merged.update(files_optional_node)\n        for file_relative_path, file_details in files_merged.iteritems():\n            old_hash = content.get(\"files\", {}).get(file_relative_path, {}).get(\"sha512\")\n            new_hash = files_merged[file_relative_path][\"sha512\"]\n            if old_hash != new_hash:\n                changed_files.append(inner_directory + file_relative_path)\n\n        self.log.debug(\"Changed files: %s\" % changed_files)\n        if update_changed_files:\n            for file_path in changed_files:\n                self.site.storage.onUpdated(file_path)\n\n        # Generate new content.json\n        self.log.info(\"Adding timestamp and sha512sums to new content.json...\")\n\n        new_content = content.copy()  # Create a copy of current content.json\n        new_content[\"files\"] = files_node  # Add files sha512 hash\n        if files_optional_node:\n            new_content[\"files_optional\"] = files_optional_node\n        elif \"files_optional\" in new_content:\n            del new_content[\"files_optional\"]\n\n        new_content[\"modified\"] = int(time.time())  # Add timestamp. Strongly recommend to make it int for all new versions, since we are porting to more new devices which may have float precision issue. In the future, if we really need millisecond we can open another field to store it.\n        if inner_path == \"content.json\":\n            new_content[\"zeronet_version\"] = config.version\n            new_content[\"signs_required\"] = content.get(\"signs_required\", 1)\n\n        new_content[\"address\"] = self.site.address\n        new_content[\"inner_path\"] = inner_path\n\n        # Verify private key\n        from Crypt import CryptBitcoin\n        self.log.info(\"Verifying private key...\")\n        privatekey_address = CryptBitcoin.privatekeyToAddress(privatekey)\n        valid_signers = self.getValidSigners(inner_path, new_content)\n        if privatekey_address not in valid_signers:\n            return self.log.error(\n                \"Private key invalid! Valid signers: %s, Private key address: %s\" %\n                (valid_signers, privatekey_address)\n            )\n        self.log.info(\"Correct %s in valid signers: %s\" % (privatekey_address, valid_signers))\n\n        if inner_path == \"content.json\" and privatekey_address == self.site.address:\n            # If signing using the root key, then sign the valid signers\n            new_content[\"signers_sign\"] = CryptBitcoin.sign(\n                \"%s:%s\" % (new_content[\"signs_required\"], \",\".join(valid_signers)), privatekey\n            )\n            if not new_content[\"signers_sign\"]:\n                self.log.info(\"Old style address, signers_sign is none\")\n\n        self.log.info(\"Signing %s...\" % inner_path)\n\n        if \"signs\" in new_content:\n            del(new_content[\"signs\"])  # Delete old signs\n        if \"sign\" in new_content:\n            del(new_content[\"sign\"])  # Delete old sign (backward compatibility)\n\n        sign_content = json.dumps(new_content, sort_keys=True)\n        sign = CryptBitcoin.sign(sign_content, privatekey)\n        # new_content[\"signs\"] = content.get(\"signs\", {}) # TODO: Multisig\n        if sign:  # If signing is successful (not an old address)\n            new_content[\"signs\"] = {}\n            new_content[\"signs\"][privatekey_address] = sign\n\n        if inner_path == \"content.json\":  # To root content.json add old format sign for backward compatibility\n            oldsign_content = json.dumps(new_content, sort_keys=True)\n            new_content[\"sign\"] = CryptBitcoin.signOld(oldsign_content, privatekey)\n\n        if not self.verifyContent(inner_path, new_content):\n            self.log.error(\"Sign failed: Invalid content\")\n            return False\n\n        if filewrite:\n            self.log.info(\"Saving to %s...\" % inner_path)\n            self.site.storage.writeJson(inner_path, new_content)\n            self.contents[inner_path] = new_content\n\n        self.log.info(\"File %s signed!\" % inner_path)\n\n        if filewrite:  # Written to file\n            return True\n        else:  # Return the new content\n            return new_content\n\n    # The valid signers of content.json file\n    # Return: [\"1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6\", \"13ReyhCsjhpuCVahn1DHdf6eMqqEVev162\"]\n    def getValidSigners(self, inner_path, content=None):\n        valid_signers = []\n        if inner_path == \"content.json\":  # Root content.json\n            if \"content.json\" in self.contents and \"signers\" in self.contents[\"content.json\"]:\n                valid_signers += self.contents[\"content.json\"][\"signers\"].keys()\n        else:\n            rules = self.getRules(inner_path, content)\n            if rules and \"signers\" in rules:\n                valid_signers += rules[\"signers\"]\n\n        if self.site.address not in valid_signers:\n            valid_signers.append(self.site.address)  # Site address always valid\n        return valid_signers\n\n    # Return: The required number of valid signs for the content.json\n    def getSignsRequired(self, inner_path, content=None):\n        return 1  # Todo: Multisig\n\n    def verifyCert(self, inner_path, content):\n        from Crypt import CryptBitcoin\n\n        rules = self.getRules(inner_path, content)\n\n        if not rules.get(\"cert_signers\"):\n            return True  # Does not need cert\n\n        name, domain = content[\"cert_user_id\"].split(\"@\")\n        cert_address = rules[\"cert_signers\"].get(domain)\n        if not cert_address:  # Cert signer not allowed\n            self.log.warning(\"Invalid cert signer: %s\" % domain)\n            return False\n        return CryptBitcoin.verify(\n            \"%s#%s/%s\" % (rules[\"user_address\"], content[\"cert_auth_type\"], name), cert_address, content[\"cert_sign\"]\n        )\n\n    # Checks if the content.json content is valid\n    # Return: True or False\n    def verifyContent(self, inner_path, content):\n        content_size = len(json.dumps(content, indent=1)) + sum([file[\"size\"] for file in content[\"files\"].values()])  # Size of new content\n        # Calculate old content size\n        old_content = self.contents.get(inner_path)\n        if old_content:\n            old_content_size = len(json.dumps(old_content, indent=1)) + sum([file[\"size\"] for file in old_content.get(\"files\", {}).values()])\n            old_content_size_optional = sum([file[\"size\"] for file in old_content.get(\"files_optional\", {}).values()])\n        else:\n            old_content_size = 0\n            old_content_size_optional = 0\n\n        content_size_optional = sum([file[\"size\"] for file in content.get(\"files_optional\", {}).values()])\n        site_size = self.site.settings[\"size\"] - old_content_size + content_size  # Site size without old content plus the new\n        site_size_optional = self.site.settings[\"size_optional\"] - old_content_size_optional + content_size_optional  # Site size without old content plus the new\n\n        site_size_limit = self.site.getSizeLimit() * 1024 * 1024\n\n        # Check site address\n        if content.get(\"address\") and content[\"address\"] != self.site.address:\n            self.log.warning(\"%s: Wrong site address: %s != %s\" % (inner_path, content[\"address\"], self.site.address))\n            return False\n\n        # Check file inner path\n        if content.get(\"inner_path\") and content[\"inner_path\"] != inner_path:\n            self.log.warning(\"%s: Wrong inner_path: %s\" % (inner_path, content[\"inner_path\"]))\n            return False\n\n        # Check total site size limit\n        if site_size > site_size_limit:\n            self.log.warning(\"%s: Site too large %s > %s, aborting task...\" % (inner_path, site_size, site_size_limit))\n            if inner_path == \"content.json\" and self.site.settings[\"size\"] == 0:\n                # First content.json download, save site size to display warning\n                self.site.settings[\"size\"] = site_size\n            task = self.site.worker_manager.findTask(inner_path)\n            if task:  # Dont try to download from other peers\n                self.site.worker_manager.failTask(task)\n            return False\n\n        if inner_path == \"content.json\":\n            self.site.settings[\"size\"] = site_size\n            self.site.settings[\"size_optional\"] = site_size_optional\n            return True  # Root content.json is passed\n\n        # Load include details\n        rules = self.getRules(inner_path, content)\n        if not rules:\n            self.log.warning(\"%s: No rules\" % inner_path)\n            return False\n\n        # Check include size limit\n        if rules.get(\"max_size\") is not None:  # Include size limit\n            if content_size > rules[\"max_size\"]:\n                self.log.warning(\"%s: Include too large %s > %s\" % (inner_path, content_size, rules[\"max_size\"]))\n                return False\n\n        if rules.get(\"max_size_optional\") is not None:  # Include optional files limit\n            if content_size_optional > rules[\"max_size_optional\"]:\n                self.log.warning(\"%s: Include optional files too large %s > %s\" % (\n                    inner_path, content_size_optional, rules[\"max_size_optional\"])\n                )\n                return False\n\n        # Filename limit\n        if rules.get(\"files_allowed\"):\n            for file_inner_path in content[\"files\"].keys():\n                if not re.match(\"^%s$\" % rules[\"files_allowed\"], file_inner_path):\n                    self.log.warning(\"%s %s: File not allowed\" % (inner_path, file_inner_path))\n                    return False\n\n        if rules.get(\"files_allowed_optional\"):\n            for file_inner_path in content.get(\"files_optional\", {}).keys():\n                if not re.match(\"^%s$\" % rules[\"files_allowed_optional\"], file_inner_path):\n                    self.log.warning(\"%s %s: Optional file not allowed\" % (inner_path, file_inner_path))\n                    return False\n\n        # Check if content includes allowed\n        if rules.get(\"includes_allowed\") is False and content.get(\"includes\"):\n            self.log.warning(\"%s: Includes not allowed\" % inner_path)\n            return False  # Includes not allowed\n\n        self.site.settings[\"size\"] = site_size\n        self.site.settings[\"size_optional\"] = site_size_optional\n\n        return True  # All good\n\n    # Verify file validity\n    # Return: None = Same as before, False = Invalid, True = Valid\n    def verifyFile(self, inner_path, file, ignore_same=True):\n        if inner_path.endswith(\"content.json\"):  # content.json: Check using sign\n            from Crypt import CryptBitcoin\n            try:\n                if type(file) is dict:\n                    new_content = file\n                elif config.isAndroid:\n                    from decimal import Decimal\n                    new_content = json.load(file, parse_float=Decimal) # hack it to be compatible to android, which has float precision issue. Firstly, parse it to Decimal. TODO: when in --verbose mode, it reports a error from UiWebsocket.py probably due to Decimal type is not understood by websocket if isAndroid is set to True ( currently isAndroid is auto-detected, for debugging it must be set by deleting  the auto-detected code in main.py). Please FIXME.\n                else: # Not on Android\n                    new_content = json.load(file)\n                if inner_path in self.contents:\n                    old_content = self.contents.get(inner_path, {\"modified\": 0})\n                    # Checks if its newer the ours\n                    if old_content[\"modified\"] == new_content[\"modified\"] and ignore_same:  # Ignore, have the same content.json\n                        return None\n                    elif old_content[\"modified\"] > new_content[\"modified\"]:  # We have newer\n                        self.log.debug(\n                            \"We have newer %s (Our: %s, Sent: %s)\" %\n                            (inner_path, old_content[\"modified\"], new_content[\"modified\"])\n                        )\n                        # gevent.spawn(self.site.publish, inner_path=inner_path)  # Try to fix the broken peers\n                        return False\n                if new_content[\"modified\"] > time.time() + 60 * 60 * 24:  # Content modified in the far future (allow 1 day+)\n                    self.log.warning(\"%s modify is in the future!\" % inner_path)\n                    return False\n                if self.isArchived(inner_path, new_content[\"modified\"]):\n                    self.log.warning(\"%s this file is archived!\" % inner_path)\n                    return False\n                # Check sign\n                sign = new_content.get(\"sign\")\n                signs = new_content.get(\"signs\", {})\n                if \"sign\" in new_content:\n                    del(new_content[\"sign\"])  # The file signed without the sign\n                if \"signs\" in new_content:\n                    del(new_content[\"signs\"])  # The file signed without the signs\n                \n                if isinstance( new_content[\"modified\"], ( int, long ) ): # hack it to be compatible to android,  which has float precision issue.\n                    modified_is_int =  True # a flag to remember that\n                else:\n                    modified_is_int = False \n                if config.isAndroid and not modified_is_int: #  if the timestamp is int, means it was not parsed to Decimal and don't need to parse to string to avoid  android float precision issue. if the timestamp is not int :\n                    new_content[\"modified\"] = str(new_content[\"modified\"]) # Secondly, parse Decimal to string.\n                    \n                sign_content = json.dumps(new_content, sort_keys=True)  # Dump the json to string to remove whitepsace\n                \n                if config.isAndroid and not modified_is_int: # hack it to be compatible to android, which has float precision issue.  Lastly,  delete two \" to make the timestamp back to float num if it was parsed previously.\n                    pos = sign_content.index('\"modified\"') # position of \"modified\"\n                    sign_content = sign_content[:pos+10] + sign_content[pos+10:].replace('\"', '', 2) # pos+10 points to the second char after 'modified' , which is ':' . From that, delete two \" to make the timestamp back to float num \n\n                if not self.verifyContent(inner_path, new_content):\n                    return False  # Content not valid (files too large, invalid files)\n\n                if signs:  # New style signing\n                    valid_signers = self.getValidSigners(inner_path, new_content)\n                    signs_required = self.getSignsRequired(inner_path, new_content)\n\n                    if inner_path == \"content.json\" and len(valid_signers) > 1:  # Check signers_sign on root content.json\n                        if not CryptBitcoin.verify(\n                            \"%s:%s\" % (signs_required, \",\".join(valid_signers)), self.site.address, new_content[\"signers_sign\"]\n                        ):\n                            self.log.warning(\"%s invalid signers_sign!\" % inner_path)\n                            return False\n\n                    if inner_path != \"content.json\" and not self.verifyCert(inner_path, new_content):  # Check if cert valid\n                        self.log.warning(\"%s invalid cert!\" % inner_path)\n                        return False\n\n                    valid_signs = 0\n                    for address in valid_signers:\n                        if address in signs:\n                            valid_signs += CryptBitcoin.verify(sign_content, address, signs[address])\n                        if valid_signs >= signs_required:\n                            break  # Break if we has enough signs\n                    if config.verbose:\n                        self.log.debug(\"%s: Valid signs: %s/%s\" % (inner_path, valid_signs, signs_required))\n                    return valid_signs >= signs_required\n                else:  # Old style signing\n                    return CryptBitcoin.verify(sign_content, self.site.address, sign)\n\n            except Exception, err:\n                self.log.warning(\"Verify sign error: %s\" % Debug.formatException(err))\n                return False\n\n        else:  # Check using sha512 hash\n            file_info = self.getFileInfo(inner_path)\n            if file_info:\n                if \"sha512\" in file_info:\n                    hash_valid = CryptHash.sha512sum(file) == file_info[\"sha512\"]\n                elif \"sha1\" in file_info:  # Backward compatibility\n                    hash_valid = CryptHash.sha1sum(file) == file_info[\"sha1\"]\n                else:\n                    hash_valid = False\n                if file_info.get(\"size\", 0) != file.tell():\n                    self.log.warning(\n                        \"%s file size does not match %s <> %s, Hash: %s\" %\n                        (inner_path, file.tell(), file_info.get(\"size\", 0), hash_valid)\n                    )\n                    return False\n                return hash_valid\n\n            else:  # File not in content.json\n                self.log.warning(\"File not in content.json: %s\" % inner_path)\n                return False\n\n    def optionalDownloaded(self, inner_path, hash, size=None, own=False):\n        if size is None:\n            size = self.site.storage.getSize(inner_path)\n        if type(hash) is int:\n            done = self.hashfield.appendHashId(hash)\n        else:\n            done = self.hashfield.appendHash(hash)\n        self.site.settings[\"optional_downloaded\"] += size\n        return done\n\n    def optionalRemove(self, inner_path, hash, size=None):\n        if size is None:\n            size = self.site.storage.getSize(inner_path)\n        if type(hash) is int:\n            done = self.hashfield.removeHashId(hash)\n        else:\n            done = self.hashfield.removeHash(hash)\n        self.site.settings[\"optional_downloaded\"] -= size\n        return done\n\n\nif __name__ == \"__main__\":\n    def testSign():\n        global config\n        from Site import Site\n        site = Site(\"12Hw8rTgzrNo4DSh2AkqwPRqDyTticwJyH\")\n        content_manager = ContentManager(site)\n        content_manager.sign(\n            \"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/content.json\", \"5JCGE6UUruhfmAfcZ2GYjvrswkaiq7uLo6Gmtf2ep2Jh2jtNzWR\"\n        )\n\n    def testVerify():\n        from Site import Site\n        site = Site(\"12Hw8rTgzrNo4DSh2AkqwPRqDyTticwJyH\")\n\n        content_manager = ContentManager(site)\n        print \"Loaded contents:\", content_manager.contents.keys()\n\n        file = open(site.storage.getPath(\"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/content.json\"))\n        print \"content.json valid:\", content_manager.verifyFile(\n            \"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/content.json\", file, ignore_same=False\n        )\n\n        file = open(site.storage.getPath(\"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/messages.json\"))\n        print \"messages.json valid:\", content_manager.verifyFile(\n            \"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/messages.json\", file, ignore_same=False\n        )\n\n    def testInfo():\n        from Site import Site\n        site = Site(\"12Hw8rTgzrNo4DSh2AkqwPRqDyTticwJyH\")\n\n        content_manager = ContentManager(site)\n        print content_manager.contents.keys()\n\n        print content_manager.getFileInfo(\"index.html\")\n        print content_manager.getIncludeInfo(\"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/content.json\")\n        print content_manager.getValidSigners(\"data/users/1KRxE1s3oDyNDawuYWpzbLUwNm8oDbeEp6/content.json\")\n        print content_manager.getValidSigners(\"data/users/content.json\")\n        print content_manager.getValidSigners(\"content.json\")\n\n    import sys\n    import logging\n    os.chdir(\"../..\")\n    sys.path.insert(0, os.path.abspath(\".\"))\n    sys.path.insert(0, os.path.abspath(\"src\"))\n    logging.basicConfig(level=logging.DEBUG)\n\n    # testSign()\n    testVerify()\n    # testInfo()\n","language":"text/x-python","encrypted":false,"added":1483711775},{"paste_id":8,"description":"FileRequest.py Line 101~105","body":"# Included modules\nimport os\nimport time\nimport json\nimport itertools\n\n# Third party modules\nimport gevent\n\nfrom Debug import Debug\nfrom Config import config\nfrom util import RateLimit\nfrom util import StreamingMsgpack\nfrom util import helper\nfrom Plugin import PluginManager\n\nFILE_BUFF = 1024 * 512\n\n\n# Incoming requests\n@PluginManager.acceptPlugins\nclass FileRequest(object):\n    __slots__ = (\"server\", \"connection\", \"req_id\", \"sites\", \"log\", \"responded\")\n\n    def __init__(self, server, connection):\n        self.server = server\n        self.connection = connection\n\n        self.req_id = None\n        self.sites = self.server.sites\n        self.log = server.log\n        self.responded = False  # Responded to the request\n\n    def send(self, msg, streaming=False):\n        if not self.connection.closed:\n            self.connection.send(msg, streaming)\n\n    def sendRawfile(self, file, read_bytes):\n        if not self.connection.closed:\n            self.connection.sendRawfile(file, read_bytes)\n\n    def response(self, msg, streaming=False):\n        if self.responded:\n            if config.verbose:\n                self.log.debug(\"Req id %s already responded\" % self.req_id)\n            return\n        if not isinstance(msg, dict):  # If msg not a dict create a {\"body\": msg}\n            msg = {\"body\": msg}\n        msg[\"cmd\"] = \"response\"\n        msg[\"to\"] = self.req_id\n        self.responded = True\n        self.send(msg, streaming=streaming)\n\n    # Route file requests\n    def route(self, cmd, req_id, params):\n        self.req_id = req_id\n        # Don't allow other sites than locked\n        if \"site\" in params and self.connection.site_lock and self.connection.site_lock not in (params[\"site\"], \"global\"):\n            self.response({\"error\": \"Invalid site\"})\n            self.log.error(\"Site lock violation: %s != %s\" % (self.connection.site_lock != params[\"site\"]))\n            self.connection.badAction(5)\n            return False\n\n        if cmd == \"update\":\n            event = \"%s update %s %s\" % (self.connection.id, params[\"site\"], params[\"inner_path\"])\n            if not RateLimit.isAllowed(event):  # There was already an update for this file in the last 10 second\n                time.sleep(5)\n                self.response({\"ok\": \"File update queued\"})\n            # If called more than once within 15 sec only keep the last update\n            RateLimit.callAsync(event, max(self.connection.bad_actions, 15), self.actionUpdate, params)\n        else:\n            func_name = \"action\" + cmd[0].upper() + cmd[1:]\n            func = getattr(self, func_name, None)\n            if cmd not in [\"getFile\", \"streamFile\"]:  # Skip IO bound functions\n                s = time.time()\n                if self.connection.cpu_time > 0.5:\n                    self.log.debug(\"Delay %s %s, cpu_time used by connection: %.3fs\" % (self.connection.ip, cmd, self.connection.cpu_time))\n                    time.sleep(self.connection.cpu_time)\n                    if self.connection.cpu_time > 5:\n                        self.connection.close()\n            if func:\n                func(params)\n            else:\n                self.actionUnknown(cmd, params)\n\n            if cmd not in [\"getFile\", \"streamFile\"]:\n                taken = time.time() - s\n                self.connection.cpu_time += taken\n\n    # Update a site file request\n    def actionUpdate(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            return False\n\n        if not params[\"inner_path\"].endswith(\"content.json\"):\n            self.response({\"error\": \"Only content.json update allowed\"})\n            return\n\n        if config.isAndroid:\n            from decimal import Decimal\n            content = json.loads(params[\"body\"], parse_float=Decimal) # hack it to be compatible to android, which has float precision issue. Firstly, parse it to Decimal\n        else:\n            content = json.loads(params[\"body\"])\n\n        file_uri = \"%s/%s:%s\" % (site.address, params[\"inner_path\"], content[\"modified\"])\n\n        if self.server.files_parsing.get(file_uri):  # Check if we already working on it\n            valid = None  # Same file\n        else:\n            valid = site.content_manager.verifyFile(params[\"inner_path\"], content)\n\n        if valid is True:  # Valid and changed\n            self.log.info(\"Update for %s/%s looks valid, saving...\" % (params[\"site\"], params[\"inner_path\"]))\n            self.server.files_parsing[file_uri] = True\n            site.storage.write(params[\"inner_path\"], params[\"body\"])\n            del params[\"body\"]\n\n            site.onFileDone(params[\"inner_path\"])  # Trigger filedone\n\n            if params[\"inner_path\"].endswith(\"content.json\"):  # Download every changed file from peer\n                peer = site.addPeer(self.connection.ip, self.connection.port, return_peer=True)  # Add or get peer\n                # On complete publish to other peers\n                diffs = params.get(\"diffs\", {})\n                site.onComplete.once(lambda: site.publish(inner_path=params[\"inner_path\"], diffs=diffs, limit=2), \"publish_%s\" % params[\"inner_path\"])\n\n                # Load new content file and download changed files in new thread\n                def downloader():\n                    site.downloadContent(params[\"inner_path\"], peer=peer, diffs=params.get(\"diffs\", {}))\n                    del self.server.files_parsing[file_uri]\n\n                gevent.spawn(downloader)\n            else:\n                del self.server.files_parsing[file_uri]\n\n            self.response({\"ok\": \"Thanks, file %s updated!\" % params[\"inner_path\"]})\n            self.connection.goodAction()\n\n        elif valid is None:  # Not changed\n            if params.get(\"peer\"):\n                peer = site.addPeer(*params[\"peer\"], return_peer=True)  # Add or get peer\n            else:\n                peer = site.addPeer(self.connection.ip, self.connection.port, return_peer=True)  # Add or get peer\n            if peer:\n                if not peer.connection:\n                    peer.connect(self.connection)  # Assign current connection to peer\n                if params[\"inner_path\"] in site.content_manager.contents:\n                    peer.last_content_json_update = site.content_manager.contents[params[\"inner_path\"]][\"modified\"]\n                if config.verbose:\n                    self.log.debug(\n                        \"Same version, adding new peer for locked files: %s, tasks: %s\" %\n                        (peer.key, len(site.worker_manager.tasks))\n                    )\n                for task in site.worker_manager.tasks:  # New peer add to every ongoing task\n                    if task[\"peers\"] and not task[\"optional_hash_id\"]:\n                        # Download file from this peer too if its peer locked\n                        site.needFile(task[\"inner_path\"], peer=peer, update=True, blocking=False)\n\n            self.response({\"ok\": \"File not changed\"})\n            self.connection.badAction()\n\n        else:  # Invalid sign or sha hash\n            self.log.debug(\"Update for %s is invalid\" % params[\"inner_path\"])\n            self.response({\"error\": \"File invalid\"})\n            self.connection.badAction(5)\n\n    # Send file content request\n    def actionGetFile(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            return False\n        try:\n            file_path = site.storage.getPath(params[\"inner_path\"])\n            with StreamingMsgpack.FilePart(file_path, \"rb\") as file:\n                file.seek(params[\"location\"])\n                file.read_bytes = FILE_BUFF\n                file_size = os.fstat(file.fileno()).st_size\n                if params[\"location\"] > file_size:\n                    self.connection.badAction(5)\n                    raise Exception(\"Bad file location\")\n\n                back = {\n                    \"body\": file,\n                    \"size\": file_size,\n                    \"location\": min(file.tell() + FILE_BUFF, file_size)\n                }\n                self.response(back, streaming=True)\n\n                bytes_sent = min(FILE_BUFF, file_size - params[\"location\"])  # Number of bytes we going to send\n                site.settings[\"bytes_sent\"] = site.settings.get(\"bytes_sent\", 0) + bytes_sent\n            if config.debug_socket:\n                self.log.debug(\"File %s at position %s sent %s bytes\" % (file_path, params[\"location\"], bytes_sent))\n\n            # Add peer to site if not added before\n            connected_peer = site.addPeer(self.connection.ip, self.connection.port)\n            if connected_peer:  # Just added\n                connected_peer.connect(self.connection)  # Assign current connection to peer\n\n            return {\"bytes_sent\": bytes_sent, \"file_size\": file_size, \"location\": params[\"location\"]}\n\n        except Exception, err:\n            self.log.debug(\"GetFile read error: %s\" % Debug.formatException(err))\n            self.response({\"error\": \"File read error: %s\" % Debug.formatException(err)})\n            return False\n\n    # New-style file streaming out of Msgpack context\n    def actionStreamFile(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            return False\n        try:\n            if config.debug_socket:\n                self.log.debug(\"Opening file: %s\" % params[\"inner_path\"])\n            with site.storage.open(params[\"inner_path\"]) as file:\n                file.seek(params[\"location\"])\n                file_size = os.fstat(file.fileno()).st_size\n                stream_bytes = min(FILE_BUFF, file_size - params[\"location\"])\n                if stream_bytes < 0:\n                    self.connection.badAction(5)\n                    raise Exception(\"Bad file location\")\n\n                back = {\n                    \"size\": file_size,\n                    \"location\": min(file.tell() + FILE_BUFF, file_size),\n                    \"stream_bytes\": stream_bytes\n                }\n                if config.debug_socket:\n                    self.log.debug(\n                        \"Sending file %s from position %s to %s\" %\n                        (params[\"inner_path\"], params[\"location\"], back[\"location\"])\n                    )\n                self.response(back)\n                self.sendRawfile(file, read_bytes=FILE_BUFF)\n\n                site.settings[\"bytes_sent\"] = site.settings.get(\"bytes_sent\", 0) + stream_bytes\n            if config.debug_socket:\n                self.log.debug(\"File %s at position %s sent %s bytes\" % (params[\"inner_path\"], params[\"location\"], stream_bytes))\n\n            # Add peer to site if not added before\n            connected_peer = site.addPeer(self.connection.ip, self.connection.port)\n            if connected_peer:  # Just added\n                connected_peer.connect(self.connection)  # Assign current connection to peer\n\n            return {\"bytes_sent\": stream_bytes, \"file_size\": file_size, \"location\": params[\"location\"]}\n\n        except Exception, err:\n            self.log.debug(\"GetFile read error: %s\" % Debug.formatException(err))\n            self.response({\"error\": \"File read error: %s\" % Debug.formatException(err)})\n            return False\n\n    # Peer exchange request\n    def actionPex(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            return False\n\n        got_peer_keys = []\n        added = 0\n\n        # Add requester peer to site\n        connected_peer = site.addPeer(self.connection.ip, self.connection.port)\n        if connected_peer:  # It was not registered before\n            added += 1\n            connected_peer.connect(self.connection)  # Assign current connection to peer\n\n        # Add sent peers to site\n        for packed_address in params.get(\"peers\", []):\n            address = helper.unpackAddress(packed_address)\n            got_peer_keys.append(\"%s:%s\" % address)\n            if site.addPeer(*address):\n                added += 1\n\n        # Add sent peers to site\n        for packed_address in params.get(\"peers_onion\", []):\n            address = helper.unpackOnionAddress(packed_address)\n            got_peer_keys.append(\"%s:%s\" % address)\n            if site.addPeer(*address):\n                added += 1\n\n        # Send back peers that is not in the sent list and connectable (not port 0)\n        packed_peers = helper.packPeers(site.getConnectablePeers(params[\"need\"], got_peer_keys))\n\n        if added:\n            site.worker_manager.onPeers()\n            if config.verbose:\n                self.log.debug(\n                    \"Added %s peers to %s using pex, sending back %s\" %\n                    (added, site, len(packed_peers[\"ip4\"]) + len(packed_peers[\"onion\"]))\n                )\n\n        back = {}\n        if packed_peers[\"ip4\"]:\n            back[\"peers\"] = packed_peers[\"ip4\"]\n        if packed_peers[\"onion\"]:\n            back[\"peers_onion\"] = packed_peers[\"onion\"]\n\n        self.response(back)\n\n    # Get modified content.json files since\n    def actionListModified(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            return False\n        modified_files = site.content_manager.listModified(params[\"since\"])\n\n        # Add peer to site if not added before\n        connected_peer = site.addPeer(self.connection.ip, self.connection.port)\n        if connected_peer:  # Just added\n            connected_peer.connect(self.connection)  # Assign current connection to peer\n\n        self.response({\"modified_files\": modified_files})\n\n    def actionGetHashfield(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            return False\n\n        # Add peer to site if not added before\n        peer = site.addPeer(self.connection.ip, self.connection.port, return_peer=True)\n        if not peer.connection:  # Just added\n            peer.connect(self.connection)  # Assign current connection to peer\n\n        peer.time_my_hashfield_sent = time.time()  # Don't send again if not changed\n\n        self.response({\"hashfield_raw\": site.content_manager.hashfield.tostring()})\n\n    def findHashIds(self, site, hash_ids, limit=100):\n        back_ip4 = {}\n        back_onion = {}\n        found = site.worker_manager.findOptionalHashIds(hash_ids, limit=limit)\n\n        for hash_id, peers in found.iteritems():\n            back_onion[hash_id] = list(itertools.islice((\n                helper.packOnionAddress(peer.ip, peer.port)\n                for peer in peers\n                if peer.ip.endswith(\"onion\")\n            ), 50))\n            back_ip4[hash_id] = list(itertools.islice((\n                helper.packAddress(peer.ip, peer.port)\n                for peer in peers\n                if not peer.ip.endswith(\"onion\")\n            ), 50))\n        return back_ip4, back_onion\n\n    def actionFindHashIds(self, params):\n        site = self.sites.get(params[\"site\"])\n        s = time.time()\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            self.connection.badAction(5)\n            return False\n\n        event_key = \"%s_findHashIds_%s_%s\" % (self.connection.ip, params[\"site\"], len(params[\"hash_ids\"]))\n        if self.connection.cpu_time > 0.5 or not RateLimit.isAllowed(event_key, 60 * 5):\n            time.sleep(0.1)\n            back_ip4, back_onion = self.findHashIds(site, params[\"hash_ids\"], limit=10)\n        else:\n            back_ip4, back_onion = self.findHashIds(site, params[\"hash_ids\"])\n        RateLimit.called(event_key)\n\n        # Check my hashfield\n        if self.server.tor_manager and self.server.tor_manager.site_onions.get(site.address):  # Running onion\n            my_ip = helper.packOnionAddress(self.server.tor_manager.site_onions[site.address], self.server.port)\n            my_back = back_onion\n        elif config.ip_external:  # External ip defined\n            my_ip = helper.packAddress(config.ip_external, self.server.port)\n            my_back = back_ip4\n        else:  # No external ip defined\n            my_ip = my_ip = helper.packAddress(self.server.ip, self.server.port)\n            my_back = back_ip4\n\n        my_hashfield_set = set(site.content_manager.hashfield)\n        for hash_id in params[\"hash_ids\"]:\n            if hash_id in my_hashfield_set:\n                if hash_id not in my_back:\n                    my_back[hash_id] = []\n                my_back[hash_id].append(my_ip)  # Add myself\n\n        if config.verbose:\n            self.log.debug(\n                \"Found: IP4: %s, Onion: %s for %s hashids in %.3fs\" %\n                (len(back_ip4), len(back_onion), len(params[\"hash_ids\"]), time.time() - s)\n            )\n        self.response({\"peers\": back_ip4, \"peers_onion\": back_onion})\n\n    def actionSetHashfield(self, params):\n        site = self.sites.get(params[\"site\"])\n        if not site or not site.settings[\"serving\"]:  # Site unknown or not serving\n            self.response({\"error\": \"Unknown site\"})\n            self.connection.badAction(5)\n            return False\n\n        # Add or get peer\n        peer = site.addPeer(self.connection.ip, self.connection.port, return_peer=True, connection=self.connection)\n        if not peer.connection:\n            peer.connect(self.connection)\n        peer.hashfield.replaceFromString(params[\"hashfield_raw\"])\n        self.response({\"ok\": \"Updated\"})\n\n    def actionSiteReload(self, params):\n        if self.connection.ip != \"127.0.0.1\" and self.connection.ip != config.ip_external:\n            self.response({\"error\": \"Only local host allowed\"})\n\n        site = self.sites.get(params[\"site\"])\n        site.content_manager.loadContent(params[\"inner_path\"], add_bad_files=False)\n        site.storage.verifyFiles(quick_check=True)\n        site.updateWebsocket()\n\n        self.response({\"ok\": \"Reloaded\"})\n\n    def actionSitePublish(self, params):\n        if self.connection.ip != \"127.0.0.1\" and self.connection.ip != config.ip_external:\n            self.response({\"error\": \"Only local host allowed\"})\n\n        site = self.sites.get(params[\"site\"])\n        num = site.publish(limit=8, inner_path=params.get(\"inner_path\", \"content.json\"), diffs=params.get(\"diffs\", {}))\n\n        self.response({\"ok\": \"Successfuly published to %s peers\" % num})\n\n    # Send a simple Pong! answer\n    def actionPing(self, params):\n        self.response(\"Pong!\")\n\n    # Unknown command\n    def actionUnknown(self, cmd, params):\n        self.response({\"error\": \"Unknown command: %s\" % cmd})\n        self.connection.badAction(5)\n","language":"text/x-python","encrypted":false,"added":1483712055},{"paste_id":9,"description":"main.py Line 86~94","body":"# Included modules\nimport os\nimport sys\nimport stat\nimport time\nimport logging\n\n# Third party modules\nimport gevent\n\nfrom gevent import monkey\nif \"patch_subprocess\" in dir(monkey):  # New gevent\n    monkey.patch_all(thread=False, subprocess=False)\nelse:  # Old gevent\n    import ssl\n    # Fix PROTOCOL_SSLv3 not defined\n    if \"PROTOCOL_SSLv3\" not in dir(ssl):\n        ssl.PROTOCOL_SSLv3 = ssl.PROTOCOL_SSLv23\n    monkey.patch_all(thread=False)\n# Not thread: pyfilesystem and systray icon, Not subprocess: Gevent 1.1+\n\nupdate_after_shutdown = False  # If set True then update and restart zeronet after main loop ended\n\n# Load config\nfrom Config import config\nconfig.parse(silent=True)  # Plugins need to access the configuration\nif not config.arguments:  # Config parse failed, show the help screen and exit\n    config.parse()\n\n# Create necessary files and dirs\nif not os.path.isdir(config.log_dir):\n    os.mkdir(config.log_dir)\nif not os.path.isdir(config.data_dir):\n    os.mkdir(config.data_dir)\nif not os.path.isfile(\"%s/sites.json\" % config.data_dir):\n    open(\"%s/sites.json\" % config.data_dir, \"w\").write(\"{}\")\n    os.chmod(\"%s/sites.json\" % config.data_dir, stat.S_IRUSR | stat.S_IWUSR)\nif not os.path.isfile(\"%s/users.json\" % config.data_dir):\n    open(\"%s/users.json\" % config.data_dir, \"w\").write(\"{}\")\n    os.chmod(\"%s/users.json\" % config.data_dir, stat.S_IRUSR | stat.S_IWUSR)\n\n# Setup logging\nif config.action == \"main\":\n    from util import helper\n    log_file_path = \"%s/debug.log\" % config.log_dir\n    try:\n        lock = helper.openLocked(\"%s/lock.pid\" % config.data_dir, \"w\")\n        lock.write(\"%s\" % os.getpid())\n    except IOError as err:\n        print \"Can't open lock file, your ZeroNet client is probably already running, exiting... (%s)\" % err\n        if config.open_browser:\n            print \"Opening browser: %s...\", config.open_browser\n            import webbrowser\n            if config.open_browser == \"default_browser\":\n                browser = webbrowser.get()\n            else:\n                browser = webbrowser.get(config.open_browser)\n            browser.open(\"http://%s:%s/%s\" % (config.ui_ip if config.ui_ip != \"*\" else \"127.0.0.1\", config.ui_port, config.homepage), new=2)\n        sys.exit()\n\n    if os.path.isfile(\"%s/debug.log\" % config.log_dir):  # Simple logrotate\n        if os.path.isfile(\"%s/debug-last.log\" % config.log_dir):\n            os.unlink(\"%s/debug-last.log\" % config.log_dir)\n        os.rename(\"%s/debug.log\" % config.log_dir, \"%s/debug-last.log\" % config.log_dir)\n    logging.basicConfig(\n        format='[%(asctime)s] %(levelname)-8s %(name)s %(message)s',\n        level=logging.DEBUG, stream=open(log_file_path, \"a\")\n    )\nelse:\n    log_file_path = \"%s/cmd.log\" % config.log_dir\n    logging.basicConfig(\n        format='[%(asctime)s] %(levelname)-8s %(name)s %(message)s',\n        level=logging.DEBUG, stream=open(log_file_path, \"w\")\n    )\n\n# Console logger\nconsole_log = logging.StreamHandler()\nif config.action == \"main\":  # Add time if main action\n    console_log.setFormatter(logging.Formatter('[%(asctime)s] %(name)s %(message)s', \"%H:%M:%S\"))\nelse:\n    console_log.setFormatter(logging.Formatter('%(name)s %(message)s', \"%H:%M:%S\"))\n\nlogging.getLogger('').addHandler(console_log)  # Add console logger\nlogging.getLogger('').name = \"-\"  # Remove root prefix\n\n# Detect for Android\ntry: # TODO:  probably here is not the best place to do that. Also, probably there is better way to detect. Please improve.\n    from jnius import JavaClass\n    import kivy\n    config.isAndroid = True\n    logging.info(\"Probably on Android, apply patch for Android float precision issue.\")\nexcept:\n    config.isAndroid = False\n    logging.info(\"Not on Android, no need to apply patch for Android float precision issue.\")\n\n# Debug dependent configuration\nfrom Debug import DebugHook\nif config.debug:\n    console_log.setLevel(logging.DEBUG)  # Display everything to console\nelse:\n    console_log.setLevel(logging.INFO)  # Display only important info to console\n\n# Load plugins\nfrom Plugin import PluginManager\nPluginManager.plugin_manager.loadPlugins()\nconfig.loadPlugins()\nconfig.parse()  # Parse again to add plugin configuration options\n\n# Log current config\nlogging.debug(\"Config: %s\" % config)\n\n# Use pure-python implementation of msgpack to save CPU\nif config.msgpack_purepython:\n    os.environ[\"MSGPACK_PUREPYTHON\"] = \"True\"\n\n# Socks Proxy monkey patch\nif config.proxy:\n    from util import SocksProxy\n    import urllib2\n    logging.info(\"Patching sockets to socks proxy: %s\" % config.proxy)\n    config.fileserver_ip = '127.0.0.1'  # Do not accept connections anywhere but localhost\n    SocksProxy.monkeyPatch(*config.proxy.split(\":\"))\nelif config.tor == \"always\":\n    from util import SocksProxy\n    import urllib2\n    logging.info(\"Patching sockets to tor socks proxy: %s\" % config.tor_proxy)\n    config.fileserver_ip = '127.0.0.1'  # Do not accept connections anywhere but localhost\n    SocksProxy.monkeyPatch(*config.tor_proxy.split(\":\"))\n    config.disable_udp = True\n# -- Actions --\n\n\n@PluginManager.acceptPlugins\nclass Actions(object):\n    def call(self, function_name, kwargs):\n        logging.info(\"Version: %s r%s, Python %s, Gevent: %s\" % (config.version, config.rev, sys.version, gevent.__version__))\n\n        func = getattr(self, function_name, None)\n        func(**kwargs)\n\n    # Default action: Start serving UiServer and FileServer\n    def main(self):\n        global ui_server, file_server\n        from File import FileServer\n        from Ui import UiServer\n        logging.info(\"Creating FileServer....\")\n        file_server = FileServer()\n        logging.info(\"Creating UiServer....\")\n        ui_server = UiServer()\n\n        logging.info(\"Removing old SSL certs...\")\n        from Crypt import CryptConnection\n        CryptConnection.manager.removeCerts()\n\n        logging.info(\"Starting servers....\")\n        gevent.joinall([gevent.spawn(ui_server.start), gevent.spawn(file_server.start)])\n\n    # Site commands\n\n    def siteCreate(self):\n        logging.info(\"Generating new privatekey...\")\n        from Crypt import CryptBitcoin\n        privatekey = CryptBitcoin.newPrivatekey()\n        logging.info(\"----------------------------------------------------------------------\")\n        logging.info(\"Site private key: %s\" % privatekey)\n        logging.info(\"                  !!! ^ Save it now, required to modify the site ^ !!!\")\n        address = CryptBitcoin.privatekeyToAddress(privatekey)\n        logging.info(\"Site address:     %s\" % address)\n        logging.info(\"----------------------------------------------------------------------\")\n\n        while True and not config.batch:\n            if raw_input(\"? Have you secured your private key? (yes, no) > \").lower() == \"yes\":\n                break\n            else:\n                logging.info(\"Please, secure it now, you going to need it to modify your site!\")\n\n        logging.info(\"Creating directory structure...\")\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        os.mkdir(\"%s/%s\" % (config.data_dir, address))\n        open(\"%s/%s/index.html\" % (config.data_dir, address), \"w\").write(\"Hello %s!\" % address)\n\n        logging.info(\"Creating content.json...\")\n        site = Site(address)\n        site.content_manager.sign(privatekey=privatekey, extend={\"postmessage_nonce_security\": True})\n        site.settings[\"own\"] = True\n        site.saveSettings()\n\n        logging.info(\"Site created!\")\n\n    def siteSign(self, address, privatekey=None, inner_path=\"content.json\", publish=False):\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n        logging.info(\"Signing site: %s...\" % address)\n        site = Site(address, allow_create=False)\n\n        if not privatekey:  # If no privatekey defined\n            from User import UserManager\n            user = UserManager.user_manager.get()\n            if user:\n                site_data = user.getSiteData(address)\n                privatekey = site_data.get(\"privatekey\")\n            else:\n                privatekey = None\n            if not privatekey:\n                # Not found in users.json, ask from console\n                import getpass\n                privatekey = getpass.getpass(\"Private key (input hidden):\")\n        diffs = site.content_manager.getDiffs(inner_path)\n        succ = site.content_manager.sign(inner_path=inner_path, privatekey=privatekey, update_changed_files=True)\n        if succ and publish:\n            self.sitePublish(address, inner_path=inner_path, diffs=diffs)\n\n    def siteVerify(self, address):\n        import time\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        s = time.time()\n        logging.info(\"Verifing site: %s...\" % address)\n        site = Site(address)\n        bad_files = []\n\n        for content_inner_path in site.content_manager.contents:\n            s = time.time()\n            logging.info(\"Verifing %s signature...\" % content_inner_path)\n            file_correct = site.content_manager.verifyFile(\n                content_inner_path, site.storage.open(content_inner_path, \"rb\"), ignore_same=False\n            )\n            if file_correct is True:\n                logging.info(\"[OK] %s (Done in %.3fs)\" % (content_inner_path, time.time() - s))\n            else:\n                logging.error(\"[ERROR] %s: invalid file!\" % content_inner_path)\n                raw_input(\"Continue?\")\n                bad_files += content_inner_path\n\n        logging.info(\"Verifying site files...\")\n        bad_files += site.storage.verifyFiles()\n        if not bad_files:\n            logging.info(\"[OK] All file sha512sum matches! (%.3fs)\" % (time.time() - s))\n        else:\n            logging.error(\"[ERROR] Error during verifying site files!\")\n\n    def dbRebuild(self, address):\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        logging.info(\"Rebuilding site sql cache: %s...\" % address)\n        site = SiteManager.site_manager.get(address)\n        s = time.time()\n        site.storage.rebuildDb()\n        logging.info(\"Done in %.3fs\" % (time.time() - s))\n\n    def dbQuery(self, address, query):\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        import json\n        site = Site(address)\n        result = []\n        for row in site.storage.query(query):\n            result.append(dict(row))\n        print json.dumps(result, indent=4)\n\n    def siteAnnounce(self, address):\n        from Site.Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        logging.info(\"Announcing site %s to tracker...\" % address)\n        site = Site(address)\n\n        s = time.time()\n        site.announce()\n        print \"Response time: %.3fs\" % (time.time() - s)\n        print site.peers\n\n    def siteDownload(self, address):\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        logging.info(\"Opening a simple connection server\")\n        global file_server\n        from Connection import ConnectionServer\n        file_server = ConnectionServer(\"127.0.0.1\", 1234)\n\n        site = Site(address)\n\n        on_completed = gevent.event.AsyncResult()\n\n        def onComplete(evt):\n            evt.set(True)\n\n        site.onComplete.once(lambda: onComplete(on_completed))\n        print \"Announcing...\"\n        site.announce()\n\n        s = time.time()\n        print \"Downloading...\"\n        site.downloadContent(\"content.json\", check_modifications=True)\n\n        print on_completed.get()\n        print \"Downloaded in %.3fs\" % (time.time()-s)\n\n\n    def siteNeedFile(self, address, inner_path):\n        from Site import Site\n        from Site import SiteManager\n        SiteManager.site_manager.load()\n\n        def checker():\n            while 1:\n                s = time.time()\n                time.sleep(1)\n                print \"Switch time:\", time.time() - s\n        gevent.spawn(checker)\n\n        logging.info(\"Opening a simple connection server\")\n        global file_server\n        from Connection import ConnectionServer\n        file_server = ConnectionServer(\"127.0.0.1\", 1234)\n\n        site = Site(address)\n        site.announce()\n        print site.needFile(inner_path, update=True)\n\n    def sitePublish(self, address, peer_ip=None, peer_port=15441, inner_path=\"content.json\", diffs={}):\n        global file_server\n        from Site import Site\n        from Site import SiteManager\n        from File import FileServer  # We need fileserver to handle incoming file requests\n        from Peer import Peer\n        SiteManager.site_manager.load()\n\n        logging.info(\"Loading site...\")\n        site = Site(address, allow_create=False)\n        site.settings[\"serving\"] = True  # Serving the site even if its disabled\n\n        logging.info(\"Creating FileServer....\")\n        file_server = FileServer()\n        site.connection_server = file_server\n        file_server_thread = gevent.spawn(file_server.start, check_sites=False)  # Dont check every site integrity\n        time.sleep(0.001)\n\n        if not file_server_thread.ready():\n            # Started fileserver\n            file_server.openport()\n            if peer_ip:  # Announce ip specificed\n                site.addPeer(peer_ip, peer_port)\n            else:  # Just ask the tracker\n                logging.info(\"Gathering peers from tracker\")\n                site.announce()  # Gather peers\n            published = site.publish(5, inner_path, diffs=diffs)  # Push to peers\n            if published > 0:\n                time.sleep(3)\n                logging.info(\"Serving files (max 60s)...\")\n                gevent.joinall([file_server_thread], timeout=60)\n                logging.info(\"Done.\")\n            else:\n                logging.info(\"No peers found, sitePublish command only works if you already have visitors serving your site\")\n        else:\n            # Already running, notify local client on new content\n            logging.info(\"Sending siteReload\")\n            my_peer = Peer(\"127.0.0.1\", config.fileserver_port)\n            logging.info(my_peer.request(\"siteReload\", {\"site\": site.address, \"inner_path\": inner_path}))\n            logging.info(\"Sending sitePublish\")\n            logging.info(my_peer.request(\"sitePublish\", {\"site\": site.address, \"inner_path\": inner_path, \"diffs\": diffs}))\n            logging.info(\"Done.\")\n\n    # Crypto commands\n    def cryptPrivatekeyToAddress(self, privatekey=None):\n        from Crypt import CryptBitcoin\n        if not privatekey:  # If no privatekey in args then ask it now\n            import getpass\n            privatekey = getpass.getpass(\"Private key (input hidden):\")\n\n        print CryptBitcoin.privatekeyToAddress(privatekey)\n\n    def cryptSign(self, message, privatekey):\n        from Crypt import CryptBitcoin\n        print CryptBitcoin.sign(message, privatekey)\n\n    # Peer\n    def peerPing(self, peer_ip, peer_port=None):\n        if not peer_port:\n            peer_port = config.fileserver_port\n        logging.info(\"Opening a simple connection server\")\n        global file_server\n        from Connection import ConnectionServer\n        file_server = ConnectionServer(\"127.0.0.1\", 1234)\n        from Crypt import CryptConnection\n        CryptConnection.manager.loadCerts()\n\n        from Peer import Peer\n        logging.info(\"Pinging 5 times peer: %s:%s...\" % (peer_ip, int(peer_port)))\n        peer = Peer(peer_ip, peer_port)\n        for i in range(5):\n            print \"Response time: %.3fs (crypt: %s)\" % (peer.ping(), peer.connection.crypt)\n            time.sleep(1)\n        peer.remove()\n        print \"Reconnect test...\"\n        peer = Peer(peer_ip, peer_port)\n        for i in range(5):\n            print \"Response time: %.3fs (crypt: %s)\" % (peer.ping(), peer.connection.crypt)\n            time.sleep(1)\n\n    def peerGetFile(self, peer_ip, peer_port, site, filename, benchmark=False):\n        logging.info(\"Opening a simple connection server\")\n        global file_server\n        from Connection import ConnectionServer\n        file_server = ConnectionServer(\"127.0.0.1\", 1234)\n        from Crypt import CryptConnection\n        CryptConnection.manager.loadCerts()\n\n        from Peer import Peer\n        logging.info(\"Getting %s/%s from peer: %s:%s...\" % (site, filename, peer_ip, peer_port))\n        peer = Peer(peer_ip, peer_port)\n        s = time.time()\n        if benchmark:\n            for i in range(10):\n                peer.getFile(site, filename),\n            print \"Response time: %.3fs\" % (time.time() - s)\n            raw_input(\"Check memory\")\n        else:\n            print peer.getFile(site, filename).read()\n\n    def peerCmd(self, peer_ip, peer_port, cmd, parameters):\n        logging.info(\"Opening a simple connection server\")\n        global file_server\n        from Connection import ConnectionServer\n        file_server = ConnectionServer()\n        from Crypt import CryptConnection\n        CryptConnection.manager.loadCerts()\n\n        from Peer import Peer\n        peer = Peer(peer_ip, peer_port)\n\n        import json\n        if parameters:\n            parameters = json.loads(parameters.replace(\"'\", '\"'))\n        else:\n            parameters = {}\n        logging.info(\"Response: %s\" % peer.request(cmd, parameters))\n\n\nactions = Actions()\n# Starts here when running zeronet.py\n\n\ndef start():\n    # Call function\n    action_kwargs = config.getActionArguments()\n    actions.call(config.action, action_kwargs)\n","language":"text/x-python","encrypted":false,"added":1483712247},{"paste_id":10,"description":"main.py","body":"from jnius import autoclass\n\nimport os\nimport shutil\n\nEnvironment = autoclass('android.os.Environment')\nmActivity = autoclass('org.kivy.android.PythonActivity').mActivity\n\nsrcinject = os.path.join(os.environ['ANDROID_APP_PATH'],  'inject.py_') # The original filename is inject.py_ to avoid converting to pyo file while pacing\ndstinject = os.path.join(mActivity.getExternalFilesDir(None).getPath(), 'inject.py')\nif not os.path.exists(dstinject):\n    shutil.copyfile(srcinject, dstinject) # Copy inject.py to ExternalFilesDir, so that users can modify it without root\n    \nextdir = mActivity.getExternalFilesDir(None).getPath()\nsys.path.insert(0,  extdir)  # Use inject.py in ExternalFilesDir\nimport inject\ndef main():\n    inject.ZeronetApp().run()\n\nif __name__ == '__main__':\n    main()","language":"text/x-python","encrypted":false,"added":1484147499},{"paste_id":11,"description":"inject.py_","body":"#!/usr/bin/python\n# -*- coding: utf-8 -*-\nfrom kivy.app import App\nfrom kivy.lang import Builder\nfrom kivy.utils import platform\nimport os\nimport shutil\nfrom jnius import autoclass\nfrom kivy.config import Config\nConfig.set('kivy', 'log_enable', 1)\nConfig.write()\n\nprint os.path.dirname(__file__)\nprint \"ANDROID_APP_PATH: %s\" % os.environ['ANDROID_APP_PATH']\nprint \"EXTERNAL_STORAGE: %s\" % os.environ['EXTERNAL_STORAGE']\n\n# GUI, somewhat like CSS.  This can also be move to a seperate kv file\nkv = '''\n<Label>:\n    font_size: 50\n    font_name: \"DroidSansFallback\"\n    markup: True\nBoxLayout:\n    orientation: 'vertical'\n    \n    Label:\n        id: Welcome\n        text: ' Welcome to [b]ZeroNet[/b]! \\\\nClick links below to open sites in browser\\\\n（欢迎来到ZeroNet！\\\\n点击以下链接在浏览器中打开网站）'\n    Label:\n        id: ZeroHello\n        text: ' [ref=http://127.0.0.1:43110/][b]ZeroHello[/b] Home page\\\\n（ZeroHello首页）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/')\n    Label:\n        id: ZeroMe\n        text: ' [ref=http://127.0.0.1:43110//Me.ZeroNetwork.bit]P2P social network [b]ZeroMe[/b]\\\\n（P2P社交网络ZeroMe）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Me.ZeroNetwork.bit')\n    Label:\n        id: GFWTalk\n        text: ' [ref=http://127.0.0.1:43110//GFWTalk.bit]P2P Chinese forum [b]GFW Talk[/b]\\\\n（P2P中文论坛）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/GFWTalk.bit')\n    Label:\n        id: Note_en\n        font_size: 30\n        text: 'To close ZeroNet background service nicely,\\\\n please click ZeroHello\\\\'s top-left ┇ button,\\\\n choose Shut down ZeroNet, thanks!\\\\nMore info & discussions please click here! (En version)'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:11_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n    Label:\n        id: Note_zh\n        font_size: 30\n        text: '（想要妥善地关闭ZeroNet后台服务，\\\\n请在浏览器中点击ZeroHello首页左上方的 ┇ 按钮,\\\\n 选择关闭ZeroNet，谢谢！\\\\n更多信息和相关讨论点这里（中文版））'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/gfwtalk.bit/?Topic:55_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n'''\n\nclass ZeronetApp(App):\n    def build(self):\n\n        if platform == 'android':\n#            from android import AndroidService # This AndroidService does NOT work! Changed to  jnius's autoclass\n#            service = AndroidService('ZeroNet', 'ZeroNet running, please stop it in browser')\n#            arg = '--config_file '+ os.path.join(dstdir, 'zeronet.conf') + ' --connected_limit = 5'\n#            print arg\n#            # service.start(arg)\n#            service.start()\n#            self.service = service\n            \n            from jnius import autoclass\n\n            Environment = autoclass('android.os.Environment')\n            # Store the  whole ZeroNet dir ( \"zero\" dir here, including all ZeroNet source code dir and  data_dir ) to public external storage in order to save phone's internal space and allow users modify them without root.\n            # But there is concern of some sensitive data e.g. users.json is accessible by other apps in the phone. So more argument to specify sensitive data dir to internal space and import users.json etc. is needed in ZeroNet itself.FIXME\n#            Context = autoclass('android.content.Context')\n#            sdpath = Environment.getExternalStorageDirectory().getAbsolutePath()\n#            print \"sdpath: %s \" % sdpath # sdpath points to Emulated storage root\n#            sdpath1 = App.get_running_app().user_data_dir\n#            print \"sdpath1 %s \" % sdpath1 # sdpath points to Emulated_storage/zeronet ( becaose of ZeronetApp)\n            # Writing to both sdpath and sdpath1 may get \"Operation not permitted \" even have declare WRITE_EXTERNAL_STORAGE permission when packing.\n            # But the files are successfully written to sdpath and sdpath1. Of course we can ingore the return error, but writing there may be unreliable.\n            # During test, shutil.copyfile is less likely to the the error than shutil.copy2\n            service = autoclass('android.test.myapp17.ServiceZn')\n            mActivity = autoclass('org.kivy.android.PythonActivity').mActivity\n\n            srczerodir = os.path.join(os.environ['ANDROID_APP_PATH'],  'zero')\n            dstzerodir = os.path.join(mActivity.getExternalFilesDir(None).getPath(), 'zero') # getExternalFilesDir points to Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/\n            env = dict({'dstzerodir': dstzerodir})\n            import json\n            with open(\"env.json\", \"w\") as f:\n                json.dump(env, f) # save the path Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/ to file for serviceloader.py using\n            try:\n                shutil.copytree(srczerodir, dstzerodir ) # shutil.copytree will refuse to copy if destination exits.\n            except:\n                pass\n            argument = ''\n            service.start(mActivity, argument) # start service ( system will run serviceloader.py)\n\n        return Builder.load_string(kv)\n    \n#ZeronetApp().run()\n\nif __name__ == '__main__':\n    ZeronetApp().run()\n","language":"text/x-python","encrypted":false,"added":1484147783},{"paste_id":12,"description":"serviceloader.py","body":"import os\nimport sys\nimport json\n\nwith open('env.json', 'r') as f:\n     env = json.load(f)\ndstzerodir = env['dstzerodir'] # Read dstzerodir from file\nprint dstzerodir\nsys.path.insert(0,  dstzerodir) \n\nimport zeronet\n\ndef main():\n    zeronet.main()\n\nif __name__ == '__main__':\n    main()\n","language":"text/x-python","encrypted":false,"added":1484147821},{"paste_id":13,"description":"main.py","body":"from jnius import autoclass\n\nimport os\nimport shutil\n\n\nEnvironment = autoclass('android.os.Environment')\nmActivity = autoclass('org.kivy.android.PythonActivity').mActivity\n\next_kivylogs = os.path.join(mActivity.getExternalFilesDir(None).getPath(), 'kivy_logs')\nfrom kivy.config import Config\nConfig.set('kivy', 'log_dir', ext_kivylogs) # Set kivy logs to ExternalFilesDir, so that users can see them without root\nConfig.write()\n\nsrcinject = os.path.join(os.environ['ANDROID_APP_PATH'],  'inject.py_') # The original filename is inject.py_ to avoid converting to pyo file while packing\ndstinject = os.path.join(mActivity.getExternalFilesDir(None).getPath(), 'inject.py')\nif not os.path.exists(dstinject):\n    shutil.copyfile(srcinject, dstinject) # Copy inject.py to ExternalFilesDir, so that users can modify it without root\n    \nextdir = mActivity.getExternalFilesDir(None).getPath()\nsys.path.insert(0,  extdir)  # Use inject.py in ExternalFilesDir\nimport inject\ndef main():\n    inject.ZeronetApp().run()\n\nif __name__ == '__main__':\n    main()\n","language":"text/x-python","encrypted":false,"added":1484499199},{"paste_id":14,"description":"inject.py_","body":"#!/usr/bin/python\n# -*- coding: utf-8 -*-\nfrom kivy.app import App\nfrom kivy.lang import Builder\nfrom kivy.utils import platform\nimport os\nimport shutil\nfrom jnius import autoclass\nfrom kivy.config import Config\nConfig.set('kivy', 'log_enable', 1)\nConfig.write()\n\nprint os.path.dirname(__file__)\nprint \"ANDROID_APP_PATH: %s\" % os.environ['ANDROID_APP_PATH']\nprint \"EXTERNAL_STORAGE: %s\" % os.environ['EXTERNAL_STORAGE']\n\n# GUI, somewhat like CSS.  This can also be move to a seperate kv file\nkv = '''\n<Label>:\n    font_size: '15sp'\n    font_name: \"DroidSansFallback\"\n    markup: True\nBoxLayout:\n    orientation: 'vertical'\n    \n    Label:\n        id: Welcome\n        text: ' Welcome to [b]ZeroNet[/b]! \\\\nClick links below to open sites in browser\\\\n（欢迎来到ZeroNet！\\\\n点击以下链接在浏览器中打开网站）'\n    Label:\n        id: ZeroHello\n        text: ' [ref=http://127.0.0.1:43110/][b]ZeroHello[/b] Home page\\\\n（ZeroHello首页）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/')\n    Label:\n        id: ZeroMe\n        text: ' [ref=http://127.0.0.1:43110//Me.ZeroNetwork.bit]P2P social network [b]ZeroMe[/b]\\\\n（P2P社交网络ZeroMe）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Me.ZeroNetwork.bit')\n    Label:\n        id: GFWTalk\n        text: ' [ref=http://127.0.0.1:43110//GFWTalk.bit]P2P Chinese forum [b]GFW Talk[/b]\\\\n（P2P中文论坛）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/GFWTalk.bit')\n    Label:\n        id: Note_en\n        font_size: '10sp'\n        text: '[ref=http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:13_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/]To close ZeroNet background service nicely,\\\\n please click ZeroHello\\\\'s top-left ┇ button,\\\\n choose Shut down ZeroNet, thanks!\\\\nMore info & discussions please click here! (En version)[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:13_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n    Label:\n        id: Note_zh\n        font_size: '10sp'\n        text: '[ref=http://127.0.0.1:43110/Me.ZeroNetwork.bit/?Post/1RedkCkVaXuVXrqCMpoXQS29bwaqsuFdL/13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/1484496342]（想要妥善地关闭ZeroNet后台服务，\\\\n请在浏览器中点击ZeroHello首页左上方的 ┇ 按钮,\\\\n 选择关闭ZeroNet，谢谢！\\\\n更多信息和相关讨论点这里（中文版））[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Me.ZeroNetwork.bit/?Post/1RedkCkVaXuVXrqCMpoXQS29bwaqsuFdL/13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/1484496342')\n'''\n\nclass ZeronetApp(App):\n    def build(self):\n\n        if platform == 'android':\n#            from android import AndroidService # This AndroidService does NOT work! Changed to  jnius's autoclass\n#            service = AndroidService('ZeroNet', 'ZeroNet running, please stop it in browser')\n#            arg = '--config_file '+ os.path.join(dstdir, 'zeronet.conf') + ' --connected_limit = 5'\n#            print arg\n#            # service.start(arg)\n#            service.start()\n#            self.service = service\n            \n            from jnius import autoclass\n\n            Environment = autoclass('android.os.Environment')\n            # Store the  whole ZeroNet dir ( \"zero\" dir here, including all ZeroNet source code dir and  data_dir ) to public external storage in order to save phone's internal space and allow users modify them without root.\n            # But there is concern of some sensitive data e.g. users.json is accessible by other apps in the phone. So more argument to specify sensitive data dir to internal space and import users.json etc. is needed in ZeroNet itself.FIXME\n#            Context = autoclass('android.content.Context')\n#            sdpath = Environment.getExternalStorageDirectory().getAbsolutePath()\n#            print \"sdpath: %s \" % sdpath # sdpath points to Emulated storage root\n#            sdpath1 = App.get_running_app().user_data_dir\n#            print \"sdpath1 %s \" % sdpath1 # sdpath points to Emulated_storage/zeronet ( becaose of ZeronetApp)\n            # Writing to both sdpath and sdpath1 may get \"Operation not permitted \" even have declare WRITE_EXTERNAL_STORAGE permission when packing.\n            # But the files are successfully written to sdpath and sdpath1. Of course we can ingore the return error, but writing there may be unreliable.\n            # During test, shutil.copyfile is less likely to the the error than shutil.copy2\n            \n            service = autoclass('android.test.myapp17.ServiceZn') # We must specify current package.name including package.domain here, e.g. io.zeronet.zeroandroid or org.zeronet.zeroapk, which is identical to corresponding one in buildozer.spec http://python-for-android.readthedocs.io/en/latest/services/\n            # service name is zn,  in the android log you can filter zn to see the ZeroNet output. The serviec name  also should be identical to corresponding one in buildozer.spec http://python-for-android.readthedocs.io/en/latest/services/\n            \n            mActivity = autoclass('org.kivy.android.PythonActivity').mActivity\n\n            srczerodir = os.path.join(os.environ['ANDROID_APP_PATH'],  'zero')\n            dstzerodir = os.path.join(mActivity.getExternalFilesDir(None).getPath(), 'zero') # getExternalFilesDir points to Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/\n            env = dict({'dstzerodir': dstzerodir})\n            import json\n            with open(\"env.json\", \"w\") as f:\n                json.dump(env, f) # save the path Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/ to file for serviceloader.py using\n            try:\n                shutil.copytree(srczerodir, dstzerodir ) # copy ZeroNet entirely to external, shutil.copytree will refuse to copy if destination exits.\n            except:\n                pass\n\n            argument = ''\n            service.start(mActivity, argument) # start service ( system will run serviceloader.py)\n        return Builder.load_string(kv)\n    \n#ZeronetApp().run()\n\nif __name__ == '__main__':\n    ZeronetApp().run()\n","language":"text/x-python","encrypted":false,"added":1484499235},{"paste_id":15,"description":"serviceloader.py","body":"import os\nimport sys\nimport json\n\nwith open('env.json', 'r') as f:\n     env = json.load(f)\ndstzerodir = env['dstzerodir'] # Read dstzerodir from file\nprint dstzerodir\nsys.path.insert(0,  dstzerodir) \n\nimport zeronet\n\ndef main():\n    zeronet.main()\n\nif __name__ == '__main__':\n    main()\n","language":"text/x-python","encrypted":false,"added":1484499294},{"paste_id":16,"description":"data.json of @fargo","body":"{\n\t\"next_topic_id\": 5,\n\t\"topic\": [\n\t\t{\n\t\t\t\"topic_id\": 1,\n\t\t\t\"title\": \"访问历史出现在首页不爽，能否取消？另外已关注中的网站，更新会出现在那？\",\n\t\t\t\"body\": \"如题。\",\n\t\t\t\"added\": 1463875131,\n\t\t\t\"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n\t\t},\n\t\t{\n\t\t\t\"topic_id\": 2,\n\t\t\t\"title\": \"原来在邮箱这可以看联络人是否在线\",\n\t\t\t\"body\": \"这点还可以\",\n\t\t\t\"added\": 1464048739,\n\t\t\t\"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n\t\t},\n\t\t{\n\t\t\t\"topic_id\": 3,\n\t\t\t\"title\": \"ZeroNet善于利用关注中也是有点爽的\",\n\t\t\t\"body\": \"遗憾的是Mail没通知，這点不够cool。\",\n\t\t\t\"added\": 1464876134,\n\t\t\t\"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n\t\t},\n\t\t{\n\t\t\t\"topic_id\": 4,\n\t\t\t\"title\": \"这个网站也是旧版的吧，怎么没有提交附件的按钮？\",\n\t\t\t\"body\": \"有每天NBA原声BT torrent文件，想上传到这。\\n编辑：提交到这里了：http://127.0.0.1:43110/ZeroTorrent.bit/\",\n\t\t\t\"added\": 1480393502,\n\t\t\t\"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n\t\t}\n\t],\n\t\"topic_vote\": {\n\t\t\"1_16LArofpYM9Fu3SvTQpXW5UD89aArepKcd\": 1,\n\t\t\"5_15oJLfpirNrTr2Fzhq6reLQ2aJGeDAnLHF\": 1\n\t},\n\t\"next_comment_id\": 40,\n\t\"comment\": {\n\t\t\"4_18gxxauQJuPCfZNJQkByuMzmH9UZG9Gu8q\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 1,\n\t\t\t\t\"body\": \"good\",\n\t\t\t\t\"added\": 1463674123\n\t\t\t}\n\t\t],\n\t\t\"1_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 2,\n\t\t\t\t\"body\": \"> [sutra](#comment_27_13Xd2FuuSKJkdmdKvJ4k37rVg8W7jUu41i): 复制 data/users.json\\n> https://zeronet.readthedocs.io/en/latest/faq/#can-i-use-the-same-username-on-multiple-machine\\n\\n似乎单单这样是不能备份身份的。\",\n\t\t\t\t\"added\": 1463875615\n\t\t\t}\n\t\t],\n\t\t\"1_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 3,\n\t\t\t\t\"body\": \"难道这个hello zeronet 就是newsfeed？\\nhttp://192.168.18.104:43110/1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D\",\n\t\t\t\t\"added\": 1463875804\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 12,\n\t\t\t\t\"body\": \"> [doobom](#comment_6_17s1HVViqrCDTk1wFWifWyAMhD8n4qNy33): 是的。\\n\\n明白了，原来想follow某个贴，是要点关注的。\",\n\t\t\t\t\"added\": 1464278030\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 13,\n\t\t\t\t\"body\": \"其实这设置也不错。\",\n\t\t\t\t\"added\": 1464278055\n\t\t\t}\n\t\t],\n\t\t\"1_16LArofpYM9Fu3SvTQpXW5UD89aArepKcd\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 4,\n\t\t\t\t\"body\": \"好像不会经常，chromium\",\n\t\t\t\t\"added\": 1463925229\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 14,\n\t\t\t\t\"body\": \"> [adm1n](#comment_17_16LArofpYM9Fu3SvTQpXW5UD89aArepKcd): 还好吧……可能不是经常，但每次出现，然后界面冻住，十分明显。\\n\\n你的是Tor连接吧，Tor有时不稳定，非tor没这个问题\",\n\t\t\t\t\"added\": 1464615557\n\t\t\t}\n\t\t],\n\t\t\"1_18gxxauQJuPCfZNJQkByuMzmH9UZG9Gu8q\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 5,\n\t\t\t\t\"body\": \"> [yb](#comment_7_1CuQFwcf76QwbaQpNfE54Kmtdjbg26RmyY): 我这里没这个问题。但是我的网站好像访问不了，帮忙看看。\\n> http://127.0.0.1:43111/1CpQfwShA6D8kAc4o3tu46GK1i89UtGP2o\\n\\n即使改为43110,也访问不了\",\n\t\t\t\t\"added\": 1463925472\n\t\t\t}\n\t\t],\n\t\t\"1_17uVK6FBn9Wiq8XWKHpaMHwLu6oBqPsf99\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 6,\n\t\t\t\t\"body\": \"关键是人太少了，信息流更新太太太慢。\",\n\t\t\t\t\"added\": 1464047102\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 7,\n\t\t\t\t\"body\": \"> [doobom](#comment_2_17s1HVViqrCDTk1wFWifWyAMhD8n4qNy33): 嗯，相信人会越来越多的。。\\n\\n不会的，人不一定会越来越多，毕竟是个封闭网络。\",\n\t\t\t\t\"added\": 1464048650\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 8,\n\t\t\t\t\"body\": \"> [doobom](#comment_2_17s1HVViqrCDTk1wFWifWyAMhD8n4qNy33): 嗯，相信人会越来越多的。。\\n\\n原来在邮箱这可以看朋友是否在线，朋友，我给你发邮件了，欢迎测试。\",\n\t\t\t\t\"added\": 1464048854\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 9,\n\t\t\t\t\"body\": \"> [d8b](#comment_2_17uVK6FBn9Wiq8XWKHpaMHwLu6oBqPsf99): 已回复。。。 :)\\n\\nｗｏ，你的是安装在ｖｐｓ上的吗？怎么看到你的是小黄点的？我是安装在24小时在线的机器上，看到我是小绿点吗？\",\n\t\t\t\t\"added\": 1464063911\n\t\t\t}\n\t\t],\n\t\t\"2_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 10,\n\t\t\t\t\"body\": \"> [douzhanshengfo](#comment_2_19WKD9DcYGPR8jrzQPkZEA5xZeDDuza7qL): 只能内部使用，发不出去的吧貌似\\n\\n嗯，能通外网就逆天了\",\n\t\t\t\t\"added\": 1464173983\n\t\t\t}\n\t\t],\n\t\t\"1_15tojHK9x7JSJYPZozDvqx77qRg1iCBoGi\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 11,\n\t\t\t\t\"body\": \"ipsec可以的，一直用。\",\n\t\t\t\t\"added\": 1464190526\n\t\t\t}\n\t\t],\n\t\t\"6_1NZsz5ugkzg27d9jmc8qrT9GxcLZdiuBGP\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 15,\n\t\t\t\t\"body\": \"good\",\n\t\t\t\t\"added\": 1464782898\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 19,\n\t\t\t\t\"body\": \"不能选择下载，真心没多大用。\",\n\t\t\t\t\"added\": 1466483036\n\t\t\t}\n\t\t],\n\t\t\"11_1DzpF7398yNGjFwHQqHAu9fRkbE3WZ6dZA\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 16,\n\t\t\t\t\"body\": \"主目录有个zeronet.conf文件，打开，tor = disable\",\n\t\t\t\t\"added\": 1464875571\n\t\t\t}\n\t\t],\n\t\t\"11_19SxyZeLrqy2AUUG9hhtK8Pd5CUxtsP15Z\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 17,\n\t\t\t\t\"body\": \"btsync , 最不爽的不能選擇下載文件\",\n\t\t\t\t\"added\": 1465687512\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 38,\n\t\t\t\t\"body\": \"其实大家都用电骡最好，就是这类软件太多了。\",\n\t\t\t\t\"added\": 1483143768\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 39,\n\t\t\t\t\"body\": \"其实大家都用电骡最好，就是这类软件太多了，最优秀的反而没人用了。\",\n\t\t\t\t\"added\": 1483143813\n\t\t\t}\n\t\t],\n\t\t\"15_19SxyZeLrqy2AUUG9hhtK8Pd5CUxtsP15Z\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 18,\n\t\t\t\t\"body\": \"黑魔术病栋 , 这个没看过 , 求ed2k链接\",\n\t\t\t\t\"added\": 1466226098\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 24,\n\t\t\t\t\"body\": \"> [g7900ms](#comment_20_1JDSdmGp7QW7GyLh6L24x5z7TkzPMKFm3n): 欲奴，美剧。禁止的爱.善良的小姨子 ，韩国电影。\\n\\n谢谢介绍，下来看看。\",\n\t\t\t\t\"added\": 1471869307\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 27,\n\t\t\t\t\"body\": \"> [mba](#comment_9_15Z67QmyH6MTfk3pDfBR635kVie5DaokHd): 西西里的美丽传说\\n\\ned2k://|file|Malena%202000%20Uncut%20%E8%A5%BF%E8%A5%BF%E9%87%8C%E7%9A%84%E7%BE%8E%E4%B8%BD%E4%BC%A0%E8%AF%B4%20%E6%9C%AA%E5%88%A0%E5%87%8F%E7%89%88%20%E4%B8%AD%E6%96%87%E5%AD%97%E5%B9%95%20Hr-Hdtv%20Ac3.1024x576%20x264-%E4%BA%BA%E4%BA%BA%E5%BD%B1%E8%A7%86%E5%88%B6%E4%BD%9C.mkv|1770396344|24728343E5E8AC826307A790673651BF|/\",\n\t\t\t\t\"added\": 1476077072\n\t\t\t}\n\t\t],\n\t\t\"33_1NwWoM1qGUV9gjLG7QGyhqsRxKKga2rhtf\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 20,\n\t\t\t\t\"body\": \"封闭网络是这样的了，始终人是有的，多少的问题。\",\n\t\t\t\t\"added\": 1467026852\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 21,\n\t\t\t\t\"body\": \"封闭网络是这样的了，始终人是有的，多少的问题。\",\n\t\t\t\t\"added\": 1467026862\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 22,\n\t\t\t\t\"body\": \"其实算是比较完善的了。\",\n\t\t\t\t\"added\": 1467026924\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 23,\n\t\t\t\t\"body\": \"如果有个send to kindle的零网按钮，一键推送Ｚｅｒｏｎｅｔ中网页到kindle就满足了。\",\n\t\t\t\t\"added\": 1467089278\n\t\t\t}\n\t\t],\n\t\t\"44_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 25,\n\t\t\t\t\"body\": \"> [p2p](#comment_853_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ): 在ZeroMe首页，右上角有三个点，点击以后出现Follow username mentions和Follow comments on your posts，点击打勾后，可以在ZeroHello首页Newsfeed看到别人@你和回复你帖子的提醒。\\n\\n这点是最棒的。\",\n\t\t\t\t\"added\": 1471869737\n\t\t\t}\n\t\t],\n\t\t\"5_15oJLfpirNrTr2Fzhq6reLQ2aJGeDAnLHF\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 26,\n\t\t\t\t\"body\": \"完美\",\n\t\t\t\t\"added\": 1473780609\n\t\t\t}\n\t\t],\n\t\t\"2_1FzCyv6ibgoShdXjQu7CCLiNTWhWhj5E6J\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 28,\n\t\t\t\t\"body\": \"支持\",\n\t\t\t\t\"added\": 1480117956\n\t\t\t}\n\t\t],\n\t\t\"4_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 29,\n\t\t\t\t\"body\": \"> [lmath](#comment_225_1958F7oCppj78MP966AfojMQwHg2WUupzq): 然而 master 就没出提交附件的功能（虽然已经有人做出来了），而且这个论坛的拥有者已经隐退了，我们没法引入新功能，只能等域名过期后转移。\\n\\n谢谢。好像看到有提交的网站。\",\n\t\t\t\t\"added\": 1480407067\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 30,\n\t\t\t\t\"body\": \"> [mydf](#comment_60_18kDuSDb2D5QTtabXj6Ert7dTvnUA3FSHN): http://127.0.0.1:43110/ZeroTorrent.bit/这个网站可以提交种子\\n\\n这个网站的搜索功能是废的，即使提交种子到这也是石沉大海，不必要。\",\n\t\t\t\t\"added\": 1480431996\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 32,\n\t\t\t\t\"body\": \"好吧，试发到ZeroTorrent.bit。发我看的，想看到另外赛事的在此发言。\",\n\t\t\t\t\"added\": 1480492375\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"comment_id\": 33,\n\t\t\t\t\"body\": \"> [linkerlin](#comment_33_13Nzuvnhyz7nBJvPoUrdTEFuQTWUdqXAJk): 可以发磁力链接\\n\\n只有torrent，怎么知道磁链接？\",\n\t\t\t\t\"added\": 1480912064\n\t\t\t}\n\t\t],\n\t\t\"2_1DD52vhXkbAdaS54PoZ2vNauiQ8XMiswC5\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 31,\n\t\t\t\t\"body\": \"中国成最大嬴家？\",\n\t\t\t\t\"added\": 1480477768\n\t\t\t}\n\t\t],\n\t\t\"48_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 34,\n\t\t\t\t\"body\": \"大赞！\",\n\t\t\t\t\"added\": 1481105706\n\t\t\t}\n\t\t],\n\t\t\"1_18Q7qa1gefr49uNPGPtcrbCE2YoyNDiZnj\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 35,\n\t\t\t\t\"body\": \"看到喜欢的博客，回到首页，点击喜欢博客的下拉铵钮，克隆（clone）即可。\",\n\t\t\t\t\"added\": 1481105965\n\t\t\t}\n\t\t],\n\t\t\"1_1DF7Sa6AkoLxZNPq5FSn3kAadKHfye9K6P\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 36,\n\t\t\t\t\"body\": \"screen吧。\",\n\t\t\t\t\"added\": 1481623282\n\t\t\t}\n\t\t],\n\t\t\"2_1JUrEVQLzG2DsmnLoLaGski2tRrPvRHtjs\": [\n\t\t\t{\n\t\t\t\t\"comment_id\": 37,\n\t\t\t\t\"body\": \"> [lmath](#comment_314_1958F7oCppj78MP966AfojMQwHg2WUupzq): 我再看看，如果难度不大就把它做出来。\\n\\n现在在首页显示已经不错了嘛，反而mail没有提示感觉就有点浪费了mail的功能。\",\n\t\t\t\t\"added\": 1481623398\n\t\t\t}\n\t\t]\n\t},\n\t\"comment_vote\": {\n\t\t\"4_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": 1,\n\t\t\"2_19WKD9DcYGPR8jrzQPkZEA5xZeDDuza7qL\": 1,\n\t\t\"12_1HrRNH7KbdxMjwLmwrHmZqJrzVZVDKc9bF\": 1,\n\t\t\"880_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": 1,\n\t\t\"225_1958F7oCppj78MP966AfojMQwHg2WUupzq\": 1\n\t}\n}","language":"application/x-json","encrypted":false,"added":1485775329},{"paste_id":17,"description":"inject.py_","body":"#!/usr/bin/python\n# -*- coding: utf-8 -*-\nfrom kivy.app import App\nfrom kivy.lang import Builder\n#from kivy.utils import platform\nimport os\nimport traceback\nimport shutil\nimport json\n#from OpenSSL import crypto\nimport time\nimport M2Crypto\nfrom M2Crypto import RSA, EVP\nfrom distutils.version import StrictVersion\nfrom jnius import autoclass\nfrom jnius import cast\nfrom kivy.config import Config\nConfig.set('kivy', 'log_enable', 1)\nConfig.write()\n\nAPK_version = \"0.2.2\"\n\nprint os.path.dirname(__file__)\nprint \"ANDROID_APP_PATH: %s\" % os.environ['ANDROID_APP_PATH']\nprint \"EXTERNAL_STORAGE: %s\" % os.environ['EXTERNAL_STORAGE']\n\n# GUI, somewhat like CSS.  This can also be move to a seperate kv file\nkv = '''\n<Label>:\n    font_size: '15sp'\n    font_name: \"DroidSansFallback\"\n    markup: True\nBoxLayout:\n    orientation: 'vertical'\n    \n    Label:\n        id: Welcome\n        text: ' Welcome to [b]ZeroNet[/b]! \\\\nClick links below to open sites in browser. \\\\n （欢迎来到ZeroNet！\\\\n点击以下链接在浏览器中打开网站）'\n    Label:\n        id: ZeroHello\n        text: ' [ref=http://127.0.0.1:43110/][b]ZeroHello[/b] Home page\\\\n（ZeroHello首页）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/')\n    Label:\n        id: ZeroMe\n        text: ' [ref=http://127.0.0.1:43110/Me.ZeroNetwork.bit]P2P social network [b]ZeroMe[/b]\\\\n（P2P社交网络ZeroMe）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Me.ZeroNetwork.bit')\n    Label:\n        id: NewGFWTalk\n        text: ' [ref=http://127.0.0.1:43110/NewGFWTalk.bit]P2P Chinese forum [b]New GFW Talk[/b]\\\\n      （P2P中文论坛）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/NewGFWTalk.bit')\n    Label:\n        id: Note_en\n        font_size: '10sp'\n        text: '[ref=http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:13_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/]                                  APK Ver. APK_ver\\\\nTo close ZeroNet background service nicely,\\\\n please click ZeroHello\\\\'s top-left ┇ button,\\\\n choose Shut down ZeroNet, thanks!\\\\nMore info & discussions please click here! (En version)[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:13_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n    Label:\n        id: Note_zh\n        font_size: '10sp'\n        text: '[ref=http://127.0.0.1:43110/NewGFWTalk.bit/?Topic:59_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/]                               APK 版本号 APK_ver\\\\n（想要妥善地关闭ZeroNet后台服务，\\\\n请在浏览器中点击ZeroHello首页左上方的 ┇ 按钮,\\\\n 选择关闭ZeroNet，谢谢！\\\\n更多信息和相关讨论点这里（中文版））[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/NewGFWTalk.bit/?Topic:59_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n'''.replace(\"APK_ver\",  APK_version)\n\n# Generate a SSL certificate using module M2Crypto,  an existing one will be overwritten .\ndef generate_self_signed_cert_m2(cert_dir):\n\n    if not os.path.exists(cert_dir):\n        os.makedirs(cert_dir)\n    cert_path = os.path.join(cert_dir, 'cert-rsa.pem')\n    key_path = os.path.join(cert_dir, 'key-rsa.pem')\n \n    if os.path.exists(cert_path):\n        os.unlink(cert_path)\n    if os.path.exists(key_path):\n        os.unlink(key_path)\n \n    # create a key pair\n    key = RSA.gen_key(2048, 65537)\n    key.save_key (key_path, None)\n    pkey = EVP.PKey() # Converting the RSA key into a PKey() which is stored in a certificate\n    pkey.assign_rsa(key)\n    \n    # create a self-signed cert, the config is copied from src/lib/opensslVerify/openssl.cnf. not sure whether making it random is good or not.\n    # time for certificate to stay valid\n    cur_time = M2Crypto.ASN1.ASN1_UTCTIME()\n    cur_time.set_time(int(time.time()) - 60*60*24)\n    expire_time = M2Crypto.ASN1.ASN1_UTCTIME()\n    expire_time.set_time(int(time.time()) + 60 * 60 * 24 * 365)\n    # creating a certificate\n    cert = M2Crypto.X509.X509()\n    cert.set_pubkey(pkey)\n    cs_name = M2Crypto.X509.X509_Name()\n    cs_name.C = \"US\"\n    cs_name.ST = 'NY'\n    cs_name.L = 'New York'\n    cs_name.O = 'Example, LLC'\n    cs_name.CN = 'Example Company'\n#    cs_name.Email = \"example@example.com\"\n    cert.set_subject(cs_name)\n    cert.set_issuer_name(cs_name)\n    cert.set_not_before(cur_time)\n    cert.set_not_after(expire_time)\n    # self signing a certificate\n    cert.sign(pkey, md=\"sha256\")\n    cert.save_pem(cert_path)\n    return cert_path, key_path\n\nclass ZeronetApp(App):\n    def get_scaled_icon(icon):  \n        Dimen = autoclass(\"android.R$dimen\")\n        Bitmap = autoclass(\"android.graphics.Bitmap\")\n    \n        scaled_icon = getattr(Drawable, icon)\n    \n        scaled_icon = cast(\"android.graphics.drawable.BitmapDrawable\", service.getResources().getDrawable(scaled_icon))\n        scaled_icon = scaled_icon.getBitmap()\n    \n        res = service.getResources()\n        height = res.getDimension(Dimen.notification_large_icon_height)\n        width = res.getDimension(Dimen.notification_large_icon_width)\n        return Bitmap.createScaledBitmap(scaled_icon, width, height, False)\n        \n    def build(self):\n        \n        platform_flag = 'android'\n        \n        if platform_flag == 'android':\n#            from android import AndroidService # This AndroidService does NOT work! Changed to  jnius's autoclass\n#            service = AndroidService('ZeroNet', 'ZeroNet running, please stop it in browser')\n#            arg = '--config_file '+ os.path.join(dstdir, 'zeronet.conf') + ' --connected_limit = 5'\n#            print arg\n#            # service.start(arg)\n#            service.start()\n#            self.service = service\n            \n            from jnius import autoclass\n\n            Environment = autoclass('android.os.Environment')\n            # Store the  whole ZeroNet dir ( \"zero\" dir here, including all ZeroNet source code dir and  data_dir ) to public external storage in order to save phone's internal space and allow users modify them without root.\n            # But there is concern of some sensitive data e.g. users.json is accessible by other apps in the phone. So more argument to specify sensitive data dir to internal space and import users.json etc. is needed in ZeroNet itself. FIXME\n#            Context = autoclass('android.content.Context')\n#            sdpath = Environment.getExternalStorageDirectory().getAbsolutePath()\n#            print \"sdpath: %s \" % sdpath # sdpath points to Emulated storage root\n#            sdpath1 = App.get_running_app().user_data_dir\n#            print \"sdpath1 %s \" % sdpath1 # sdpath points to Emulated_storage/zeronet ( becaose of ZeronetApp)\n            # Writing to both sdpath and sdpath1 may get \"Operation not permitted \" even have declare WRITE_EXTERNAL_STORAGE permission when packing.\n            # But the files are successfully written to sdpath and sdpath1. Of course we can ingore the return error, but writing there may be unreliable.\n            # During test, shutil.copyfile is less likely to get the error than shutil.copy2\n            \n            service = autoclass('android.test.myapp17.ServiceZn') # We must specify current package.name including package.domain here, e.g. io.zeronet.zeroandroid or org.zeronet.zeroapk, which is identical to corresponding one in buildozer.spec http://python-for-android.readthedocs.io/en/latest/services/\n            # service name is zn,  in the android log you can filter zn to see the ZeroNet output. The serviec name  also should be identical to corresponding one in buildozer.spec http://python-for-android.readthedocs.io/en/latest/services/\n            \n            mActivity = autoclass('org.kivy.android.PythonActivity').mActivity\n\n            srczerodir = os.path.join(os.environ['ANDROID_APP_PATH'],  'zero')\n            extdir = mActivity.getExternalFilesDir(None).getPath() # getExternalFilesDir points to Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/\n            dstzerodir = os.path.join(extdir, 'zero')\n            \n            needupdate = False\n            if not os.path.exists(os.path.join(extdir, 'env_ext.json')):\n                needupdate = True\n            else:\n                with open(os.path.join(extdir, 'env_ext.json'), 'r') as fx:\n                     env_ext_old = json.load(fx)\n                APK_version_old = env_ext_old['APK_version'] # Read APK_version from file to detemin whether need to update\n                if StrictVersion(APK_version) > StrictVersion(APK_version_old):\n                    needupdate = True\n            if needupdate == True:\n                print \"Need to update\"\n                try:\n                    if os.path.exists(os.path.join(extdir, \"zero_backup\")):\n                        shutil.rmtree(os.path.join(extdir, \"zero_backup\")) # Prepare for updating the exiting code and importing data\n                        print \"zero_backup removed\"\n                    if os.path.exists(dstzerodir):\n                        os.rename(dstzerodir,  os.path.join(extdir, \"zero_backup\"))\n                        print \"zero renamed to zero_backup\"\n                    if not os.path.exists(dstzerodir):\n                        try:\n                            shutil.copytree(srczerodir, dstzerodir ) # Copy ZeroNet entirely to external, shutil.copytree will refuse to copy if destination exists.\n                        except:\n#                            traceback.print_exc()\n                            pass\n                        print \"zero copied to external zero\"\n                    if os.path.exists(os.path.join(extdir, \"zero_backup/data\")):\n                        try:\n                            shutil.move(os.path.join(extdir, \"zero_backup/data\"),  os.path.join(dstzerodir,  'data')) # import data\n                        except:\n                            traceback.print_exc()\n                        print \"data imported\"\n                except:\n                    traceback.print_exc()\n            env = dict({'dstzerodir': dstzerodir})\n            with open(\"env.json\", \"w\") as f:\n                json.dump(env, f) # Save the path Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/ to file for serviceloader.py using\n            env_ext = dict({'APK_version':APK_version})\n            with open(os.path.join(extdir, 'env_ext.json'), \"w\") as fx:\n                json.dump(env_ext, fx) # Save APK_version to file for next time updating the exiting code and importing data\n                \n            generate_self_signed_cert_m2(os.path.join(dstzerodir,  'data')) # Generate a SSL certificate to 'data' folder,  existing pem files will be overwritten . TODO: read the `data_dir` in zeronet.conf\n\n            argument = ''\n            service.start(mActivity, argument) # Start service ( system will run serviceloader.py)\n            \n            print \"Service started. Begin GUI...\"\n            \n            # A way to test notification\n#            from os.path import dirname\n#            from os.path import join\n#            from os.path import realpath\n#            \n#            from plyer import notification\n#            from plyer.utils import platform\n#            from plyer.compat import PY2\n#            \n#            print \"imported!!\"\n#            \n#            title = \"title test\"\n#            message = \"msg test\"\n#            ticker = \"ticker test\"\n#            if PY2:\n#                title = title.decode('utf8')\n#                message = message.decode('utf8')\n#            kwargs = {'title': title, 'message': message, 'ticker': ticker}\n#            \n#            mode = 'fancy'\n#    \n#            if mode == 'fancy':\n#                kwargs['app_name'] = \"Mt App17\"\n#                if platform == \"win\":\n#                    kwargs['app_icon'] = join(dirname(realpath(__file__)),\n#                                              'plyer-icon.ico')\n#                    kwargs['timeout'] = 4\n#                else:\n#                    kwargs['app_icon'] = join(dirname(realpath(__file__)),\n#                                              'plyer-icon.png')\n#            notification.notify(**kwargs)\n\n            # Another way to test notification\n            Context = autoclass('android.content.Context')\n            Intent = autoclass('android.content.Intent')\n            PendingIntent = autoclass('android.app.PendingIntent')\n            AndroidString = autoclass('java.lang.String')\n            NotificationBuilder = autoclass('android.app.Notification$Builder')\n        \n#            service = autoclass('org.renpy.android.PythonService').mService\n\n            from plyer.platforms.android import activity, SDK_INT # plyer in pip is old and has bugs, so need to download source code manually from plyer repo to replace all the plyer source code folder downloaded by buildozer\n            print \"{}.R$drawable\".format(activity.getPackageName())\n            print \"{}.R$drawable\".format('android.test.myapp17')\n\n            print \"SDK_INT:\"\n            print SDK_INT\n            Drawable = autoclass(\"{}.R$drawable\".format(activity.getPackageName()))\n#            PythonService = autoclass('org.renpy.android.PythonService')\n#            service = PythonService.mService\n            text = AndroidString(\"text test\".encode('utf-8'))\n            message = AndroidString(\"message test\".encode('utf-8'))\n            try:\n                small_icon = getattr(Drawable, 'icon')\n                print \"got icon\"\n            except:\n                small_icon = getattr(Drawable, 'icon_android')\n                print \"got icon_android\"\n        \n#            large_icon_bitmap = get_scaled_icon('icon')\n#            large_icon_bitmap = getattr(Drawable, 'icon')\n        \n#            contentIntent = PendingIntent.getActivity(service, 0, Intent(service, service.getClass()), 0)\n#            print \"contentIntent = \"\n            notification_builder = NotificationBuilder(activity)\n            notification_builder.setContentTitle(text)\n            notification_builder.setContentText(message)\n            notification_builder.setSmallIcon(small_icon)\n#            notification_builder.setLargeIcon(large_icon_bitmap)\n#            notification_builder.setContentIntent(contentIntent)\n        \n            notification = notification_builder.getNotification()\n        \n            notification_service = activity.getSystemService(Context.NOTIFICATION_SERVICE)\n#            notification_service.notify(233, notification) # uncomment this line, a notification will be shown.\n#            print \"notified\"\n            mService = autoclass('org.kivy.android.PythonService').mService\n            aService = autoclass('android.app.Service')\n            # Want to make service foregound in order to keep less likely to be killed by android system. A notification is needed to make service foregound.\n#            aService.startForeground(233, notification) # don't know how to make service foregound. Have tried a few, no luck. FIXME\n            # If we can not make service foregound, another idea is to create 1~2 daemon services to restart ZeroNet service when it killed by android system.\n        return Builder.load_string(kv)\n    \n#ZeronetApp().run()\n\nif __name__ == '__main__':\n    ZeronetApp().run()\n","language":"text/x-python","encrypted":false,"added":1485879277},{"paste_id":18,"description":"main.py","body":"from jnius import autoclass\n\nimport os\nimport shutil\nfrom distutils.version import StrictVersion\nimport json\nimport traceback\nfrom plyer.platforms.android import activity, SDK_INT # plyer in pip is old and has bugs, so need to download source code manually from plyer repo to replace all the plyer source code folder downloaded by buildozer\n\nEnvironment = autoclass('android.os.Environment')\nmActivity = autoclass('org.kivy.android.PythonActivity').mActivity\nextdir = mActivity.getExternalFilesDir(None).getPath() # getExternalFilesDir points to Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/\next_kivylogs = os.path.join(extdir, 'kivy_logs')\nfrom kivy.config import Config\nConfig.set('kivy', 'log_dir', ext_kivylogs) # Set kivy logs to ExternalFilesDir, so that users can see them without root\nConfig.write()\n\nsrcinject = os.path.join(os.environ['ANDROID_APP_PATH'],  'inject.py_') # The original filename is inject.py_ to avoid converting to pyo file while packing\ndstinject = os.path.join(extdir, 'inject.py')\npm = mActivity.getPackageManager()\nAPK_version = pm.getPackageInfo(activity.getPackageName(), 0).versionName\nprint \" APK_version: %s \" %  APK_version\nneedupdate = False\nif not os.path.exists(os.path.join(extdir, 'env_ext.json')):\n    needupdate = True\nelse:\n    with open(os.path.join(extdir, 'env_ext.json'), 'r') as fx:\n         env_ext_old = json.load(fx)\n    APK_version_old = env_ext_old['APK_version'] # Read APK_version from file to detemin whether need to update\n    if StrictVersion(APK_version) > StrictVersion(APK_version_old):\n        needupdate = True\nif needupdate == True:\n    print \"Need to update inject.py\"\n    try:\n        if os.path.exists(os.path.join(extdir, \"inject_backup.py\")):\n            os.remove(os.path.join(extdir, \"inject_backup.py\")) # Prepare for updating the exiting code\n            print \"inject_backup.py removed\"\n        if os.path.exists(dstinject):\n            os.rename(dstinject, os.path.join(extdir, \"inject_backup.py\"))\n            print \"inject.py renamed to inject_backup.py\"\n        try:\n            shutil.copyfile(srcinject, dstinject) # Copy inject.py to ExternalFilesDir, so that users can modify it without root\n        except:\n            traceback.print_exc()\n        print \"inject.py_ copied to external inject.py\"\n    except:\n        traceback.print_exc()\n        \nsys.path.insert(0,  extdir)  # Use inject.py in ExternalFilesDir\nimport inject\ndef main():\n    inject.ZeronetApp().run()\n\nif __name__ == '__main__':\n    main()\n","language":"text/x-python","encrypted":false,"added":1485954893},{"paste_id":19,"description":"inject.py_","body":"#!/usr/bin/python\n# -*- coding: utf-8 -*-\nfrom kivy.app import App\nfrom kivy.lang import Builder\n#from kivy.utils import platform\nimport os\nimport traceback\nimport shutil\nimport json\n#from OpenSSL import crypto\nimport time\nimport M2Crypto\nfrom M2Crypto import RSA, EVP\nfrom distutils.version import StrictVersion\nfrom jnius import autoclass\nfrom jnius import cast\nfrom kivy.config import Config\nConfig.set('kivy', 'log_enable', 1)\nConfig.write()\n\nprint os.path.dirname(__file__)\nprint \"ANDROID_APP_PATH: %s\" % os.environ['ANDROID_APP_PATH']\nprint \"EXTERNAL_STORAGE: %s\" % os.environ['EXTERNAL_STORAGE']\n\n# GUI, somewhat like CSS.  This can also be move to a seperate kv file\nkv = '''\n<Label>:\n    font_size: '15sp'\n    font_name: \"DroidSansFallback\"\n    markup: True\nBoxLayout:\n    orientation: 'vertical'\n    \n    Label:\n        id: Welcome\n        text: ' Welcome to [b]ZeroNet[/b]! \\\\nClick links below to open sites in browser. \\\\n （欢迎来到ZeroNet！\\\\n点击以下链接在浏览器中打开网站）'\n    Label:\n        id: ZeroHello\n        text: ' [ref=http://127.0.0.1:43110/][b]ZeroHello[/b] Home page\\\\n（ZeroHello首页）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/')\n    Label:\n        id: ZeroMe\n        text: ' [ref=http://127.0.0.1:43110/Me.ZeroNetwork.bit]P2P social network [b]ZeroMe[/b]\\\\n（P2P社交网络ZeroMe）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Me.ZeroNetwork.bit')\n    Label:\n        id: NewGFWTalk\n        text: ' [ref=http://127.0.0.1:43110/NewGFWTalk.bit]P2P Chinese forum [b]New GFW Talk[/b]\\\\n      （P2P中文论坛）[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/NewGFWTalk.bit')\n    Label:\n        id: Note_en\n        font_size: '10sp'\n        text: '[ref=http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:13_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/]                                  APK Ver. APK_ver\\\\nTo close ZeroNet background service nicely,\\\\n please click ZeroHello\\\\'s top-left ┇ button,\\\\n choose Shut down ZeroNet, thanks!\\\\nMore info & discussions please click here! (En version)[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/Talk.ZeroNetwork.bit/?Topic:13_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n    Label:\n        id: Note_zh\n        font_size: '10sp'\n        text: '[ref=http://127.0.0.1:43110/NewGFWTalk.bit/?Topic:59_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/]                               APK 版本号 APK_ver\\\\n（想要妥善地关闭ZeroNet后台服务，\\\\n请在浏览器中点击ZeroHello首页左上方的 ┇ 按钮,\\\\n 选择关闭ZeroNet，谢谢！\\\\n更多信息和相关讨论点这里（中文版））[/ref]'\n        on_ref_press:\n            import webbrowser\n            webbrowser.open('http://127.0.0.1:43110/NewGFWTalk.bit/?Topic:59_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ/')\n'''\n\n# Generate a SSL certificate using module M2Crypto,  an existing one will be overwritten .\ndef generate_self_signed_cert_m2(cert_dir):\n\n    if not os.path.exists(cert_dir):\n        os.makedirs(cert_dir)\n    cert_path = os.path.join(cert_dir, 'cert-rsa.pem')\n    key_path = os.path.join(cert_dir, 'key-rsa.pem')\n \n    if os.path.exists(cert_path):\n        os.remove(cert_path)\n    if os.path.exists(key_path):\n        os.remove(key_path)\n \n    # create a key pair\n    key = RSA.gen_key(2048, 65537)\n    key.save_key (key_path, None)\n    pkey = EVP.PKey() # Converting the RSA key into a PKey() which is stored in a certificate\n    pkey.assign_rsa(key)\n    \n    # create a self-signed cert, the config is copied from src/lib/opensslVerify/openssl.cnf. not sure whether making it random is good or not.\n    # time for certificate to stay valid\n    cur_time = M2Crypto.ASN1.ASN1_UTCTIME()\n    cur_time.set_time(int(time.time()) - 60*60*24)\n    expire_time = M2Crypto.ASN1.ASN1_UTCTIME()\n    expire_time.set_time(int(time.time()) + 60 * 60 * 24 * 365)\n    # creating a certificate\n    cert = M2Crypto.X509.X509()\n    cert.set_pubkey(pkey)\n    cs_name = M2Crypto.X509.X509_Name()\n    cs_name.C = \"US\"\n    cs_name.ST = 'NY'\n    cs_name.L = 'New York'\n    cs_name.O = 'Example, LLC'\n    cs_name.CN = 'Example Company'\n#    cs_name.Email = \"example@example.com\"\n    cert.set_subject(cs_name)\n    cert.set_issuer_name(cs_name)\n    cert.set_not_before(cur_time)\n    cert.set_not_after(expire_time)\n    # self signing a certificate\n    cert.sign(pkey, md=\"sha256\")\n    cert.save_pem(cert_path)\n    return cert_path, key_path\n\nclass ZeronetApp(App):\n    def get_scaled_icon(icon):  \n        Dimen = autoclass(\"android.R$dimen\")\n        Bitmap = autoclass(\"android.graphics.Bitmap\")\n    \n        scaled_icon = getattr(Drawable, icon)\n    \n        scaled_icon = cast(\"android.graphics.drawable.BitmapDrawable\", service.getResources().getDrawable(scaled_icon))\n        scaled_icon = scaled_icon.getBitmap()\n    \n        res = service.getResources()\n        height = res.getDimension(Dimen.notification_large_icon_height)\n        width = res.getDimension(Dimen.notification_large_icon_width)\n        return Bitmap.createScaledBitmap(scaled_icon, width, height, False)\n        \n    def build(self):\n        \n        platform_flag = 'android'\n        \n        if platform_flag == 'android':\n#            from android import AndroidService # This AndroidService does NOT work! Changed to  jnius's autoclass\n#            service = AndroidService('ZeroNet', 'ZeroNet running, please stop it in browser')\n#            arg = '--config_file '+ os.path.join(dstdir, 'zeronet.conf') + ' --connected_limit = 5'\n#            print arg\n#            # service.start(arg)\n#            service.start()\n#            self.service = service\n            \n            from jnius import autoclass\n\n            Environment = autoclass('android.os.Environment')\n            # Store the  whole ZeroNet dir ( \"zero\" dir here, including all ZeroNet source code dir and  data_dir ) to public external storage in order to save phone's internal space and allow users modify them without root.\n            # But there is concern of some sensitive data e.g. users.json is accessible by other apps in the phone. So more argument to specify sensitive data dir to internal space and import users.json etc. is needed in ZeroNet itself. FIXME\n#            Context = autoclass('android.content.Context')\n#            sdpath = Environment.getExternalStorageDirectory().getAbsolutePath()\n#            print \"sdpath: %s \" % sdpath # sdpath points to Emulated storage root\n#            sdpath1 = App.get_running_app().user_data_dir\n#            print \"sdpath1 %s \" % sdpath1 # sdpath points to Emulated_storage/zeronet ( becaose of ZeronetApp)\n            # Writing to both sdpath and sdpath1 may get \"Operation not permitted \" even have declare WRITE_EXTERNAL_STORAGE permission when packing.\n            # But the files are successfully written to sdpath and sdpath1. Of course we can ingore the return error, but writing there may be unreliable.\n            # During test, shutil.copyfile is less likely to get the error than shutil.copy2\n            \n            service = autoclass('android.test.myapp17.ServiceZn') # We must specify current package.name including package.domain here, e.g. io.zeronet.zeroandroid or org.zeronet.zeroapk, which is identical to corresponding one in buildozer.spec http://python-for-android.readthedocs.io/en/latest/services/\n            # service name is zn,  in the android log you can filter zn to see the ZeroNet output. The serviec name  also should be identical to corresponding one in buildozer.spec http://python-for-android.readthedocs.io/en/latest/services/\n            \n            mActivity = autoclass('org.kivy.android.PythonActivity').mActivity\n\n            srczerodir = os.path.join(os.environ['ANDROID_APP_PATH'],  'zero')\n            extdir = mActivity.getExternalFilesDir(None).getPath() # getExternalFilesDir points to Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/\n            dstzerodir = os.path.join(extdir, 'zero')\n            \n            pm = mActivity.getPackageManager()\n            from plyer.platforms.android import activity, SDK_INT # plyer in pip is old and has bugs, so need to download source code manually from plyer repo to replace all the plyer source code folder downloaded by buildozer\n            APK_version = pm.getPackageInfo(activity.getPackageName(), 0).versionName\n            print \" APK_version: %s \" %  APK_version\n            needupdate = False\n            if not os.path.exists(os.path.join(extdir, 'env_ext.json')):\n                needupdate = True\n            else:\n                with open(os.path.join(extdir, 'env_ext.json'), 'r') as fx:\n                     env_ext_old = json.load(fx)\n                APK_version_old = env_ext_old['APK_version'] # Read APK_version from file to detemin whether need to update\n                if StrictVersion(APK_version) > StrictVersion(APK_version_old):\n                    needupdate = True\n            if needupdate == True:\n                print \"Need to update\"\n                try:\n                    if os.path.exists(os.path.join(extdir, \"zero_backup\")):\n                        shutil.rmtree(os.path.join(extdir, \"zero_backup\")) # Prepare for updating the exiting code and importing data\n                        print \"zero_backup removed\"\n                    if os.path.exists(dstzerodir):\n                        os.rename(dstzerodir,  os.path.join(extdir, \"zero_backup\"))\n                        print \"zero renamed to zero_backup\"\n                    try:\n                        shutil.copytree(srczerodir, dstzerodir ) # Copy ZeroNet entirely to external, shutil.copytree will refuse to copy if destination exists.\n                    except:\n#                        traceback.print_exc()\n                        pass\n                    print \"zero copied to external zero\"\n                    if os.path.exists(os.path.join(extdir, \"zero_backup/data\")):\n                        try:\n                            shutil.move(os.path.join(extdir, \"zero_backup/data\"),  os.path.join(dstzerodir,  'data')) # import data\n                        except:\n                            traceback.print_exc()\n                        print \"data imported\"\n                except:\n                    traceback.print_exc()\n            env_ext = dict({'APK_version':APK_version})\n            with open(os.path.join(extdir, 'env_ext.json'), \"w\") as fx:\n                json.dump(env_ext, fx) # Save APK_version to file for next time updating the exiting code and importing data\n            env = dict({'dstzerodir': dstzerodir})\n            with open(\"env.json\", \"w\") as f:\n                json.dump(env, f) # Save the path Emulated_storage/Android/data/package_name(e.g.android.test.myapp17)/files/ to file for serviceloader.py using\n\n            generate_self_signed_cert_m2(os.path.join(dstzerodir,  'data')) # Generate a SSL certificate to 'data' folder,  existing pem files will be overwritten . TODO: read the `data_dir` in zeronet.conf\n\n            argument = ''\n            service.start(mActivity, argument) # Start service ( system will run serviceloader.py)\n            \n            print \"Service started. Begin GUI...\"\n            \n            # A way to test notification\n#            from os.path import dirname\n#            from os.path import join\n#            from os.path import realpath\n#            \n#            from plyer import notification\n#            from plyer.utils import platform\n#            from plyer.compat import PY2\n#            \n#            print \"imported!!\"\n#            \n#            title = \"title test\"\n#            message = \"msg test\"\n#            ticker = \"ticker test\"\n#            if PY2:\n#                title = title.decode('utf8')\n#                message = message.decode('utf8')\n#            kwargs = {'title': title, 'message': message, 'ticker': ticker}\n#            \n#            mode = 'fancy'\n#    \n#            if mode == 'fancy':\n#                kwargs['app_name'] = \"Mt App17\"\n#                if platform == \"win\":\n#                    kwargs['app_icon'] = join(dirname(realpath(__file__)),\n#                                              'plyer-icon.ico')\n#                    kwargs['timeout'] = 4\n#                else:\n#                    kwargs['app_icon'] = join(dirname(realpath(__file__)),\n#                                              'plyer-icon.png')\n#            notification.notify(**kwargs)\n\n            # Another way to test notification\n            Context = autoclass('android.content.Context')\n            Intent = autoclass('android.content.Intent')\n            PendingIntent = autoclass('android.app.PendingIntent')\n            AndroidString = autoclass('java.lang.String')\n            NotificationBuilder = autoclass('android.app.Notification$Builder')\n        \n#            service = autoclass('org.renpy.android.PythonService').mService\n\n            print \"{}.R$drawable\".format(activity.getPackageName())\n            print \"{}.R$drawable\".format('android.test.myapp17')\n\n            print \"SDK_INT:\"\n            print SDK_INT\n            Drawable = autoclass(\"{}.R$drawable\".format(activity.getPackageName()))\n#            PythonService = autoclass('org.renpy.android.PythonService')\n#            service = PythonService.mService\n            text = AndroidString(\"text test\".encode('utf-8'))\n            message = AndroidString(\"message test\".encode('utf-8'))\n            try:\n                small_icon = getattr(Drawable, 'icon')\n                print \"got icon\"\n            except:\n                small_icon = getattr(Drawable, 'icon_android')\n                print \"got icon_android\"\n        \n#            large_icon_bitmap = get_scaled_icon('icon')\n#            large_icon_bitmap = getattr(Drawable, 'icon')\n        \n#            contentIntent = PendingIntent.getActivity(service, 0, Intent(service, service.getClass()), 0)\n#            print \"contentIntent = \"\n            notification_builder = NotificationBuilder(activity)\n            notification_builder.setContentTitle(text)\n            notification_builder.setContentText(message)\n            notification_builder.setSmallIcon(small_icon)\n#            notification_builder.setLargeIcon(large_icon_bitmap)\n#            notification_builder.setContentIntent(contentIntent)\n        \n            notification = notification_builder.getNotification()\n        \n            notification_service = activity.getSystemService(Context.NOTIFICATION_SERVICE)\n#            notification_service.notify(233, notification) # uncomment this line, a notification will be shown.\n#            print \"notified\"\n            mService = autoclass('org.kivy.android.PythonService').mService\n            aService = autoclass('android.app.Service')\n            # Want to make service foregound in order to keep less likely to be killed by android system. A notification is needed to make service foregound.\n#            aService.startForeground(233, notification) # don't know how to make service foregound. Have tried a few, no luck. FIXME\n            # If we can not make service foregound, another idea is to create 1~2 daemon services to restart ZeroNet service when it killed by android system. Then nicely-shutdown button in APK's GUI is needed. HELP NEEDED! FIXME\n        return Builder.load_string(kv.replace(\"APK_ver\",  APK_version))\n    \n#ZeronetApp().run()\n\nif __name__ == '__main__':\n    ZeronetApp().run()\n","language":"text/x-python","encrypted":false,"added":1485954932},{"paste_id":21,"description":"@fargo 的合并前的另一个data.json","body":"{\n        \"next_topic_id\": 2,\n        \"topic\": [\n                {\n                        \"topic_id\": 1,\n                        \"title\": \"这轮VPN整治，那种通过支付宝付款的vps是不是首当其冲？\",\n                        \"body\": \"大家说说没有海外卡是怎么支付的？\",\n                        \"added\": 1485763138,\n                        \"parent_topic_uri\": \"10_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n                }\n        ],\n        \"topic_vote\": {},\n        \"next_comment_id\": 6,\n        \"comment\": {\n                \"56_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n                        {\n                                \"comment_id\": 1,\n                                \"body\": \"还是不能发图片？\",\n                                \"added\": 1485341499\n                        }\n                ],\n                \"1_15FDfY8PxKsonSWAs2XTbDMuAzVkK4oyYD\": [\n                        {\n                                \"comment_id\": 2,\n                                \"body\": \"虽然可惜硬盘空间，但是还是支持要发图，怎么才能删除特定网站的图片？\",\n                                \"added\": 1485680968\n                        }\n                ],\n                \"56_1DcMmKhgdfkR1GDA6zhWhoFRreaej4wLmW\": [\n                        {\n                                \"comment_id\": 3,\n                                \"body\": \"tox\",\n                                \"added\": 1485681633\n                        }\n                ],\n                \"1_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n                        {\n                                \"comment_id\": 4,\n                                \"body\": \"> [p2p](#comment_1071_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ): @fargo 的数据混乱了，貌似是数据没有同步完成就发帖。我这里有快照，自己研究一下格式，把数据手动合并，保存后随便点个赞就签名发布了（注意备份原数据）  http://127.0.0.1:43110/17iF64gTLycSohUSJsFyq7FMYsQfMqghJa/?13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ_16在他弄好之前，其他人不要跟他互动（包括在他的帖子下评论），否则就更混乱\\n\\n@p2p 我找不到类似你给我的那个文件，现在是删除了ZeroNet-master下的整个data文件，现在正常了吗？\",\n                                \"added\": 1485878588\n                        },\n                        {\n                                \"comment_id\": 5,\n                                \"body\": \"> [p2p](#comment_1075_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ): 你的文件在 ZeroNet/data/19BPUZYAdCMxExKHoVSG3cG95wfUfFTEC9/data/users/15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7/如果你没手动改过来，就不会正常\\n\\n太复杂了，我就看看不说话好了。\",\n                                \"added\": 1485937985\n                        }\n                ]\n        },\n        \"comment_vote\": {\n                \"1071_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": 1\n        }\n}","language":"application/x-json","encrypted":false,"added":1485958345},{"paste_id":22,"description":"@fargo 的合并后的data.json","body":"{\n    \"next_topic_id\": 6,\n    \"topic\": [\n        {\n            \"topic_id\": 1,\n            \"title\": \"访问历史出现在首页不爽，能否取消？另外已关注中的网站，更新会出现在那？\",\n            \"body\": \"如题。\",\n            \"added\": 1463875131,\n            \"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n        },\n        {\n            \"topic_id\": 2,\n            \"title\": \"原来在邮箱这可以看联络人是否在线\",\n            \"body\": \"这点还可以\",\n            \"added\": 1464048739,\n            \"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n        },\n        {\n            \"topic_id\": 3,\n            \"title\": \"ZeroNet善于利用关注中也是有点爽的\",\n            \"body\": \"遗憾的是Mail没通知，這点不够cool。\",\n            \"added\": 1464876134,\n            \"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n        },\n        {\n            \"topic_id\": 4,\n            \"title\": \"这个网站也是旧版的吧，怎么没有提交附件的按钮？\",\n            \"body\": \"有每天NBA原声BT torrent文件，想上传到这。\\n编辑：提交到这里了：http://127.0.0.1:43110/ZeroTorrent.bit/\",\n            \"added\": 1480393502,\n            \"parent_topic_uri\": \"8_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n        },\n                {\n                        \"topic_id\": 5,\n                        \"title\": \"这轮VPN整治，那种通过支付宝付款的vps是不是首当其冲？\",\n                        \"body\": \"大家说说没有海外卡是怎么支付的？\",\n                        \"added\": 1485763138,\n                        \"parent_topic_uri\": \"10_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa\"\n                }\n    ],\n    \"topic_vote\": {\n        \"1_16LArofpYM9Fu3SvTQpXW5UD89aArepKcd\": 1,\n        \"5_15oJLfpirNrTr2Fzhq6reLQ2aJGeDAnLHF\": 1\n    },\n    \"next_comment_id\": 43,\n    \"comment\": {\n        \"4_18gxxauQJuPCfZNJQkByuMzmH9UZG9Gu8q\": [\n            {\n                \"comment_id\": 1,\n                \"body\": \"good\",\n                \"added\": 1463674123\n            }\n        ],\n        \"1_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n            {\n                \"comment_id\": 2,\n                \"body\": \"> [sutra](#comment_27_13Xd2FuuSKJkdmdKvJ4k37rVg8W7jUu41i): 复制 data/users.json\\n> https://zeronet.readthedocs.io/en/latest/faq/#can-i-use-the-same-username-on-multiple-machine\\n\\n似乎单单这样是不能备份身份的。\",\n                \"added\": 1463875615\n            }\n        ],\n        \"1_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n            {\n                \"comment_id\": 3,\n                \"body\": \"难道这个hello zeronet 就是newsfeed？\\nhttp://192.168.18.104:43110/1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D\",\n                \"added\": 1463875804\n            },\n            {\n                \"comment_id\": 12,\n                \"body\": \"> [doobom](#comment_6_17s1HVViqrCDTk1wFWifWyAMhD8n4qNy33): 是的。\\n\\n明白了，原来想follow某个贴，是要点关注的。\",\n                \"added\": 1464278030\n            },\n            {\n                \"comment_id\": 13,\n                \"body\": \"其实这设置也不错。\",\n                \"added\": 1464278055\n            }\n        ],\n        \"1_16LArofpYM9Fu3SvTQpXW5UD89aArepKcd\": [\n            {\n                \"comment_id\": 4,\n                \"body\": \"好像不会经常，chromium\",\n                \"added\": 1463925229\n            },\n            {\n                \"comment_id\": 14,\n                \"body\": \"> [adm1n](#comment_17_16LArofpYM9Fu3SvTQpXW5UD89aArepKcd): 还好吧……可能不是经常，但每次出现，然后界面冻住，十分明显。\\n\\n你的是Tor连接吧，Tor有时不稳定，非tor没这个问题\",\n                \"added\": 1464615557\n            }\n        ],\n        \"1_18gxxauQJuPCfZNJQkByuMzmH9UZG9Gu8q\": [\n            {\n                \"comment_id\": 5,\n                \"body\": \"> [yb](#comment_7_1CuQFwcf76QwbaQpNfE54Kmtdjbg26RmyY): 我这里没这个问题。但是我的网站好像访问不了，帮忙看看。\\n> http://127.0.0.1:43111/1CpQfwShA6D8kAc4o3tu46GK1i89UtGP2o\\n\\n即使改为43110,也访问不了\",\n                \"added\": 1463925472\n            }\n        ],\n        \"1_17uVK6FBn9Wiq8XWKHpaMHwLu6oBqPsf99\": [\n            {\n                \"comment_id\": 6,\n                \"body\": \"关键是人太少了，信息流更新太太太慢。\",\n                \"added\": 1464047102\n            },\n            {\n                \"comment_id\": 7,\n                \"body\": \"> [doobom](#comment_2_17s1HVViqrCDTk1wFWifWyAMhD8n4qNy33): 嗯，相信人会越来越多的。。\\n\\n不会的，人不一定会越来越多，毕竟是个封闭网络。\",\n                \"added\": 1464048650\n            },\n            {\n                \"comment_id\": 8,\n                \"body\": \"> [doobom](#comment_2_17s1HVViqrCDTk1wFWifWyAMhD8n4qNy33): 嗯，相信人会越来越多的。。\\n\\n原来在邮箱这可以看朋友是否在线，朋友，我给你发邮件了，欢迎测试。\",\n                \"added\": 1464048854\n            },\n            {\n                \"comment_id\": 9,\n                \"body\": \"> [d8b](#comment_2_17uVK6FBn9Wiq8XWKHpaMHwLu6oBqPsf99): 已回复。。。 :)\\n\\nｗｏ，你的是安装在ｖｐｓ上的吗？怎么看到你的是小黄点的？我是安装在24小时在线的机器上，看到我是小绿点吗？\",\n                \"added\": 1464063911\n            }\n        ],\n        \"2_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n            {\n                \"comment_id\": 10,\n                \"body\": \"> [douzhanshengfo](#comment_2_19WKD9DcYGPR8jrzQPkZEA5xZeDDuza7qL): 只能内部使用，发不出去的吧貌似\\n\\n嗯，能通外网就逆天了\",\n                \"added\": 1464173983\n            }\n        ],\n        \"1_15tojHK9x7JSJYPZozDvqx77qRg1iCBoGi\": [\n            {\n                \"comment_id\": 11,\n                \"body\": \"ipsec可以的，一直用。\",\n                \"added\": 1464190526\n            }\n        ],\n        \"6_1NZsz5ugkzg27d9jmc8qrT9GxcLZdiuBGP\": [\n            {\n                \"comment_id\": 15,\n                \"body\": \"good\",\n                \"added\": 1464782898\n            },\n            {\n                \"comment_id\": 19,\n                \"body\": \"不能选择下载，真心没多大用。\",\n                \"added\": 1466483036\n            }\n        ],\n        \"11_1DzpF7398yNGjFwHQqHAu9fRkbE3WZ6dZA\": [\n            {\n                \"comment_id\": 16,\n                \"body\": \"主目录有个zeronet.conf文件，打开，tor = disable\",\n                \"added\": 1464875571\n            }\n        ],\n        \"11_19SxyZeLrqy2AUUG9hhtK8Pd5CUxtsP15Z\": [\n            {\n                \"comment_id\": 17,\n                \"body\": \"btsync , 最不爽的不能選擇下載文件\",\n                \"added\": 1465687512\n            },\n            {\n                \"comment_id\": 38,\n                \"body\": \"其实大家都用电骡最好，就是这类软件太多了。\",\n                \"added\": 1483143768\n            },\n            {\n                \"comment_id\": 39,\n                \"body\": \"其实大家都用电骡最好，就是这类软件太多了，最优秀的反而没人用了。\",\n                \"added\": 1483143813\n            }\n        ],\n        \"15_19SxyZeLrqy2AUUG9hhtK8Pd5CUxtsP15Z\": [\n            {\n                \"comment_id\": 18,\n                \"body\": \"黑魔术病栋 , 这个没看过 , 求ed2k链接\",\n                \"added\": 1466226098\n            },\n            {\n                \"comment_id\": 24,\n                \"body\": \"> [g7900ms](#comment_20_1JDSdmGp7QW7GyLh6L24x5z7TkzPMKFm3n): 欲奴，美剧。禁止的爱.善良的小姨子 ，韩国电影。\\n\\n谢谢介绍，下来看看。\",\n                \"added\": 1471869307\n            },\n            {\n                \"comment_id\": 27,\n                \"body\": \"> [mba](#comment_9_15Z67QmyH6MTfk3pDfBR635kVie5DaokHd): 西西里的美丽传说\\n\\ned2k://|file|Malena%202000%20Uncut%20%E8%A5%BF%E8%A5%BF%E9%87%8C%E7%9A%84%E7%BE%8E%E4%B8%BD%E4%BC%A0%E8%AF%B4%20%E6%9C%AA%E5%88%A0%E5%87%8F%E7%89%88%20%E4%B8%AD%E6%96%87%E5%AD%97%E5%B9%95%20Hr-Hdtv%20Ac3.1024x576%20x264-%E4%BA%BA%E4%BA%BA%E5%BD%B1%E8%A7%86%E5%88%B6%E4%BD%9C.mkv|1770396344|24728343E5E8AC826307A790673651BF|/\",\n                \"added\": 1476077072\n            }\n        ],\n        \"33_1NwWoM1qGUV9gjLG7QGyhqsRxKKga2rhtf\": [\n            {\n                \"comment_id\": 20,\n                \"body\": \"封闭网络是这样的了，始终人是有的，多少的问题。\",\n                \"added\": 1467026852\n            },\n            {\n                \"comment_id\": 21,\n                \"body\": \"封闭网络是这样的了，始终人是有的，多少的问题。\",\n                \"added\": 1467026862\n            },\n            {\n                \"comment_id\": 22,\n                \"body\": \"其实算是比较完善的了。\",\n                \"added\": 1467026924\n            },\n            {\n                \"comment_id\": 23,\n                \"body\": \"如果有个send to kindle的零网按钮，一键推送Ｚｅｒｏｎｅｔ中网页到kindle就满足了。\",\n                \"added\": 1467089278\n            }\n        ],\n        \"44_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n            {\n                \"comment_id\": 25,\n                \"body\": \"> [p2p](#comment_853_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ): 在ZeroMe首页，右上角有三个点，点击以后出现Follow username mentions和Follow comments on your posts，点击打勾后，可以在ZeroHello首页Newsfeed看到别人@你和回复你帖子的提醒。\\n\\n这点是最棒的。\",\n                \"added\": 1471869737\n            }\n        ],\n        \"5_15oJLfpirNrTr2Fzhq6reLQ2aJGeDAnLHF\": [\n            {\n                \"comment_id\": 26,\n                \"body\": \"完美\",\n                \"added\": 1473780609\n            }\n        ],\n        \"2_1FzCyv6ibgoShdXjQu7CCLiNTWhWhj5E6J\": [\n            {\n                \"comment_id\": 28,\n                \"body\": \"支持\",\n                \"added\": 1480117956\n            }\n        ],\n        \"4_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n            {\n                \"comment_id\": 29,\n                \"body\": \"> [lmath](#comment_225_1958F7oCppj78MP966AfojMQwHg2WUupzq): 然而 master 就没出提交附件的功能（虽然已经有人做出来了），而且这个论坛的拥有者已经隐退了，我们没法引入新功能，只能等域名过期后转移。\\n\\n谢谢。好像看到有提交的网站。\",\n                \"added\": 1480407067\n            },\n            {\n                \"comment_id\": 30,\n                \"body\": \"> [mydf](#comment_60_18kDuSDb2D5QTtabXj6Ert7dTvnUA3FSHN): http://127.0.0.1:43110/ZeroTorrent.bit/这个网站可以提交种子\\n\\n这个网站的搜索功能是废的，即使提交种子到这也是石沉大海，不必要。\",\n                \"added\": 1480431996\n            },\n            {\n                \"comment_id\": 32,\n                \"body\": \"好吧，试发到ZeroTorrent.bit。发我看的，想看到另外赛事的在此发言。\",\n                \"added\": 1480492375\n            },\n            {\n                \"comment_id\": 33,\n                \"body\": \"> [linkerlin](#comment_33_13Nzuvnhyz7nBJvPoUrdTEFuQTWUdqXAJk): 可以发磁力链接\\n\\n只有torrent，怎么知道磁链接？\",\n                \"added\": 1480912064\n            }\n        ],\n        \"2_1DD52vhXkbAdaS54PoZ2vNauiQ8XMiswC5\": [\n            {\n                \"comment_id\": 31,\n                \"body\": \"中国成最大嬴家？\",\n                \"added\": 1480477768\n            }\n        ],\n        \"48_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n            {\n                \"comment_id\": 34,\n                \"body\": \"大赞！\",\n                \"added\": 1481105706\n            }\n        ],\n        \"1_18Q7qa1gefr49uNPGPtcrbCE2YoyNDiZnj\": [\n            {\n                \"comment_id\": 35,\n                \"body\": \"看到喜欢的博客，回到首页，点击喜欢博客的下拉铵钮，克隆（clone）即可。\",\n                \"added\": 1481105965\n            }\n        ],\n        \"1_1DF7Sa6AkoLxZNPq5FSn3kAadKHfye9K6P\": [\n            {\n                \"comment_id\": 36,\n                \"body\": \"screen吧。\",\n                \"added\": 1481623282\n            }\n        ],\n        \"2_1JUrEVQLzG2DsmnLoLaGski2tRrPvRHtjs\": [\n            {\n                \"comment_id\": 37,\n                \"body\": \"> [lmath](#comment_314_1958F7oCppj78MP966AfojMQwHg2WUupzq): 我再看看，如果难度不大就把它做出来。\\n\\n现在在首页显示已经不错了嘛，反而mail没有提示感觉就有点浪费了mail的功能。\",\n                \"added\": 1481623398\n            }\n        ],\n                \"56_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": [\n                        {\n                                \"comment_id\": 38,\n                                \"body\": \"还是不能发图片？\",\n                                \"added\": 1485341499\n                        }\n                ],\n                \"1_15FDfY8PxKsonSWAs2XTbDMuAzVkK4oyYD\": [\n                        {\n                                \"comment_id\": 39,\n                                \"body\": \"虽然可惜硬盘空间，但是还是支持要发图，怎么才能删除特定网站的图片？\",\n                                \"added\": 1485680968\n                        }\n                ],\n                \"56_1DcMmKhgdfkR1GDA6zhWhoFRreaej4wLmW\": [\n                        {\n                                \"comment_id\": 40,\n                                \"body\": \"tox\",\n                                \"added\": 1485681633\n                        }\n                ],\n                \"5_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": [\n                        {\n                                \"comment_id\": 41,\n                                \"body\": \"> [p2p](#comment_1071_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ): @fargo 的数据混乱了，貌似是数据没有同步完成就发帖。我这里有快照，自己研究一下格式，把数据手动合并，保存后随便点个赞就签名发布了（注意备份原数据）  http://127.0.0.1:43110/17iF64gTLycSohUSJsFyq7FMYsQfMqghJa/?13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ_16在他弄好之前，其他人不要跟他互动（包括在他的帖子下评论），否则就更混乱\\n\\n@p2p 我找不到类似你给我的那个文件，现在是删除了ZeroNet-master下的整个data文件，现在正常了吗？\",\n                                \"added\": 1485878588\n                        },\n                        {\n                                \"comment_id\": 42,\n                                \"body\": \"> [p2p](#comment_1075_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ): 你的文件在 ZeroNet/data/19BPUZYAdCMxExKHoVSG3cG95wfUfFTEC9/data/users/15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7/如果你没手动改过来，就不会正常\\n\\n太复杂了，我就看看不说话好了。\",\n                                \"added\": 1485937985\n                        }\n                ]\n    },\n    \"comment_vote\": {\n        \"4_15TMCGSiwvvrDjuvU2arnpsyC19BHnj8k7\": 1,\n        \"2_19WKD9DcYGPR8jrzQPkZEA5xZeDDuza7qL\": 1,\n        \"12_1HrRNH7KbdxMjwLmwrHmZqJrzVZVDKc9bF\": 1,\n        \"880_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\": 1,\n        \"225_1958F7oCppj78MP966AfojMQwHg2WUupzq\": 1\n    }\n}","language":"application/x-json","encrypted":false,"added":1485958417},{"paste_id":23,"description":"FileServer.py","body":"    # Announce sites every 20 min\n    def announceSites(self):\n        import gc\n        if config.trackers_file:\n            gevent.spawn(self.trackersFileReloader)\n        start_up = True # Added by @P2P\n        while 1:\n            # Sites health care every 20 min\n            for address, site in self.sites.items():\n                if not site.settings[\"serving\"]:\n                    continue\n                    \n                self.log.info( \"Every 20 min's check: %s site...\" % site.address_short) # Added by @P2P\n                \n                if site.peers:\n                    site.announcePex()\n                    \n                if not start_up and len(site.getConnectedPeers()) == 0: # All connected peers are gone! During this time some files's update may be missed. We need check\n                    self.log.info( \"Every 20 min's check: %s All connected peers are gone!  We need check the site.\" % site.address_short)\n                    gevent.spawn(self.checkSite, site,  check_files=False) # Added by @P2P\n\n                # Retry failed files\n                if site.bad_files:\n                    site.retryBadFiles()\n\n                site.cleanupPeers()\n                \n                if not start_up:  # Don't do it at start up because checkSite already has needConnections at start up. Added by @P2P\n                    site.needConnections()  # Keep 5 active peer connection to get the updates\n\n                time.sleep(2)  # Prevent too quick request\n\n            site = None\n            gc.collect()  # Implicit garbage collection\n\n            # Find new peers\n            for tracker_i in range(len(config.trackers)):\n                self.log.info( \"announceSites's tracker_i: %s\"  % tracker_i) # Added by @P2P\n\n                for site in sorted(self.sites.values(), key=lambda site: site.settings.get(\"modified\", 0), reverse=True):  # Added by @P2P\n                    if not site.settings[\"serving\"]:\n                        continue\n                    self.log.info( \"Announce %s site, mode=update\"  % site.address_short) # Added by @P2P\n                    site.announce(mode=\"update\", pex=False)\n                    self.log.info( \" %s site's modified time:  %s\" % (site.address_short, site.settings.get(\"modified\", 0) )) # Added by @P2P\n                    if site.settings[\"own\"]:  # Check connections more frequently on own sites to speed-up first connections\n                        if len(site.getConnectedPeers()) == 0: # All connected peers are gone! During this time some files's update may be missed. We need check.\n                            self.log.info( \"%s All connected peers are gone!  We need to check the site.\" % site.address_short)\n                            gevent.spawn(self.checkSite, site,  check_files=False) # Added by @P2P\n                        else:\n                            site.needConnections()\n                    elif time.time() - site.settings.get(\"modified\", 0) < 24 * 60 *60: # Active site should be checked connections more frequently. \n                        # The 24h in config is better than hardcoded.\n                        self.log.info(\"%s Active site, check connections more frequently.\" % site.address_short)\n                        if len(site.getConnectedPeers()) == 0: # All connected peers are gone! During this time some files's update may be missed. We need check\n                            self.log.info( \"%s All connected peers are gone!  We need to check the site.\" % site.address_short)\n                            gevent.spawn(self.checkSite, site,  check_files=False) # Added by @P2P\n                        else:\n                            site.needConnections()\n                    else:\n                        self.log.info(\"%s Inactive site, don't check connections for now. \" % site.address_short) # Added by @P2P\n                    site.sendMyHashfield(3)\n                    site.updateHashfield(3)\n                    time.sleep(2)\n                    \n                # Put the sleep to end of the for loop to let it anounce to tracker earlier,  by @P2P\n                time.sleep(60 * 20 / len(config.trackers))  # Query all trackers one-by-one in 20 minutes evenly distributed\n                start_up = False # Added by @P2P","language":"text/x-python","encrypted":false,"added":1487942004},{"paste_id":24,"description":"FileServer.py ( updated )","body":"    # Announce sites every 20 min\n    def announceSites(self):\n        import gc\n        if config.trackers_file:\n            gevent.spawn(self.trackersFileReloader)\n        start_up = True # Added by @P2P\n        while 1:\n            # Sites health care every 20 min\n            for address, site in self.sites.items():\n                if not site.settings[\"serving\"]:\n                    continue\n                    \n                self.log.info( \"Every 20 min's check: %s site...\" % site.address_short) # Added by @P2P\n                \n                if site.peers:\n                    site.announcePex()\n                    \n                if not start_up and len(site.getConnectedPeers()) == 0: # All connected peers are gone! During this time some files's update may be missed. We need check\n                    self.log.info( \"Every 20 min's check: %s All connected peers are gone!  We need check the site.\" % site.address_short)\n                    gevent.spawn(self.checkSite, site,  check_files=False) # Added by @P2P\n\n                # Retry failed files\n                if site.bad_files:\n                    site.retryBadFiles()\n\n                site.cleanupPeers()\n                \n                if not start_up:  # Don't do it at start up because checkSite already has needConnections at start up. Added by @P2P\n                    site.needConnections()  # Keep 5 active peer connection to get the updates\n\n                time.sleep(2)  # Prevent too quick request\n\n            site = None\n            gc.collect()  # Implicit garbage collection\n\n            # Find new peers\n            for tracker_i in range(len(config.trackers)):\n                self.log.info( \"announceSites's tracker_i: %s\"  % tracker_i) # Added by @P2P\n                # Create a queue for the loop to prevent site's position in the queue changing during the check.\n                site_queue = sorted(self.sites.values(), key=lambda site: site.settings.get(\"modified\", 0), reverse=True)  # Added by @P2P\n                for site in site_queue:  # Added by @P2P\n                    if not site.settings[\"serving\"]:\n                        continue\n                    self.log.info( \"Announce %s site, mode=update\"  % site.address_short) # Added by @P2P\n                    site.announce(mode=\"update\", pex=False)\n                    self.log.info( \" %s site's modified time:  %s\" % (site.address_short, site.settings.get(\"modified\", 0) )) # Added by @P2P\n                    if site.settings[\"own\"]:  # Check connections more frequently on own sites to speed-up first connections\n                        if len(site.getConnectedPeers()) == 0: # All connected peers are gone! During this time some files's update may be missed. We need check.\n                            self.log.info( \"%s All connected peers are gone!  We need to check the site.\" % site.address_short)\n                            gevent.spawn(self.checkSite, site,  check_files=False) # Added by @P2P\n                        else:\n                            site.needConnections()\n                    elif time.time() - site.settings.get(\"modified\", 0) < 24 * 60 *60: # Active site should be checked connections more frequently. \n                        # The 24h in config is better than hardcoded.\n                        self.log.info(\"%s Active site, check connections more frequently.\" % site.address_short)\n                        if len(site.getConnectedPeers()) == 0: # All connected peers are gone! During this time some files's update may be missed. We need check\n                            self.log.info( \"%s All connected peers are gone!  We need to check the site.\" % site.address_short)\n                            gevent.spawn(self.checkSite, site,  check_files=False) # Added by @P2P\n                        else:\n                            site.needConnections()\n                    else:\n                        self.log.info(\"%s Inactive site, don't check connections for now. \" % site.address_short) # Added by @P2P\n                    site.sendMyHashfield(3)\n                    site.updateHashfield(3)\n                    time.sleep(2)\n                    \n                # Put the sleep to end of the for loop to let it anounce to tracker earlier,  by @P2P\n                time.sleep(60 * 20 / len(config.trackers))  # Query all trackers one-by-one in 20 minutes evenly distributed\n                start_up = False # Added by @P2P\n","language":"text/x-python","encrypted":false,"added":1488027299},{"paste_id":26,"description":"python script to find someone's file from ZeroNet snapshot and copy to somewhere","body":"# python script to find someone's file from ZeroNet snapshot and copy to somewhere\n# see: http://127.0.0.1:43110/NewGFWTalk.bit/?Topic:69_13Z7XxTa7JuFat3KzzMWu3onwM6biLuurJ\nfrom shutil import copytree\nimport os\npath = os.getcwd()  # assume that this py file is in data dir of ZeroNet snapshot\ndest_path =  '/somewhere/lmath testapp/' # destination where you'd like to copy to\n \nfor root, dirs, files in os.walk(path):\n   for d  in dirs:\n     if d =='17xeFZRG9nokuGNj8WZQU5V9ZdfUGr2gGT':  # @testapp's ID address\n         fullpath = os.path.join(root, d)\n         print fullpath\n         site_name = os.path.basename(os.path.dirname(os.path.dirname(root)))\n         print site_name\n         copytree(fullpath, os.path.join(dest_path,site_name))\n         ","language":"text/x-python","encrypted":false,"added":1520143422}],"comment":[]}