(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{27:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"e",(function(){return l}));var i=function(e){return"SELECT * FROM file_to_item AS fti WHERE fti.file_to_item_id='"+e+"'"},a=function(e){var t="SELECT f.*, j.* ";return t+="FROM file f ",t+="LEFT JOIN json AS j ON f.json_id=j.json_id ",t+="WHERE f.file_id='"+e+"'"},o=function(e){var t;return"jpg"===e||"png"===e||"jpeg"===e||"gif"===e?t="image":"avi"===e||"mpeg"===e||"webm"===e||"ogg"===e||"mp4"===e?t="video":"mp3"!==e&&"wav"!==e||(t="audio"),t},r=function(e){return e.replace(/[^\x20-\x7E]+/g,c()).replace(/ /g,"_").replace(/[&\/\\#,+()$~%'":*?!<>|{}\[\]]/g,c())},c=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<1;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},l=function(e){for(var t=[],n=0;n<e.pieces;n++){var i={};i.index=n,i.start=1048576*i.index,i.end=1048576*(i.index+1),n<e.pieces_downloaded?i.state="complete":n===e.pieces_downloaded&&(i.state="downloading"),t.push(i)}return t}},29:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return p}));var i=n(0),a=n.n(i),o=n(1),r=n(27),c=n(2);function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){d(e,t,n[t])}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,a=!1,o=void 0;try{for(var r,c=e[Symbol.iterator]();!(i=(r=c.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var f=Object(i.lazy)((function(){return Promise.all([n.e(0),n.e(3)]).then(n.bind(null,31))})),m=function(e){var t,n=Object(i.useContext)(o.a),d=n.appState,u=n.zeroNetState;e.topic?t=e.topic:e.comment?t=e.comment:e.profile&&(t=e.profile);var m=s(Object(i.useState)(t),2),p=m[0],_=(m[1],s(Object(i.useState)(!0),2)),g=_[0],b=_[1],E=s(Object(i.useState)(""),2),O=(E[0],E[1]),w=s(Object(i.useState)(""),2),j=w[0],h=w[1],S=s(Object(i.useState)(""),2),y=S[0],I=S[1],N=s(Object(i.useState)(""),2),x=N[0],P=N[1],C=s(Object(i.useState)(""),2),D=C[0],L=C[1],k=s(Object(i.useState)(""),2),A=k[0],F=k[1],R=s(Object(i.useState)(""),2),T=R[0],M=R[1],H=s(Object(i.useState)(!1),2),W=H[0],U=H[1],G=s(Object(i.useState)(""),2),J=G[0],q=G[1],z=s(Object(i.useState)(""),2),Q=z[0],$=z[1],B=s(Object(i.useState)(""),2),K=B[0],V=B[1],X=s(Object(i.useState)(!1),2),Y=X[0],Z=X[1];function ee(){if(p.file_to_item_id){O(!0);var e=Object(r.d)(p.file_to_item_id);Page.cmd("dbQuery",[e],(function(e){e.length>0?te(e[0].file_id):console.log("no file to item")}))}else te()}function te(e){var t;t=e?Object(r.c)(e):"SELECT * FROM file WHERE item_id='"+p.topic_id+"'",Page.cmd("dbQuery",[t],(function(e){if(e.length>0){var t=e[0],n=Object(r.a)(t.file_type),i=d.config,a=t.directory;t.directory||(a=i.cluster+"/data/users/"+t.user_id),ne("merged-"+i.merger_name+"/"+a+"/"+t.file_name,n,t.file_type)}else console.log("no file")}))}function ne(e,t,n){Page.cmd("optionalFileInfo",e,(function(i){var a,o;i&&(a=i.peer,o=Object(r.e)(i)),h(e);var c=u.user_settings,l=!1;c&&c.deleted_items&&c.deleted_items.indexOf(e)>-1&&(l=!0),Z(l),I(n),P(t),L(a),F(o),b(!1);var d=i&&1===i.is_downloaded&&1===i.is_downloading;(i&&!i.uploaded||d)&&(i.pieces===i.pieces_downloaded?M("downloaded"):(M("downloading"),function(e,t){var n=t&&1===t.is_downloaded&&1===t.is_downloading;if(!t.uploaded||n)if(t.pieces===t.pieces_downloaded)M("downloaded");else{1===t.is_downloading||t.is_downloaded,t.pieces_downloaded>0||t.bytes_downloaded;M("downloading"),ie(t,e)}}(e,i)))}))}function ie(e,t){Page.cmd("fileNeed",t,(function(e){Page.onRequest=function(e,n){var i,a,o,c=t.split("/")[1],d=t.split(c+"/")[1];n.event[0]&&(i=n.event[0]),n.event[1]&&(a=n.event[1]),a&&a.indexOf("|")>-1&&(o=a.split("|")[1],a=a.split("|")[0]),"setSiteInfo"==e&&a===d&&("file_failed"===i?(!function(e,t){var n=parseInt(e.split("-")[0]),i=parseInt(e.split("-")[1]),a=A.map((function(e){if(e.start===n||e.end===i)return"file_failed"===t?l({},e,{state:"failed"}):e}));F(a)}(o,i),M("download failed")):Page.cmd("optionalFileInfo",t,(function(e){var t=Object(r.e)(e);F(t),clearInterval(checkDownloadDuration)})))}}))}a.a.useEffect((function(){!function(){var t;e.topic?t=e.topic:e.comment?t=e.comment:e.profile&&(t=e.profile);t.file_to_item_id||t.added<=1498441955800?ee():t.embed_url&&function(e){var t=e.embed_url.lastIndexOf("."),n=e.embed_url.substring(t+1),i=Object(r.a)(n),a=!1;(e.embed_url.indexOf("http:")>-1||e.embed_url.indexOf("https:")>-1)&&(a=!0);a?function(e,t,n){h(e);var i=u.user_settings,a=!1;i&&i.deleted_items&&i.deleted_items.indexOf(e)>-1&&(a=!0);Z(a),I(n),P(t),b(!1),U(!0),q(!1)}(e.embed_url,i,n):ne(e.embed_url,i,n)}(t)}()}),[]);var ae,oe,re,ce,le="item-media-container";if(!0===W&&(ce=e.topic.embed_url),!0===g)ae=a.a.createElement(c.a,{cssClass:"centered",msg:"Loading Item Media..."});else if(x)if(!0!==W||J){var de;if(!0===W)oe=a.a.createElement("div",{className:"item-media-peers-display red"},"external");else de=!1===Y?a.a.createElement("span",null,a.a.createElement("a",{onClick:function(){return function(){var t=u.user_settings;t.deleted_items||(t.deleted_items=[]);var n=j;t.deleted_items&&-1===t.deleted_items.indexOf(n)&&t.deleted_items.push(n),Page.cmd("userSetSettings",{settings:t},function(t){Page.cmd("optionalFileDelete",n,function(t){Page.cmd("optionalFileDelete",n+".piecemap.msgpack",function(t){window.top.location.href="index.html?v=topic+id="+e.topic.topic_id}.bind(this))}.bind(this))}.bind(this))}()}},a.a.createElement("i",{className:"trash icon red"}))):a.a.createElement("span",null,a.a.createElement("a",{onClick:function(){return t=u.user_settings,n=t.deleted_items.findIndex((function(e){return e===j})),t.deleted_items.splice(n),void Page.cmd("userSetSettings",{settings:t},(function(t){window.top.location.href="index.html?v=topic+id="+e.topic.topic_id}));var t,n}},a.a.createElement("i",{className:"cloud download icon green"}))),oe=a.a.createElement("div",{className:"item-media-peers-display"},a.a.createElement("span",null,"peers : ",D," | "),de);!0===Y?ae=a.a.createElement("div",{className:"file-deleted-container"},a.a.createElement("i",{className:"icon trash red huge"}),a.a.createElement("p",null,"file is deleted")):(A&&A.length>0&&(re=a.a.createElement(v,{piecesInfo:A,downloadState:T}),le+=" w-pieces "),"image"===x?(le+=" image",Q||(le+=" image-loading ui segment"),ae=!0===K?a.a.createElement("img",{className:"not-found",src:"assets/img/404-not-found.png"}):a.a.createElement("div",null,a.a.createElement("img",{onError:function(){$(!0),V(!0)},onLoad:function(){$(!0)},src:j}),ce)):"video"!==x&&"audio"!==x||(ae=a.a.createElement("div",null,a.a.createElement(i.Suspense,{fallback:a.a.createElement(c.a,null)},a.a.createElement(f,{filePath:j,fileType:y,mediaType:x,comment:e.comment})),ce),le+=" video"))}else ae=a.a.createElement("div",{onClick:function(){q(!0)}},a.a.createElement("div",{className:"external-link-overlay"},"External!",a.a.createElement("br",null),"Load?"),ce);else ae=a.a.createElement("img",{className:"not-found",src:"assets/img/404-not-found.png"});return a.a.createElement("div",{className:le},ae,oe,re)},p=function(e){var t,n,o=s(Object(i.useState)(!0),2),c=(o[0],o[1]),d=s(Object(i.useState)(""),2),u=(d[0],d[1],s(Object(i.useState)(e.innerPath),2)),f=u[0],m=(u[1],s(Object(i.useState)(""),2)),p=m[0],_=m[1],g=s(Object(i.useState)(""),2),b=(g[0],g[1]),E=s(Object(i.useState)(""),2),O=(E[0],E[1]),w=s(Object(i.useState)(""),2),j=w[0],h=w[1],S=s(Object(i.useState)(""),2),y=S[0],I=S[1];return a.a.useEffect((function(){Page.cmd("optionalFileInfo",f,(function(e){var t,n;e&&(t=e.peer,n=Object(r.e)(e));var i=f.lastIndexOf("."),a=f.substring(i+1),o=Object(r.a)(p);_(a),b(o),O(t),h(n),c(!0);var d,s=e&&1===e.is_downloaded&&1===e.is_downloading;e.uploaded&&!s||(I("downloading"),d=f,Page.cmd("fileNeed",d,(function(e){Page.onRequest=function(e,t){var n,i,a,o=d.split("/")[1],c=d.split(o+"/")[1];t.event[0]&&(n=t.event[0]),t.event[1]&&(i=t.event[1]),i&&i.indexOf("|")>-1&&(a=i.split("|")[1],i=i.split("|")[0]),"setSiteInfo"==e&&i===c&&("file_failed"===n?(function(e,t){var n=parseInt(e.split("-")[0]),i=parseInt(e.split("-")[1]),a=j.map((function(e){if(e.start===n||e.end===i)return"file_failed"===t?l({},e,{state:"failed"}):e}));h(a)}(a,n),I("download failed")):Page.cmd("optionalFileInfo",d,(function(e){var t=Object(r.e)(e);h(t),clearInterval(checkDownloadDuration)})))}})))}))}),[]),j&&j.length>0&&(t=a.a.createElement(v,{piecesInfo:j,downloadState:y}),n+=" w-pieces "),a.a.createElement("div",{className:"unassigned-media-item-infobar "+n},t)},v=function(e){var t,n="";return e.piecesInfo.length>0?t=e.piecesInfo.map((function(t,n){return a.a.createElement(_,{key:n,piece:t,piecesLength:e.piecesInfo.length})})):e.fileInfo&&1===e.fileInfo.is_downloaded&&(n="non-bfs-loaded"),a.a.createElement("div",{className:"item-file-piece-download-info-container "+n},t,a.a.createElement("span",{className:"download-status"},e.downloadState))},_=function(e){var t=100/e.piecesLength,n="ui progress ";return"complete"===e.piece.state?n+=" success":"downloading"===e.piece.state?n+=" active":"failed"===e.piece.state&&(n+="error"),a.a.createElement("div",{style:{width:t+"%"},className:"piece "+e.piece.state},a.a.createElement("div",{className:n},a.a.createElement("div",{className:"bar"},a.a.createElement("div",{className:"progress"}))))}},34:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return o})),n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return l}));var i=function(e){return"SELECT * FROM topic_vote WHERE topic_vote.topic_id='"+e+"'"},a=function(e){return"SELECT * FROM comment_vote WHERE comment_vote.comment_id='"+e+"'"},o=function(e,t){return{up:e.filter((function(e){return 1===e.vote})),down:e.filter((function(e){return 0===e.vote})),user_vote:e.find((function(e){return e.user_id===t}))}},r=function(e,t){var n;return"UP"===t?e?1===e.vote?n="DELETE":0===e.vote&&(n="CHANGE"):n="UP":"DOWN"===t&&(e?1===e.vote?n="CHANGE":0===e.vote&&(n="DELETE"):n="DOWN"),n},c=function(e,t,n,i,a,o){var r;if(a&&(r=e[o+"_vote"].findIndex((function(e){return e[o+"_vote_id"]===a[o+"_vote_id"]}))),"UP"===n||"DOWN"===n){var c="UP"===n?1:0,l={user_id:t.cert_user_id,vote:c,added:Date.now()};l[o+"_vote_id"]=t.auth_address+"vt"+e["next_"+o+"_vote_id"],l[o+"_id"]=i,e[o+"_vote"].push(l),e["next_"+o+"_vote_id"]+=1}else"CHANGE"===n?e[o+"_vote"][r].vote=1===e[o+"_vote"][r].vote?0:1:"DELETE"===n&&e[o+"_vote"].splice(r,1);return e},l=function(e){var t={};return e.votes?(t.total=e.votes.up.length+e.votes.down.length,t.uvp=e.votes.up.length/t.total*100,t.dvp=e.votes.down.length/t.total*100):(t.total=e.up_votes+e.down_votes,t.uvp=e.up_votes/t.total*100,t.dvp=e.down_votes/t.total*100),t}}}]);