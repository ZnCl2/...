(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{111:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var r=n(0),i=n.n(r),a=n(1),o=n(7),u=n(27),s=n(35);function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(){var e,t,n,c=Object(r.useContext)(a.a),l=c.appState,d=c.appDispatch,m=c.zeroNetState,_=f(Object(r.useState)(),2),p=_[0],g=_[1],v=f(Object(r.useState)(),2),b=v[0],y=v[1],h=f(Object(r.useState)(),2),E=(h[0],h[1]);function j(e){Page.cmd("bigfileUploadInit",[e,p.file_size],(function(e){var t=new FormData,n=new XMLHttpRequest;t.append(p.file_name,p.f),n.upload.addEventListener("progress",(function(e){E(parseInt(e.loaded/e.total*100))})),n.upload.addEventListener("loadend",(function(){!function(){var e="merged-"+l.config.merger_name+"/"+l.config.cluster+"/data/users/"+m.site_info.auth_address+"/data.json";Page.cmd("fileGet",{inner_path:e},(function(t){(t=JSON.parse(t))?(t.file||(t.file=[],t.next_file_id=1),t.file_to_item||(t.file_to_item=[],t.next_file_to_item_id=1)):t={file:[],next_file_id:1,file_to_item:[],next_file_to_item_id:1};var n=m.site_info.auth_address,r={file_id:n+"fl"+t.next_file_id,file_type:p.file_type,file_name:p.file_name,item_id:n,item_type:"user",user_id:n,added:Date.now()};t.file.push(r),t.next_file_id+=1;var i={file_to_item_id:n+"fti"+t.next_file_to_item_id,item_type:"user",item_id:n,file_id:p.file_id,cluster_id:l.config.cluster,user_id:p.user_id,added:Date.now()};t.file_to_item.push(i),t.next_file_to_item_id+=1;var a=unescape(encodeURIComponent(JSON.stringify(t,void 0,"\t")));Page.cmd("fileWrite",[e,btoa(a)],(function(t){Page.cmd("sitePublish",{inner_path:e},(function(e){Page.cmd("wrapperNotification",["done","Avatar Created!",5e3])}))}))}))}()})),n.withCredentials=!0,n.open("POST",e.url),n.send(t)}))}function S(){var e="merged-"+l.config.merger_name+"/"+l.user.cluster_id+"/data/users/"+l.user.user_id+"/data.json";Page.cmd("fileGet",{inner_path:e},function(t){var n=(t=JSON.parse(t)).file.findIndex((function(e){return e.file_id===l.user.file_id})),r=t.file_to_item.findIndex((function(e){return e.file_to_item_id===l.user.file_to_item_id}));t.file.splice(n,1),t.file_to_item.splice(r,1);var i=unescape(encodeURIComponent(JSON.stringify(t,void 0,"\t")));Page.cmd("fileWrite",[e,btoa(i)],function(t){Page.cmd("sitePublish",{inner_path:e},function(e){!function(){var e="merged-"+l.config.merger_name+"/"+l.user.cluster_id+"/data/users/"+l.user.user_id+"/"+l.user.file_name;Page.cmd("fileDelete",{inner_path:e},(function(e){var t=Object(o.b)(m.site_info.auth_address);Page.cmd("dbQuery",[t],(function(e){var t=e[0];d.setUser(t),b&&j(b)}))}))}()}.bind(this))}.bind(this))}.bind(this))}p?e=i.a.createElement("img",{src:p.f.data}):(l.user.file_id&&(t="merged-"+l.config.merger_name+"/"+l.user.cluster_id+"/data/users/"+l.user.user_id+"/"+l.user.file_name),e=i.a.createElement(s.a,{userId:l.user.user_id,userName:l.user.user_name,filePath:t,dimensions:"100"}));return p&&(n=i.a.createElement("button",{type:"button",className:"native-btn",onClick:function(){var e="merged-"+l.config.merger_name+"/"+l.config.cluster+"/data/users/"+m.site_info.auth_address+"/"+p.file_name;y(e),l.user.file_id?S():j(e)}},i.a.createElement("a",null,"upload"))),i.a.createElement("div",{id:"user-avatar-form-container"},i.a.createElement("div",{id:"avatar-form-menu",className:"ui compact segment lightgray"},i.a.createElement("a",{onClick:S,className:"item"},i.a.createElement("i",{className:"ui icon remove"})),i.a.createElement("a",{className:"item"},i.a.createElement("input",{type:"file",accept:"image/*",onChange:function(e){!function(e,t){var n=new FileReader;n.onload=function(){e.f.data=n.result,g(e)},n.readAsDataURL(t)}({f:e.target.files[0],file_name:Object(u.b)(e.target.files[0].name),file_type:e.target.files[0].type.split("/")[1],file_size:e.target.files[0].size,media_type:e.target.files[0].type.split("/")[0],item_type:"topic"},e.target.files[0])}}),i.a.createElement("i",{className:"ui icon add"}))),e,n)}},27:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return s}));var r=function(e){return"SELECT * FROM file_to_item AS fti WHERE fti.file_to_item_id='"+e+"'"},i=function(e){var t="SELECT f.*, j.* ";return t+="FROM file f ",t+="LEFT JOIN json AS j ON f.json_id=j.json_id ",t+="WHERE f.file_id='"+e+"'"},a=function(e){var t;return"jpg"===e||"png"===e||"jpeg"===e||"gif"===e?t="image":"avi"===e||"mpeg"===e||"webm"===e||"ogg"===e||"mp4"===e?t="video":"mp3"!==e&&"wav"!==e||(t="audio"),t},o=function(e){return e.replace(/[^\x20-\x7E]+/g,u()).replace(/ /g,"_").replace(/[&\/\\#,+()$~%'":*?!<>|{}\[\]]/g,u())},u=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<1;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},s=function(e){for(var t=[],n=0;n<e.pieces;n++){var r={};r.index=n,r.start=1048576*r.index,r.end=1048576*(r.index+1),n<e.pieces_downloaded?r.state="complete":n===e.pieces_downloaded&&(r.state="downloading"),t.push(r)}return t}},35:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(0),i=n.n(r),a=n(1),o=n(7);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t,n=Object(r.useContext)(a.a),s=n.appState,f=n.zeroNetState,c=u(Object(r.useState)(!0),2),l=c[0],d=c[1],m=u(Object(r.useState)(""),2),_=m[0],p=m[1],g=u(Object(r.useState)(""),2),v=g[0],b=g[1],y=u(Object(r.useState)(""),2),h=y[0],E=y[1];function j(){var t=e.userName?e.userName:f.site_info.auth_address,n=t.substring(0,2),r=Object(o.c)(t);b(n),E(r),d(!1)}if(i.a.useEffect((function(){var t;e.filePath?(p(e.filePath),d(!1)):(t=Object(o.a)(e.userId),Page.cmd("dbQuery",[t],(function(e){if(e.length>0){var t=e[0];if(t.cluster_id){var n="merged-"+s.config.merger_name+"/"+t.cluster_id+"/data/users/"+t.user_id+"/"+t.file_name;p(n),d(!1)}else{var r="SELECT * FROM json WHERE json_id='"+t.json_id+"'";Page.cmd("dbQuery",[r],(function(e){var n=e[0],r="merged-"+s.config.merger_name+"/"+n.directory+"/"+t.file_name;p(r),d(!1)}))}}else j()})))}),[e]),!l)if(_)t=i.a.createElement("img",{onError:function(){d(!0),p(""),j()},className:"comment-avatar",src:_});else{var S="28",O="28";e.dimensions&&(S=e.dimensions,O=e.dimensions),t=i.a.createElement("div",{className:"user-avatar initials",style:{width:S+"px",height:O+"px"}},i.a.createElement("span",{style:{background:h}},v))}return i.a.createElement("div",{className:"user-avatar-display-container"},t)}}}]);