{
	"title": "DIY@Balancer",
	"description": "DIY, IoT, Arduino, ESP8266 and more...\n\n«Умный дом», «сделай сам» и прочая ардуинщина",
	"links": "*   [Balancer's Blog](/1MaQ4W5D6G52TpBfPACU9k9QcB1DxvHZ5v/)\n*   [Balancer's Wiki](/1NbzP9dgYhuY71bde9G1LuVGaCE69venzR/)",
	"next_post_id": 26,
	"demo": false,
	"modified": 1544485272,
	"post": [
		{
			"post_id": 25,
			"title": "WS2812 and children :)",
			"date_published": 1544481260.492,
			"body": "Сорри за адскую смесь русского и английского языка, но я пока не знаю, как мне лучше делать двуязычный блог. А для того, чтобы делить блог на два на разных языках тут мало материала. И я тогда точно буду лениться переводить его на английский язык :)\n\n_Sorry for a hell of a mixture of Russian and English, but I still do not know how I better do a bilingual blog. And in order to divide the blog into two in different languages there is not enough material. And then I will definitely be lazy to translate it into English :)_\n\nЕщё весной [я заказал для тестов китайскую светодиодную матрицу на базе светодиодов WS2812b](/1ApsfuUfnyJm19qZguDzzqj7se41Ggxzrt/?Post:14:8x8+WS2812b+matrix). Это на которых RGB-ленты делают, в которые данные по одному проводочку грузятся и каждый светодиод своим цветом зажигается. Тогда я не мудрствуя лукаво прицепил матрицу к уже готовой ESP8266, которой рулил светодиодной лентой, написал простейший код для вывода плоских битмапов в шестнадцатеричном виде и надолго забыл.\n\n_Back in the spring, [I ordered a Chinese LED matrix based on WS2812b for testing](/1ApsfuUfnyJm19qZguDzzqj7se41Ggxzrt/?Post:14:8x8+WS2812b+matrix). These are on which RGB tapes are made, in which data on one wire is loaded and each LED lights up in its own color. Then, without further ado, I hooked the matrix to the ready-made ESP8266, which I was driving with LED tape, wrote the simplest code for outputting flat bitmaps in hexadecimal and forgot for a long time._\n\nДочка сейчас болеет, физические нагрузки исключены, по улице особо не погулять — начал придумывать, чем бы занять. Вспомнил про эту матрицу. Сперва вместе с ней посадили матрицу и отладочную плату на термоклей на Лего-детали, чтобы можно было собирать более-менее устойчивую конструкцию:\n\n_My daughter is sick now, physical exertion is excluded, I didn’t take a special walk down the street - I started to figure out what to do. I remembered this matrix. First, together with it, they put the matrix and the solderless breadboard on the hot-melt glue on the Lego part, so that you can assemble a more or less stable structure:_\n\n![07-6949953-20181207-113655.jpg (1200x900)](data/img/post_25_07-6949953-20181207-113655.jpg)\n\n* * *\n\nДальше была идея показать ей, как делать картинки формата 8x8 в спрайтовом редакторе, экспортировать в шестнадцатеричном виде и грузить их в программы на Lua в ESP8266\\. Но я же зануда. Я ей с очень низкого уровня показал, как программируют на Lua, что такое двоичный и шестнадцатеричный код, что такое RGB и как шестнадцатеричные цифры превращаются в пиксели. Внезапно дочка вместо работы через редактор стала редактировать с телефона картинки прямо в шестнадцатеричном виде :D Вот так:\n\n_Next was the idea to show her how to make 8x8 pictures in the sprite editor, export in hexadecimal and load them into Lua programs in ESP8266\\. But I'm a bore. I showed her from a very low level how to program on Lua, what a binary and hexadecimal code is, what RGB is and how hexadecimal numbers turn into pixels. Suddenly, instead of working through the editor, the daughter began to edit the pictures from the phone directly in hex :D Like this:_\n\n![07-6950477-2018-12-07-17-00-10.png (1194x498)](data/img/post_25_07-6950477-2018-12-07-17-00-10.png)\n\n![07-6950477-20181207-170150.jpg (1200x900)](data/img/post_25_07-6950477-20181207-170150.jpg)\n\nА сегодня пошла и записала ролик на YouTube (про матрицу — с 0:55)\n\n_And today she recorded a video on YouTube (about the matrix - from 0:55)_\n\n[https://youtu.be/U6rPl9CT38I](https://youtu.be/U6rPl9CT38I)\n\n![2018-12-11_01-47-03.jpg (1212x898)](data/img/post_25_2018-12-11_01-47-03.jpg)\n\nЗабавно получилось — дочка устроила стресс-тест «Web-IDE». Оказывается, если там много файлов в ФС (штук под 40), то для формирования HTML-страницы не хватает памяти и NodeMCU уходит в рестарт. Т.е. понаписала файлов с картинками, а потом больше запускать их не смогла. При попытке открыть в браузере IDE, микроконтроллер сразу уходит в рестарт. Мне сегодня костылять пришлось, пока просто ограничил тупо число выводимых файлов, потом надо будет или переписать на поблочный вывод, или с разбивкой на страницы.\n\n_It turned out funny - the daughter arranged a stress test for the \"Web-IDE\". It turns out that if there are a lot of files in the FS (40 pieces), then there is not enough memory to form the HTML page and the NodeMCU goes to restart. My daughter wrote a lot of files with pictures, and then she couldn’t run them anymore. When you try to open the IDE in the browser, the microcontroller immediately goes into restart. Today I had to dirty fix, until I just stupidly limited the number of output files, then I would have to either rewrite it by block output, or paginated._"
		},
		{
			"post_id": 24,
			"title": "Radio 86RK — My first self-welded computer (1990)",
			"date_published": 1541073065.03,
			"body": "This is not a complete article yet, but a short note for a comment in ZeroMe :) Maybe later I will write more in detail. The first computer I did with my own hands was Radio 86РК.\n\n![Radio86RK.jpg (1200x771)](data/img/post_24_Radio86RK.jpg)\n\nI started doing it in late 1990, and launched it in the summer of 1991\\. I had two memory modules defective, and I didn’t have any oscilloscopes or any other tools ... I even determined the status of the data and address buses using a probe from the LED :) But the problem was detected and soon the computer started working. It had 32kbytes of RAM, a 64x25 text screen and a tape recorder as a program carrier.\n\n* * *\n\n![BARMEN.RK-1.png (936x600)](data/img/post_24_BARMEN.RK-1.png)\n\n![ALIAZ1.RK-2.png (936x600)](data/img/post_24_ALIAZ1.RK-2.png)\n\nI did not have a tape recorder, so after each turn on of the game and other programs I manually entered byte by byte in hexadecimal form :)\n\n![IMG_1048.JPG (800x598)](data/img/post_24_IMG_1048.JPG)\n\nWhen the refrigerator was turned on at home, the computer would hang due to a voltage surge. No capacitor banks saved. So, during operation, the refrigerator had to be turned off :D But with this computer I first learned programming in machine codes. I wrote on a piece of paper a program in assembler 8080 (the Soviet analogue is KR580VM80A), manually translated this program into machine codes, arranged the addresses of transitions and in this form entered the program into the computer's memory.\n\nAlthough now my Radio 86RK is still somewhere stored by my mother in the village, I have not seen him for a long time and I don’t have his photos. Anything higher is on the Internet. My case was the same as in this photo. Only the keyboard was different, with tight little buttons :)\n\n![maxresdefault__1_.jpg (1280x720)](data/img/post_24_maxresdefault__1_.jpg)"
		},
		{
			"post_id": 23,
			"title": "Munin and temperature from ESP8266",
			"date_published": 1540454712.884,
			"body": "For [forum topic](https://www.linux.org.ru/forum/development/14556551?cid=14557800):\n\n![mqtt_hbr_d1_temp-week.png (497x280)](data/img/post_23_mqtt_hbr_d1_temp-week.png)\n\n![mqtt_hbr_d1_humidity-week.png (497x280)](data/img/post_23_mqtt_hbr_d1_humidity-week.png)"
		},
		{
			"post_id": 22,
			"title": "Munin for IoT-charts",
			"date_published": 1539135675.034,
			"body": "**Sorry, I'll do the text in English later. May be**\n\n> **[dude](/1ApsfuUfnyJm19qZguDzzqj7se41Ggxzrt/?Post:21#comment_1_1APx2pf1wNGFz4mWCN2sFzrtTGzrLKZUQ2):** что за прога дает такие графики красивые?\n\n[Munin](http://munin-monitoring.org/). Он содержит в себе RRD-базу данных и рисовалку. Работает на довольно простой системе плагинов, которые можно писать на любом любимом скриптовом языке. Конкретно на Orange Pi используются штатные плагины. А так я много MQTT-графиков на нём делаю, удобно получается :)\n\nНапример, освещённость в комнате (в попугаях) за неделю:\n\n![](https://gateway.ipfs.io/ipfs/QmcU8AGxjukz6S4vsabkVQme6V61ttYg7knRYmDQphSWna/mqtt_neron_luminosity-week.png)\n\n---\n\nФоторезистор висит на Arduino, прицепленном к Orange Pi, Arduino скармливает по Serial данные в Orange Pi, тот уже кладёт в MQTT, а Munin на другом компе снимает данные с MQTT и пишет в базу.\n\nВлажность за месяц. Тут просто ESP8266 + BME280, пишет в MQTT прямо от себя по воздуху через Wi-Fi:\n\n![](https://gateway.ipfs.io/ipfs/QmdPUyWZdjNGRKKqT3yVebVFrjJpXrRdyNTGAeSnkcxps8/mqtt_hbr_d1_humidity-month.png)\n\nИ даже заряд батареи моего телефона :)\n\n![](https://gateway.ipfs.io/ipfs/QmU57izhqpa8kuE2RHHEgXcA6gkUkEeDEBnusjW8MZ8zpN/mqtt_v20_battery-week.png)\n\nВ этом случае на телефоне стоит [Zanzito](https://play.google.com/store/apps/details?id=it.barbaro.zanzito), он и отсылает по MQTT данные в сеть."
		},
		{
			"post_id": 21,
			"title": "Orange Pi and overheating",
			"date_published": 1539081706.997,
			"body": "My wife once dropped my working Orange Pi on a radiator. I noticed very soon, only when I suspected something because of the slow work :) You can estimate the temperature to which it was warming up. No cooler, only a passive radiator. And all this is in a box.\n\n**Жена однажды уронила работающий Orange Pi на батарею отопления. Я заметил очень нескоро, только когда заподозрил, что-то из-за замедленной работы :) Можно оценить, до каких температур он разогревался. Кулера нет, только пассивный радиатор. И всё это — в коробке.**\n\n![neron-on-heating-radiator-thermal_zone-month.png (0x0)](data/img/post_21_neron-on-heating-radiator-thermal_zone-month.png)\n\n![neron-on-heating-radiator-thermal_zone-week.png (0x0)](data/img/post_21_neron-on-heating-radiator-thermal_zone-week.png)"
		},
		{
			"post_id": 20,
			"title": "New Guide: John Park’s Crickit x LEGO Harmonic Drawing Machine @adafruit @johnedgarpark #adafruit #lego",
			"date_published": 1535872383.277,
			"body": "##### Origin: [http://www.iotexpert.it/2018/08/03/new-guide-john-parks-crickit-x-lego-harmonic-drawing-machine-adafruit-johnedgarpark-adafruit-lego/](http://www.iotexpert.it/2018/08/03/new-guide-john-parks-crickit-x-lego-harmonic-drawing-machine-adafruit-johnedgarpark-adafruit-lego/), Agosto 3, 2018\n\nCreate beautiful complex harmonic curves with this drawing robot! [This new guide will show you how](https://learn.adafruit.com/crickit-harmonic-drawing-machine).\n\n![makecode_IMG_0144-768x576.jpg (768x576)](data/img/post_20_makecode_IMG_0144-768x576.jpg)\n\n---\n\nDifferent from a roulette curve drawing machine, such as a Spirograph, a harmonograph/pintograph generates Lissajous curves that are bounded by four corners.\n\nBy adjusting the pivots and motor speed ratios using the Circuit Playground Express buttons, you can make different types of drawings.\n\n![curveCU-600x450.gif (600x450)](data/img/post_20_curveCU-600x450.gif)\n\n![makecode_IMG_0063-768x576.jpg (768x576)](data/img/post_20_makecode_IMG_0063-768x576.jpg)\n\nYou’ll even get to merge the worlds of Crickit and LEGO with this TT motor-to-Technic cross axle! And, a very stylish 3D printed Crickit-to-LEGO plate finishes it off.\n\n![makecode_IMG_0067-600x450.jpg (600x450)](data/img/post_20_makecode_IMG_0067-600x450.jpg)"
		},
		{
			"post_id": 19,
			"title": "ESP32 + Lego",
			"date_published": 1535871756.774,
			"body": "I found that ESP32 in the M5Stack version has holders for Lego Technic. Although I have not seen any ready-made interesting solutions with this, but it is worth paying attention and thinking.\n\n**Обнаружил, что ESP32 в варианте M5Stack имеет крепления под Lego Technic. Хотя пока готовых интересных решений с этим не увидел, но оно стоит того, чтобы обратить внимание и подумать.**\n\n![1set-M5Stack-M5GO-IoT-Starter-Kit-ESP32-for-Arduino-MicroPython-font-b-Programming-b-font-Development.jpg (829x800)](data/img/post_19_1set-M5Stack-M5GO-IoT-Starter-Kit-ESP32-for-Arduino-MicroPython-font-b-Programming-b-font-Development.jpg)\n\n---\n\n![M5Stack-NEW-PSRAM-2-0-FIRE-IoT-Kit-Dual-Core-ESP32-16M-FLash-4M-PSRAM-Development.jpg (700x700)](data/img/post_19_M5Stack-NEW-PSRAM-2-0-FIRE-IoT-Kit-Dual-Core-ESP32-16M-FLash-4M-PSRAM-Development.jpg)\n\n![M5Stack-NEW-PSRAM-2-0-FIRE-IoT-Kit-Dual-Core-ESP32-16M-FLash-4M-PSRAM-Development.jpg_640x640.jpg (640x640)](data/img/post_19_M5Stack-NEW-PSRAM-2-0-FIRE-IoT-Kit-Dual-Core-ESP32-16M-FLash-4M-PSRAM-Development.jpg_640x640.jpg)​​​​​​​"
		},
		{
			"post_id": 18,
			"title": "New forum",
			"date_published": 1561710316,
			"body": "I opened a forum on this topic. I do not know how much it will be in demand, but let it be :)\n\n[http://127.0.0.1:43110/1diyHbGrjKR65DLVpaLoMYsiwqiQYskKD](http://127.0.0.1:43110/1diyHbGrjKR65DLVpaLoMYsiwqiQYskKD)\n\n**Открыл форум по этой теме. Не знаю, насколько он будет востребован, но пусть будет :)**"
		},
		{
			"post_id": 17,
			"title": "Px marices with ESP8266",
			"date_published": 1522527310.484,
			"body": "**How to connect Px-matrix to ESP8266 without additional chips.**\n\nПопалось интересное решение по подключению RGB LED матрицы (Px) к ESP8266/NodeMCU. Обычным вариантом такое не сделать, так как требуется 13 линий (6 — данные, 7 — управление) а на ESP8266 ног не хватает. Я для этого цеплял матрицу к Ardunio Mega, а уже на Mega скармливал управляющий код с ESP по serial. А тут товарищ извернулся, закольцевав шину данных и скармливая туда данные по одной линии. Т.е. получилось как раз 8 линий:\n\n[https://github.com/2dom/PxMatrix](https://github.com/2dom/PxMatrix)\n\n![P10_cables.jpg (1200x900)](data/img/post_17_P10_cables.jpg)\n\nЯ, конечно, переделывать уже не буду, даже шилд сделал для подключения ESP01 к Arduno Mega, но на будущее может пригодиться :)"
		},
		{
			"post_id": 16,
			"title": "Android sensors to MQTT",
			"date_published": 1522471968.296,
			"body": "I used the data collection from sensors hanging in the kitchen on the wall of the tablet (Asus TF300T). It will be necessary to make a separate article on [Zanzito](https://play.google.com/store/apps/details?id=it.barbaro.zanzito). ​​​​​​​Though paid, but an interesting solution. A daemon that throws data from Android to MQTT and vice versa allows you to control the Android slightly through MQTT (although it's not important for me to turn on the volume).\n\nThe reading of the sensor of illumination is interesting. Although in general everything is in line. Probably, it will be necessary to smooth out the data.\n\n![mqtt_tf300t_light-day.png (497x280)](data/img/post_16_mqtt_tf300t_light-day.png)\n\n**Задействовал сбор данных с сенсоров висящего на кухне на стене планшета (Asus TF300T). Надо будет сделать отдельную статью по [Zanzito](https://play.google.com/store/apps/details?id=it.barbaro.zanzito). Хоть и платное, но интересное решение. Демон, который кидает данные с Андроида на MQTT и наоборот, позволяет немного управлять Андроидом через MQTT (хотя важного для меня включения громкости тут нет).**\n\n**Интересно дёргаются показания сенсора освещённости. Хотя в целом всё соответствует. Видимо, нужно будет сглаживать данные.**"
		},
		{
			"post_id": 15,
			"title": "RPV-Tank",
			"date_published": 1521270011.136,
			"body": "At the [Chinese radio-controlled Lego technic tank](/1ApsfuUfnyJm19qZguDzzqj7se41Ggxzrt/?Post:9:Китайский+радиоуправляемый+Lego-танк), I took off the tower and mounted an old FPV quadrocopter. It turned out \"RPV-tank\" :) My son does not understand much yet, but my daughter was absolutely delighted yesterday. She locked herself in one room and crushed us with the help of this tank in another :)\n\n**С [китайского радиоуправляемого Lego technic танка](/1ApsfuUfnyJm19qZguDzzqj7se41Ggxzrt/?Post:9:Китайский+радиоуправляемый+Lego-танк) я снял башню и закрепил старенький FPV-квадрокоптер. Получился \"RPV-танк\" :) Сын пока особо не понимает, а вот дочка вчера была в полном восторге. Заперлась в одной комнате и давила нас этим танком в другой :)**\n\n![photo_2018-03-16_13-51-08.jpg (1200x900)](data/img/post_15_photo_2018-03-16_13-51-08.jpg)"
		},
		{
			"post_id": 14,
			"title": "8x8 WS2812b matrix",
			"date_published": 1520703332.392,
			"body": "I play with a matrix of 8x8 based on WS2812b. Connected to ESP8266 and I want to make downloadable by air animations.\n\n**Балуюсь с матрицей 8x8 на основе WS2812b. Подключил к ESP8266 и хочу сделать загружаемые по воздуху анимации.**\n\n![20180310_200220.jpg (1200x900)](data/img/post_14_20180310_200220.jpg)"
		},
		{
			"post_id": 13,
			"title": "ESP8266 Uptime",
			"date_published": 1515330993.411,
			"body": "Некоторое время назад, после очередного флейма в Телеграме об аптаймах ESP8266 я поставил логгирование аптайма своих ESP-шек (кроме одной-двух, что не в постоянном включении). Вот такой график вышел :) Аптайм в часах за неделю.\n\n![esp8266_uptimes-week.png (497x316)](data/img/post_13_esp8266_uptimes-week.png)\n\nЗелёный, «MH-Z19» — это NodeMCU «новая» версия, которая более узкая, чем старая. Синий, «Gas» — это, как раз, старая NodeMCU. \"D1 mini\" — это соответствующий WeMos. \"Wemos D1\" — это который в формфакторе Arduino. Прошивка всюду NodeMCU.\n\nЕщё можно отметить, что D1 Mini только включен и ничего не делает :) Я на нём отлаживал online-ide, да так и оставил пока."
		},
		{
			"post_id": 12,
			"title": "Морда виртуального робота умного дома",
			"date_published": 1514573110.272,
			"body": "Делаю вот такую морду виртуального робота своего умного дома :) Пока тупо матрицы для рисования состояния ну и PIR-сенсор для использования полезной площади :)\n\n![photo_2017-12-29_19-24-58.jpg (1280x960)](data/img/post_12_photo_2017-12-29_19-24-58.jpg)\n\nПотом ещё добавлю ультразвуковой дальномер, чтобы видел, что кто-то спереди есть, датчик освещённости, чтобы яркость регулировать и сервопривод для поворотов морды в стороны :)"
		},
		{
			"post_id": 11,
			"title": "Светодиодные ленты SK6812",
			"date_published": 1513940308.401,
			"body": "У знакомого возникла интересная задача. Нужно сделать осветительную подсветку светодиодной лентой. С эффектом зажигания от одной стороны. Просто с эффектами проблем нет, WS2811 — и готово. Но освещение! Сейчас там энергосберегайка на 75Вт. Значит, светодиодов надо где-то ватт на 36\\. На 4 метра длиной.\n\nЯ долго рылся, но белых светодиодных лент с пиксельной адресацией на Али не нашёл :)\n\nНо нашёл SK6812\\. Которая почти как WS2811b, но с дополнительным белым светодиодом, т.е. RGBW вместо RGB.\n\n![HTB1bCSZRXXXXXckaXXXq6xXFXXXV.jpg (800x800)](data/img/post_11_HTB1bCSZRXXXXXckaXXXq6xXFXXXV.jpg)\n\nЗаказал в Китае такой лот:\n\n[https://www.aliexpress.com/item/Wholesale-4m-5m-SK6812-similar-ws2812b-RGBW-4-in-1-Waterproof-IP65-IP67-60-leds-pixles/32476317187.html](https://www.aliexpress.com/item/Wholesale-4m-5m-SK6812-similar-ws2812b-RGBW-4-in-1-Waterproof-IP65-IP67-60-leds-pixles/32476317187.html)\n\nНу и БП пожирнее (40А при 5В).\n\nНедавно ленты пришли и вчера я начал тестировать.\n\n* * *\n\nНа упаковке заявлено до 90Вт при полном включении. Первые же тесты показали, что ленте этого не хватает, даже при питании с двух концов. Напряжение проседает на ленте страшно и она виснет... Решил, что придётся резать влагозащиту и питать через каждый метр. И толстый силовой провод рядом :)\n\nОднако, сегодня снова сел, пересобрал, перенеся на другое место для тестов и теперь при питании с двух концов на полной яркости, (255,255,255,255) — ничего не виснет :) Видимо, как всегда, дело в контактах было... Хотя яркость, конечно, на 90Вт и близко не тянет :D\n\nНашёл китайский ваттметр :) Из розетки на полной яркости жрёт 67.5Вт. На холостом ходу жрётся 5.5Вт. Какой там КПД у блоков питания? Процентов 90? Тогда выходит, что лента жрёт где-то 55Вт\n\nЛента при долгой работе на полной яркости разогрелась до 50°С, мощность потребления из розетки упала до 65.8Вт.\n\nОднако, освещение явно не тянет на эквивалент ~55x9 = 500Вт накаливания :) Или на ~100Вт энергосберегайки. Явно тусклее. То ли от особенностей исполнения элементов, то ли от диаграммы направленности. Точнее пока днём оценить сложно даже при закрытых жалюзи, вечером попробую яркость оценить точнее :)\n\n- См. также тему на форуме: [Светодиодные ленты WS2811 и другие](http://forums.balancer.ru/tech/forum/2016/02/t92411--svetodiodnye-lenty-ws2811-i-drugie.html)"
		},
		{
			"post_id": 10,
			"title": "Умный дом",
			"date_published": 1512561829.31,
			"body": ">**[Bruce_Lee@LOR](https://www.linux.org.ru/forum/linux-hardware/13872128)**:\n>Интересуют даже небольшие практичные проекты, какие платки, датчики, модули, питание, реле и прочие железки используете?\n\nЯ пишу довольно мало, но что пишу — тут, в основном: http://www.balancer.ru/tech/forum/viewforum.php?id=55\n\nЗавёл ещё отдельный блог в ZeroNet, но он вообще пока почти пустой (это из серии отработки формата): http://127.0.0.1:43110/1ApsfuUfnyJm19qZguDzzqj7se41Ggxzrt/\n\n>Я уже понял, что делаю неправильно и запутался, потому что не учёл опыт других, а просто тупо по каталогам заказываю на первый взгляд подходящие датчики, модули и т.п.\n\nЯ почти так и делаю, поскольку многое заранее не решить, многие идеи приходят позже и если нет чего-то готового для их реализации, ждать, заказывать... :)\n\nНо я не запутался, я сразу понимал, что работа будет рваная и неравномерная. Поэтому не стал заморачиваться целостностью решений, а продумал концепцию связи разрозненных устройств. В обсновном сейчас всё делается на MQTT-протоколе. Сперва их готового HomeAssistant, но пользы от него не нашёл, так что сейчас использую чистый Mosquitto.\n\nСуть в том, что каждый источник данных кладёт на MQTT свои данные независимо от остальных. Температура, влажность, CO2, природный газ, уровень освещения... Даже IP каждого устройства после старта, чтобы потом не ломать голову, кто что получил по DHCP :) Каждый приёмник способен воспринимать по MQTT команды. Например, включение светодиодной матрицы, голосовое сообщение, включение Интернет-радио и т.п.\n\nИ пара условно мозгов в виде cron-скриптов на домашнем сервере и  OrangePi, которые смотрят данные, отправленные по MQTT и что-то предпринимают. Например, в 22:00 робот гонит всех голосовым сообщение спать, а с 22:30, если свет ещё не выключен, начинает раз в 10-15 минут ругаться. Если концентрация CO2 превышает 800 ppm, то шлёт предупреждение в Телеграм, а если превышает 1500, то ругается голосом. Также ругается, если обнаруживается газ.\n\nВ планах много чего ещё, но я особо не тороплюсь :)\n\n>Взять те же доплеровские датчики HB100, которых я прикупил 20 штук\n\nНу, это оверкил :) Я редко беру больше 1-2 штук сразу :) А для наличия присутствия человека брал PIR'ы.\n\n>Или вот думал закупаться ESP8266, а потом узнал про ESP32\n\nЯ пока почти всё делаю на ESP8266. Часто даже в виде ESP-01. Под ESP32 пока не было задач. Из исключений пока только Arduino Nano, подключённый к Orange Pi и снимающий показания нескольких аналоговых датчиков и Arduino Mega, управляющий светодиодной матрицей. Хотя зоопарк микропроцессоров собран разнообразный, от ATtiny85 до STM32."
		},
		{
			"post_id": 9,
			"title": "Китайский радиоуправляемый Lego-танк",
			"date_published": 1512301788.243,
			"body": "Думаю, про Lego — тоже сюда :)\n\nЗаказал на НГ сыну радиоуправляемый китайский «лего-совместимый» (Lego Technic) танк. Но подарок обломался, дочка нашла пакет с посылкой и немедленно принялась собирать (за три часа справилась). По итогу первых испытаний:\n\n> **Руслан**:\n> Папа, а то это бехаха домой биби танк\n> _Перевод:_\n> папа, давай катать черепаху по дому на танке\n\nНа фото — попытка пристроить пистолет к ещё не достроенному танку.\n\n![20171202_160555-200k.jpg (1280x849)](data/img/post_9_20171202_160555-200k.jpg)\n\nНаконец у сына есть танк. А то он с ума сходит по танкам :)\n\nПод катом более подробный обзор и впечатления.\n\n* * *\n\nЛего всем хороши, кроме двух вещей:\n\n1.  Цена.\n\n2.  Принципиальное отсутствие военной техники :)\n\nТак что я стал присматриваться к китайским изделиям. Традиционно их ругают за низкое качество и пиратство. Да, действительно, львиная доля наборов является пиратскими копиями Lego. Но есть и совершенно оригинальные модели. Например, я брал одну из таких:\n\n![HTB1Y71SSXXXXXapXVXXq6xXFXXXo_1_.jpg (800x800)](data/img/post_9_HTB1Y71SSXXXXXapXVXXq6xXFXXXo_1_.jpg)\n\n[https://www.aliexpress.com/item/WAZ-8011-454pcs-Military-Remote-Control-RC-99-Capital-Tank-Building-Block-Brick-Toy/32822015407.html](https://www.aliexpress.com/item/WAZ-8011-454pcs-Military-Remote-Control-RC-99-Capital-Tank-Building-Block-Brick-Toy/32822015407.html)\n\nКачество деталей, конечно, ниже, чем у оригиналов. Но вполне сносное. Детали держатся хорошо. Тем более, это Lego Technic, соединения которых конструктивно намного надёжнее, чем у оригинальных «кубиков» — для мелких детей особенно актуально. Обычный Лего разламывается на запчасти моментально, даже не нарочно. А тут, у меня есть самолёт из набора [42002](https://shop.lego.com/en-US/Hovercraft-42002), ему года три-четыре уже, сперва Тася мучила, потом Руслан, никто не чинил, а у него частично хвост отвалился и мотор разобрался. В целом конструкция форму сохраняет :) Детали потерялись многие, но я тупо заказал недавно китайскую копию за 500 рублей, придёт — дополню, а остаток пойдёт на детали для самостоятельного творчества :)\n\nЗато цена таких наборов, порой, в 2-3 раза дешевле оригиналов (правда, не в случае итак недорогих наборов, там выигрыш может быть всего раза в полтора — это может уже не компенсировать потерю качества). Вот сколько стоит в России у Лего аналог (танков у них нет) набора из 454 деталей с моторами и настоящим радиоуправлением? Близкий аналог, хотя попроще (370 деталей) — [вездеход 42065](https://shop.lego.com/en-DE/RC-Tracked-Racer-42065). Он стоит в России 5-7 тыс рублей. А наш танк — 2000 руб :)\n\nХотя у китайца, с другой стороны, есть минус. Родного аккумулятора на 300мАч при 7.2В хватает едва на десяток минут катания, а родная зарядка от USB заряжает его не целиком :D Пока, как временную меру, поставил снаружи 2x18650, их ему раз в 10 дольше должно хватить, а потом поставлю внутрь 2x7.2В аккумулятора в формате «Кроны» — будут 600мАч (или даже больше, у меня какие-то старые совсем, наверняка сейчас есть и больше по ёмкости) в том же формфакторе.\n\nСловом, продолжу понемногу изучать этот рынок :D\n\nКросспостинг/компиляция из:\n\n- http://www.balancer.ru/g/p5668013\n- http://www.balancer.ru/g/p5668093"
		},
		{
			"post_id": 8,
			"title": "Борьба с бутлупами и зависами NodeMCU",
			"date_published": 1511877918.509,
			"body": "Для защиты от бутлупов и зависов сразу после старта системы (а то не один раз из-за этого приходилось NodeMCU перепрошивать) я одно время использовал паузу в 5 секунд в init.lua перед стартом остального кода. Этого времени хватает, чтобы, если возникли проблемы, успеть грохнуть init.lua через терминал.\n\nСейчас сделал лучше. Система теперь после старта считывает файлик, инкрементирует число в нём и записывает. Если результат становится более трёх — вываливаемся, ничего не делая. Иначе ставим таймер, по которому через несколько секунд файл удаляем, а систему тем временем грузим дальше.\n\nПолучается, что при обычной загрузке задержки нет вообще, а для аварийного сброса нужно нажать трижды reset за короткий период времени.\n\nНиже — код:\n\n---\n\n```lua\nlocal count = 0\n\nlocal pin = 4 -- D1-mini LED\ngpio.mode(pin, gpio.OUTPUT)\ngpio.write(pin, gpio.LOW)\n\nif file.open(\"fail-counter.txt\") then\n\tcount = tonumber(file.read())\n     if count == nil then\n          count = 0\n     end\n\tfile.close()\nend\n\nif count >= 2 then\n\tprint(\"Emergency stop\")\n\tfile.remove(\"fail-counter.txt\")\n\treturn\nend\n\nprint(\"Fail proof check: \", count)\n\nfile.remove(\"fail-counter.txt\")\nfile.open(\"fail-counter.txt\",\"w+\")\nfile.writeline(count+1)\nfile.close();\n\nif not tmr.create():alarm(3000, tmr.ALARM_SINGLE, function()\n\t\tfile.remove(\"fail-counter.txt\")\n\t\tprint(\"Fail proof check passed\")\n\tend)\nthen\n\tprint(\"Can't start timer\")\n     return\nend\n\ngpio.write(pin, gpio.HIGH)\ndofile('main.lua')\n```\n\n- Если всё нормально, то ```init.lua``` грузит ```main.lua```, в котором уже и хранится основной инициализирующий код.\n- Если трижды быстро (в течении трёх секунд после запуска) нажать reset, то ничего не делаем. Кстати, надо доделать, поставить опционально загрузку ```ide.lua``` и тогда можно будет контроллер и к компу не цеплять — трижды reset и грузится удалённый редактор.\n- Важно не нажимать очень-очень быстро, а то дело даже не дойдёт до чтения кода. Скрипт на время готовность нажатия reset зажигает светодиод. Период нажатия — от ~0.5 до 3 секунд после старта."
		},
		{
			"post_id": 7,
			"title": "RGB LED matrix 64x32",
			"date_published": 1508869065.412,
			"body": "Всё руки не доходят сделать RGB LED матрицу управляемую целиком по воздуху, но хоть временно повесил мелкую полезную функцию :)\n\n![](data:,)![IMG_20171024_205906-200.jpg (0x0)](data/img/post_7_IMG_20171024_205906-200.jpg)\n\nВывод инфо сейчас через последовательный порт. Бегло с STM32 так ничего и не сделал, закапываться не стал, сделал простенький шилд к Arduino MEGA."
		},
		{
			"post_id": 5,
			"title": "STM32F103C8T6",
			"date_published": 1495275387.552,
			"body": "Чтобы управлять [RGB LED-матрицей](http://www.balancer.ru/g/p4993117) решил задействовать год назад заброшенный STM32\\. А то у Arduino (кроме MEGA, но это оверкил) не хватает памяти, а у ESP8266 — ног (нужно 13 пинов для управления).\n\n![78d1f591fd6dc721.jpg (0x0)](data/img/post_5_78d1f591fd6dc721.jpg)\n\n* * *\n\nСперва никак не мог воспроизвести прошивку Blink из Arduino IDE. Но повезло. В старой тестовой прошивке стояло `Serial.println(\"Hello World\");`. Посмотрел монитор порта — пусто. Оказалось, на той схеме, что смотрел, перепутаны RX и TX :) Поменял — заработало.\n\nНу и на будущее себе пометка, а то вдруг тоже забуду. При работе с Arduino IDE нужно:\n\n1.  Перевести BOOT0 в «1» (это я выше писал)\n2.  Нажать RESET.\n\nПлата переходит в режим ожидания прошивки. После прошивки перезапустится и стартует автоматом. Если джампер BOOT0 в «0» не переставить, то после ресета снова ждёт прошивку. Соответственно, каждый раз перед аплоадом скетча нужно жать RESET.\n\nНу и настройки Arduino IDE для STM32F103C8T6\n\n![19-4993293-2017-05-19-21-00-50.png (0x0)](data/img/post_5_19-4993293-2017-05-19-21-00-50.png)\n\nНаучился через Arduino (ЯП/IDE) управлять портами не через `digitalWrite`, а через регистры. То, что надо для управления панелью (вместо регистра PORTB Arduino).\n\nПримерно так:\n\n```cpp\nvoid setup() {\n  // Пока не знаю, как настроить вывод нативно, через GPIOA->regs->CRL не вышло.\n  // GPIOA->regs->CRL = (GPIOA->regs->CRL & 0x33333333) ; //set PA0-PA7 output — не работает\n  // Поэтому — через Arduino API\n  pinMode(PA0, OUTPUT);\n  pinMode(PA1, OUTPUT);\n  pinMode(PA2, OUTPUT);\n}\n\nvoid loop() {\n  // Вешаем для теста RGB-светодиод каналами на PA0/PA1/PA2\n  // Инкрементим регистр состояний —\n  // младшие биты по очереди перебирают все комбинации\n  // Светодиод меняет цвета каждую секунду\n  GPIOA->regs->ODR++;\n  delay(1000);\n}\n```\n\nПодробнее по нативному программированию пинов:\n\n*   [GPIO registers and port manipulation](http://www.stm32duino.com/viewtopic.php?t=1220)\n*   [API - STM32duino wiki](http://wiki.stm32duino.com/index.php?title=API#Pin_Modes)\n\nПотом прошил, наконец, USB-загрузчик. И теперь моя STM32 шьётся по USB, USB-Serial можно убрать в коробочку :) Рецепт есть тут:\n\n*   [Дешевая STM32 плата + Arduino IDE](https://geektimes.ru/post/277928/)"
		},
		{
			"post_id": 4,
			"title": "Потребление памяти в 32 бит ARM Ubuntu",
			"date_published": 1492704461.048,
			"body": "Сравните эти показания с x86_64 :)\n\n[![2017-04-20_19-07-13.png](data/img/post_4_2017-04-20_19-07-13.png)](data/img/post_4_2017-04-20_19-07-13.png)\n\nЭто крутится [http://neron.home.balancer.ru/](http://neron.home.balancer.ru/)\n\n```bash\nbalancer@neron:/$ cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.2 LTS\"\n```"
		},
		{
			"post_id": 3,
			"title": "Вспомнилось...",
			"date_published": 1490555725.597,
			"body": "_«У нас было 2 мешка травы, 75 таблеток мескалина...» _\n\nПомню, у меня был один транс на 6В 2А. Нужно было сделать для Радио 86РК б/п с 5В 2А и по мелочи +12В и -5В :) Ни о каких импульсинках тогда я и не слышал. И, таки, сделал :D Прямо с обмотки КРЕН5А на +5В. С удвоением на кондесаторах — на +12В. С них же гальванической развязкой конденсаторами ещё и на -5В. Работало, блин! Позже как-то в студенческие годы пытался повторить — конденсаторы взорвались нафиг! Хотя запас был большой. Больше не повторял, потому что появились доступные импульсные БП :)"
		},
		{
			"post_id": 2,
			"title": "Имитатор огня из светодиодной ленты...",
			"date_published": 1487443775.814,
			"body": "... точнее, электронная его часть. Дочкин класс в школе готовил выступление «Берегите лес». И там был эдакий стенд, на котором изображены разные стадии загрязнений леса — от чистой природы до лесного пожара. Было задумано сделать пожар с электронной подсветкой. Я сразу решил, что делать надо на светодиодной ленте [WS2812B](http://forums.balancer.ru/tech/forum/2016/02/t92411--svetodiodnye-lenty-ws2811-i-drugie.html).\n\n![20170128_213413.jpg (506x900)](data/img/post_2_20170128_213413.jpg)\n\n---\n\nТребовалось много экспериментировать с параметрами мерцания, поэтому я решил ставить не Arduino/ATTiny, а [ESP8266 с NodeMCU](http://forums.balancer.ru/tech/forum/2016/06/t92427--esp8266-nodemcu-ili-lua-na-bortu-narodnogo-wi-fi-arduino.7433.html). Там цикл отладки получается много короче.\n\nТакже решил делать не на привычной уже макетке без пайки, а на макетке, но уже с пайкой :) Питание для универсальности организовал от USB, преобразователь 5В → 3.3В, ленту подключал без преобразования уровней, ей 3.3В хватает для сигналов (питалась, понятно, от 5В). Получилось примерно так:\n\nМного экспериментировал с разными алгоритмами, чего хотелось — так и не достиг. Но результат был вполне сносный.\n\n<iframe width=\"640\" height=\"360\" src=\"https://www.youtube.com/embed/0QsdYGd15xc\" frameborder=\"0\" allowfullscreen=\"\"></iframe>\n\nО том, как это выглядело в готовом изделии — чуть позже :)"
		},
		{
			"post_id": 1,
			"title": "Очередной блог",
			"date_published": 1487218320,
			"body": "Ввиду лёгкости клонирования блогов в ZeroNet и дабы не загормождать дисковое пространство тех, кому не интересно, буду дробить свои блоги по узким темам. Это блог будет посвящён всякому моему дилетантскому опыту с современными попсовыми микроконтроллерами и экспериментам с «умным домом».\n\nВ «Большом Интернете» это материалы, в основном дублирующиеся на [Радиоэлектронном форуме](http://www.balancer.ru/tech/forum/viewforum.php?id=55) на balancer.ru"
		}
	]
}