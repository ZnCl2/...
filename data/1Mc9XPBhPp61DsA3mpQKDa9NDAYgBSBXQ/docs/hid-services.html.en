<!DOCTYPE html>
 <html>
 <head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width="device-width," initial-scale=1">
   <meta name="author" content="The Tor Project, Inc.">
   <meta name="description" content="The Tor Project's free software protects your privacy online. Site blocked? Email [mailto:gettor@torproject.org] for help downloading Tor Browser.">
   <meta name="keywords" content="tor, tor project, tor browser, avoid censorship, traffic analysis, anonymous communications, privacy, avoid surveillance, online security, anonymous online, private browsing, anonymity online, online privacy, protect privacy, private mac browser, private windows browser, private android browser, linux browser, anonymity network, tor network, onion router, onion browser">
   <meta property="og:image" content="https://www.torproject.org/images/tor-logo.jpg">
   <title>Tor: Hidden Service Protocol</title>
   <link rel="icon" href="../images/favicon.ico">
   <link href="../css/master.min.css" rel="stylesheet">
   <!--[if lte IE 8]>
   <link href="../css/ie8-and-down.min.css" rel="stylesheet">
   <![endif]-->
   <!--[if lte IE 7]>
   <link href="../css/ie7-and-down.min.css" rel="stylesheet">
   <![endif]-->
   <!--[if IE 6]>
   <link href="../css/ie6.min.css" rel="stylesheet">
   <![endif]-->
</head>
<body>
<div id="wrap">
  <div id="header">
    <h1 id="logo"><a href="../index.html">Tor</a></h1>
      <div id="nav">
        <ul>
        <li><a href="../index.html">Home</a></li>
<li><a href="../about/overview.html">About Tor</a></li>
<li><a class="active documentation hidden-services" href="documentation.html">Documentation</a></li>
<li><a href="../press/press.html">Press</a></li>
<li><a href="https://blog.torproject.org/blog/">Blog</a></li>
<li><a href="../about/contact.html">Contact</a></li>
        </ul>
      </div>
      <!-- END NAV -->
      <div id="calltoaction">
        <ul>
          <li class="donate"><a href="../download/download-easy.html">Download</a></li>
<li class="donate"><a href="../getinvolved/volunteer.html">Volunteer</a></li>
<li class="donate"><a href="../donate/donate-button.html">Donate</a></li>
        </ul>
      </div>
      <!-- END CALLTOACTION -->
  </div>
  <!-- END HEADER -->
<div id="content" class="clearfix">
  <div id="breadcrumbs">
    <a href="../index.html">Home &raquo; </a>
    <a href="documentation.html">Documentation &raquo; </a>
    <a href="hidden-services.html">Hidden Services</a>
  </div>
  <div id="maincol">
    <h2>Tor: Hidden Service Protocol</h2>
    <hr>
    <p>
    Tor makes it possible for users to hide their locations while offering
    various kinds of services, such as web publishing or an instant
    messaging server. Using Tor "rendezvous points," other Tor users can
    connect to these hidden services, each without knowing the other's
    network identity. This page describes the technical details of how
    this rendezvous protocol works. For a more direct how-to, see our <a
    href="tor-hidden-service.html">configuring hidden services</a>
    page.
    </p>
    <p>
    A hidden service needs to advertise its existence in the Tor network before
    clients will be able to contact it. Therefore, the service randomly picks
    some relays, builds circuits to them, and asks them to act as
    <em>introduction points</em> by telling them its public key. Note
    that in the following figures the green links are circuits rather
    than direct connections. By using a full Tor circuit, it's hard for
    anyone to associate an introduction point with the hidden server's IP
    address. While the introduction points and others are told the hidden
    service's identity (public key), we don't want them to learn about the
    hidden server's location (IP address).
    </p>
    <img alt="Tor hidden service step one" src="../images/THS-1.png" width="563" height="387">
    <p>
    Step two: the hidden service assembles a <em>hidden service
    descriptor</em>, containing its public key and a summary of each
    introduction point, and signs this descriptor with its private key.
    It uploads that descriptor to a distributed hash table. The descriptor will be
    found by clients requesting XYZ.onion where XYZ is a 16 character
    name derived from the service's public key. After
    this step, the hidden service is set up.
    </p>
    <p>
    Although it might seem impractical to use an automatically-generated
    service name, it serves an important goal: Everyone &ndash; including
    the introduction points, the distributed hash table directory, and of course the
    clients &ndash; can verify that they are talking to the right hidden
    service. See also <a href="https://en.wikipedia.org/wiki/Zooko%27s_triangle">Zooko's
    conjecture</a> that out of Decentralized, Secure, and Human-Meaningful,
    you can achieve at most two. Perhaps one day somebody will implement a <a
    href="http://www.skyhunter.com/marcs/petnames/IntroPetNames.html">Petname</a>
    design for hidden service names?
    </p>
    <img alt="Tor hidden service step two" src="../images/THS-2.png" width="563" height="387">
    <p>
    Step three: A client that wants to contact a hidden service needs
    to learn about its onion address first. After that, the client can
    initiate connection establishment by downloading the descriptor from
    the distributed hash table. If there is a descriptor for XYZ.onion
    (the hidden service could also be offline or have left long ago,
    or there could be a typo in the onion address), the client now
    knows the set of introduction points and the right public key to
    use. Around this time, the client also creates a circuit to another
    randomly picked relay and asks it to act as <em>rendezvous point</em>
    by telling it a one-time secret.
    </p>
    <img alt="Tor hidden service step three" src="../images/THS-3.png" width="563" height="387">
    <p>
    Step four: When the descriptor is present and the rendezvous
    point is ready, the client assembles an <em>introduce</em> message
    (encrypted to the hidden service's public key) including the address
    of the rendezvous point and the one-time secret. The client sends
    this message to one of the introduction points, requesting it be
    delivered to the hidden service. Again, communication takes place
    via a Tor circuit: nobody can relate sending the introduce message
    to the client's IP address, so the client remains anonymous.
    </p>
    <img alt="Tor hidden service step four" src="../images/THS-4.png" width="563" height="387">
    <p>
    Step five: The hidden service decrypts the client's introduce message
    and finds the address of the rendezvous point and the one-time secret
    in it. The service creates a circuit to the rendezvous point and
    sends the one-time secret to it in a rendezvous message.
    </p>
    <p>
    At this point it is of special importance that the hidden service sticks to
    the same set of <a
    href="https://trac.torproject.org/projects/tor/wiki/doc/TorFAQ#Whatsthisaboutentryguardformerlyknownashelpernodes">entry
    guards</a> when creating new circuits. Otherwise an attacker
    could run his own relay and force a hidden service to create an arbitrary
    number of circuits in the hope that the corrupt relay is picked as entry
    node and he learns the hidden server's IP address via timing analysis. This
    attack was described by &Oslash;verlier and Syverson in their paper titled
    <a href="http://freehaven.net/anonbib/#hs-attack06">Locating Hidden
    Servers</a>.
    </p>
    <img alt="Tor hidden service step five" src="../images/THS-5.png" width="563" height="387">
    <p>
    In the last step, the rendezvous point notifies the client about successful
    connection establishment. After that, both client and hidden service can
    use their circuits to the rendezvous point for communicating with each
    other. The rendezvous point simply relays (end-to-end encrypted) messages
    from client to service and vice versa.
    </p>
    <p>
    One of the reasons for not using the introduction circuit
    for actual communication is that no single relay should
    appear to be responsible for a given hidden service. This is why the
    rendezvous point never learns about the hidden service's identity.
    </p>
    <p>
    In general, the complete connection between client and hidden service
    consists of 6 relays: 3 of them were picked by the client with the third
    being the rendezvous point and the other 3 were picked by the hidden
    service.
    </p>
    <img alt="Tor hidden service step six" src="../images/THS-6.png" width="563" height="387">
    <p>
    There are more detailed descriptions about the hidden service protocol than
    this one. See the
    <a href="https://svn.torproject.org/svn/projects/design-paper/tor-design.pdf">Tor design paper</a>
    for an in-depth design description and the
    <a href="https://gitweb.torproject.org/torspec.git/tree/rend-spec.txt">rendezvous specification</a>
    for the message formats.
    </p>
  </div>
  <!-- END MAINCOL -->
  <div id="sidecol">
<div class="img-shadow">
  <div id="sidenav">
    <ul>
<li><a href="documentation.html">Documentation Overview</a></li>
<li><a href="../projects/torbrowser.html">Install Tor Browser</a></li>
<li><a href="https://guardianproject.info/apps/orbot/">Tor on Android</a></li>
<li><a href="../projects/projects.html">Other Tor software</a></li>
<li class="dropdown"><a href="installguide.html">Expert guides</a></li>
<li class="dropdown"><a href="manual.html">Manuals</a></li>
<li><a href="https://trac.torproject.org/projects/tor/wiki/">Tor Wiki</a></li>
<li><a href="faq.html">General FAQ</a></li>
<li><a href="faq-abuse.html">Abuse FAQ</a></li>
<li><a href="trademark-faq.html">Trademark FAQ</a></li>
<li><a href="../eff/tor-legal-faq.html">Tor Legal FAQ</a></li>
</ul>
  </div>
  <!-- END SIDENAV -->
</div>
<!-- END IMG-SHADOW -->
<div class="img-shadow">
  <div class="infoblock">
    <h2 class="bulb">Tor Tip</h2>
    <p>Tor is written for and supported by people like you. <a href="../donate/donate.html">Donate today</a>!</p>
  </div>
  <!-- END INFOBLOCK -->
</div>
<!-- END IMG-SHADOW -->
  </div>
  <!-- END SIDECOL -->
</div>
<!-- END CONTENT -->
    <div id="footer">
    	<div class="onion"><img src="../images/onion.jpg" alt="Tor" width="78" height="118"></div>
      <div class="about">
    <p>Trademark, copyright notices, and rules for use by third parties can be found
    <a href="trademark-faq.html">in our FAQ</a>.</p>
<!--
        Last modified: Fri Aug 11 11:19:58 2017 +0200
        Last compiled: Tue Aug 22 2017 15:17:18 +0000
-->
      </div>
      <!-- END ABOUT -->
      <div class="col first">
      	<h4>About Tor</h4>
        <ul>
          <li><a href="../about/overview.html">What Tor Does</a></li>
          <li><a href="../about/torusers.html">Users of Tor</a></li>
          <li><a href="../about/corepeople.html">Core Tor People</a></li>
          <li><a href="../about/sponsors.html">Sponsors</a></li>
          <li><a href="../about/contact.html">Contact Us</a></li>
        </ul>
      </div>
      <!-- END COL -->
      <div class="col">
      	<h4>Get Involved</h4>
        <ul>
          <li><a href="../donate/donate-foot.html">Donate</a></li>
          <li><a href="documentation.html#MailingLists">Mailing Lists</a></li>
          <li><a href="hidden-services.html">Hidden Services</a></li>
          <li><a href="../getinvolved/translation.html">Translations</a></li>
        </ul>
      </div>
      <!-- END COL -->
      <div class="col">
      	<h4>Documentation</h4>
        <ul>
          <li><a href="tor-manual.html">Manuals</a></li>
          <li><a href="documentation.html">Installation Guides</a></li>
          <li><a href="https://trac.torproject.org/projects/tor/wiki/">Tor Wiki</a></li>
          <li><a href="faq.html">General Tor FAQ</a></li>
        </ul>
      </div>
        <div class="col">
        <a href="https://internetdefenseleague.org/"><img src="../images/InternetDefenseLeague-footer-badge.png" alt="Internet Defense League" width="125" height="125"></a>
        </div>
      <!-- END COL -->
    </div>
    <!-- END FOOTER -->
  </div>
  <!-- END WRAP -->
</body>
</html>
