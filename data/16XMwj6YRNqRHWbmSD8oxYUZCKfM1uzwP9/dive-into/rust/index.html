<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dive into Rust mmap.page</title>
    <link rel="stylesheet" href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/assets/css/style.css">
    <link rel="alternate" type="application/rss+xml" href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/rss.xml">
    <link rel="alternate" type="application/git+http" href="https://github.com/weakish/weakish.github.com.git"/>
</head>
<body>
  <div class="container-lg px-3 my-5 markdown-body">

    <h1><a href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/">mmap.page</a></h1>
    <h1 id="dive-into-rust">
        
        
          Dive into Rust
        
        
      </h1>
    
      <h2 id="variable-shadowing">
        
        
          Variable Shadowing <a href="#variable-shadowing" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="k">mut</span> <span class="n">guess</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

<span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span>
    <span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read line"</span><span class="p">);</span>

<span class="k">let</span> <span class="n">guess</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="n">guess</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span>
    <span class="nf">.expect</span><span class="p">(</span><span class="s">"Please type a number!"</span><span class="p">);</span>

<span class="k">const</span> <span class="n">CONSTANT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"a constant expression, not the result of a function call computed at runtime"</span><span class="p">;</span>
<span class="k">let</span> <span class="n">immutable_variable</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"variables are immutable by default"</span><span class="p">;</span>
<span class="k">let</span> <span class="k">mut</span> <span class="n">mutable_variable</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">let</span> <span class="n">immutable_variable</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"shadowing the previous immutable_variable, which is bad"</span><span class="p">;</span>
<span class="k">let</span> <span class="n">immutable_variable</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>
    
      <h2 id="data-types">
        
        
          Data Types <a href="#data-types" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
    
      <h3 id="scalar-types">
        
        
          Scalar Types <a href="#scalar-types" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h3>
<ul>
<li>Integer: <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code>, <code>isize</code> and their unsigned counterpart <code>u8</code>, ..., <code>usize</code>. <code>isize</code> is <code>i32</code> on 32 bit systems and <code>i64</code> on 64 bit systems. Integer types default to <code>i32</code>. Compiling in debug mode will check for integer overflows. Relying on integer overflowâ€™s wrapping behavior is considered an error, use the <code>Wrapping</code> type instead.</li>
<li>Floats: <code>f32</code> and <code>f64</code>.</li>
<li>Boolean: <code>bool</code> (values: <code>true</code> and <code>false</code>).</li>
<li>Character: <code>char</code> (Unicode Scalar Value).</li>
</ul>
    
      <h3 id="compound-types">
        
        
          Compound Types <a href="#compound-types" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h3>
<ul>
<li>Tuple: tuple index must be written as a decimal literal, e.g. <code>(0, 1, 2).1</code>.</li>
<li>Array: can be considered as a tuple whose elements all have the same type. Index out of bounds is a <em>runtime</em> error though.</li>
</ul>
    
      <h2 id="control-flow">
        
        
          Control Flow <a href="#control-flow" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>Condition <em>must</em> be a <code>bool</code>.
Nice!</p>
    
      <h2 id="enum">
        
        
          Enum <a href="#enum" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>Rust's enum is actually a tagged union.</p>
    
      <h2 id="generics">
        
        
          Generics <a href="#generics" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>Rust monomorphizes code that is using generics at compile time.</p>
    
      <h2 id="traits">
        
        
          Traits <a href="#traits" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>Rust's traits is similar to interface in other languages.</p>
    
      <h2 id="memory-management">
        
        
          Memory Management <a href="#memory-management" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>Rust does not use GC or RC.
For values on the heap, it only allow one variable &quot;own&quot; a value at a time.
Assignment, passing a value to function and returning a value move the &quot;ownership&quot;.
Also, Rust allows multiple immutable pointers (<code>&amp;</code>) but only one mutable pointer (<code>&amp;mut</code>),
and restricts mixing immutable and mutable pointers to the same target.
The basic idea is to keep the number of reference to a value to one,
to make memory management easier for the compiler.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"A long long string"</span><span class="p">);</span>
<span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">+</span> <span class="s">"."</span><span class="p">;</span>
</code></pre></div></div>
<p>Conceptually s2 can be considered as a newly constructed immutable variable,
but since the ownership moves from s1 to s2, and s1 becomes invalid afterwards,
the compiler just need to appends <code>&quot;.&quot;</code> to the end of the value, which is efficient.</p>
<p>Smart pointers can be used for reference counting.
Smart pointers are structs satisfying <code>Deref</code> and <code>Drop</code> traits.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">List</span> <span class="p">{</span>
    <span class="nf">Cons</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nb">Nil</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>
<p>In the above example, <code>Box&lt;List&gt;</code> is a smart pointer.
We use <code>Box&lt;List&gt;</code> to store the <code>Box&lt;List&gt;</code> data on the heap,
otherwise <code>Cons(i32, List)</code> will result in infinite size on the stack,
which causes Rust failed to construct the <code>List</code> enum.</p>
<p>To allow <code>cons</code> more than one lists from a same base list:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">List</span> <span class="p">{</span>
    <span class="nf">Cons</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">Rc</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nb">Nil</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>
<p><code>Rc</code> is another smart pointer for reference counting.
It increases the reference counter on <code>RC::clone(&amp;l)</code>,
and reduce the reference counter automatically when the related variable goes out of scope.
When there are zero references, the value will be cleaned up.</p>
<p>Be aware that <code>Rc</code> only works in single-thread context.
In multiple-threads context, use <code>Arc</code> instead.</p>
<p>In Rust, functions and struts working with references need lifetime annotation.
However, Rust can infer function lifetime in simplest cases:</p>
<ul>
<li>If there is only one reference input parameter, then its lifetime will be the lifetime of output values.</li>
<li>If there are multiple reference input parameters, but one of them is <code>&amp;self</code> or <code>&amp;mut self</code>, then its lifetime will be the lifetime of output values.</li>
</ul>
<p>String literals have a <code>'static</code> lifetime, which lives for the entire duration of the program.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">b</span><span class="p">;</span>
<span class="p">{</span>
    <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"hi"</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
<span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c">// prints "hi"</span>
</code></pre></div></div>
<p>Lifetime annotation tells Rust compiler the lifetime of variables,
but it cannot alter the lifetime.</p>
    
      <h2 id="testing">
        
        
          Testing <a href="#testing" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>While Go use special function name <code>TestXxx</code>, Rust uses <code>#[test]</code> attribute annotation.</p>
<p>Unit tests are written in <code>mod tests</code>, and integration tests are put in the <code>test</code> directory.</p>
    
      <h2 id="documentation-comments">
        
        
          Documentation Comments <a href="#documentation-comments" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>Three leading slashes <code>///</code> with Markdown.</p>
<p>Similar to Python, Rust also supports doctest:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// # Example</span>
<span class="c">///</span>
<span class="c">/// ```</span>
<span class="c">/// let foo = "foo";</span>
<span class="c">/// assert_eq!(foo, "foo");</span>
<span class="c">/// ```</span>
</code></pre></div></div>
    
      <h2 id="unsafe">
        
        
          unsafe <a href="#unsafe" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p>In the unsafe block (<code>unsafe {}</code>), you can:</p>
<ul>
<li>
<p>Dereference a raw pointer which</p>
<ul>
<li>can have both immutable and mutable pointers or multiple mutable pointers to the same location;</li>
<li>is not guaranteed to point to valid memory;</li>
<li>can be null;</li>
<li>does not implement any automatic cleanup.</li>
</ul>
</li>
<li>
<p>Call an unsafe function or method (<code>unsafe fn dangerous() {}</code>, including foreign functions such as C functions).</p>
</li>
<li>
<p>Access or modify a mutable static variable (Rust call global variables as static variables).</p>
</li>
<li>
<p>Implement an unsafe trait.</p>
</li>
<li>
<p>Access fields of an union (the unsafe counterpart of Rust's <code>enum</code>, mainly used for FFI).</p>
</li>
</ul>
    <div class="footer border-top border-gray-light mt-5 pt-3 text-gray">
      <div style="display: flex; justify-content: space-between; align-items: flex-start">
        <form id="site-search" action="https://duckduckgo.com/html/" method="get">
          <input name="q" type="search" value="site:mmap.page " required pattern="site:mmap\.page\s.+">
          <input type="submit" value="&#x1F50D;" title="search through site content via DuckDuckGo">
        </form>
        <p>
          <a href="mailto:weakish@gmail.com" title="weakish@gmail.com"><img src="https://icongr.am/feather/mail.svg" alt="Feather Icon Mail"></a>
          <a href="https://savannah.nongnu.org/people/viewgpg.php?user_id=65699" title="2414 AEA0 EA48 5263 9697  F1BA 55F6 EEC2 EA3F 0A87"><img src="https://icongr.am/feather/key.svg" alt="Feather Icon Key"></a>
          <a href="https://github.com/weakish/" title="GitHub"><img src="https://icongr.am/feather/github.svg" alt="Feather Icon Github"></a>
          <a href="https://www.instagram.com/jakukyo/" title="Instagram"><img src="https://icongr.am/feather/instagram.svg" alt="Feather Icon Instagram"></a>
          <a href="https://twitter.com/weakish" title="Twitter"><img src="https://icongr.am/feather/twitter.svg" alt="Feather Icon Twitter"></a>
          <a href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/rss.xml" title="RSS 2.0 Feed"><img src="https://icongr.am/feather/rss.svg" alt="Feather Icon RSS"></a>
          <a href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/uses/" title="uses"><img src="https://icongr.am/feather/book-open.svg" alt="Feather Icon Book Open"></a>
          
          
          <a href="/Me.ZeroNetwork.bit/?Profile/12h51ug6CcntU2aiBjhP8Ns2e5VypbWWtv/1GnJD7CXskmG8GywMbTvbP12wneCFW9XzR/weakish@zeroid.bit" title="ZeroMe"><img src="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/assets/images/zeronet_logo.svg" alt="ZeroNet Logo" width="32" height="32"></a>
        </p>
      </div>
        <p>
        Permission to use, copy, modify, and/or distribute this site for any purpose with or without fee is hereby granted.
        This site is provided "as is" without express or implied warranty.
        </p>
        <p>
        This site does not use cookies or tracking codes.
        The hosting service provider (<a href="https://pages.github.com/">GitHub Pages</a>) probably collects server logs,
        but I do not have access to them.
        </p>
        <p>
        Site source is <a href="https://github.com/weakish/weakish.github.com/">available</a>
        and feedback is <a href="https://github.com/weakish/weakish.github.com/issues">welcome</a>.
        </p>
        <noscript>
        <p>
        This site does not use JavaScript.
        </p>
        </noscript>
    </div>
  </div>
</body>
</html>
