<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Exception and Union Type mmap.page</title>
    <link rel="stylesheet" href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/assets/css/style.css">
    <link rel="alternate" type="application/rss+xml" href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/rss.xml">
    <link rel="alternate" type="application/git+http" href="https://github.com/weakish/weakish.github.com.git"/>
</head>
<body>
  <div class="container-lg px-3 my-5 markdown-body">

    <h1><a href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/">mmap.page</a></h1>
    <h1 id="exception-and-union-type">
        
        
          Exception and Union Type
        
        
      </h1>
<p>Java has checked exception, which is essentially union type.</p>
<p>Kotlin dislikes Java's checked exception, and just removes it.</p>
<p>Ceylon also does not have checked exception, but it has union types.</p>
<p>Swift has something like semi-checked exception.
Unlike Java, a Swift function can only declare if it may throw an exception or not.
(Specifying <code>throws</code> in function signature.)
But it cannot specify types of exception.
Thus if the caller of the function tries to catch the exception,
it must have a default catch all clause in the end.
And since Swift only distinguish functions may throw and may not throw,
it is straightforward to map a function's throwability to optional type
(via <code>try?</code>).</p>
    
      <h2 id="optional-type-and-union-type">
        
        
          Optional Type and Union Type <a href="#optional-type-and-union-type" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<p><code>T?</code> can be considered as a union of <code>T|Null</code>.</p>
<p><code>(J|K) -&gt; T</code> can be expressed as overloads.</p>
    
      <h2 id="more-on-exception-and-union-type">
        
        
          More on Exception and Union Type <a href="#more-on-exception-and-union-type" class="anchor-hash" title="link to this heading">#</a>
        
        
      </h2>
<blockquote>
<p>Checked exception is an imperfect, ugly implementation of union type.</p>
</blockquote>
<p>-- <a href="http://www.yinwang.org/blog-cn/2017/05/23/kotlin">Yin Wang</a></p>
<p>For example, <code>String f() throws NotFound</code> can be considered as a function returning a union type of <code>String | NotFound</code>.</p>
<p>From the viewpoint of union type, <code>String | NotFound</code> and <code>NotFound | String</code> is equivalent.
Thus we can use exceptions as return value, and return value as exception in Java.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">DividedByZero</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">IntRet</span> <span class="kd">extends</span> <span class="nc">Exception</span>
<span class="o">{</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="n">value</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">IntRet</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span>
    <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CharRet</span> <span class="kd">extends</span> <span class="nc">Exception</span>
<span class="o">{</span>
	<span class="kd">public</span> <span class="kt">char</span> <span class="n">value</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">CharRet</span><span class="o">(</span><span class="kt">char</span> <span class="n">value</span><span class="o">)</span>
    <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span>
<span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">DividedByZero</span> <span class="nf">divide</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IntRet</span><span class="o">,</span> <span class="nc">CharRet</span>
	<span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nf">DividedByZero</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">CharRet</span><span class="o">(</span><span class="sc">'N'</span><span class="o">);</span>
        <span class="o">}</span>
		<span class="k">else</span>
		<span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IntRet</span><span class="o">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">try</span>
		<span class="o">{</span>
			<span class="nc">DividedByZero</span> <span class="n">err</span> <span class="o">=</span> <span class="n">divide</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">err</span><span class="o">);</span> <span class="c1">// handle error</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">IntRet</span> <span class="n">e</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">CharRet</span> <span class="n">e</span><span class="o">)</span>
        <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Divided by a negative number is not supported yet."</span><span class="o">);</span>
        <span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>This also applies Kotlin.
Using exceptions as return values can spare return value for exception.
The Kotlin compiler will warn us unused declared variable,
so this in effect mimics checked exception for a language without checked exception in an exotic and ugly way.</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">object</span> <span class="nc">DividedByZero</span> <span class="p">{}</span>

<span class="kd">class</span> <span class="nc">IntRet</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Throwable</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="p">{}</span>

<span class="k">fun</span> <span class="nf">divide</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">DividedByZero</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nc">DividedByZero</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IntRet</span><span class="p">(</span><span class="n">x</span> <span class="p">/</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kd">val</span> <span class="py">err</span> <span class="p">=</span> <span class="nf">divide</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="c1">// handle error</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IntRet</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
    <div class="footer border-top border-gray-light mt-5 pt-3 text-gray">
      <div style="display: flex; justify-content: space-between; align-items: flex-start">
        <form id="site-search" action="https://duckduckgo.com/html/" method="get">
          <input name="q" type="search" value="site:mmap.page " required pattern="site:mmap\.page\s.+">
          <input type="submit" value="&#x1F50D;" title="search through site content via DuckDuckGo">
        </form>
        <p>
          <a href="mailto:weakish@gmail.com" title="weakish@gmail.com"><img src="https://icongr.am/feather/mail.svg" alt="Feather Icon Mail"></a>
          <a href="https://savannah.nongnu.org/people/viewgpg.php?user_id=65699" title="2414 AEA0 EA48 5263 9697  F1BA 55F6 EEC2 EA3F 0A87"><img src="https://icongr.am/feather/key.svg" alt="Feather Icon Key"></a>
          <a href="https://github.com/weakish/" title="GitHub"><img src="https://icongr.am/feather/github.svg" alt="Feather Icon Github"></a>
          <a href="https://www.instagram.com/jakukyo/" title="Instagram"><img src="https://icongr.am/feather/instagram.svg" alt="Feather Icon Instagram"></a>
          <a href="https://twitter.com/weakish" title="Twitter"><img src="https://icongr.am/feather/twitter.svg" alt="Feather Icon Twitter"></a>
          <a href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/rss.xml" title="RSS 2.0 Feed"><img src="https://icongr.am/feather/rss.svg" alt="Feather Icon RSS"></a>
          <a href="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/uses/" title="uses"><img src="https://icongr.am/feather/book-open.svg" alt="Feather Icon Book Open"></a>
          
          
          <a href="/Me.ZeroNetwork.bit/?Profile/12h51ug6CcntU2aiBjhP8Ns2e5VypbWWtv/1GnJD7CXskmG8GywMbTvbP12wneCFW9XzR/weakish@zeroid.bit" title="ZeroMe"><img src="/16XMwj6YRNqRHWbmSD8oxYUZCKfM1uzwP9/assets/images/zeronet_logo.svg" alt="ZeroNet Logo" width="32" height="32"></a>
        </p>
      </div>
        <p>
        Permission to use, copy, modify, and/or distribute this site for any purpose with or without fee is hereby granted.
        This site is provided "as is" without express or implied warranty.
        </p>
        <p>
        This site does not use cookies or tracking codes.
        The hosting service provider (<a href="https://pages.github.com/">GitHub Pages</a>) probably collects server logs,
        but I do not have access to them.
        </p>
        <p>
        Site source is <a href="https://github.com/weakish/weakish.github.com/">available</a>
        and feedback is <a href="https://github.com/weakish/weakish.github.com/issues">welcome</a>.
        </p>
        <noscript>
        <p>
        This site does not use JavaScript.
        </p>
        </noscript>
    </div>
  </div>
</body>
</html>
