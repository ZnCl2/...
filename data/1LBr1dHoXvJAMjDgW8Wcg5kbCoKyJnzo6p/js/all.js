(function(){var Follow;var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Follow=
function(superClass){extend(Follow,superClass);function Follow(elem){this.elem=elem;this.handleMenuClick=bind(this.handleMenuClick,this);this.init=bind(this.init,this);this.menu=new Menu(this.elem);this.feeds={};this.follows={};this.elem.on("click",function(_this){return function(){if(Page.server_info.rev>850)if(_this.elem.hasClass("following"))_this.showFeeds();else _this.followDefaultFeeds();else Page.cmd("wrapperNotification",["info","Please update your ZeroNet client to use this feature"]);return false}}(this))}
Follow.prototype.init=function(){if(!this.feeds)return;return Page.cmd("feedListFollow",[],function(_this){return function(follows1){var isDefaultFeed,menuItem,param,query,ref,ref1,title;_this.follows=follows1;ref=_this.feeds;for(title in ref){ref1=ref[title];query=ref1[0];menuItem=ref1[1];isDefaultFeed=ref1[2];param=ref1[3];if(_this.follows[title]&&indexOf.call(_this.follows[title][1],param)>=0)menuItem.addClass("selected");else menuItem.removeClass("selected")}_this.updateListitems();return _this.elem.css("display",
"inline-block")}}(this))};Follow.prototype.addFeed=function(title,query,isDefaultFeed,param){var menuItem;if(isDefaultFeed==null)isDefaultFeed=false;if(param==null)param="";menuItem=this.menu.addItem(title,this.handleMenuClick);this.feeds[title]=[query,menuItem,isDefaultFeed,param];return this.feeds[title]};Follow.prototype.handleMenuClick=function(item){item.toggleClass("selected");this.updateListitems();this.saveFeeds();return true};Follow.prototype.showFeeds=function(){return this.menu.show()};
Follow.prototype.followDefaultFeeds=function(){var isDefaultFeed,menuItem,param,query,ref,ref1,title;ref=this.feeds;for(title in ref){ref1=ref[title];query=ref1[0];menuItem=ref1[1];isDefaultFeed=ref1[2];param=ref1[3];if(isDefaultFeed){menuItem.addClass("selected");this.log("Following",title)}}this.updateListitems();return this.saveFeeds()};Follow.prototype.updateListitems=function(){if(this.menu.elem.find(".selected").length>0)return this.elem.addClass("following");else return this.elem.removeClass("following")};
Follow.prototype.saveFeeds=function(){return Page.cmd("feedListFollow",[],function(_this){return function(follows){var isDefaultFeed,item,menuItem,param,params,query,ref,ref1,title;_this.follows=follows;ref=_this.feeds;for(title in ref){ref1=ref[title];query=ref1[0];menuItem=ref1[1];isDefaultFeed=ref1[2];param=ref1[3];if(follows[title])params=function(){var i,len,ref2,results;ref2=follows[title][1];results=[];for(i=0,len=ref2.length;i<len;i++){item=ref2[i];if(item!==param)results.push(item)}return results}();
else params=[];if(menuItem.hasClass("selected"))params.push(param);if(params.length===0)delete follows[title];else follows[title]=[query,params]}return Page.cmd("feedFollow",[follows])}}(this))};return Follow}(Class);window.Follow=Follow}).call(this);(function(){var InlineEditor;var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};InlineEditor=function(){function InlineEditor(elem1,getContent,saveContent,getObject){this.elem=elem1;this.getContent=getContent;this.saveContent=saveContent;this.getObject=getObject;this.cancelEdit=bind(this.cancelEdit,this);this.deleteObject=bind(this.deleteObject,this);this.saveEdit=bind(this.saveEdit,this);this.stopEdit=bind(this.stopEdit,this);this.startEdit=bind(this.startEdit,this);this.edit_button=
$("<a href='#Edit' class='editable-edit icon-edit'></a>");this.edit_button.on("click",this.startEdit);this.elem.addClass("editable").before(this.edit_button);this.editor=null;this.elem.on("mouseenter",function(_this){return function(e){var scrolltop,top;_this.edit_button.css("opacity","0.4");scrolltop=$(window).scrollTop();top=_this.edit_button.offset().top-parseInt(_this.edit_button.css("margin-top"));if(scrolltop>top)return _this.edit_button.css("margin-top",scrolltop-top+e.clientY-20);else return _this.edit_button.css("margin-top",
"")}}(this));this.elem.on("mouseleave",function(_this){return function(){return _this.edit_button.css("opacity","")}}(this));if(this.elem.is(":hover"))this.elem.trigger("mouseenter")}InlineEditor.prototype.startEdit=function(){var j,results;this.content_before=this.elem.html();this.editor=$("<textarea class='editor'></textarea>");this.editor.val(this.getContent(this.elem,"raw"));this.elem.after(this.editor);$(".editbg").css("display","block").cssLater("opacity",.9,10);this.elem.html(function(){results=
[];for(j=1;j<=50;j++)results.push(j);return results}.apply(this).join("fill the width"));this.copyStyle(this.elem,this.editor);this.elem.html(this.content_before);this.autoExpand(this.editor);this.elem.css("display","none");if($(window).scrollTop()===0){this.editor[0].selectionEnd=0;this.editor.focus()}$(".editable-edit").css("display","none");$(".editbar").css("display","inline-block").addClassLater("visible",10);$(".publishbar").css("opacity",0);$(".editbar .object").text(this.getObject(this.elem).data("object")+
"."+this.elem.data("editable"));$(".editbar .button").removeClass("loading");$(".editbar .save").off("click").on("click",this.saveEdit);$(".editbar .delete").off("click").on("click",this.deleteObject);$(".editbar .cancel").off("click").on("click",this.cancelEdit);if(this.getObject(this.elem).data("deletable"))$(".editbar .delete").css("display","").html("Delete "+this.getObject(this.elem).data("object").split(":")[0]);else $(".editbar .delete").css("display","none");window.onbeforeunload=function(){return"Your unsaved blog changes will be lost!"};
return false};InlineEditor.prototype.stopEdit=function(){if(this.editor)this.editor.remove();this.editor=null;this.elem.css("display","");$(".editbg").css("opacity",0).cssLater("display","none",300);$(".editable-edit").css("display","");$(".editbar").cssLater("display","none",1E3).removeClass("visible");$(".publishbar").css("opacity",1);window.onbeforeunload=null;return window.onbeforeunload};InlineEditor.prototype.saveEdit=function(){var content;content=this.editor.val();$(".editbar .save").addClass("loading");
this.saveContent(this.elem,content,function(_this){return function(contentHtml){if(contentHtml){$(".editbar .save").removeClass("loading");_this.stopEdit();if(typeof contentHtml==="string")_this.elem.html(contentHtml);return $("pre code").each(function(i,block){return hljs.highlightBlock(block)})}else return $(".editbar .save").removeClass("loading")}}(this));return false};InlineEditor.prototype.deleteObject=function(){var objectType;objectType=this.getObject(this.elem).data("object").split(":")[0];
Page.cmd("wrapperConfirm",["Are you sure you sure to delete this "+objectType+"?","Delete"],function(_this){return function(confirmed){$(".editbar .delete").addClass("loading");return Page.saveContent(_this.getObject(_this.elem),null,function(){return _this.stopEdit()})}}(this));return false};InlineEditor.prototype.cancelEdit=function(){this.stopEdit();this.elem.html(this.content_before);$("pre code").each(function(i,block){return hljs.highlightBlock(block)});return false};InlineEditor.prototype.copyStyle=
function(elemFrom,elemTo){var fromStyle;elemTo.addClass(elemFrom[0].className);romStyle=getComputedStyle(elemFrom[0]);elemTo.css({fontFamily:fromStyle.fontFamily,fontSize:fromStyle.fontSize,fontWeight:fromStyle.fontWeight,marginTop:fromStyle.marginTop,marginRight:fromStyle.marginRight,marginBottom:fromStyle.marginBottom,marginLeft:fromStyle.marginLeft,paddingTop:fromStyle.paddingTop,paddingRight:fromStyle.paddingRight,paddingBottom:fromStyle.paddingBottom,paddingLeft:fromStyle.paddingLeft,lineHeight:fromStyle.lineHeight,
textAlign:fromStyle.textAlign,color:fromStyle.color,letterSpacing:fromStyle.letterSpacing});if(elemFrom.innerWidth()<1E3)return elemTo.css("minWidth",elemFrom.innerWidth())};InlineEditor.prototype.autoExpand=function(elem){var editor;editor=elem[0];elem.height(1);elem.on("input",function(){if(editor.scrollHeight>elem.height())return elem.height(1).height(editor.scrollHeight+parseFloat(elem.css("borderTopWidth"))+parseFloat(elem.css("borderBottomWidth")))});elem.trigger("input");return elem.on("keydown",
function(e){var s,val;if(e.which===9){e.preventDefault();s=this.selectionStart;val=elem.val();elem.val(val.substring(0,this.selectionStart)+"\t"+val.substring(this.selectionEnd));this.selectionEnd=s+1;return this.selectionEnd}})};return InlineEditor}();window.InlineEditor=InlineEditor}).call(this);(function(){var Menu;var slice=[].slice;Menu=function(){function Menu(button){this.button=button;this.elem=$(".menu.template").clone().removeClass("template");var _this=this;_this.elem[0].style.position="relative";_this.elem[0].style.top="-2.5em";_this.elem[0].style.left=null;_this.elem[0].style.right=0;$(".feed-follow-list").get(0).appendChild(_this.elem[0]);this.items=[]}Menu.prototype.show=function(){var buttonPos;if(window.visible_menu&&window.visible_menu.button[0]===this.button[0]){window.visible_menu.hide();
return this.hide()}else{buttonPos=this.button.offset();this.elem.css({"top":"-2.5em","right":"0"});this.button.addClass("menu-active");this.elem.addClass("visible");if(window.visible_menu)window.visible_menu.hide();window.visible_menu=this;return window.visible_menu}};Menu.prototype.hide=function(){this.elem.removeClass("visible");this.button.removeClass("menu-active");window.visible_menu=null;return window.visible_menu};Menu.prototype.addItem=function(title,cb){var item;item=$(".menu-item.template",
this.elem).clone().removeClass("template");item.html(title);item.on("click",function(_this){return function(){if(!cb(item))_this.hide();return false}}(this));item.appendTo(this.elem);this.items.push(item);return item};Menu.prototype.log=function(){var args;args=1<=arguments.length?slice.call(arguments,0):[];return console.log.apply(console,["[Menu]"].concat(slice.call(args)))};return Menu}();window.Menu=Menu;$("body").on("click",function(e){if(window.visible_menu&&e.target!==window.visible_menu.button[0]&&
$(e.target).parent()[0]!==window.visible_menu.elem[0])return window.visible_menu.hide()})}).call(this);(function(){var callAfterInterval,limits;limits={};callAfterInterval={};window.RateLimit=function(interval,fn){if(!limits[fn]){callAfterInterval[fn]=false;fn();return limits[fn]=setTimeout(function(){if(callAfterInterval[fn])fn();delete limits[fn];return delete callAfterInterval[fn]},interval)}else{callAfterInterval[fn]=true;return callAfterInterval[fn]}}}).call(this);(function(){var Renderer,Text;var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;Renderer=function(superClass){extend(Renderer,superClass);function Renderer(){return Renderer.__super__.constructor.apply(this,arguments)}Renderer.prototype.image=function(href,title,text){return"<code>!["+
text+"]("+href+")</code>"};return Renderer}(marked.Renderer);Text=function(){function Text(){}Text.prototype.toColor=function(text){var hash,i,j,ref;hash=0;for(i=j=0,ref=text.length-1;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j)hash+=text.charCodeAt(i)*i;return"hsl("+hash%360+",30%,50%)"};Text.prototype.toMarked=function(text,options){if(options==null)options={};options["gfm"]=true;options["breaks"]=true;options["renderer"]=renderer;text=this.fixReply(text);text=marked(text,options);return this.fixHtmlLinks(text)};
Text.prototype.fixHtmlLinks=function(text){if(window.is_proxy)return text.replace(/href="http:\/\/(127.0.0.1|localhost):43110/g,'href="http://zero');else return text.replace(/href="http:\/\/(127.0.0.1|localhost):43110/g,'href="')};Text.prototype.fixLink=function(link){var back;if(window.is_proxy){back=link.replace(/http:\/\/(127.0.0.1|localhost):43110/,"http://zero");return back.replace(/http:\/\/zero\/([^\/]+\.bit)/,"http://$1")}else return link.replace(/http:\/\/(127.0.0.1|localhost):43110/,"")};
Text.prototype.toUrl=function(text){return text.replace(/[^A-Za-z0-9]/g,"+").replace(/[+]+/g,"+").replace(/[+]+$/,"")};Text.prototype.fixReply=function(text){return text.replace(/(>.*\n)([^\n>])/gm,"$1\n$2")};Text.prototype.toBitcoinAddress=function(text){return text.replace(/[^A-Za-z0-9]/g,"")};Text.prototype.jsonEncode=function(obj){return btoa(unescape(encodeURIComponent(JSON.stringify(obj,void 0,"\t"))))};return Text}();window.is_proxy=window.location.pathname==="/";window.renderer=new Renderer;
window.Text=new Text}).call(this);(function(){var Time;Time=function(){function Time(){}Time.prototype.since=function(time){var back,now,secs;now=+new Date/1E3;secs=now-time;if(secs<60)back="Just now";else if(secs<60*60)back=Math.round(secs/60)+" minutes ago";else if(secs<60*60*24)back=Math.round(secs/60/60)+" hours ago";else if(secs<60*60*24*3)back=Math.round(secs/60/60/24)+" days ago";else back="on "+this.date(time);back=back.replace(/1 ([a-z]+)s/,"1 $1");return back};Time.prototype.date=function(timestamp,format){var display,parts;
if(format==null)format="short";parts=(new Date(timestamp*1E3)).toString().split(" ");if(format==="short")display=parts.slice(1,4);else display=parts.slice(1,5);return display.join(" ").replace(/( [0-9]{4})/,",$1")};Time.prototype.timestamp=function(date){if(date==null)date="";if(date==="now"||date==="")return parseInt(+new Date/1E3);else return parseInt(Date.parse(date)/1E3)};return Time}();window.Time=new Time}).call(this);(function(){var APITopicList;var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;APITopicList=function(superClass){extend(APITopicList,superClass);function APITopicList(){this.submitTopicVote=bind(this.submitTopicVote,
this);this.thread_sorter=null;this.parent_topic_uri=void 0;this.topic_parent_uris={};this.topic_sticky_uris={}}APITopicList.prototype.actionList=function(parentTopicId,parentTopicUserAddress,category,search){if(category==null)category=false;if(search==null)search=false;$("body").empty;return this.loadTopics("noanim",false,search,category)};APITopicList.prototype.loadTopics=function(type,cb,search,category){var lastElem,query,where,whereb;if(type==null)type="list";if(cb==null)cb=false;if(search==null)search=
false;if(category==null)category=false;this.logStart("Load topics...");if(this.parent_topic_uri)where="WHERE parent_topic_uri = '"+this.parent_topic_uri+"' OR row_topic_uri = '"+this.parent_topic_uri+"'";else where="WHERE topic.type IS NULL AND topic.parent_topic_uri IS NULL ";if(category===false||category==="all");else{whereb=' AND topic.category LIKE "'+category+'"';if(where)where=where+' AND topic.category LIKE "'+category+'"';else where='WHERE topic.category LIKE "'+category+'"'}if(search!==false){whereb=
whereb+' AND topic.title LIKE "%'+search+'%"';if(where)where=where+' AND topic.title LIKE "%'+search+'%"';else where='WHERE topic.title LIKE "%'+search+'%"'}else whereb="";lastElem=$(".topics-list .topic.template");query="SELECT\n COUNT(comment_id) AS comments_num, MAX(comment.added) AS last_comment, topic.added as last_added,\n topic.*,\n topic_creator_user.value AS topic_creator_user_name,\n topic_creator_content.directory AS topic_creator_address,\n topic.topic_id || '_' || topic_creator_content.directory AS row_topic_uri,\n NULL AS row_topic_sub_uri,\n (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || '_' || topic_creator_content.directory)+1 AS votes\nFROM topic\nLEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id)\nLEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = 'content.json')\nLEFT JOIN keyvalue AS topic_creator_user ON (topic_creator_user.json_id = topic_creator_content.json_id AND topic_creator_user.key = 'cert_user_id')\nLEFT JOIN comment ON (comment.topic_uri = row_topic_uri)\n"+
where+"\nGROUP BY topic.topic_id, topic.json_id";console.log(query);if(!this.parent_topic_uri)query+="\nUNION ALL\n\nSELECT\n COUNT(comment_id) AS comments_num, MAX(comment.added) AS last_comment, MAX(topic_sub.added) AS last_added,\n topic.*,\n topic_creator_user.value AS topic_creator_user_name,\n topic_creator_content.directory AS topic_creator_address,\n topic.topic_id || '_' || topic_creator_content.directory AS row_topic_uri,\n topic_sub.topic_id || '_' || topic_sub_creator_content.directory AS row_topic_sub_uri,\n (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || '_' || topic_creator_content.directory)+1 AS votes\nFROM topic\nLEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id)\nLEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = 'content.json')\nLEFT JOIN keyvalue AS topic_creator_user ON (topic_creator_user.json_id = topic_creator_content.json_id AND topic_creator_user.key = 'cert_user_id')\nLEFT JOIN topic AS topic_sub ON (topic_sub.parent_topic_uri = topic.topic_id || '_' || topic_creator_content.directory)\nLEFT JOIN json AS topic_sub_creator_json ON (topic_sub_creator_json.json_id = topic_sub.json_id)\nLEFT JOIN json AS topic_sub_creator_content ON (topic_sub_creator_content.directory = topic_sub_creator_json.directory AND topic_sub_creator_content.file_name = 'content.json')\nLEFT JOIN comment ON (comment.topic_uri = row_topic_sub_uri)\nWHERE topic.type = \"group\" \nGROUP BY topic.topic_id";
return Page.cmd("dbQuery",[query],function(_this){return function(topics){topics.sort(function(a,b){var boosterA,boosterB;boosterA=boosterB=0;if(window.APITopicList.topic_sticky_uris[a.row_topic_uri])boosterA=window.APITopicList.topic_sticky_uris[a.row_topic_uri]*1E7;if(window.APITopicList.topic_sticky_uris[b.row_topic_uri])boosterB=window.APITopicList.topic_sticky_uris[b.row_topic_uri]*1E7;return Math.max(b.last_comment+boosterB,b.last_added+boosterB)-Math.max(a.last_comment+boosterA,a.last_added+
boosterA)});console.log("set body Text");$("body").html(JSON.stringify(topics));console.log(JSON.stringify(topics));_this.logEnd("Load topics...");if(parseInt($(".topics-loading").css("top"))>-30)$(".topics-loading").css("top","-30px");else $(".topics-loading").remove();if(_this.parent_topic_uri)$(".topics-title").html("<span class='parent-link'><a href='?Main'>Main</a> &rsaquo;</span> "+topic_parent.title);$(".topics").css("opacity",1);if(cb)return cb()}}(this))};APITopicList.prototype.applyTopicData=
function(elem,topic,type){var body,lastAction,magnet,titleHash,topicUri,torrent,torrentUrl,torrentCategory,torrentFile,torrentString,url,urlMatch,visited;if(type==null)type="list";titleHash=Text.toUrl(topic.title);topicUri=topic.row_topic_uri;$(".title .title-link",elem).text(topic.title);$(".title .title-link, a.image, .comment-num",elem).attr("href","?full&Topic:"+topicUri+"/"+titleHash);elem.data("topic_uri",topicUri);body=topic.body;urlMatch=body.match(/http[s]{0,1}:\/\/[^"', \r\n)$]+/);if(topic.type===
"group"){$(elem).addClass("topic-group");$(".image .icon",elem).removeClass("icon-topic-chat").addClass("icon-topic-group");$(".link",elem).css("display","none");$(".title .title-link, a.image, .comment-num",elem).attr("href","?Topics:"+topicUri+"/"+titleHash)}else if(urlMatch){url=urlMatch[0];if(type!=="show")body=body.replace(/http[s]{0,1}:\/\/[^"' \r\n)$]+$/g,"");$(".image .icon",elem).removeClass("icon-topic-chat").addClass("icon-topic-link");$(".link",elem).css("display","").attr("href",Text.fixLink(url));
$(".link .link-url",elem).text(url)}else{$(".image .icon",elem).removeClass("icon-topic-link").addClass("icon-topic-chat");$(".link",elem).css("display","none")}torrentCategory=topic.category;if(type==="show"){torrent=topic.torrent_file;torrentString=torrent.split(",")[1];torrentFile=new Blob([torrentString],{type:"application/x-bittorrent"});magnet=topic.magnet;torrentUrl=URL.createObjectURL(torrentFile);$(".body",elem).html(Text.toMarked(body,{"sanitize":true})+"<br />Category: "+torrentCategory+
"<br />Magnet: "+magnet+'<br /><a href="'+torrent+'" download>Download torrent</a>')}else $(".body",elem).text(body);if(window.APITopicList.topic_sticky_uris[topicUri])elem.addClass("topic-sticky");if(type!=="show"){lastAction=Math.max(topic.last_comment,topic.added);if(topic.type==="group"){$(".comment-num",elem).text("last activity");$(".added",elem).text(Time.since(lastAction))}else if(topic.comments_num>0){$(".comment-num",elem).text(topic.comments_num+" comment");$(".added",elem).text("last "+
Time.since(lastAction))}else{$(".comment-num",elem).text("0 comments");$(".added",elem).text(Time.since(lastAction))}}$(".user_name",elem).text(topic.topic_creator_user_name.replace(/@.*/,"")).attr("title",topic.topic_creator_user_name+": "+topic.topic_creator_address);if(User.my_topic_votes[topicUri]){$(".score-inactive .score-num",elem).text(topic.votes-1);$(".score-active .score-num",elem).text(topic.votes);$(".score",elem).addClass("active")}else{$(".score-inactive .score-num",elem).text(topic.votes);
$(".score-active .score-num",elem).text(topic.votes+1)}$(".score",elem).off("click").on("click",this.submitTopicVote);visited=Page.local_storage["topic."+topicUri+".visited"];if(!visited)elem.addClass("visit-none");else if(visited<lastAction)elem.addClass("visit-newcomment");if(type==="show")$(".added",elem).text(Time.since(topic.added));if(topic.topic_creator_address===Page.site_info.auth_address){$(elem).attr("data-object","Topic:"+topicUri).attr("data-deletable","yes");$(".title .title-link",elem).attr("data-editable",
"title").data("content",topic.title);return $(".body",elem).attr("data-editable","body").data("content",topic.body)}};APITopicList.prototype.submitCreateTopic=function(){var body,title,torrentCategory,torrentFile,torrentFilename,torrentMagnet;if(!Page.site_info.cert_user_id){Page.cmd("wrapperNotification",["info","Please, your choose account before creating a topic."]);return false}title=$(".topic-new #topic_title").val();body=$(".topic-new #topic_body").val();torrentMagnet=$(".topic-new #torrent_magnet").val();
torrentFile=$(".topic-new #filedata").val();torrentFilename=$(".topic-new #torrent_file").val().replace("C:\\fakepath\\","");torrentCategory=$(".topic-new #torrent_category").val();if(!title)return $(".topic-new #topic_title").focus();$(".topic-new .button-submit").addClass("loading");return User.getData(function(_this){return function(data){var innerPath,topic;innerPath="data/users/"+Page.site_info.auth_address+"/"+torrentFilename;topic={"topic_id":data.next_topic_id,"category":torrentCategory,"title":title,
"body":body,"magnet":torrentMagnet,"torrent_file":innerPath,"added":Time.timestamp()};console.log(innerPath);console.log(torrentFile.split(",")[1]);Page.writePublish(innerPath,torrentFile.split(",")[1],function(res){User.checkCert("updaterules");return Page.cmd("wrapperNotification",["info","File upload success"])});if(_this.parent_topic_uri)topic.parent_topic_uri=_this.parent_topic_uri;data.topic.push(topic);data.next_topic_id+=1;console.log("get this far");return User.publishData(data,function(res){$(".topic-new .button-submit").removeClass("loading");
$(".topic-new").slideUp();$(".topic-new-link").slideDown();setTimeout(function(){return _this.loadTopics()},600);$(".topic-new #topic_body").val("");$(".topic-new #topic_title").val("");return $(".topic-new #torrent_magnet").val("")})}}(this))};APITopicList.prototype.submitTopicVote=function(e){var elem,innerPath;if(!Page.site_info.cert_user_id){Page.cmd("wrapperNotification",["info","Please, your choose account before upvoting."]);return false}elem=$(e.currentTarget);elem.toggleClass("active").addClass("loading");
innerPath="data/users/"+User.my_address+"/data.json";User.getData(function(_this){return function(data){var topicUri;if(data.topic_vote==null)data.topic_vote={};topicUri=elem.parents(".topic").data("topic_uri");if(elem.hasClass("active"))data.topic_vote[topicUri]=1;else delete data.topic_vote[topicUri];return User.publishData(data,function(res){return elem.removeClass("loading")})}}(this));return false};return APITopicList}(Class);window.APITopicList=new APITopicList}).call(this);(function(){var TopicList;var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;TopicList=function(superClass){extend(TopicList,superClass);function TopicList(){this.submitTopicVote=bind(this.submitTopicVote,
this);this.thread_sorter=null;this.parent_topic_uri=void 0;this.list_all=false;this.topic_parent_uris={};this.topic_sticky_uris={}}TopicList.prototype.actionList=function(parentTopicId,parentTopicUserAddress,category){var i,len,ref,topicStickyUri;if(category==null)category=false;ref=Page.site_info.content.settings.topic_sticky_uris;for(i=0,len=ref.length;i<len;i++){topicStickyUri=ref[i];this.topic_sticky_uris[topicStickyUri]=1}$(".topics-loading").cssLater("top","0px",200);if(parentTopicId){$(".topics-title").html("&nbsp;");
this.parent_topic_uri=parentTopicId+"_"+parentTopicUserAddress;Page.local_storage["topic."+parentTopicId+"_"+parentTopicUserAddress+".visited"]=Time.timestamp();Page.cmd("wrapperSetLocalStorage",Page.local_storage);this.loadTopics("noanim")}else if(category!==false){$(".topics-title").html(category);this.loadTopics("noanim",false,false,category)}else{var search=window.location.href.match(/(\??|&?)q=(.*)/);if(search){search=decodeURIComponent(search.pop().replace(/&Category:(.*)/g,"").replace(/&wrapper_nonce=(.*)/g,
""));$(".topics-title").html(search);this.loadTopics("list",false,search,$("#torrent_search_category").val())}else{$(".topics-title").html("Newest torrents");this.loadTopics("noanim");[{category:"movies",div:"latestMovies",iconType:"filmType"},{category:"tv",div:"latestTv",iconType:"filmType"},{category:"music",div:"latestMusic",iconType:"musicType"},{category:"games",div:"latestGames",iconType:"exeType"},{category:"applications",div:"latestApplications",iconType:"zipType"},{category:"anime",div:"latestAnime",
iconType:"filmType"},{category:"books",div:"latestBooks",iconType:"pdfType"},{category:"music' AND title LIKE '%flac%' OR title LIKE '%aif%' OR title LIKE '%wav%",div:"latestLosslessMusic",iconType:"musicType"}].map(function(el){Page.cmd("dbQuery",["SELECT * FROM topic WHERE category LIKE '"+el.category+"' ORDER BY added DESC LIMIT 15"],function(res){var latestThing=res.map(function(res){return{title:res.title,comments:0,files:0,age:res.added,seeders:res.seeders||0,leechers:res.leechers||0,permalink:"?full&Topic:"+
res.topic_id+"_"+res.torrent_file.split("/")[2]}});var row=document.createElement("tr");for(var i=latestThing.length-1;i>-1;i--){row.className=!(i%2)?"odd":"even";row.innerHTML="<td>"+'<div class="iaconbox floatright">'+(latestThing[i].comments>0?'<a class="icommentjs kaButton smallButton rightButton" href="'+latestThing[i].permalink+'#comment">'+latestThing[i].comment+' <i class="ka ka-comment"></i>'+"</a>":"")+"</div>"+'<div class="markeredBlock torType '+el.iconType+'">'+'<a href="'+latestThing[i].permalink+
'" class="cellMainLink">'+latestThing[i].title+"</a>"+"</div>"+"</td>"+'<td class="nobr center">&nbsp;\x3c!-- FILE SIZE HERE --\x3e<span>\x3c!-- FILE SIZE UNIT HERE e.g GB --\x3e</span></td>'+'<td class="center">\x3c!-- NUMBER OF FILES GOES HERE --\x3e</td>'+'<td class="center"><span class="timeago">'+moment(latestThing[i].age*1E3).format("D MMM YYYY, hh:mm:ss")+"</span></td>"+'<td class="green center">'+latestThing[i].seeders+"</td>"+'<td class="red lasttd center">'+latestThing[i].leechers+"</td>";
document.getElementById(el.div).getElementsByClassName("firstr")[0].parentNode.insertBefore(row,document.getElementById(el.div).getElementsByClassName("firstr")[0].nextSibling);row=document.createElement("tr")}})})}}$(".topic-new-link").on("click",function(_this){return function(){$(".topic-new").fancySlideDown();$(".topic-new-link").slideUp();return false}}(this));$(".topic-new .button-submit").on("click",function(_this){return function(){_this.submitCreateTopic();return false}}(this));$("#contentSearch").on("keypress",
function(_this){return function(e){if(e.keyCode===13){_this.loadTopics("list",false,e.currentTarget.value,$("#torrent_search_category").val());$("#originalZeroTorrent").fadeIn();setTimeout(function(){$("html,body").animate({scrollTop:$(".topics-list").offset().top},"normal")},100);return false}}}(this));$("#tagcloud a").on("click",function(_this){return function(e){e.preventDefault();_this.loadTopics("list",false,e.currentTarget.textContent,$("#torrent_search_category").val());$("#originalZeroTorrent").fadeIn();
setTimeout(function(){$("html,body").animate({scrollTop:$(".topics-list").offset().top},"normal")},100);return false}}(this));$("#latestSearches a").on("click",function(_this){return function(e){e.preventDefault();_this.loadTopics("list",false,e.currentTarget.textContent,$("#torrent_search_category").val());$("#originalZeroTorrent").fadeIn();setTimeout(function(){$("html,body").animate({scrollTop:$(".topics-list").offset().top},"normal")},100);return false}}(this));$("#torrent_search_category").on("change",
function(_this){return function(e){$("#originalZeroTorrent").fadeIn();_this.loadTopics("list",false,$("#torrent_search").val(),e.currentTarget.value);return false}}(this));$(".topics-more").on("click",function(_this){return function(){_this.list_all=true;$(".topics-more").text("Loading...");_this.loadTopics("noanim");return false}}(this));if(window.location.href.match(/(\??|&)Category:/)){$("#originalZeroTorrent").fadeIn();setTimeout(function(){$("html,body").animate({scrollTop:$(".topics-list").offset().top},
"normal")},1E3)}return this.initFollowButton()};TopicList.prototype.initFollowButton=function(){var username;this.follow=new Follow($(".feed-follow-list"));if(this.parent_topic_uri)this.follow.addFeed("New topics in this group","SELECT title AS title, body, added AS date_added, 'topic' AS type, '?full&Topic:' || topic.topic_id || '_' || topic_creator_json.directory AS url, parent_topic_uri AS param FROM topic LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id) WHERE parent_topic_uri IN (:params)",
true,this.parent_topic_uri);else{this.follow.addFeed("New topics","SELECT title AS title, body, added AS date_added, 'topic' AS type, '?full&Topic:' || topic.topic_id || '_' || topic_creator_json.directory AS url FROM topic LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id) WHERE parent_topic_uri IS NULL",true);if(Page.site_info.cert_user_id){username=Page.site_info.cert_user_id.replace(/@.*/,"");this.follow.addFeed("Username mentions","SELECT 'mention' AS type, comment.added AS date_added, topic.title, commenter_user.value || ': ' || comment.body AS body, topic_creator_json.directory AS topic_creator_address, topic.topic_id || '_' || topic_creator_json.directory AS row_topic_uri, '?full&Topic:' || topic.topic_id || '_' || topic_creator_json.directory AS url FROM topic LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id) LEFT JOIN comment ON (comment.topic_uri = row_topic_uri) LEFT JOIN json AS commenter_json ON (commenter_json.json_id = comment.json_id) LEFT JOIN json AS commenter_content ON (commenter_content.directory = commenter_json.directory AND commenter_content.file_name = 'content.json') LEFT JOIN keyvalue AS commenter_user ON (commenter_user.json_id = commenter_content.json_id AND commenter_user.key = 'cert_user_id') WHERE comment.body LIKE '%["+
username+"%' OR comment.body LIKE '%@"+username+"%'",true)}this.follow.addFeed("All comments","SELECT 'comment' AS type, comment.added AS date_added, topic.title, commenter_user.value || ': ' || comment.body AS body, topic_creator_json.directory AS topic_creator_address, topic.topic_id || '_' || topic_creator_json.directory AS row_topic_uri, '?full&Topic:' || topic.topic_id || '_' || topic_creator_json.directory AS url FROM topic LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id) LEFT JOIN comment ON (comment.topic_uri = row_topic_uri) LEFT JOIN json AS commenter_json ON (commenter_json.json_id = comment.json_id) LEFT JOIN json AS commenter_content ON (commenter_content.directory = commenter_json.directory AND commenter_content.file_name = 'content.json') LEFT JOIN keyvalue AS commenter_user ON (commenter_user.json_id = commenter_content.json_id AND commenter_user.key = 'cert_user_id')")}return this.follow.init()};
TopicList.prototype.loadTopics=function(type,cb,search,category){var elem,elems,i,lastElem,len,query,where,whereb;if(type==null)type="list";if(cb==null)cb=false;if(search==null)search=false;if(category==null)category=false;this.logStart("Load topics...");if(this.parent_topic_uri)where="WHERE parent_topic_uri = '"+this.parent_topic_uri+"' OR row_topic_uri = '"+this.parent_topic_uri+"'";else where="WHERE topic.type IS NULL AND topic.parent_topic_uri IS NULL AND (comment.added < "+(Date.now()/1E3+120)+
" OR comment.added IS NULL)";if(category===false||category==="all")whereb="";else{whereb=' AND topic.category LIKE "'+category+'"';if(where)where=where+' AND topic.category LIKE "'+category+'"';else where='WHERE topic.category LIKE "'+category+'"'}if(search!==false){whereb=whereb+' AND topic.title LIKE "%'+search+'%"';if(where)where=where+' AND topic.title LIKE "%'+search+'%"';else where='WHERE topic.title LIKE "%'+search+'%"';elems=$(".topic[id^=topic]");for(i=0,len=elems.length;i<len;i++){elem=
elems[i];elem.parentNode.removeChild(elem)}}else whereb="";lastElem=$(".topics-list .topic.template");query="SELECT\n COUNT(comment_id) AS comments_num, MAX(comment.added) AS last_comment, topic.added as last_added, CASE WHEN MAX(comment.added) IS NULL THEN topic.added ELSE MAX(comment.added) END as last_action,\n topic.*,\n topic_creator_user.value AS topic_creator_user_name,\n topic_creator_content.directory AS topic_creator_address,\n topic.topic_id || '_' || topic_creator_content.directory AS row_topic_uri,\n NULL AS row_topic_sub_uri,\n (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || '_' || topic_creator_content.directory)+1 AS votes\nFROM topic\nLEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id)\nLEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = 'content.json')\nLEFT JOIN keyvalue AS topic_creator_user ON (topic_creator_user.json_id = topic_creator_content.json_id AND topic_creator_user.key = 'cert_user_id')\nLEFT JOIN comment ON (comment.topic_uri = row_topic_uri)\n"+
where+"\nGROUP BY topic.topic_id, topic.json_id";if(!this.parent_topic_uri)query+="\nUNION ALL\n\nSELECT\n COUNT(comment_id) AS comments_num, MAX(comment.added) AS last_comment, MAX(topic_sub.added) AS last_added, CASE WHEN MAX(topic_sub.added) > MAX(comment.added) THEN MAX(topic_sub.added) ELSE MAX(comment.added) END as last_action,\n topic.*,\n topic_creator_user.value AS topic_creator_user_name,\n topic_creator_content.directory AS topic_creator_address,\n topic.topic_id || '_' || topic_creator_content.directory AS row_topic_uri,\n topic_sub.topic_id || '_' || topic_sub_creator_content.directory AS row_topic_sub_uri,\n (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || '_' || topic_creator_content.directory)+1 AS votes\nFROM topic\nLEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id)\nLEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = 'content.json')\nLEFT JOIN keyvalue AS topic_creator_user ON (topic_creator_user.json_id = topic_creator_content.json_id AND topic_creator_user.key = 'cert_user_id')\nLEFT JOIN topic AS topic_sub ON (topic_sub.parent_topic_uri = topic.topic_id || '_' || topic_creator_content.directory)\nLEFT JOIN json AS topic_sub_creator_json ON (topic_sub_creator_json.json_id = topic_sub.json_id)\nLEFT JOIN json AS topic_sub_creator_content ON (topic_sub_creator_content.directory = topic_sub_creator_json.directory AND topic_sub_creator_content.file_name = 'content.json')\nLEFT JOIN comment ON (comment.topic_uri = row_topic_sub_uri)\nWHERE topic.type = \"group\" "+
whereb+"\nGROUP BY topic.topic_id";if(!this.list_all&&!this.parent_topic_uri)query+=" ORDER BY last_action DESC LIMIT 30";return Page.cmd("dbQuery",[query],function(_this){return function(topics){var j,topicsLength,topic,topicParent,topicUri;topics.sort(function(a,b){var boosterA,boosterB;boosterA=boosterB=0;if(window.TopicList.topic_sticky_uris[a.row_topic_uri])boosterA=window.TopicList.topic_sticky_uris[a.row_topic_uri]*1E7;if(window.TopicList.topic_sticky_uris[b.row_topic_uri])boosterB=window.TopicList.topic_sticky_uris[b.row_topic_uri]*
1E7;return Math.max(b.last_comment+boosterB,b.last_added+boosterB)-Math.max(a.last_comment+boosterA,a.last_added+boosterA)});for(j=0,topicsLength=topics.length;j<topicsLength;j++){topic=topics[j];topicUri=topic.row_topic_uri;if(topic.last_added)topic.added=topic.last_added;if(_this.parent_topic_uri&&topicUri===_this.parent_topic_uri){topicParent=topic;continue}elem=$("#topic_"+topicUri);if(elem.length===0){elem=$(".topics-list .topic.template").clone().removeClass("template").attr("id","topic_"+topicUri);
if(type!=="noanim")elem.cssSlideDown()}elem.insertAfter(lastElem);lastElem=elem;_this.applyTopicData(elem,topic)}Page.addInlineEditors();$("body").css({"overflow":"auto","height":"auto"});if(window.location.href.match(/(\?|&)q=/)){$("#originalZeroTorrent").fadeIn();$("html,body").animate({scrollTop:$(".topics-list").offset().top},"normal")}_this.logEnd("Load topics...");if(parseInt($(".topics-loading").css("top"))>-30)$(".topics-loading").css("top","-30px");else $(".topics-loading").remove();if(_this.parent_topic_uri)$(".topics-title").html("<span class='parent-link'><a href='?Main'>Main</a> &rsaquo;</span> "+
topicParent.title);$(".topics").css("opacity",1);if(topics.length===0){if(Page.site_info.bad_files)$(".message-big").text("Initial sync in progress...");else{$(".message-big").text("Welcome to your own forum! :)");$(".topic-new-link").trigger("click")}$(".message-big").css("display","block").cssLater("opacity",1)}else $(".message-big").css("display","none");if(topics.length===30)$(".topics-more").css("display","block");else $(".topics-more").css("display","none");if(cb)return cb()}}(this))};TopicList.prototype.applyTopicData=
function(elem,topic,type){var body,imdblink,lastAction,magnet,magnetlink,swarm,titleHash,topicUri,torrent,torrentCategory,torrentImdb,torrentlink,url,urlMatch,visited;if(type==null)type="list";titleHash=Text.toUrl(topic.title);topicUri=topic.row_topic_uri;$(".title .title-link",elem).text(topic.title);$(".title .title-link, a.image, .comment-num",elem).attr("href","?full&Topic:"+topicUri+"/"+titleHash);elem.data("topic_uri",topicUri);body=topic.body;urlMatch=body.match(/http[s]{0,1}:\/\/[^"', \r\n)$]+/);
if(topic.type==="group"){$(elem).addClass("topic-group");$(".image .icon",elem).removeClass("icon-topic-chat").addClass("icon-topic-group");$(".link",elem).css("display","none");$(".title .title-link, a.image, .comment-num",elem).attr("href","?Topics:"+topicUri+"/"+titleHash)}else if(urlMatch){url=urlMatch[0];if(type!=="show")body=body.replace(/http[s]{0,1}:\/\/[^"' \r\n)$]+$/g,"");$(".image .icon",elem).removeClass("icon-topic-chat").addClass("icon-topic-link");$(".link",elem).css("display","").attr("href",
Text.fixLink(url));$(".link .link-url",elem).text(url)}else{$(".image .icon",elem).removeClass("icon-topic-link").addClass("icon-topic-chat");$(".link",elem).css("display","none")}torrentCategory=topic.category;torrentImdb=topic.torrent_imdb;swarm={seeders:topic.seeders||0,leechers:topic.leechers||0};$(".torrent-seeders").text(swarm.seeders);$(".torrent-leechers").text(swarm.leechers);if(type==="show"){torrent=topic.torrent_file;if(torrent.split("/")[3]===""){torrentlink="";$(".topics-full .topic.topic-full .torrentfile_link").hide()}else{$(".topics-full .topic.topic-full .torrentfile_link").attr("href",
torrent);torrentlink="<a href='"+torrent+"' download>Download torrent</a>"}magnet=topic.magnet;if(magnet===""){magnetlink="";$(".topics-full .topic.topic-full .magnet_link").hide()}else{$(".topics-full .topic.topic-full .magnet_link").attr("href",magnet);magnetlink="<a href='"+magnet+"'>Magnet Link</a><br />"}if(torrentImdb==="")imdblink="";else imdblink="<a href='http://www.imdb.com/title/"+torrentImdb+"'>IMDB Link</a><br />";$(".body",elem).html(Text.toMarked(body,{"sanitize":true})+("<br />Category: "+
torrentCategory+"<br />"+imdblink+" "+magnetlink+" "+torrentlink));$(".topics-full .topic.topic-full .torrent_category").html(torrentCategory);$(".topics-full .topic.topic-full .torrent_category").attr("href","?full&Category:"+torrentCategory)}else $(".body",elem).text(body);if(window.TopicList.topic_sticky_uris[topicUri])elem.addClass("topic-sticky");if(type!=="show"){lastAction=Math.max(topic.last_comment,topic.added);if(topic.type==="group"){$(".comment-num",elem).text("last activity");$(".added",
elem).text(Time.since(lastAction))}else if(topic.comments_num>0){$(".comment-num",elem).text(topic.comments_num+" comment");$(".added",elem).text("last "+Time.since(lastAction))}else{$(".comment-num",elem).text("0 comments");$(".added",elem).text(Time.since(lastAction))}}$(".user_name",elem).text(topic.topic_creator_user_name.replace(/@.*/,"")).attr("title",topic.topic_creator_user_name+": "+topic.topic_creator_address);if(User.my_topic_votes[topicUri]){$(".score-inactive .score-num",elem).text(topic.votes-
1);$(".score-active .score-num",elem).text(topic.votes);$(".score",elem).addClass("active")}else{$(".score-inactive .score-num",elem).text(topic.votes);$(".score-active .score-num",elem).text(topic.votes+1)}$(".score",elem).off("click").on("click",this.submitTopicVote);visited=Page.local_storage["topic."+topicUri+".visited"];if(!visited)elem.addClass("visit-none");else if(visited<lastAction)elem.addClass("visit-newcomment");if(type==="show")$(".added",elem).text(Time.since(topic.added));if(topic.topic_creator_address===
Page.site_info.auth_address){$(elem).attr("data-object","Topic:"+topicUri).attr("data-deletable","yes");$(".title .title-link",elem).attr("data-editable","title").data("content",topic.title);return $(".body",elem).attr("data-editable","body").data("content",topic.body)}};TopicList.prototype.submitCreateTopic=function(){var body,innerPath,title,torrentCategory,torrentFile,torrentFilename,torrentImdb,torrentMagnet;if(!Page.site_info.cert_user_id){Page.cmd("wrapperNotification",["info","Please, choose your account before creating a topic."]);
return false}title=$(".topic-new #topic_title").val().trim();body=$(".topic-new #topic_body").val().trim();torrentMagnet=$(".topic-new #torrent_magnet").val();torrentImdb=$(".topic-new #torrent_imdb").val().replace("http://www.imdb.com/title/","");torrentFile=$(".topic-new #filedata").val();torrentFilename=$(".topic-new #torrent_file").val().replace("C:\\fakepath\\","");torrentCategory=$(".topic-new #torrent_category").val();if(!title)return $(".topic-new #topic_title").focus();$(".topic-new .button-submit").addClass("loading");
innerPath="data/users/"+Page.site_info.auth_address+"/"+torrentFilename;if(torrentFile)Page.writePublish(innerPath,torrentFile.split(",")[1],function(_this){return function(res){User.checkCert("updaterules");Page.cmd("wrapperNotification",["info","File upload success"]);return Page.cmd("sitePublish",{"inner_path":innerPath},function(res){if(res==="ok")return Page.cmd("wrapperNotification",["info","Torrent file published."]);else return Page.cmd("wrapperNotification",["error",res])})}}(this));return User.getData(function(_this){return function(data){var topic;
topic={"topic_id":data.next_topic_id,"category":torrentCategory,"title":title,"torrent_imdb":torrentImdb,"body":body,"magnet":torrentMagnet,"torrent_file":innerPath,"added":Time.timestamp()};if(_this.parent_topic_uri)topic.parent_topic_uri=_this.parent_topic_uri;data.topic.push(topic);data.next_topic_id+=1;return User.publishData(data,function(res){$(".topic-new .button-submit").removeClass("loading");$(".topic-new").slideUp();$(".topic-new-link").slideDown();setTimeout(function(){return _this.loadTopics()},
600);$(".topic-new #topic_body").val("");$(".topic-new #topic_title").val("");return $(".topic-new #torrent_magnet").val("")})}}(this))};TopicList.prototype.submitTopicVote=function(e){var elem,innerPath;console.log(innerPath);if(!Page.site_info.cert_user_id){Page.cmd("wrapperNotification",["info","Please, choose your account before upvoting."]);return false}elem=$(e.currentTarget);elem.toggleClass("active").addClass("loading");innerPath="data/users/"+User.my_address+"/data.json";User.getData(function(_this){return function(data){var topicUri;
if(data.topic_vote==null)data.topic_vote={};topicUri=elem.parents(".topic").data("topic_uri");if(elem.hasClass("active"))data.topic_vote[topicUri]=1;else delete data.topic_vote[topicUri];return User.publishData(data,function(res){return elem.removeClass("loading")})}}(this));return false};return TopicList}(Class);window.TopicList=new TopicList}).call(this);(function(){var TopicShow;var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;TopicShow=function(superClass){extend(TopicShow,superClass);function TopicShow(){this.submitCommentVote=bind(this.submitCommentVote,
this);return TopicShow.__super__.constructor.apply(this,arguments)}TopicShow.prototype.actionShow=function(topicID,topicUserAddress){var textarea;this.topic_id=topicID;this.topic_user_address=topicUserAddress;this.topic_uri=this.topic_id+"_"+this.topic_user_address;this.topic=null;this.list_all=false;this.loadTopic();this.loadComments("noanim");$(".comment-new .button-submit-form").on("click",function(_this){return function(){_this.submitComment();return false}}(this));textarea=$(".comment-new #comment_body");
$(".comment-new #comment_body").on("input",function(_this){return function(){var currentSize;if(User.rules.max_size){if(textarea.val().length>0)currentSize=User.rules.current_size+textarea.val().length+90;else currentSize=User.rules.current_size;return User.setCurrentSize(currentSize)}}}(this));$(".comments-more").on("click",function(_this){return function(){_this.list_all=true;$(".comments-more").text("Loading...");_this.loadComments("noanim");return false}}(this));return this.initFollowButton()};
TopicShow.prototype.initFollowButton=function(){this.follow=new Follow($(".feed-follow-show"));this.follow.addFeed("Comments in this topic","SELECT 'comment' AS type, comment.added AS date_added, topic.title, commenter_user.value || ': ' || comment.body AS body, topic_creator_json.directory AS topic_creator_address, topic.topic_id || '_' || topic_creator_json.directory AS row_topic_uri, '?full&Topic:' || topic.topic_id || '_' || topic_creator_json.directory AS url FROM topic LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id) LEFT JOIN comment ON (comment.topic_uri = row_topic_uri) LEFT JOIN json AS commenter_json ON (commenter_json.json_id = comment.json_id) LEFT JOIN json AS commenter_content ON (commenter_content.directory = commenter_json.directory AND commenter_content.file_name = 'content.json') LEFT JOIN keyvalue AS commenter_user ON (commenter_user.json_id = commenter_content.json_id AND commenter_user.key = 'cert_user_id') WHERE row_topic_uri IN (:params)",
true,this.topic_uri);return this.follow.init()};TopicShow.prototype.queryTopic=function(topicID,topicUserAddress){return"SELECT topic.*, topic_creator_user.value AS topic_creator_user_name, topic_creator_content.directory AS topic_creator_address, topic.topic_id || '_' || topic_creator_content.directory AS row_topic_uri, (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || '_' || topic_creator_content.directory)+1 AS votes FROM topic LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id) LEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = 'content.json') LEFT JOIN keyvalue AS topic_creator_user ON (topic_creator_user.json_id = topic_creator_content.json_id AND topic_creator_user.key = 'cert_user_id') WHERE topic.topic_id = "+
topicID+" AND topic_creator_address = '"+topicUserAddress+"' LIMIT 1"};TopicShow.prototype.loadTopic=function(cb){if(cb==null)cb=false;this.logStart("Loading topic...");$(".topic-full").attr("id","topic_"+this.topic_uri);$(".topic-title").css("display","none");return Page.cmd("dbQuery",[this.queryTopic(this.topic_id,this.topic_user_address)],function(_this){return function(res){var parentTopicId,parentTopicUserAddress,ref;_this.topic=res[0];TopicList.applyTopicData($(".topic-full"),_this.topic,"show");
if(_this.topic.parent_topic_uri){$(".topic-title").html("&nbsp;").css("display","");ref=_this.topic.parent_topic_uri.split("_");parentTopicId=ref[0];parentTopicUserAddress=ref[1];Page.cmd("dbQuery",[_this.queryTopic(parentTopicId,parentTopicUserAddress)],function(parentRes){var parentTopic;parentTopic=parentRes[0];return $(".topic-title").html("<span class='parent-link'><a href='?Main'>Main</a> &rsaquo;</span> <span class='parent-link'><a href='?Topics:"+parentTopic.row_topic_uri+"/"+Text.toUrl(parentTopic.title)+
"'>"+parentTopic.title+"</a> &rsaquo;</span> "+_this.topic.title)})}$(".topic-full").css("opacity",1);$("body").addClass("page-topic");_this.logEnd("Loading topic...");if(cb)return cb()}}(this))};TopicShow.prototype.loadComments=function(type,cb){var query;if(type==null)type="show";if(cb==null)cb=false;this.logStart("Loading comments...");query="SELECT comment.*, user.value AS user_name, user_json_content.directory AS user_address, (SELECT COUNT(*) FROM comment_vote WHERE comment_vote.comment_uri = comment.comment_id || '_' || user_json_content.directory)+1 AS votes FROM comment LEFT JOIN json AS user_json_data ON (user_json_data.json_id = comment.json_id) LEFT JOIN json AS user_json_content ON (user_json_content.directory = user_json_data.directory AND user_json_content.file_name = 'content.json') LEFT JOIN keyvalue AS user ON (user.json_id = user_json_content.json_id AND user.key = 'cert_user_id') WHERE comment.topic_uri = '"+
this.topic_id+"_"+this.topic_user_address+"' AND added < "+(Date.now()/1E3+120)+" ORDER BY added DESC";if(!this.list_all)query+=" LIMIT 60";return Page.cmd("dbQuery",[query],function(_this){return function(comments){var comment,commentUri,elem,i,len;_this.logEnd("Loading comments...");$(".comments .comment:not(.template)").attr("missing","true");for(i=0,len=comments.length;i<len;i++){comment=comments[i];commentUri=comment.comment_id+"_"+comment.user_address;elem=$("#comment_"+commentUri);if(elem.length===
0){elem=$(".comment.template").clone().removeClass("template").attr("id","comment_"+commentUri).data("topic_uri",_this.topic_uri);if(type!=="noanim")elem.cssSlideDown();$(".reply",elem).on("click",function(e){return _this.buttonReply($(e.target).parents(".comment"))});$(".score",elem).attr("id","comment_score_"+commentUri).on("click",_this.submitCommentVote)}_this.applyCommentData(elem,comment);elem.appendTo(".comments:not(.topComments)").removeAttr("missing")}$("body").css({"overflow":"auto","height":"auto"});
$(".comment[missing]").remove();Page.addInlineEditors();if(comments.length===60)$(".comments-more").css("display","block");else $(".comments-more").css("display","none");if(comments.length>0)Page.local_storage["topic."+_this.topic_id+"_"+_this.topic_user_address+".visited"]=comments[0].added;else Page.local_storage["topic."+_this.topic_id+"_"+_this.topic_user_address+".visited"]=_this.topic.added;Page.cmd("wrapperSetLocalStorage",Page.local_storage);if(cb)return cb()}}(this))};TopicShow.prototype.applyCommentData=
function(elem,comment){var commentURI,image,userName;userName=comment.user_name;image=comment.image;if(!image||image==="data/users/"+comment.user_address+"/")$(".body",elem).html(Text.toMarked(comment.body,{"sanitize":true}));else $(".body",elem).html(Text.toMarked(comment.body,{"sanitize":true})+'<br /><img src="'+image+'">');$(".user_name",elem).text(userName.replace(/@.*/,"")).css({"color":Text.toColor(userName)}).attr("title",userName+": "+comment.user_address);$(".added",elem).text(Time.since(comment.added)).attr("title",
Time.date(comment.added,"long"));commentURI=elem.attr("id").replace("comment_","");if(User.my_comment_votes[commentURI]){$(".score-inactive .score-num",elem).text(comment.votes-1);$(".score-active .score-num",elem).text(comment.votes);$(".score",elem).addClass("active")}else{$(".score-inactive .score-num",elem).text(comment.votes);$(".score-active .score-num",elem).text(comment.votes+1)}if(comment.user_address===Page.site_info.auth_address){$(elem).attr("data-object","Comment:"+commentURI+"@"+this.topic_uri).attr("data-deletable",
"yes");return $(".body",elem).attr("data-editable","body").data("content",comment.body)}};TopicShow.prototype.buttonReply=function(elem){var bodyAdd,elemQuote,postID,userName;this.log("Reply to",elem);userName=$(".user_name",elem).text();postID=elem.attr("id");bodyAdd="> ["+userName+"]("+postID+"): ";elemQuote=$(".body",elem).clone();$("blockquote",elemQuote).remove();bodyAdd+=elemQuote.text().trim("\n").replace(/\n/g,"\n> ");bodyAdd+="\n\n";$(".comment-new #comment_body").val($(".comment-new #comment_body").val()+
bodyAdd);$(".comment-new #comment_body").trigger("input").focus();return false};TopicShow.prototype.submitComment=function(){var body,commentImageFile,commentImageFilename;body=$(".comment-new #comment_body").val().trim();if(!body){$(".comment-new #comment_body").focus();return}commentImageFile=$(".comment-new #commentfiledata").val();commentImageFilename=$(".comment-new #comment_image_file").val().replace("C:\\fakepath\\","");$(".comment-new .button-submit").addClass("loading");return User.getData(function(_this){return function(data){var base,
innerPath,name;innerPath="data/users/"+Page.site_info.auth_address+"/"+commentImageFilename;if((base=data.comment)[name=_this.topic_uri]==null)base[name]=[];data.comment[_this.topic_uri].push({"comment_id":data.next_comment_id,"body":body,"image":innerPath,"added":Time.timestamp()});Page.writePublish(innerPath,commentImageFile.split(",")[1],function(res){User.checkCert("updaterules");Page.cmd("wrapperNotification",["info","File upload success"]);return Page.cmd("sitePublish",{"inner_path":innerPath},
function(res){if(res==="ok")return Page.cmd("wrapperNotification",["info","Image file published."]);else return Page.cmd("wrapperNotification",["error",res])})});data.next_comment_id+=1;return User.publishData(data,function(res){$(".comment-new .button-submit").removeClass("loading");if(res===true){_this.log("File written");_this.loadComments();return $(".comment-new #comment_body").val("").delay(600).animate({"height":72},{"duration":1E3,"easing":"easeInOutCubic"})}})}}(this))};TopicShow.prototype.submitCommentVote=
function(e){var elem;if(!Page.site_info.cert_user_id){Page.cmd("wrapperNotification",["info","Please, choose your account before upvoting."]);return false}elem=$(e.currentTarget);elem.toggleClass("active").addClass("loading");User.getData(function(_this){return function(data){var commentUri;if(data.comment_vote==null)data.comment_vote={};commentUri=elem.attr("id").match("_([0-9]+_[A-Za-z0-9]+)$")[1];if(elem.hasClass("active"))data.comment_vote[commentUri]=1;else delete data.comment_vote[commentUri];
return User.publishData(data,function(res){return elem.removeClass("loading")})}}(this));return false};return TopicShow}(Class);window.TopicShow=new TopicShow}).call(this);(function(){var User;var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;User=function(superClass){extend(User,superClass);function User(){this.my_topic_votes={};this.my_comment_votes={};this.rules={};var _this=this;setTimeout(function(){_this.certselectButtons();console.log("Executed certselectButtons TimeOut")},
1E3)}User.prototype.updateMyInfo=function(cb){if(cb==null)cb=null;this.log("Updating user info...",this.my_address);return this.updateMyVotes(cb)};User.prototype.updateMyVotes=function(cb){var query;if(cb==null)cb=null;query="SELECT 'topic_vote' AS type, topic_uri AS uri FROM json LEFT JOIN topic_vote USING (json_id) WHERE directory = \""+Page.site_info.auth_address+"\" AND file_name = 'data.json'\nUNION\nSELECT 'comment_vote' AS type, comment_uri AS uri FROM json LEFT JOIN comment_vote USING (json_id) WHERE directory = \""+
Page.site_info.auth_address+"\" AND file_name = 'data.json'";Page.cmd("dbQuery",[query],function(_this){return function(votes){var i,len,results,vote;results=[];for(i=0,len=votes.length;i<len;i++){vote=votes[i];if(vote.type==="topic_vote")results.push(_this.my_topic_votes[vote.uri]=true);else results.push(_this.my_comment_votes[vote.uri]=true)}return results}}(this));if(cb)return cb()};User.prototype.certselectButtons=function(){return $(".certselect").on("click",function(_this){return function(){if(Page.server_info.rev<
160)Page.cmd("wrapperNotification",["error","Comments requires at least ZeroNet 0.3.0 Please upgade!"]);else Page.cmd("certSelect",[["zeroid.bit"]]);return false}}(this))};window.certselectButtons=User.prototype.certselectButton;User.prototype.checkCert=function(type){var lastCertUserId;lastCertUserId=$(".user_name-my").text();console.log(lastCertUserId);if($(".comment-new .user_name").text()!==Page.site_info.cert_user_id||type==="updaterules"){if(Page.site_info.cert_user_id){$(".comment-new").removeClass("comment-nocert");
$(".user_name-my").text(Page.site_info.cert_user_id).css({"color":Text.toColor(Page.site_info.cert_user_id)})}else{$(".comment-new").addClass("comment-nocert");$(".user_name-my").text("Please sign in")}if(Page.site_info.cert_user_id)return Page.cmd("fileRules","data/users/"+Page.site_info.auth_address+"/content.json",function(_this){return function(rules){_this.rules=rules;if(rules.max_size)return _this.setCurrentSize(rules.current_size);else return _this.setCurrentSize(0)}}(this));else return this.setCurrentSize(0)}};
User.prototype.setCurrentSize=function(currentSize){var currentSizeKb,percent;if(currentSize){currentSizeKb=currentSize/1E3;$(".user-size").text("used: "+currentSizeKb.toFixed(1)+"k/"+Math.round(this.rules.max_size/1E3)+"k").attr("title","Every new user has limited space to store comments, topics and votes.\n"+"This indicator shows your used/total allowed KBytes.\n"+"The site admin can increase it if you about to run out of it.");percent=Math.round(100*currentSize/this.rules.max_size);$(".user-size-used").css("width",
percent+"%");if(percent>80)return $(".user-size-warning").css("display","block").find("a").text(Page.site_info.content.settings.admin).attr("href",Text.fixLink(Page.site_info.content.settings.admin_href))}else return $(".user-size").text("")};User.prototype.getData=function(cb){var innerPath;innerPath="data/users/"+Page.site_info.auth_address+"/data.json";return Page.cmd("fileGet",{"inner_path":innerPath,"required":false},function(_this){return function(data){if(data)data=JSON.parse(data);else data=
{"next_topic_id":1,"topic":[],"topic_vote":{},"next_comment_id":1,"comment":{},"comment_vote":{}};return cb(data)}}(this))};User.prototype.publishData=function(data,cb){var innerPath;innerPath="data/users/"+Page.site_info.auth_address+"/data.json";return Page.writePublish(innerPath,Text.jsonEncode(data),function(_this){return function(res){_this.checkCert("updaterules");if(cb)return cb(res)}}(this))};return User}(Class);window.User=new User}).call(this);(function(){var ZeroTalk,NotImplemented;var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};var extend=function(child,parent){for(var key in parent)if(hasProp.call(parent,key))child[key]=parent[key];function Ctor(){this.constructor=child}Ctor.prototype=parent.prototype;child.prototype=new Ctor;child.__super__=parent.prototype;return child};var hasProp={}.hasOwnProperty;NotImplemented=window.NotImplemented=function(errType){if(errType)Page.cmd("wrapperNotification",["error",
errType+" are currently not implemented!",6E3]);else Page.cmd("wrapperNotification",["error","This functionality has not currently been implemented!",6E3])};ZeroTalk=function(superClass){extend(ZeroTalk,superClass);function ZeroTalk(){this.setSiteinfo=bind(this.setSiteinfo,this);this.actionSetSiteInfo=bind(this.actionSetSiteInfo,this);this.saveContent=bind(this.saveContent,this);this.getObject=bind(this.getObject,this);this.getContent=bind(this.getContent,this);this.onOpenWebsocket=bind(this.onOpenWebsocket,
this);return ZeroTalk.__super__.constructor.apply(this,arguments)}ZeroTalk.prototype.init=function(){var i,len,ref,textarea;this.log("inited!");this.site_info=null;this.server_info=null;this.local_storage={};this.site_address=null;ref=$("textarea");for(i=0,len=ref.length;i<len;i++){textarea=ref[i];this.autoExpand($(textarea))}return $(".editbar .icon-help").on("click",function(_this){return function(){$(".editbar .markdown-help").css("display","block");$(".editbar .markdown-help").toggleClassLater("visible",
10);$(".editbar .icon-help").toggleClass("active");return false}}(this))};ZeroTalk.prototype.onOpenWebsocket=function(e){this.cmd("wrapperSetViewport","width=device-width, initial-scale=1.0");this.cmd("wrapperGetLocalStorage",[],function(_this){return function(res){if(res==null)res={};_this.local_storage=res;return _this.local_storage}}(this));this.cmd("siteInfo",{},function(_this){return function(site){_this.site_address=site.address;_this.setSiteinfo(site);return User.updateMyInfo(function(){return _this.routeUrl(window.location.search.substring(1))})}}(this));
return this.cmd("serverInfo",{},function(_this){return function(ret){var version;_this.server_info=ret;version=parseInt(_this.server_info.version.replace(/\./g,""));if(version<31)return _this.cmd("wrapperNotification",["error","ZeroTalk requires ZeroNet 0.3.1, please update!"])}}(this))};ZeroTalk.prototype.onPageLoaded=function(){return $("body").addClass("loaded")};ZeroTalk.prototype.autocompleteSearch=function(){$("#contentSearch").autocomplete({cache:!0,minLength:2,open:function(e,t){$("#contentSearch").autocomplete("widget").addClass("ui-search-autocomplete")},
source:function(e,t){if(e.term.length===0)return;Page.cmd("dbQuery",["SELECT (title) FROM topic WHERE title LIKE '"+e.term.replace(/'/g,"''")+"%' ORDER BY added DESC LIMIT 100"],function(res){if(res.length!==0)t(res.map(function(i){return{label:i.title,value:e.title}}));else Page.cmd("dbQuery",["SELECT (title) FROM topic WHERE title LIKE '%"+e.term.replace(/'/g,"''")+"%' ORDER BY added DESC LIMIT 100"],function(res){t(res.map(function(i){return{label:i.title,value:e.title}}))})})},select:function(e,
t){if(!window.location.href.match(/(\??|&?)q=/))window.location="?full&q="+t.item.value;else TopicList.loadTopics("list",false,t.item.value,$("#torrent_search_category").val())}})};ZeroTalk.prototype.routeUrl=function(url){var _this=this;var match=false;this.log("Routing url:",url);if(match){$("body").addClass("page-topics");return TopicList.actionList(parseInt(match[1]),Text.toBitcoinAddress(match[2]))}else if(match=function(){if(url.match(/Category:([0-9a-zA-Z]+)/))return false;else return url.match(/Category:([0-9a-zA-Z]+)/)}()){$("body").addClass("page-topics");
$("#"+match[1]).attr("selected","selected");return TopicList.actionList(null,null,match[1])}else if(match=url.match(/API_GET_([0-9a-zA-Z]+)_([0-9a-zA-Z]+)/))return APITopicList.actionList(match[1],match[2]);else{if(window.location.search.match(/(\??|&?)full(&?)/)){var template;if(window.location.search.match(/(\??|&?)full&Topic:.*(&?)/))template="views/topic.html";else template="views/full.html";Page.cmd("fileGet",[template],function(data){document.body.className="mainBody";document.getElementById("wrapper").innerHTML=
data;if(Page.site_info.cert_user_id)$(".upload-link").show();if(template==="views/topic.html"){_this.autocompleteSearch();(function(e,t,i){e.fn.tabs=function(n){var s=null;n=e.extend({useHash:!0,"default":null,tabSelector:"> div",linkSelector:".tabNavigation:first a",selectedTabClass:"selectedTab",onShow:function(){}},n);function r(){var e=t.hash.substring(1);e=e.replace(/_\d+$/,"");e=e.replace(/_.+$/,"");return e}e(this).each(function(){var l=e(n.tabSelector,this);var a=e(n.linkSelector,this);l.hide();
function u(e,r){if(!e)return;a.removeClass(n.selectedTabClass);l.hide();l.filter("#"+e).show();l.filter("#tab-"+e).show();a.filter("[rel="+e+"]").addClass(n.selectedTabClass);if(n.useHash&&r)if(i.replaceState)i.replaceState({},"","#"+e);else t.hash=e;s=e}var o=e();var c=r();if(n.useHash&&c)o=a.filter("[rel="+c+"]");if(!o.length&&n["default"])o=a.filter("[rel="+n["default"]+"]");if(!o.length)o=a.filter("."+n.selectedTabClass);if(!o.length)o=a.filter(":first");u(o.prop("rel"));a.click(function(){n.onShow(s,
e(this));u(e(this).prop("rel"),!0);return!1})});return this};e(function(){e(".tabSwitcher").tabs()})})(jQuery,document.location,history);$("searchform").attr("onsubmit","");document.forms.searchform.onsubmit=function(){if(this.contentSearch.value.length>1)window.location.href=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+"/?full&q="+encodeURIComponent(this.contentSearch.value);return false}}else{_this.autocompleteSearch();Page.cmd("fileGet",["categories.json"],
function(categories){categories=JSON.parse(categories);var opt,cat,appendCategory;for(var category in categories){appendCategory=true;cat=category==="xxx"?"XXX":category==="tv"?"TV":category.substring(0,1).toUpperCase()+category.substring(1,category.length);for(var j=0;j<document.getElementById("torrent_category").getElementsByTagName("option").length;j++)if(document.getElementById("torrent_category").getElementsByTagName("option")[j].innerHTML===cat){appendCategory=false;break}if(appendCategory){opt=
document.createElement("option");opt.value=cat.toLowerCase();opt.innerHTML=cat;document.getElementById("torrent_category").appendChild(opt);opt=document.createElement("option");opt.value=cat.toLowerCase();opt.innerHTML=cat;document.getElementById("torrent_search_category").appendChild(opt)}}})}match=url.match(/Topic:([0-9]+)_([0-9a-zA-Z]+)/);if(match){$("body").addClass("page-topic");return TopicShow.actionShow(parseInt(match[1]),Text.toBitcoinAddress(match[2]))}else{$("body").addClass("page-main");
return TopicList.actionList()}})}else{document.body.className="landing-page";Page.cmd("fileGet",["views/landing.html"],function(data){$("#originalZeroTorrent").css("display","none");document.getElementById("wrapper").innerHTML=data;_this.autocompleteSearch();document.forms.landingSearchform.action=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1];document.forms.landingSearchform.onsubmit=function(){if(document.forms.landingSearchform.q.value.length>0)window.location.href=
window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+"/?full&q="+encodeURIComponent(document.forms.landingSearchform.q.value);return false};document.forms.landingSearchform.contentSearch.onkeypress=function(e){if(e.keyCode===13)document.forms.landingSearchform.landingSearchFormSubmit.click()}})}setTimeout(function(){$("#latestForum a").click(function(e){e.preventDefault();return NotImplemented("Forums")});$("#navigation .community-link").click(function(e){e.preventDefault();
return NotImplemented("Forums")});$("#blogroll a").click(function(e){e.preventDefault();return NotImplemented("Blog Posts")});$("#navigation .blog-link").click(function(e){e.preventDefault();return NotImplemented("Blog Posts")});$(".ka-rss").click(function(e){e.preventDefault();return NotImplemented("RSS feeds")});$(".not-implemeneted").click(function(e){e.preventDefault();return NotImplemented()});console.log("Executed NotImplemented TimeOut")},1E3)}};ZeroTalk.prototype.addInlineEditors=function(){var editor,
elem,elems,i,len;this.logStart("Adding inline editors");elems=$("[data-editable]");for(i=0,len=elems.length;i<len;i++){elem=elems[i];elem=$(elem);if(!elem.data("editor")&&!elem.hasClass("editor")){editor=new InlineEditor(elem,this.getContent,this.saveContent,this.getObject);elem.data("editor",editor)}}return this.logEnd("Adding inline editors")};ZeroTalk.prototype.getContent=function(elem,raw){if(raw==null)raw=false;return elem.data("content")};ZeroTalk.prototype.getObject=function(elem){if(elem.data("object"))return elem;
else return elem.parents("[data-object]")};ZeroTalk.prototype.saveContent=function(elem,content,cb){var deleteObject,id,object,ref,type;if(cb==null)cb=false;if(elem.data("deletable")&&content===null)deleteObject=true;else deleteObject=false;object=this.getObject(elem);ref=object.data("object").split(":");type=ref[0];id=ref[1];return User.getData(function(_this){return function(data){var comment,commentId,commentUri,ref1,ref2,ref3,ref4,topic,topicCreatorAddress,topicId,topicUri,userAddress;console.log(topicCreatorAddress);
console.log(userAddress);if(type==="Topic"){ref1=id.split("_");topicId=ref1[0];userAddress=ref1[1];topicId=parseInt(topicId);topic=function(){var i,len,ref2,results;ref2=data.topic;results=[];for(i=0,len=ref2.length;i<len;i++){topic=ref2[i];if(topic.topic_id===topicId)results.push(topic)}return results}()[0];if(deleteObject)data.topic.splice(data.topic.indexOf(topic),1);else topic[elem.data("editable")]=content}if(type==="Comment"){ref2=id.split("@");commentUri=ref2[0];topicUri=ref2[1];ref3=commentUri.split("_");
commentId=ref3[0];userAddress=ref3[1];ref4=topicUri.split("_");topicId=ref4[0];topicCreatorAddress=ref4[1];commentId=parseInt(commentId);comment=function(){var i,len,ref5,results;ref5=data.comment[topicUri];results=[];for(i=0,len=ref5.length;i<len;i++){comment=ref5[i];if(comment.comment_id===commentId)results.push(comment)}return results}()[0];if(deleteObject)data.comment[topicUri].splice(data.comment[topicUri].indexOf(comment),1);else comment[elem.data("editable")]=content}return User.publishData(data,
function(res){if(res)if(deleteObject){if(cb)cb(true);return elem.fancySlideUp()}else{if(type==="Topic"){if($("body").hasClass("page-main")||$("body").hasClass("page-topics"))TopicList.loadTopics("list",function(){if(cb)return cb(true)});if($("body").hasClass("page-topic"))TopicShow.loadTopic(function(){if(cb)return cb(true)})}if(type==="Comment")return TopicShow.loadComments("normal",function(){if(cb)return cb(true)})}else if(cb)return cb(false)})}}(this))};ZeroTalk.prototype.onRequest=function(cmd,
message){if(cmd==="setSiteInfo")return this.actionSetSiteInfo(message);else return this.log("Unknown command",message)};ZeroTalk.prototype.writePublish=function(innerPath,data,cb){return this.cmd("fileWrite",[innerPath,data],function(_this){return function(res){if(res!=="ok"){_this.cmd("wrapperNotification",["error","File write error: "+res]);cb(false);return false}return _this.cmd("sitePublish",{"inner_path":innerPath},function(res){if(res==="ok")return cb(true);else return cb(res)})}}(this))};ZeroTalk.prototype.actionSetSiteInfo=
function(res){var siteInfo;siteInfo=res.params;this.setSiteinfo(siteInfo);if(siteInfo.event&&siteInfo.event[0]==="file_done"&&siteInfo.event[1].match(/.*users.*data.json$/))return RateLimit(500,function(_this){return function(){if($("body").hasClass("page-topic")){TopicShow.loadTopic();TopicShow.loadComments()}if($("body").hasClass("page-main")||$("body").hasClass("page-topics"))return TopicList.loadTopics()}}(this))};ZeroTalk.prototype.setSiteinfo=function(siteInfo){this.site_info=siteInfo;return User.checkCert()};
ZeroTalk.prototype.autoExpand=function(elem){var editor;editor=elem[0];if(elem.height()>0)elem.height(1);elem.on("input",function(){var minHeight,newHeight,oldHeight;console.log(oldHeight);if(editor.scrollHeight>elem.height()){oldHeight=elem.height();elem.height(1);newHeight=editor.scrollHeight;newHeight+=parseFloat(elem.css("borderTopWidth"));newHeight+=parseFloat(elem.css("borderBottomWidth"));newHeight-=parseFloat(elem.css("paddingTop"));newHeight-=parseFloat(elem.css("paddingBottom"));minHeight=
parseFloat(elem.css("lineHeight"))*2;if(newHeight<minHeight)newHeight=minHeight+4;return elem.height(newHeight-4)}});if(elem.height()>0)return elem.trigger("input");else return elem.height("48px")};return ZeroTalk}(ZeroFrame);window.Page=new ZeroTalk}).call(this);console.info("Interested in seeing what makes this zite tick?\nThe source code is available here: https://gitlab.com/kickasstorrents/KAT");
