<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="referrer" content="no-referrer">
        
        
        
        <link rel="shortcut icon" href="./img/favicon.ico">

	<title>ZeroMux</title>

        <link href="./css/bootstrap-custom.min.css" rel="stylesheet" crossorigin="anonymous">
        <link href="./css/font-awesome-4.0.3.css" rel="stylesheet" crossorigin="anonymous">
        <link rel="stylesheet" href="./css/highlight.css" crossorigin="anonymous">
        <link href="./css/base.css" rel="stylesheet" crossorigin="anonymous">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href=".">ZeroMux</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="active">
                    <a href=".">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="usage/">File Dependencies</a>
</li>

                    
                        
<li >
    <a href="usage/making-file-downloader/">Making a File Downloader</a>
</li>

                    
                        
<li >
    <a href="usage/making-mp4-file-streaming-friendly/">Making an MP4 File Streaming Friendly</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li class="disabled">
                    <a rel="next" >
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="usage/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#overview">Overview</a></li>
        
    
        <li class="main "><a href="#installation">Installation</a></li>
        
    
        <li class="main "><a href="#preparation">Preparation</a></li>
        
            <li><a href="#slicing-big-file">Slicing Big File</a></li>
        
            <li><a href="#writing-filejson">Writing file.json</a></li>
        
            <li><a href="#automating-this-process">Automating This Process</a></li>
        
    
        <li class="main "><a href="#next-steps">Next Steps</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1> <center>ZeroMux</center> </h1>

<p><center>Stream video files directly in browser.</center></p>
<h2 id="overview">Overview</h2>
<p>ZeroMux is a <strong>file downloading</strong> and <strong>video streaming</strong> tool designed for the ZeroNet. It is capable of <strong>reassembling</strong> chunked files and <strong>muxing</strong> MP4 files in real time. It is designed to work both in ZeroNet and in Localhost.</p>
<p>ZeroMux is still an Alpha software, but I think it is working well enough. Since the time I can spend on it is barely enough, some APIs are not well-wrapped. Free free to change the code according to your needs.</p>
<h2 id="installation">Installation</h2>
<p>If you are reading this documentation in ZeroNet, you have already downloaded all necessary files.<br />
To see them, simply go to</p>
<pre><code class="bash">ZeroNet/data/1CiDoBP...nw2V/big/js/
             (site address)
</code></pre>

<p>and copy all JS files to a folder you like.</p>
<pre><code class="bash">asmcrypto.js    async-hash.js
daemon.js       download.js
mp4alg.js       mp4builder.js
mp4parser.js    mp4worker.js
reader.js       sandblaster.min.js
ui.js           utils.js
</code></pre>

<h2 id="preparation">Preparation</h2>
<p>However, before you start to use ZeroMux, you need to do some preprocessing on your big file.</p>
<p>A big file is expected to be sliced into small pieces. In addition, necessary information of each file chunk has to be written in a JSON file list.</p>
<h3 id="slicing-big-file">Slicing Big File</h3>
<p>The recommended size of each chunk is <strong>250 ~ 450 KB</strong>. It is also recommended that each chunk be named after a numeric name with a <code>.dat</code> extension.</p>
<p>Example directory structure:</p>
<pre><code class="bash">big_file/
    0.dat       400 KB
    1.dat       400 KB
    2.dat       400 KB
    ......
    file.json     9 KB
</code></pre>

<h3 id="writing-filejson">Writing <code>file.json</code></h3>
<p>The file list is represented as a JSON file, placed in the same folder as the file chunks.</p>
<p>The <code>file.json</code> contains important information on how the file chunks should be reassembled. It contains the order, path, name, size and integrity digest of each chunk. It also contains the name, size and integrity digest of the original big file. Here is an example <code>file.json</code>:</p>
<pre><code class="json">{
    &quot;bigFile&quot;:
    {
        &quot;fileName&quot;: &quot;Big file.mp4&quot;,
        &quot;size&quot;: 5415151,
        &quot;hashingAlgorithm&quot;: &quot;sha256&quot;,
        &quot;hash&quot;: &quot;daeb232f55cf2e4820553d517a8f73cb5b621f2d39fab42605354f272ead532d&quot;
    },

    &quot;fileParts&quot;:
    [
        {
            &quot;path&quot;: &quot;files/big_file/0.dat&quot;,
            &quot;order&quot;: 0,
            &quot;size&quot;: 5415000,
            &quot;hashingAlgorithm&quot;: &quot;sha256&quot;,
            &quot;hash&quot;: &quot;2ba1019d8a58e80fef9f7441a523107d6d5a45fed5564ee15749fa2c5418437f&quot;
        },

        {
            &quot;path&quot;: &quot;files/big_file/1.dat&quot;,
            &quot;order&quot;: 1,
            &quot;size&quot;: 151,
            &quot;hashingAlgorithm&quot;: &quot;sha256&quot;,
            &quot;hash&quot;: &quot;c57006d96b2ece6feb14b67ef0b97ca1d80e22278d2365c334323c4599df2035&quot;
        }
    ]
}
</code></pre>

<h3 id="automating-this-process">Automating This Process</h3>
<p>You don't need to preprocess your files by hand. I have a working Python script that helps automate this process.</p>
<pre><code class="python">import os
import json
import hashlib
import codecs


filePath = &quot;D:\\My Documents\\movie.mp4&quot;
# File to be sliced

savePath = &quot;D:\\My Site\\files\\very_big\\&quot;
# Path where all produced files will be saved to

relativePath = &quot;files/very_big&quot;
# Relative path with respect to the page

givenFileName = &quot;Big file.mp4&quot;
# File name to be displayed

idealChunkSize = 400*1024

fileSize = os.path.getsize(filePath)

filePartList = []

fileSha256 = hashlib.sha256()
fileInfo = open(filePath, 'rb')


chunkOrder = 0
chunkBytes = fileInfo.read(idealChunkSize)
actualChunkSize = len(chunkBytes)

while actualChunkSize &gt; 0:
    fileSha256.update(chunkBytes)

    chunkSha256 = hashlib.sha256(chunkBytes).hexdigest()

    chunkFileName = &quot;%s.dat&quot; % str(chunkOrder)
    chunkRelativePath = relativePath + &quot;/&quot; + chunkFileName

    info = {
        &quot;path&quot;: chunkRelativePath,
        &quot;order&quot;: chunkOrder,
        &quot;size&quot;: actualChunkSize,
        &quot;hashingAlgorithm&quot;: &quot;sha256&quot;,
        &quot;hash&quot;: chunkSha256
    }
    filePartList.append(info)

    chunkFilePath = savePath + &quot;/&quot; + chunkFileName
    chunkFileInfo = open(chunkFilePath, 'wb')
    chunkFileInfo.write(chunkBytes)
    chunkFileInfo.flush()
    chunkFileInfo.close()

    chunkOrder += 1
    chunkBytes = fileInfo.read(idealChunkSize)
    actualChunkSize = len(chunkBytes)


wholeFileSha256 = fileSha256.hexdigest()

bigFileDict = {
    &quot;fileName&quot;: givenFileName,
    &quot;size&quot;: fileSize,
    &quot;hashingAlgorithm&quot;: &quot;sha256&quot;,
    &quot;hash&quot;: wholeFileSha256
}

jsonContent = {
    &quot;bigFile&quot;: bigFileDict,
    &quot;fileParts&quot;: filePartList
}

jsonFileInfo = codecs.open(savePath + &quot;/file.json&quot;, 'w', 'utf-8')
jsonFileInfo.write( unicode(json.dumps(jsonContent)) )
jsonFileInfo.flush()
jsonFileInfo.close()
</code></pre>

<h2 id="next-steps">Next Steps</h2>
<p>Please learn about the <strong>usage</strong> by reading the <a href="./usage/">next page</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="./js/jquery-1.10.2.min.js"></script>
        <script src="./js/bootstrap-3.0.3.min.js"></script>
        <script src="./js/highlight.pack.js"></script>
        <script>var base_url = '.';</script>
        <script data-main="./mkdocs/js/search.js" src="./mkdocs/js/require.js"></script>
        <script src="./js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>