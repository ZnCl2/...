<!DOCTYPE HTML>
<html lang="ru">
    <head>
      <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb</title>
      <link rel="stylesheet" href="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb/css/main.css"/>
      <link rel="shortcut icon" type="image/x-icon" href="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb/i/favicon.ico"/>
      <link href="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb/rss.xml" title="Akademic's blog" type="application/rss+xml" rel="alternate"/>
    </head>
    <body>
        <header><h1><a href="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb" rel="home">akademic.name</a></h1></header>
        <main class="content">
            
<article>
    <h1>Переход на php7.0 c php5.6</h1> <time>17.10.2015</time>
	<p>Больше года не писал в блог, а тема всё та же - переход на очередную версию php.
15 октября вышел пятый релиз-кандидать седьмой версии php.
Новые версии появляются по графику и если ничего экстраординарного не произойдёт, то 12 ноября будет полноценный релиз.
Настало время проверить какие проблемы ждут нас при переходе и потестировать производительность.
К тому же удачно вышла версия шаблонизатора <a href="https://github.com/alexeyrybak/blitz">Blitz</a> с поддержкой php7.
Без него тестирование бы не получилось.</p>

<h2>Исходные данные</h2>

<p>В предыдущем <a href="/blog/2014/perehod-na-php5.6/">посте</a> я рассказывал о контейнере для тестов.
С тех пор количество тестов сильно подросло, увеличилось и время тестирования.
Теперь все тесты проходят за 10 минут. Но контейнер надо пересобрать.</p>

<p>На этот раз задача посложнее:
1. В пакете для php7 с <a href="https://www.dotdeb.org">dotdeb.org</a> другие пути для конфигов.
2. Не хватает некоторых расширений, которые надо скомпилить из исходников.
3. Поддержка функций <code>mysql_</code> окончательно прекращена и надо будет переписать адаптер для БД.
4. Так же в php7 удалили множество устаревших функций, так что возможно придётся что-то переписывать в проекте.</p>

<h2>Какие проблемы возникли</h2>

<p>Удивительно, но факт - очень мало чего пришлось переделывать:
1. Переписал адаптер для mysql на использование расшерения mysqli.
2. Заменил несколько вызовов split на preg_split.
3. Заменил кучу вызовов mysql_real_escape_string на аналог из mysqli.
4. Убрал пару забытых со времён перехода с php4 амперсандов.</p>

<p>Вот и все изменения, которые потребовались для запуска на php7</p>

<h2>Результат тестирования</h2>

<p>Итак, теперь тесты могут пройти без провалов.</p>

<ol>
<li>Время работы тестов составило 7.5 минут (против 10и на php5.6)</li>
<li>Также автоматически прошли тесты в контейнере с php5.6.
Время их выполнения также уменьшилось до 8.5 минут.
Что показывает, что переход на mysqli также даёт прирост производительности.</li>
</ol>

<h2>Выводы</h2>

<ol>
<li>Переход с php5 на php7 безболезненная процедура (особенно если код изначально писался для php5 и в нём нет устаревшего кода из времён php4).</li>
<li>В связи с первым пунктом: переход на php7 - халявное увеличение скорости работы кода.</li>
</ol>

    
    <span class="next_blog_post">
    <a href="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb/blog/2015/dell-inspirion-mini-1010/index.html" rel="next">Что можно сделать со старым нетбуком</a>
    </span>
	
	
    <span class="prev_blog_post">
    <a href="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb/blog/2014/perehod-na-php5.6/index.html" rel="previous">Переход на php5.6 c php5.4</a>
    </span>
	
</article>

        </main>
        <footer>
        Будьте внимательны, многое из того, что написано в этом блоге, является личным мнением автора и не претендует на истину.
        <img src="/18Yd2NFggSXzLRvSaDVi936KrM8Ehc3neb/i/yopiright.jpg" width="12" height="12"/> 2008
        </footer>
    </body>
</html>
