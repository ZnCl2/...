<!DOCTYPE html>
<html>
	<head>
		<title>The SandS</title>

		<link rel="stylesheet" type="text/css" href="css/index.css">
	</head>
	<body>
		<img src="sands_logo.svg" class="logo" width="268" height="19">

		<canvas id="canvas" class="canvas" width="640" height="360"></canvas>
		<img src="hal_4000.jpg" id="image" class="image" width="640" height="360">
		<audio src="hal_4000.mp3" id="audio"></audio>

		<div class="footer">
			<a href="/0demoscene.bit/">0demoscene.bit</a>
		</div>

		<script type="application/x-vertex-shader" id="vertex_shader">
			attribute vec2 pos;
			varying vec2 coordVar;

			void main() {
				coordVar = pos / 2.;
				gl_Position = vec4(pos, 0., 1.);
			}
		</script>

		<script type="application/x-fragment-shader" id="fragment_shader">
			// HAL 4 kb intro by the SandS
			precision highp float;
			varying vec2 coordVar;
			uniform float t;

			float torus(vec3 o,float k){o.z-=4.5;vec3 r=vec3(t/2.3,t/1.95,t/2.7),s=sin(r),c=cos(r);o*=mat3(c.y,s.z*s.y,-s.y*c.z,-s.x*s.y,c.x*c.z+s.x*s.z*c.y,s.z*c.x-s.x*c.z*c.y,c.x*s.y,s.x*c.z-c.x*s.z*c.y,s.z*s.x+c.x*c.z*c.y);float s1=clamp((t-33.)/14.,0.,1.);k=mix(k,0.,s1*s1*s1);float n=8.-6.*k,l=3.8*k-2.;n=mix(n,2.,s1*s1*s1);o=abs(o);return pow(pow(o.x,n)+pow(o.y,n)+pow(o.z,n)+l,2.)-k*8.*(o.x*o.x+o.y*o.y);}float shape(vec3 o){return sin(o.x*5.)/15.+cos(o.x+1.5)/3.+sin(o.z+t)/5.-cos(o.x+2.)*cos(o.z+t)/3.;}float rt(vec3 o){return length(o-vec3(o.x,shape(o)-1.5,o.z));}float s(float a,float z){return(a-a*z+1.)*991.;}float wire(float dist){return pow(1.-min(1.,abs(dist)),4.);}void main(){float aspect=16./9.;vec2 uv=coordVar/vec2(1.,aspect)*1.4;float cf=0.,ct=0.,cm=0.,cl=0.,cs=0.,pi=3.1416;float l=1.,d,e=.0001,m1,m2,r=0.,size,n,z;vec3 xyz,c=vec3(0.,0.,0.),norm=c,light=vec3(0.,1.,12.+max(0.,(t-47.)/8.));if(t<62.){float kf=clamp(t/4.-5.,0.,1.);float kt=cos((t)/3.1)/2.5+.4;float s1=t-22.,td=1.+max(s1*s1*s1/999.,0.)/9.;n=min(t*t*t/451.,17.7)+.3;n=mix(n,3.,clamp((t-42.)/5.,0.,1.));z=30.-fract(t);for(int i=30;i>0;i--){xyz=vec3(uv*(1.+z),z);cf=max(cf,pow(wire(-xyz.y-1.5+kf*shape(xyz+vec3(0.,0.,1.))),7.)*-uv.y*2.6);z--;};z=4.5+2.*(n-1.)/(n+1.);for(int i=18;i>0;i--){xyz=vec3(uv*(2.+z)*td,z);cm=max(cm,float(torus(xyz,kt)<.1));ct=max(ct,wire(torus(xyz,kt))/(z-2.6));z-=4./(n+1.);};cm=1.-cm;if(t>46.){xyz=normalize(vec3(uv,1.));for(int i=0;i<40;i++){d=rt(xyz*l);if(d<.001)break;l+=d;if(l>40.)break;}if(l<40.){xyz*=l;norm=normalize(vec3(rt(xyz+vec3(e,0.,0.))-rt(xyz-vec3(e,0.,0.)),rt(xyz+vec3(0.,e,0.))-rt(xyz-vec3(0.,e,0.)),rt(xyz+vec3(0.,0.,e))-rt(xyz-vec3(0.,0.,e))));cl=cm*pow((length(norm+normalize(light-xyz))-1.1)*max(1.2-length(light-xyz)/15.,0.),4.);}}e=2371.;for(int i=0;i<40;i++){n=t/15.;if(t>=47.1){n=47.1/15.+(t-47.1)/20.;}z=fract(n+r);m2=s(uv.y,z);if(m2>935.){m1=s(uv.x,z);d=fract(sin(pow(floor(m1),floor(m2)/941.))*e);if(d>.9985){d=distance(vec2(m1,m2),vec2(floor(m1)+.5,floor(m2)+.5))*2.;cs=max(cs,z*min(1.,pow(1.5-d,15.)));cs=max(cs,z*max(0.,1.-d));}}e-=.9;r+=.05;}cf*=cm;cs*=cm;cf*=clamp(t/4.-2.5,0.,1.);cs*=clamp(t-31.,0.,1.);cl+=cm*max(2.-l/20.,0.)*max(norm.z,0.);cl*=pow(clamp(t*2.-93.2,0.,1.),3.);c=vec3(cs/2.,cs*cs,sqrt(cs))+vec3(0.,cl*cl,cl)+vec3(0.,ct*ct,ct)+vec3(cf*cf/2.,0.,cf);c*=min(1.,t/4.);d=2.-clamp(t/4.-12.75,0.,2.);cf=smoothstep(1.,0.,abs(d-length(uv)));c+=vec3(0.,cf*cf,cf);d=2.-clamp(t/4.-13.5,0.,2.2);cf=smoothstep(d-.1,d+.1,length(uv));c*=1.-cf;}else{if(t<104.){m1=min(t,85.)-62.;size=31.-m1;z=fract(cos(m1*3.9)+sin(m1)*cos(m1*3.7));if(t<65.)z=3.-m1;r=length(uv)*size;cf=max(0.,.7-min(1.,r));ct=pow(r/99.*float(r<.6),.4)+(.8-r)*float(r<.02);cm=min(1.,pow(max(0.,1.25-r),8.))/(10.-z*3.)+(z*.8+.3)*min(.7,pow(max(0.,.15-r)*9.,12.));n=uv.y*size;m2=.3+.6*cos(cos(9.*(uv.x-.4)*pi+t/3.)+9.*uv.y+t/7.)-.6+.6*cos(cos(9.*uv.y*pi+t/5.)+9.*(uv.x-.4)-t/9.);cf+=clamp(m2,0.,1.)/3.*smoothstep(.1,0.,r-.4);cf=mix(cf,floor(cf*16.)/16.,max(0.,0.-n));xyz=vec3(cf+cm,cm,ct);cf=atan(abs(uv.x),uv.y);cm=clamp(pow(1.3-abs(cf),7.),0.,1.);cm+=clamp(pow(1.05-abs(.8-cf),7.),0.,1.);cm*=smoothstep(.1,0.,r-.53);cl=max(0.,n)*pow(1.-sqrt(abs(r-.55)),10.);cl+=(0.-pow(n,3.))*pow(1.-sqrt(abs(r-.5)),14.);cl*=(.5+cm/2.);cf=smoothstep(.97,.99,1.035-abs(r-.68));cf-=(1.-z/3.)*.5*float(r>.61)*smoothstep(.0,.01,.685-r);r=length(uv*vec2(.7,1.))*size;m2=1.35-fract(m1/24.);ct=0.;for(int i=1;i<4;i++){ct+=min(.8,max(0.,n)*pow(1.2-sqrt(abs(length(r-m2/float(i)))),12.))/((float(i)+.5)/1.5);}ct*=cm;cl+=ct;light=vec3(cl*.9,cl*.9,cl);norm=.4*sqrt(n+.8)*vec3(cf/2.7,cf/2.,cf/1.5);c=float(r<2.)*(xyz+light+norm);c*=min(1.,(t-62.)/4.);}}gl_FragColor=vec4(c,1.);}
		</script>

		<script type="text/javascript" src="js/index.js"></script>
	</body>
</html>