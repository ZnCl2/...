  
  


<!doctype html public "-//w3c//dtd html 4.0 transitional//de">
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="STYLESHEET" type="text/css" href="linuxmagazin.css">
</head>

<body bgcolor="white" text="Black" link="#003399" vlink="#003399" alink="Red">

<table bgcolor="#cccccc" border="0" cellpadding="0" cellspacing="0">

<tr>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Home/"><font color="#000000">Home</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Info/"><font color="#000000">Info</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td bgcolor="#4778ff" width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td bgcolor="#4778ff" width="5%"><p class="tab"><a href="/ausgabe/"><font color="#000000">Artikel</font></a></p></td>
<td bgcolor="#4778ff" width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Produkte/"><font color="#000000">Produkte</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Stickers/"><font color="#000000">Stickers</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Usergroups/"><font color="#000000">UserGroups</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Events/"><font color="#000000">Events</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
<td width="1%" valign="top"><img src="ecke_l.gif" width="15" height="21"></td>
<td width="5%"><p class="tab"><a href="/Buecher/"><font color="#000000">Bücher</font></a></p></td>
<td width="1%" valign="top" align=right><img src="ecke_r.gif" width="15" height="21"></td>
</tr>

<tr bgcolor="#000000">
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#4778ff" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
<td bgcolor="#000000" colspan="3" height="1"><img src="invis.gif" width="1" height="1"></td>
</tr>
</table>

<table WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" BGCOLOR="#4778ff">
<tr>

<td width="2%" valign="top"><br></td>

<td BGCOLOR="#4778ff" colspan=2 nowrap width="100%">
<font color="#000000">
<p class="subnav">
&nbsp;
<a href="/Home/linuxmagazin_html">Linux-Magazin |</a>
<a href="/Home/linuxuser_html">LinuxUser |</a>
<a href="/Home/linuxevents_html">Linux-Events |</a>
<a href="/Home/linuxcommunity_html">Linux-Community |</a>
<a href="/Home/perl.html">Perl Snapshots</a>
</p>
</font>
</td>
<td ALIGN="RIGHT" BGCOLOR="#4778ff" nowrap>
<form action="/search" method="get">
<div align="right" style="font-size: 12pt;">Suchen:
<INPUT TYPE="TEXT" SIZE="12" NAME="words" VALUE="" style="width:100;font:9px">
</div>
</td>

<td width="1%" valign="top"><br></td>
</tr>

<tr>
<td BGCOLOR="#003399" HEIGHT="1" COLSPAN="5"><IMG SRC="invis.gif" WIDTH="1" HEIGHT="1"></td>
</tr>

<tr>
<td BGCOLOR="#003399" HEIGHT="2" COLSPAN="5"><IMG SRC="invis.gif" WIDTH="1" HEIGHT="1"></td>
</tr>

<tr>
<td BGCOLOR="#003399" width="2%" valign="top"><br></td>


<td BGCOLOR="#003399" align=left><br>
</td>

<td BGCOLOR="#003399" width=""100% align=center>

<A HREF="banner/redirect?idBanner=3" target="_blank"><img src="bshow" alt="Linux-Community" border="0" width="468" height="60"></A>

</td>

<td BGCOLOR="#003399" align=right>
<table bgcolor="#ffdd00" border=0 cellspacing=1 cellpadding=2 width="150">
<tr>
<td align=center>
<table bgcolor=white border=0 cellspacing=0 cellpadding=2 width="100%">
<tr>
<td bgcolor="#ffdd00" nowrap>
<b><font face="arial,geneva,helvetica" color="#003399" size=+0>
<A class=news HREF="https://www.linux-magazin.de/bestellung/">Jetzt bestellen!</A></font></b>
</td>
</tr>
<tr>
<td nowrap>
<font face="arial,geneva,helvetica" color="#000000" size=-1>
<img src="bluearrow.gif" alt=">" border=0> <A HREF="/Produkte/rebellen.html">Die Software Rebellen</A><br>
<img src="bluearrow.gif" alt=">" border=0> <A HREF="/Produkte/">Jahres-CD 2000</A><BR>
</font>
</td>
</tr>
</table>
</td>
</tr>
</table>
</td>

<td BGCOLOR="#003399" width="1%" valign="top"><br></td>
</tr>

<tr>
<td BGCOLOR="#003399" HEIGHT="2" COLSPAN="5"><IMG SRC="invis.gif" WIDTH="1" HEIGHT="1"></td>
</tr>

</table>
</form>

<TABLE width="100%">
<TR>
<TD>
<H4>Postfix - der Sendmail-Ersatz?</H4>
<H1>Modular und sicher</H1>
Gregor Longariva
</TD>
<TD>
<A href="Postfix.png"><IMG src="Postfix_s.png" align="right" border="0"></A>
</TD>
</TR>
</TABLE>



<P>
<HR noshade="NOSHADE"><I>
<FONT color="#0000FF">
Täglich senden weltweit über 100 Millionen Benutzer
E-Mails. Erstaunlich ist, daß nach wie vor Eric Allman's
betagter Sendmail der am weitesten verbreitete Mail Transfer Agent ist.
Postfix hat das Zeug, Sendmail als Standard-Mailer abzulösen.
</FONT></I>
<HR noshade="NOSHADE">


<P>
<TABLE align="left" border="0" cellspacing="0" cellpadding="0"><TD valign="top"><FONT size="9"><B>
N
</B></FONT></TD><TD width="2">&nbsp;</TD></TABLE>
ahezu unüberschaubar ist die Flut von Diensten, die das Internet
mittlerweile bietet. Einer der wichtigsten Dienste bleibt jedoch das
Versenden und Empfangen von Mails. Ohne Open-Source-Tools wäre das
undenkbar - gerade Sendmail gehört zu den am weitesten verbreiteten Mail
Transfer Agents (MTA). </P>

<P> Leider ist der monolithische Sendmail alles andere als leicht zu
pflegen. In solch ein "Multifunktions-Tool" schleichen sich zwangsläufig
Fehler ein - eine neue Sicherheitslücke in Sendmail gehörte in der
Vergangenheit zu den Treppenwitzen der Internet-Geschichte schlechthin.
</P>

<P> Aber auch wenn die aktuelle Version - soweit bekannt - keine großen
Sicherheitsmängel aufweist: alleine die Konfiguration von Sendmail
schreit geradezu nach einer Alternativlösung. Das Standardwerk zu
Sendmail, das so genannte "bat book" von Bryan Costales und Eric Allman
<A href="#infos">[3]</A> umfaßt 1021 Seiten.  </P>

<P> Die beiden am häufigsten eingesetzten (freien) Alternativen zu
Sendmail sind Dan Bernsteins Qmail und Postfix von Wietse Venema. Beide
sind wie Sendmail im Quelltext frei verfügbar - Qmail unter der GPL,
Postfix unter einer von der Mozilla Public License abgeleiteten Lizenz
von IBM - und beide sind einfacher zu handhaben als das altehrwürdige
Sendmail.   </P>

<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="LEFT" valign="TOP">
<TD>
Ursprünglich hieß das Projekt "VMailer". IBMs Rechtsanwälte haben
aber herausgefunden, daß der Name zu ähnlich dem eines eingetragenen
Markenzeichens war. Wietse Venemas Antwort auf meine Frage nach dem
Namen seines Mailerprojekts: 
<PRE>
&gt; We spent several months giving names to the program. 
&gt;&nbsp; 
&gt; The IBM name polizei killed every name we thought up, and so we 
&gt; decided to change tactics. The program now has TWO names: 
&gt; IBM Secure Mailer + Postfix.
</PRE>
</TD>
</TR>
</TABLE>


<P> Wieste's Ziel bei der Entwicklung von Postfix war, ein schnelles,
einfach zu administrierendes und sicheres Programm(paket) zu entwickeln,
das so weit wie möglich zu Sendmail kompatibel sein soll. Das
Interessanteste an Postfix ist sein innerer Aufbau (siehe Grafik): es
besteht aus mehreren kleinen Programmen, die über UNIX-Domain-Sockets
kommunizieren. Auf diese Weise ist es viel einfacher, Probleme, Fehler
oder Sicherheitsmängel in den Griff zu bekommen. Beispielsweise
kommt Postfix ganz ohne setuid-M©chanismen aus. Deshalb ist es
für einen potenziellen Angreifer unmöglich, Superuser-Rechte zu
bekommen - selbst wenn er ein Sicherheitsloch von Postfix gefunden
hätte. <I>Sendmail</I> hingegen muß unter UID 0 (root) laufen, zumindest
in einer Standardinstallation und ohne größere Klimmzüge.  </P>

<P>
Ebenfalls aus Sicherheitsgründen arbeitet Postfix mit vier verschiedenen
Queues: "maildrop", "incoming", "active" und "deferred". Lokal gesendete
Mails landen in "maildrop" und werden von dort in die "incoming"-Queue
kopiert, nachdem sie regelbasiert auf Größe, Inhalt und anderes überprüft
wurden. In der "active" Queue landen die Mails, die der Queue-Manager
gerade bearbeitet und ausliefert (lokal oder remote). Nachrichten, die
Postfix nicht ausliefern kann (Dienst des Zielmailservers reagiert nicht,
keine Route, keine Netzverbindung, ...), landen in der "deferred" Queue.
Da Postfix immer nur eine Mail gleichzeitig bearbeitet und die "active"
Queue klein hält, ist es unempfindlich gegen Ressourcenknappheit. Das
Bearbeiten/Ausliefern von Mails kann also in keinem Fall, beispielsweise
wegen eines vollen Dateisystems, blockiert werden. </P>

<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dfefff">
<TD align="CENTER"><FONT size="+1">Modularer Aufbau von
	  Postfix</FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD>

<IMG src="postfix.gif"><P>

Die Grafik zeigt den modularen Aufbau von Postfix. Hierbei bedeuten:

<UL>

<LI>gelbe Ellipsen Programme </LI>

<LI>gelbe Kästen Mail-Queues oder -Dateien

<LI> blaue Kästen (Nachschlage-) Tabellen 

<LI>Programme in der umrandeten Box laufen unter der
Kontrolle des Postfix <I>master</I> Daemons.

<LI>Dateien in diesem Kasten gehören dem
	      Postfix-Mail-System.

</UL>

</TD>
</TR>
</TABLE>


<P> <I>Postfix</I> bietet zudem einige Mechanismen, empfangende,
möglicherweise ressourcenschwache Mailsysteme zu schützen. Der Autor
bezeichnet sein Mailsystem als "guten Nachbarn", der auch langsame
Systeme nicht in Bedrängnis bringt. </P>

<H3>Installation und Konfiguration </H3>

<P> <I>Postfix</I> befindet sich derzeit immer noch in der
Entwicklungsphase. So findet man auf den verschiedenen FTP-Servern
verschiedene Versionen: die offiziellen und die experimentellen Releases
(Snapshots). Operative Mailsysteme sollten nur eine offizielle Release
verwenden, auch wenn die Snapshots nach Aussagen des Autors stabil
laufen.  Nach dem Auspacken sollte ein einfaches <I>make</I> genügen,
um Postfix zu compilieren. Sollte Postfix bereits vorher für ein anderes
Betriebssystem übersetzt worden sein, etwa in einem heterogenen Netz mit
verschiedenen Unix-Systemen (siehe Kasten "Postfix-Plattformen"), löscht
<I>make tidy</I> alle betriebssystemspezifischen Einstellungen.  </P>

<P> ach dem Übersetzen folgt etwas Handarbeit. Bei Ersetzen eines
bestehenden Mailsystems (etwa Sendmail), empfiehlt sich das Anlegen
einer Sicherheitskopie der bestehenden Programme. Ein Beispiel: </P>

<PRE>
mv /usr/sbin/sendmail /usr/sbin/sendmail.OFF
mv /usr/bin/newaliases /usr/bin/newaliases.OFF 
mv /usr/bin/mailq /usr/bin/mailq.OFF 
chmod 755 /usr/sbin/sendmail.OFF /usr/bin/newaliases.OFF 
/usr/bin/mailq.OFF 
</PRE>

<P> Da Postfix nicht als "root" laufen sollte, ist es sinnvoll, einen
neuen (virtuellen) Account einzurichten - etwa mit dem Namen "postfix"
und ohne Login Shell: </P>

<P> Postfix verwaltet die Systemmailbox (etwa <I>/var/ mail</I>
oder <I>/var/spool/mail</I>) auf zwei mögliche Arten: als systemweit
schreibbares Verzeichnis, oder mittels SGID-Bit. Welche Methode sinnvoller
ist, bleibt dem Systemadministrator überlassen. Ein SGID-Bit zu vergeben,
ist immer mit Risiken verbunden. Wenn Postfix mit SETGID installiert wird,
führt das Installationsskript folgendes aus: </P>

<PRE>
chmod 1733 $QUEUE_DIRECTORY/maildrop
chmod g-s $COMMAND_DIRECTORY/postdrop
</PRE>

<P> andernfalls (nicht setgid): </P>

<PRE>
chgrp $setgid $COMMAND_DIRECTORY/postdrop
chmod g+s $COMMAND_DIRECTORY/postdrop  
chgrp $setgid $QUEUE_DIRECTORY/maildrop
chmod 1730 $QUEUE_DIRECTORY/maildrop
</PRE>

<P> Das Installationsskript installiert die einzelnen Postfix-Dateien
und ermöglicht gleichzeitig, einige Pfade interaktiv zu setzen. Diese
werden gespeichert, um bei einer Neuinstallation nicht alles nochmal
eingeben zu müssen. </P>

<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dfefff">
<TD align="CENTER" colspan="3"><FONT size="+1">Postfix-Plattformen </FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD colspan="3">
Postfix ist derzeit auf folgende Unix-Systemen erfolgreich getestet:
</TD>

<TR><TD> AIX 3.2.5 </TD><TD> AIX 4.1.x </TD><TD> AIX 4.2.0  </TD></TR>

<TR><TD> BSD/OS 2.x </TD><TD> BSD/OS 3.x </TD><TD> BSD/OS 4.x  </TD></TR>

<TR><TD> FreeBSD 2.x </TD><TD> FreeBSD 3.x </TD><TD> FreeBSD 4.x  </TD></TR>

<TR><TD> HP-UX  9.x </TD><TD> HP-UX 10.x </TD><TD> HP-UX 11.x  </TD></TR>

<TR><TD> IRIX 5.x </TD><TD> IRIX 6.x </TD><TD> Mac OS X server  </TD></TR>

<TR><TD> Linux Debian 1.3.1 </TD><TD> Linux Debian 2.x  </TD><TD> </TD></TR>

<TR><TD> Linux RedHat 4.x  </TD><TD> Linux RedHat 5.x </TD><TD> Linux RedHat 6.x </TD></TR>

<TR><TD> Linux Slackware 3.5  </TD><TD> Linux Slackware 4.0 </TD><TD> Linux Slackware 7.0
</TD></TR>

<TR><TD> Linux SuSE 5.x  </TD><TD> Linux SuSE 6.x </TD><TD> NEXTSTEP 3.x </TD></TR>

<TR><TD> NetBSD 1.x  </TD><TD> OPENSTEP 4.x </TD><TD> Digital UNIX V3 - 5 </TD></TR>

<TR><TD> OpenBSD 2.x  </TD><TD> Reliant UNIX 5.x  </TD><TD> Rhapsody 5.x  </TD></TR>

<TR><TD> SunOS 4.1.x </TD><TD> Solaris 2.4..7 </TD><TD> Ultrix 4.x </TD></TR>
</TD>
</TR>
</TABLE>


<P> Nun folgt die eigentliche (Laufzeit-) Konfiguration des
Postfix-Mailsystems. Die Konfigurationsdateien liegen alle in einem
einzigen Verzeichnis - in der Regel in <I>/etc/postfix</I>. Meistens
braucht der System- oder Mailadministrator nicht viel einzustellen. Die
Defaulteinstellungen sind entsprechend gewählt, um ein einfaches
Mailsystem abzudecken.  Sollte die Installation ein "send-only" Mailsystem
sein (etwa auf einem Client, der über einen dedizierten Mailserver die
Mails verschickt), kann Postfix einfach ohne weitere Konfigurierung
gestartet werden. Allenfalls kann man in der Datei <I>main.cf</I> den
Eintrag "smtp" auskommentieren. So verbietet man eine Verbindung von
außen per inetd/smtp auf den Rechner.   </P>

<P> Aber auch die Konfiguration eines "echten" Mailservers sollte keine
Schwierigkeiten bereiten. Lediglich folgende Einträge in der Datei
<I>/etc/postfix/main.cf</I> sind bei Bedarf anzupassen, darunter in
jedem Fall die eigene Domain:  </P>

<PRE>
myhostname = mail.softbaer.de 
inet_interfaces = $myhostname 
mydestination = $myhostname 
mydomain = softbaer.de
myorigin = $mydomain 
</PRE>

<P>
 Setzt man diese Werte nicht explizit, ermittelt Postfix die Werte
 durch Systemaufrufe - etwa den Hostnamen durch <I>gethostname(2)</I>.
 Die Variable "myorigin" setzt den rechten Teil der Absenderadresse
 (longariva@MYORIGIN) der Mails. Setzt man "myorigin" nicht, setzt
 Postfix den Hostname als Absenderadresse, etwa 
<I>longariva@mail.softbaer.de</I>. Meistens ist die Form
<I>longariva@softbaer.de</I>aerwünscht. Vorausgesetzt der MX-Eintrag im
Nameserver ist richtig gesetzt, kann man dies durch  </P>


<PRE> 
myorigin = $mydomain  
</PRE>

<P> erreichen.  Die Datei <I>/etc/postfix/main.cf</I> sowie die im
gleichen Verzeichnis liegenden Beispieldateien für weitere Konfigurationen
sind ziemlich gut kommentiert - damit sollten eventuell notwendige
Feineinstellungen ohne weiteres möglich sein. Bleibt noch anzumerken,
daß jede zugewiesene Variable an beliebiger anderer Stelle der
Konfigurationsdatei wieder verwendet werden kann: </P>

<PRE>
mydomain = domaene.de 
myorigin = $mydomain
relay_domains = $mydomain 
</PRE>

<P>
 Falls doch das eine oder andere Feintuning notwendig sein sollte,
 kann man sich auf die beiden zentralen Dateien <I>main.cf</I> und
 <I>master.cf</I> (siehe Kasten "master.cf") beschränken. Erstere
 wurde bereits besprochen, letztere dient dem Steuern der Ressourcen,
 die Postfix verbraucht. Hier kann unter anderem angegeben werden,
 wieviele Prozesse maximal gleichzeitig laufen dürfen. </P>

<P> Gestartet wird Postfix  auf zweierlei Art: einmal so, wie der gute
alte sendmail mit </P>

<PRE>
sendmail -bd -q5
</PRE>

<P> oder durch </P>

<PRE> 
postfix start 
</PRE>
<P> Dadurch daß der "alte" Aufruf funktioniert, brauchen eventuell
vorhandene <I>rc-</I> (BSD) oder <I>init.d-</I> (SystemV) Skripte nicht
angepaßt werden. </P>


<P> Beim ersten Aufruf legt das Postfix-Startup-Skript einige Dateien
und Verzeichnisse an. Dies sollte keine Probleme bereiten, sollte aber
wie bereits erwähnt nur beim ersten Start erfolgen. Sollten im laufenden
Betrieb Änderungen in den Konfigurationsdateien gemacht werden, genügt
das Kommando </P>

<PRE> 
postfix reload 
</PRE>

<P> Um die Sicherheit von postfix noch etwas zu erhöhen ist es möglich,
die einzelnen Postfix-Dämonen in einer "chroot"-Umgebung laufen zu
lassen. Beispiele dazu liegen in <I>examples/chroot-setup</I> des
Sourcebaumes. </P>

<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dfefff">
<TD align="CENTER"><FONT size="+1">Datei <I>master.cf</I></FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD>
<PRE>
# ====================================================================
# service type  private unpriv  chroot  wakeup  maxproc command + args
#                (yes)   (yes)   (yes)   (never) (50)
# ====================================================================
. . .
smtp      inet  n        -        -        -        5        smtpd
pickup    fifo  n        n        -        60       1        pickup
cleanup   unix  -        -        -        -        0        cleanup
qmgr      fifo  n        -        -        300      1        qmgr
</PRE>
</TD>
</TR>
</TABLE>


<H3>Postfix im Einsatz </H3>

<P> Auch im laufenden Betrieb ist Postfix pflegeleicht. Die wenigen
für den Mailadministrator relevanten Kommandozeilen-Utilities sind
folgende: </P>

<P>
  Das Kommando <I>postfix</I> dient zum Steuern des gesamten
  Systems. Damit kann der Administrator das Mailsystem starten oder
  herunterfahren, die Konfiguration neu laden, ohne das Mailsystem
  ganz runterfahren zu müssen. oder ähnliches. Dieses Kommando ist dem
  Superuser vorbehalten. </P>

<P>
  ähnlich Sendmails Kommando <I>newaliases</I> ist <I>postalias</I>
  für die Mail-Aliases zuständig </P>

<P>
  <I>postcat</I> zeigt in der aktuellen Postfix-Version den Inhalt der
  Queues an </P>

<P>
  <I>postconf</I> zeigt die in der Datei <I>main.cf</I> gesetzten Werte
  an. </P>

<P>
  <I>postdrop</I> wird auf solchen Systemen verwendet, die kein für alle
  schreibbares Verzeichnis für die "maildrop"-Queue haben. <I>postdrop</I>
  wird vom Kommando <I>sendmail</I> ausgeführt. </P>

<P>
  <I>postkick</I> dient als Schnittstelle zu internen
  -ommunikationskanälen, etwa für Shellskripts. </P>

<P>
  <I>postlock</I> stellt ein Postfix-kompatibles Mailbox-Locking zur
  Verfügung, etwa für Shellskripts. </P>

<P>
  <I>postlog</I> stellt für externe Programme oder Shellskripts eine
  Postfix-kompatible Logging-Funktion bereit. </P>

<P>
  <I>postmap</I> stellt in etwa dieselbe Funktion wie <I>makemap</I> zur
  Verfügung und generiert die Lookup-Tabellen, je nach System als hash
  (db) oder dbm. </P>

<P>
  <I>postsuper</I> ist das Tool, das die Mails in den verschiedenen Queues
  verschiebt. Das Postfix-Startskript führt dieses Kommando aus.  </P>

<P> &nbsp; </P>

<P> Wer den alten Sendmail gewöhnt ist, kann auch gewohnte Kommandos
wie </P>

<PRE> 
sendmail -q    
</PRE>

<P> zum Absenden der Mails in der Queue </P>

<PRE> 
sendmail -bp          
</PRE>

<P> zum Anzeigen der Mail-Queue verwenden. Außer <I>sendmail -v</I>
sollten alle gewohnten Befehle funktionieren.  Dies erleichtert den
Umstieg von Sendmail auf Postfix ungemein. </P>

<H3>Virtuelle Domains </H3>

<P> Postfix kann auch mit "virtual domains" umgehen. Das ist vor allem
für Internet Service Provider interessant. Anstatt für jede Domäne einen
eigenen Mailserver aufzubauen, kann Postfix das genauso wie Sendmail oder
Qmail übernehmen. Wer das schon einmal unter Sendmail konfiguriert hat,
wird erstaunt sein, wie einfach es ist.  Am besten verwendet man dazu
die leere Datei <I>/etc/postfix/virtual</I> aus den Beispielen. Die
Einträge sollen in etwa folgendermaßen aussehen: </P>

<PRE>
bereich.com EGAL WAS HIER STEHT
longariva@bereich.com grlongar
reimer@bereich.com reimer@softbaer.de
info@bereich.com grlongar, bnreimer, xwolf@xwolf.com
mein-zahnarzt.net Zahnarztportal
info@mein-zahnarzt.net info@softbaer.de 
</PRE>

<P> In der ersten Zeile wird die Domäne ohne Mailadresse angegeben. Der
rechte Teil spielt hier keine Rolle - als Tipp: eine kurze Erklärung
zur Domäne kann ganz hilfreich sein. Darauf folgen die EMail-Adressen,
die Postfix annehmen soll. Im rechten Teil stehen die (existierenden)
Benutzeraccounts oder externe EMail-Adressen, an die Postfix die Mail
weiterleiten soll. Postfix akzeptiert nur die hier eingetragenen Adressen.
In <I>/etc/postfix/main.cf</I> muß man die Datei noch bekannt machen,
je nach installiertem System mit db- oder dbm-Hashes: </P>

<PRE>
#virtual_maps = dbm:/etc/postfix/virtual
virtual_maps = hash:/etc/postfix/virtual
</PRE>

<P> Nach einer Änderung in der Datei sollte der Administrator nicht
vergessen, <I>postmap /etc/postfix/virtual</I> aufzurufen, um die
Hashtabelle für Postfix zu generieren.  Sollten Hosts über eine
Dialin-Verbindung die Mails an den Mailserver abschicken, kann es not-
wendig sein, die Domäne des Providers, über den der Dialin erfolgt,
zusätzlich als akzeptierte Relay-Domain einzutragen: </P>

<PRE>
relay_domains = $mydestination, einwahl.provider.de, noch.einer.de 
</PRE>

<P> Verschickt nämlich jemand von einem solchen Host aus eine Mail -
zwar mit korrekter Absenderadresse - an jemanden außerhalb einer von
Postfix verwalteten Domain, wird diese Mail nicht akzeptiert, weil
Postfix die Domäne des Hosts überprüft.  </P>

<P> Die meisten Provider bieten keine feste IP-Adresse für ihre Kunden;
damit erscheinen die Dialin-Hosts unter der Domäne des Providers. Es
sollten hier wirklich nur die allernotwendigsten Domänen oder Hosts
eingetragen wer- den! Abhilfe könnte hier das weiter unten erläuterte
"POP before SMTP" bieten.   </P>

<P> Auf die Einträge in den DNS-Server soll hier nicht weiter eingegangen
werden.  Natürlich hat es keinen Sinn, virtuelle Domänen einzurichten,
wenn der entspre- chende MX-Eintrag nicht auf den Postfix-Server
zeigt. </P>

<H3>Mail Relaying durch POP before SMTP </H3>

<P>
 Generell ist es keine gute Idee, jedem Host zu erlauben, Mails auf dem
 Server abzulegen und weiterzuschicken. Genau dies benutzen nämlich
 die Mail-Spammer, um ihre Mails zu verteilen: auf einem schlecht
 administrierten Mailserver werden Mails abgelegt. Der sichtbare Absender
 einer solchen Mail ist in der Regel eine nichtexistierende Adresse
 (das SMTP Protokoll sieht hier keine Überprüfungsmechanismen vor),
 und der oder die Empfänger sind real existierende Adressen. Die
 Mails werden zugestellt, und der Empfänger hat in der Regel keine
 Chance festzustellen, woher die Mail tatsächlich kam. Der Absender
 ist gefälscht; als Absenderhost steht der angegriffene Mailhost im
 Header. </P>

<P> Lediglich der Rechner, der den Connect zum Mailhost aufgebaut hat,
ist im Header ersichtlich. Meistens ist das ein Dialin-Account, der
einmalig für solche Aktionen verwendet und danach nie wieder benutzt
wird. Außerdem kann ein "normaler" Benutzer nichts mit den Informationen
eines Mailheaders anfangen. Somit bleiben die Absender weitgehend
anonym. Deshalb soll kein Rechner, der über das Internet erreichbar ist,
Mails relayen! </P>

<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dfefff">
<TD align="CENTER"><FONT size="+1">.procmailrc</FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD>
<PRE>
VERBOSE=off
LOGABSTRACT=none
MAILHOME=$HOME/Mail
FRIENDS=$MAILHOME/friends
SPAM=$MAILHOME/spam
WORK=$MAILHOME/work
LISTS=$MAILHOME/lists

:0
* ^From.*bnreimer@(office\.|)softbaer\.de.*
  $FRIENDS

:0
* ^(To|Cc).*info@softbaer\.de.*
  $WORK

:0
* ^(From|To|Cc).*BUGTRAQ@SECURITYFOCUS.COM.*
  $LISTS

:0
* ^Subject: .*FREE .*
  $SPAM
</PRE>
</TD>
</TR>
</TABLE>


<P> Eine Möglichkeit um auftretende Probleme zu lösen - man
will ja schließlich nicht wirklich jedem den Zugang verwehren -
ist das so genannte POP before SMTP.  SMTP bietet per se keine
Authentifizierungsmöglichkeit. Es gibt zwar einige Erweiterungen
des SMTP-Protokolls; diese muß aber auch der sendende Client
unterstützen. Deshalb wird oft folgender einfacher Trick angewandt:
Der Client (oder besser: der Benutzer) loggt sich in den POP-Server
ein und holt seine Mails ab. Dazu muß er sich Login und Paßwort
authentifizieren. Nun kann man den POP Server "aufbohren" und ihn
anweisen, den gerade eben authentifizierten Host in eine Tabelle
einzutragen. Beim Versenden von Mails schaut Postfix in dieser Tabelle
nach und gestattet das Weitersenden von Mails von eben diesem Host. Nach
einer gewissen Zeit löscht Postfix die Einträge wieder. </P>

<P> Das Paket DRAC (Dynamic Relay Authorization Control Daemon, <A href="#infos">[6]</A>) wurde ursprünglich für Sendmail entwickelt. Es
besteht aus einem Patch für den weit verbreiteten (freien) POP-Daemon
<I>qpopper</I> <A href="#infos">[7]</A> von Qualcomm und einem
Dämon. Der Patch bewirkt, daß <I>qpopper</I> sich nach erfolgreicher
Authentifizierung an den <I>dracd</I> verbindet und diesem die aktuelle
Adresse des Rechners mitteilt. Der <I>dracd</I> schreibt diese dann in
eine bestimmte Datei, die Postfix ausliest.  </P>

<P> Der dazu nötige Eintrag in <I>/etc/postfix/main.cf</I> lautet: </P>

<PRE>
smtpd_recipient_restrictions = permit_mynetworks \
check_client_access hash:/etc/postfix/client_access \
check_relay_domains
</PRE>

<P> Auch hier ist zu beachten, ob man Hashes in db- oder dbm-Form
verwendet. Den <I>dracd</I> muß man natürlich auch entsprechend
konfigurieren.   </P>

<P> Generell sollte man möglichst wenig Rechnern Zugriff gestatten;
nicht nur um sich und seine Benutzer zu schützen, sondern auch um dem
Phänomen SPAM entgegenzuwirken, das täglich Millionen von Dollar an Kosten
verursacht - irgendjemand muß ja für das Datenaufkommen zahlen! </P>

<H3>Postfix-Erweiterungen  </H3>

<P> Wegen des modularen Aufbaus von Postfix läßt sich das Paket sehr
leicht erweitern. Es ist beispielsweise sehr leicht möglich, einen
Virenscanner für einkommende Mails in Postfix einzubauen. Dazu kann es
ein externes Programm an zwei Stellen aufrufen: entweder gleich beim
Eintreffen der Mail, bevor die Mail in die Postfix-Queue übernommen wird,
oder sobald die Mail in die Systemmailbox geschrieben wird - also wenn
die Mail die Postfix-Queue wieder verläßt. In <I>/etc/postfix/main.cf</I>
ist dazu ein lokales Mailverteilprogramm aufzurufen: </P>

<PRE> 
mailbox_command = /local/bin/viruscheck
</PRE>

<P> Man sollte nicht vergessen, die Mail nach dem Check auch wirklich in
die Mailbox zu schreiben, etwa mit Procmail <A href="#infos">[8]</A>. Das
Verwenden von Procmail hat übrigens den Vorteil, daß eventuell von den
Benutzern definierte Filter automatisch verwendet werden. Das heißt, daß
eine möglicherweise vorhandene <I>.procmailrc</I> im Home-Verzeichnis
eines Benutzers automatisch verwendet wird, ohne daß der Benutzer die
Mails mittels <I>.forward</I> an Procmail weiterleitet (siehe Kasten
<I>.procmailrc</I>). Natürlich ist das nur ein sehr allgemeines Beispiel,
das auf keinen Fall die Funktion von procmail erklären kann. Es zeigt
aber, wie die Regeln auf einfachen regulären Ausdrücken basieren -
damit sollte jeder,  der etwas Perl, <I>sed</I>, <I>awk</I> oder
<I>grep</I>>beherrscht, zurechtkommen. Lesen der Man-Pages von Procmail
(<I>procmail(1)</I>, <I>procmailrc(5)</I>, <I>procmailsc(5)</I>,
<I>procmailex(5)</I>) hilft in jedem Fall weiter.  </P>

<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dfefff">
<TD align="CENTER"><FONT size="+1">Untersuchung Mailer im Internet</FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD>
Anfang April 2000 veröffentlichte Dan Bernstein,
der Autor von Qmail, in den Newsgroups
<I>comp.mail.misc</I>,
<I>comp.mail.sendmail</I>,<I>comp.security.unix</I> eine
Untersuchung über die Anteile der verschiedenen Mailer
im Netz. Dazu schaute er sich 1/256 aller "second
level" <I>.com</I>-Domains an, insgesamt 12595
IP-Adressen, und bekam in 11460 Fällen Kontakt auf dem
SMTP-Port. Für die Verhältnisse in Europa mag diese
Untersuchung wenig relevant sein, sie gestattet aber
trotzdem einen gewissen Einblick.

Einige Details der Untersuchung: 

<UL>
<LI>Unix ist mit einem Anteil von 65% das
meistgebräuchliche Betriebssystem; etwa 22% der Hosts
sind Windows, und bei zirka 8% ist keine eindeutige
Aussage möglich. 

<LI>Sendmail, Inc. spricht auf seiner Webseite von einem
Marktanteil von "über 75 Prozent", diese Zahl ist aber
schon ein paar Jahre alt. 

<LI>die meisten gefundenen Sendmail-Versionen sind
bekanntermaßen fehlerhaft; in einigen Fällen kann man
sich hierüber unautorisierten Zugriff verschaffen. Die
wenigsten Server haben eine aktuelle
Sendmail-Version. Offenbar nehmen die meisten
Sendmail-Nutzer, was gerade auf einem System
installiert ist. 
</UL>

<P>Die "Markt"-Anteile im einzelnen:

<TABLE border="1" width="100%">

<TR><TH>Anteil %</TH><TH>Anzahl </TH><TH> Mailer</TH><TR>
<TR><TD>54.5   </TD><TD>6247     </TD><TD>UNIX Sendmail</TD></TR>
<TR><TD>9.2    </TD><TD>1057     </TD><TD>Windows Ipswitch IMail</TD></TR>
<TR><TD>5.7    </TD><TD>650      </TD><TD>Windows Microsoft Exchange</TD></TR>
<TR><TD>5.3    </TD><TD>607      </TD><TD>UNIX qmail</TD></TR>
<TR><TD>4.1    </TD><TD>472      </TD><TD>UNIX/Windows Software.com Post.Office</TD></TR>
<TR><TD>       </TD><TD>294      </TD><TD>unsicher</TD></TR>
<TR><TD>       </TD><TD>231      </TD><TD>UNIX Exim</TD></TR>
<TR><TD>       </TD><TD>168      </TD><TD>Windows Gordano NTMail</TD></TR>
<TR><TD>       </TD><TD>148      </TD><TD>UNIX/Windows Netscape Messaging Server</TD></TR>
<TR><TD>       </TD><TD>134      </TD><TD>MacOS Eudora Internet Mail Server, früher AIMS</TD></TR>
<TR><TD>       </TD><TD>122      </TD><TD>UNIX IBM Postfix, früher VMailer</TD></TR>
</TABLE>


</TD>
</TR>
</TABLE>


<P> Die Möglichkeiten, externe Programme in Postfix einzubinden, sind sehr
vielfältig. Beispielsweise könnte der Administrator eine automatische
Ver/Entschlüsselung von Mails vom Firmensitz zu einer Außenstelle
implementieren, damit sie "unterwegs" nicht lesûar sind. Außerdem kann
ein SPAM-Filter an zentraler Stelle eingebaut werden. Ein solcher
ist wesentlich einfacher zu verwalten als Procmail-Filter für jeden
einzelnen Benutzer.  Der Fantasie der Mailadministratoren sind (fast)
keine Grenzen gesetzt.  <I>(hmi)</I> </P> 


<A name="infos">
<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dfefff">
<TD align="CENTER"><FONT size="+1">Infos</FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD>
<br>
[1] Wietse Venema's postfix, <A href="http://www.postfix.org">http://www.postfix.org</A>

<BR> [2] Eric Allman's sendmail, <A href="http://www.sendmail.org">http://www.sendmail.org</A>

<BR> [3] Bryan Costales, Eric Allman sendmail, 2nd Edition O'Reilly, 1997

<BR> [4] Dan Bernstein's qmail, <A href="http://www.qmail.org/top.html">http://www.qmail.org/top.html</A>

<BR> [5] postfix download sites, <A href="http://www.postfix.org/ftp-sites.html">http://www.postfix.org/ftp-sites.html</A>

<BR> [6]  Dynamic Relay Authorization Control Daemon,
http://www.mbnet.mb.ca/howto/ dynamic.htm

<BR> [7] Qpopper - POP3 Daemon, <A href="http://www.eudora.com/qpopper">http://www.eudora.com/qpopper</A>

<BR> [8] procmail, <A href="http://www.procmail.org">http://www.procmail.org</A>
</TD>
</TR>
</TABLE>

<P>
<TABLE border="1" cellspacing="0" cellpadding="0" width="100%">
<TR align="CENTER" bgcolor="#dddddd">
<TD align="CENTER"><FONT size="+1">Der Autor </FONT>
</TD>
</TR>
<TR align="LEFT" valign="TOP">
<TD>
<br>
 Gregor Longariva studierte Informatik an der Uni Erlangen. Während
des Studiums gründete er die Firma SOFTbaer, die sich in erster Linie
mit dem Thema Sicherheit und Netzwerkadministration auf Unix-Basis
beschäftigt. Nebenbei ist er noch als Administrator des CIP-Pools der
Informatik an der Uni Erlangen tätig und beschäftigt sich neben HPUX
und Irix vor allem mit Solaris und Linux.
</TD>
</TR>
</TABLE>

<P>
Copyright &copy; 2000 Linux New Media AG

</tr>
</table>
</body>
</html>
