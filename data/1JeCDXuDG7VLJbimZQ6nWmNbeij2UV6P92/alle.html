<!DOCTYPE html>

<html>
<head>
 <title>INCANTATA</title>
 <meta charset="utf-8">
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <link rel="stylesheet" href="css/all.css" />
 <base href="" target="_top" id="base">
 <script>base.href = document.location.href.replace("/media", "").replace("index.html", "").replace(/[&?]wrapper=False/, "").replace(/[&?]wrapper_nonce=[A-Za-z0-9]+/, "")</script>
</head>
<body>

<script type="text/javascript" src="js/ZeroFrame.js"></script>
<script type="text/javascript" src="js/incantata_functions.js"></script>
<script>
class Page extends ZeroFrame {
  setSiteInfo(site_info) {
    var out = document.getElementById("out")
    //out.innerHTML =
      "Page address: " + site_info.address +
      "<br>- Peers: " + site_info.peers +
      "<br>- Size: " + site_info.settings.size +
      "<br>- Modified: " + (new Date(site_info.content.modified*1000))
  }


  onOpenWebsocket() {
    this.cmd("siteInfo", [], function(site_info) {
      page.setSiteInfo(site_info)
    })
    this.dump_all_cards_vert()
    this.loadCards_byid()
  }

  onRequest(cmd, message) {
    if (cmd == "setSiteInfo")
      this.setSiteInfo(message.params)
    else
      this.log("Unknown incoming message:", cmd)
  }
}
page = new Page()

function increase(id){
  var o=document.getElementById("card_counter_"+id)
  o.innerHTML=parseInt(o.innerHTML)+1;
  o=document.getElementById("pressme")
  o.style.backgroundColor="#e9df9a"
  o=document.getElementById("counter")
  o.innerHTML=parseInt(o.innerHTML)+1
}
function decrease(id){
  var o=document.getElementById("card_counter_"+id)
  if (parseInt(o.innerHTML)>0){
    o.innerHTML=parseInt(o.innerHTML)-1;
    o=document.getElementById("pressme")
    o.style.backgroundColor="#e9df9a"
    o=document.getElementById("counter")
    o.innerHTML=parseInt(o.innerHTML)-1
    if(parseInt(o.innerHTML)<1){
      o=document.getElementById("pressme")
      o.style.backgroundColor="#cccccc"
    }
  }
}
function generate_print_pages(){
  var how_many,ct;
  var longest_chain=0;
  var best_card=842;
  var abbruch=0;
  var o;
  var buffer="";
  var bufarray=[];
  var c=document.getElementById("print_div")
  c.innerHTML=""
  for(var l=1; l<841; l++){
    o=document.getElementById('card_counter_' + l.toString())
    if(o)how_many=parseInt(o.innerHTML);
    if(o && how_many>0){
      if(abbruch==0){
        longest_chain=l;
      }
      if(best_card>l)best_card=l;
      for(var z=1; z<= how_many; z++){
        bufarray.push(l.toString());
      }
    }else{
      if(o) abbruch=1;
    }
  }
  if(bufarray.length==0)c.innerHTML="Nenio elektita!";
  else{
    for(l=0;l<Math.ceil(bufarray.length/9);l++){
      buffer=""
      if (l*9+9 < bufarray.length)ct=l*9+9;
      else ct=bufarray.length;
      for(var i=l*9;i<ct;i++){
        buffer+=","+bufarray[i]
      }
      c.innerHTML+='<a href="druck.html?ids=' + buffer.substring(1) + '">druck.html?ids='+buffer.substring(1)+'</a><br>';
    }
    if (window.location.search.substring(1).search("krypto")>0){
      o=document.getElementById("rank")
      var rank=Math.ceil((842 - best_card + longest_chain)/2)
      o.innerHTML='&nbsp;&nbsp;<b>Kryptomagierstufe: ' + rank+'</b>'
    }
    o=document.getElementById("pressme")
    o.style.backgroundColor="#cccccc"
  }
}
function erase_all(){
  var c=document.getElementById("print_div")
  c.innerHTML=""
  for(var l=1; l<841; l++){
    o=document.getElementById('card_counter_' + l.toString())
    if(o)o.innerHTML=0;
  }
  o=document.getElementById("pressme")
  o.style.backgroundColor="#cccccc"
  o=document.getElementById("counter")
  o.innerHTML=0
}
</script>
<div class="headline" style="height: 26px;"><span style="margin-right: 10px;" class="headelement" title="Incantata"><a href="index.html" style="text-decoration:none"><img style="vertical-align: middle;" src="img/flag_incantata.gif"></img>Incantata</a></span><span id="pressme" class="clickable" style="margin-right: 10px;" onClick="generate_print_pages()"> &nbsp; ðŸ–¶ &nbsp; </span><span class="clickable" onClick="erase_all()" style="margin-right: 10px;"> &nbsp; âŒ« &nbsp; </span><span class="headelement" style="margin-right: 10px;"> &nbsp; â˜‘ &nbsp; <span id="counter">0</span></span><span id="rank"></span></div>

<div id="print_div"></div>
<div id="card_dump"></div>
</body>
</html>
