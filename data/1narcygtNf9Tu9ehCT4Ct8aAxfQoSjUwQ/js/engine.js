"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Attachment=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"shortName",value:function(){var e=this.state.data.attachment;if(e.length>25){var t=e.split(".");e=(e=t.slice(0,t.length-1).join(".")).slice(0,23)+"...."+t[t.length-1]}return e}},{key:"onImageLoad",value:function(){console.log("loaded"),this.setState({loaded:!0})}},{key:"render",value:function(){var e={opacity:0};return 1==this.state.loaded&&(e={opacity:1}),React.createElement("div",{className:"attachment"},React.createElement("div",{className:"attachment-info"},"File: ",Helpers.formatSizeUnits(this.state.data.attachment_size),", ",this.state.data.attachment_full_width,"x",this.state.data.attachment_full_height,", ",React.createElement("a",{href:this.state.data.attachment_full_path,download:this.state.data.attachment,target:"_blank"},this.shortName())),React.createElement("div",{className:"image-loading",style:{width:this.state.data.attachment_thumb_width+"px",height:this.state.data.attachment_thumb_height+"px"}},React.createElement("br",null),React.createElement("br",null),"image loading..."),React.createElement("a",{href:this.state.data.attachment_full_path,target:"_blank"},React.createElement("img",{width:this.state.data.attachment_thumb_width,height:this.state.data.attachment_thumb_height,src:this.state.data.attachment_thumb_path,style:e,onLoad:this.onImageLoad.bind(this)})))}}]),t}(React.Component),AttachmentOld=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"attachment"},React.createElement("a",{href:this.props.urlFull,target:"_blank"},React.createElement("img",{src:this.props.urlThumb})))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),AuthForm=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"showAuthDialog",value:function(){Nullchan.cmd("certSelect",[["zeroid.bit"]])}},{key:"handleChange",value:function(e){if("other"==e.currentTarget.value)return this.showAuthDialog(),e.preventDefault(),void(e.currentTarget.value="anonymous")}},{key:"render",value:function(){var e;return e=this.state.userName?React.createElement("div",null,React.createElement("select",{name:"name",className:"name",onChange:this.handleChange.bind(this),defaultValue:"anonymous"},React.createElement("option",{value:"anonymous"},"Anonymous"),React.createElement("option",{value:"signed"},this.state.userName),React.createElement("option",{value:"other"},"select other...")),React.createElement("input",{type:"submit",value:"Submit!",className:"submit"})):React.createElement("div",{className:"auth-please",onClick:this.showAuthDialog},React.createElement("u",null,"Authorize")," to post messages.",React.createElement("br",null),"You will still be able to post anonymously."),React.createElement("div",{className:"auth-form"},e)}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),BoardPage=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.threadMap={},n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t="",n=null,r="create new thread";return"thread"==Nullchan.currentPage&&(r="reply to this thread",n=this.props.threads[0][0].hashsum),t=this.props.threads?this.props.threads.map(function(t){return React.createElement(Thread,{ref:function(n){return e.threadMap[t[0].hashsum]=n},key:t[0].hashsum,posts:t,full:"thread"==Nullchan.currentPage})}):React.createElement("div",{id:"empty-board"},"It looks like this board is empty. ",React.createElement("br",null)," Why don't you post something?"),React.createElement("div",{id:"board-page"},React.createElement(FormButton,{text:r,hidden:this.state.formShown}),React.createElement(Form,{hidden:!this.state.formShown,ref:function(t){return e.rForm=t},parent:n}),React.createElement("hr",null),t)}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Form=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"called",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._textarea.focus(),e&&(this._textarea.value=this._textarea.value+e)}},{key:"showBlur",value:function(){View.formBlurred=!0,this._node.className="form loading"}},{key:"hideBlur",value:function(){View.formBlurred=!1,this._node.className="form"}},{key:"clear",value:function(){this._node.reset()}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var n=this.collectFormData();0!=n?(this.showBlur(),Images.process(n).then(function(e){Files.uploadPost(e).then(function(e){t.hideBlur(),t.clear(),SeenCount.setLocalCounter(Nullchan.currentBoard.key,!0),t.state.parent?(View.postWithReplyForm&&(View.postWithReplyForm.setState({showForm:!1}),View.postWithReplyForm=null),Threads.appendPost(e),setTimeout(function(){SeenCount.setLocalCounter(Nullchan.currentBoard.key)},2e3)):(View.rBoardPage.setState({formShown:!1}),Nullchan.determineRoute())})}).catch(function(e){alert(e),t.hideBlur()})):this.hideBlur()}},{key:"collectFormData",value:function(){var e={body:this._node.getElementsByClassName("text")[0].value.trim(),file:this._node.getElementsByClassName("file")[0].files[0],created_at:Helpers.unixTimestamp(),parent:this._node.getElementsByClassName("parent")[0].value};e.parent||(e.parent=null);var t=this._node.getElementsByClassName("name")[0];return e.anonymous="anonymous"==t.options[t.selectedIndex].value,e.file||""!=e.body?e:(alert("Your post is empty"),!1)}},{key:"render",value:function(){var e=this,t="block",n="top-form";return 1==this.props.hidden&&(t="none"),1==this.props.isReply&&(n="reply-form"),React.createElement("form",{id:n,className:"form",style:{display:t},onSubmit:this.handleSubmit.bind(this),ref:function(t){return e._node=t}},React.createElement("div",{className:"form-preloader"},React.createElement("span",null,"sending your message...")),React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,"Comment"),React.createElement("td",null,React.createElement("textarea",{placeholder:"Up to 3000 symbols, required if no file attached",name:"body",className:"text",ref:function(t){return e._textarea=t}}),React.createElement("input",{type:"hidden",name:"parent",className:"parent",value:this.state.parent}))),React.createElement("tr",null,React.createElement("td",null,"File"),React.createElement("td",null,React.createElement("input",{type:"file",name:"file",className:"file"}))),React.createElement("tr",null,React.createElement("td",null,"Sign as"),React.createElement("td",null,React.createElement(AuthForm,{ref:function(e){return View.rAuthForm=e},userName:Nullchan.shortUserName()}))))))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),FormButton=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleClick",value:function(e){View.rBoardPage.setState({formShown:!0},function(){View.rBoardPage.rForm.called()})}},{key:"render",value:function(){var e="block";return 1==this.props.hidden&&(e="none"),React.createElement("div",{id:"form-call-button",style:{display:e},onClick:this.handleClick},"[ ",React.createElement("span",{className:"text"},this.props.text)," ]")}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Header=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return this.link=React.createElement(BoardLink,{boardKey:this.state.board.key,boardName:this.state.board.name}),React.createElement("div",null,this.link,React.createElement("div",{id:"stats"},this.state.siteInfo.settings.peers," peers, ",Helpers.formatSizeUnits(this.state.siteInfo.settings.size)))}}]),t}(React.Component),BoardLink=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="none";return this.props.boardName&&(e="inline-block"),React.createElement("span",{style:{display:e}},React.createElement("a",{href:Helpers.fixLink("?/"+this.props.boardKey+"/"),className:"board-name",target:"_parent"},this.props.boardName)," on ",React.createElement("a",{href:Helpers.fixLink("/0chan.bit"),target:"_parent",id:"nullchan-link",className:"to-main"},"0chan.bit"))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),BoardLine=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="";return this.props.data.unread>0&&(e="+"+this.props.data.unread),React.createElement("tr",null,React.createElement("td",{className:"unread"},e),React.createElement("td",null,React.createElement("a",{href:Helpers.fixLink("?/"+this.props.data.key+"/")},this.props.data.name)))}}]),t}(React.Component),MainPage=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{id:"glagne",key:"mainpage"},React.createElement("pre",{id:"logo"},React.createElement("code",null,"\n  /$$$$$$            /$$                          \n /$$$_  $$          | $$                          \n| $$$$\\ $$  /$$$$$$$| $$$$$$$   /$$$$$$  /$$$$$$$ \n| $$ $$ $$ /$$_____/| $$__  $$ |____  $$| $$__  $$\n| $$\\ $$$$| $$      | $$  \\ $$  /$$$$$$$| $$  \\ $$\n| $$ \\ $$$| $$      | $$  | $$ /$$__  $$| $$  | $$\n|  $$$$$$/|  $$$$$$$| $$  | $$|  $$$$$$$| $$  | $$\n \\______/  \\_______/|__/  |__/ \\_______/|__/  |__/\n          ")),React.createElement("hr",null),React.createElement("blockquote",{className:"monospace"},"fork me on ",React.createElement("a",{href:"https://github.com/Nullchan/nullchan",target:"_parent"},"GitHub")," (v ",VERSION,")"),React.createElement("hr",null),React.createElement("div",{className:"inner"},React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"board-list-container"},React.createElement("table",{id:"board-list"},React.createElement("tbody",null,this.state.boards.map(function(e){return React.createElement(BoardLine,{key:e.key,data:e})}))),React.createElement("span",null,"last post: ",React.createElement("em",{id:"last-post"},this.state.lastPostTime))),React.createElement("td",null,React.createElement("blockquote",null,React.createElement("strong",null,"0chan")," is a p2p imageboard engine",React.createElement("br",null),"currently in development.",React.createElement("br",null),React.createElement("br",null),"This site is basically just a tech demo which misses a lot of crucial features, but it will get better with time.",React.createElement("br",null),React.createElement("br",null),React.createElement("hr",null),React.createElement("span",null,React.createElement("em",null,"Current development status:"),"Investigating image processing errors, writing pagination (16.02.2016)"),React.createElement("br",null)," ")))))),React.createElement("hr",null),React.createElement("blockquote",{className:"monospace"},"message me on ",React.createElement("a",{href:Helpers.fixLink("/Mail.ZeroNetwork.bit/?to=sthetz"),target:"_parent"},"ZeroMail")))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),NotFound=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{id:"not-found"},React.createElement("h1",null,"Nothing found."),React.createElement("a",{target:"_parent",href:Helpers.fixLink("/0chan.bit")},"return to index"))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Post=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"shortHashsum",value:function(){return this.state.data.hashsum.substring(22,32)}},{key:"userName",value:function(){return Nullchan.shortUserName(this.state.data.cert_user_id)}},{key:"formattedTime",value:function(){return Helpers.timeSince(this.state.data.created_at)}},{key:"renderMarkup",value:function(){return{__html:Markup.render(this.state.data.body)}}},{key:"bodyClick",value:function(e){if("reflink"==e.target.className){var t=e.target.innerHTML.substring(8),n=Threads.shortMap[t];if(n){var r=document.getElementById("post-"+n.hashsum);r&&(e.preventDefault(),r.scrollIntoView())}}}},{key:"callForm",value:function(){var e=this;View.formBlurred||(View.postWithReplyForm&&View.postWithReplyForm.setState({showForm:!1}),View.postWithReplyForm=this,this.setState({showForm:!0},function(){View.rReplyForm.called(">>"+e.shortHashsum()+"\n")}))}},{key:"render",value:function(){var e="post",t="",n="",r="",a="",o="info";return this.state.data.parent?e+=" reply":(e+=" opening","list"==Nullchan.currentPage&&(t=React.createElement("a",{target:"_parent",className:"thread-link",href:Helpers.fixLink("?/"+this.state.data.board+"/thread/"+this.state.data.hashsum)},"[ ",React.createElement("span",{className:"highlighted"},"open thread")," ]"))),this.state.data.attachment?(o+=" with-file",n=React.createElement(Attachment,{data:this.state.data})):this.state.data.file_thumb&&(n=React.createElement(AttachmentOld,{urlFull:this.state.data.file_full,urlThumb:this.state.data.file_thumb})),1==this.state.showForm&&(r=React.createElement(Form,{hidden:!1,ref:function(e){return View.rReplyForm=e},isReply:!0,parent:this.state.data.parent||this.state.data.hashsum})),this.state.data.anonymous&&(a="anonymous"),React.createElement("div",{className:"post-wrapper"},React.createElement("div",{className:e,"data-hashsum":this.state.data.hashsum,id:"post-"+this.state.data.hashsum},React.createElement("div",{className:o},React.createElement("div",{className:"time-and-id"},React.createElement("strong",{className:a},this.state.data.anonymous?"Anonymous":""+this.userName())," wrote ",this.formattedTime(),",  ",React.createElement("em",{className:"post-id",onClick:this.callForm.bind(this)},"#",this.shortHashsum())),t),n,React.createElement("blockquote",{className:"text",onClick:this.bodyClick,dangerouslySetInnerHTML:this.renderMarkup()})),r)}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SkipGap=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleClick",value:function(){View.rBoardPage.threadMap[this.props.parent].setState({full:!0})}},{key:"render",value:function(){return React.createElement("div",{className:"skip-gap",onClick:this.handleClick.bind(this)},this.props.count," post(s) omitted. ↕ ",React.createElement("span",{className:"expand-button"},"expand"))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Thread=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="",t=1;if(0==this.state.full){var n=this.state.posts.length-6;n>0&&(e=React.createElement(SkipGap,{count:n,parent:this.state.posts[0].hashsum}),t=this.state.posts.length-5)}return React.createElement("div",{id:"thread-"+this.state.posts[0].hashsum,className:"thread"},React.createElement(Post,{data:this.state.posts[0]}),e,this.state.posts.slice(t,this.state.posts.length).map(function(e){return React.createElement(Post,{data:e,key:e.hashsum})}))}}]),t}(React.Component),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Boards=function(){function e(){_classCallCheck(this,e),this._list=[]}return _createClass(e,[{key:"list",get:function(){return this._list}}]),_createClass(e,[{key:"getByKey",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=this.list[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(i.key==e)return i}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return null}},{key:"reload",value:function(){var e=this;return new Promise(function(t){Nullchan.cmd("fileGet","data/boards.json",function(n){e._list=JSON.parse(n).boards,SeenCount.getUnread().then(function(n){for(var r in e.list)e._list[r].unread=n[e.list[r].key];t()})})})}}]),e}();window.Boards=new Boards;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Database=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"execute",value:function(e){return new Promise(function(t){Nullchan.cmd("dbQuery",e.trim(),function(e){t(e)})})}},{key:"getLastPost",value:function(){var e=this;return new Promise(function(t){e.execute("\n        SELECT message.* FROM message\n        ORDER BY message.created_at DESC LIMIT 1\n      ").then(function(e){t(e[0])})})}},{key:"getMessageCountByBoard",value:function(){var e=this;return new Promise(function(t){e.execute("SELECT message.board, COUNT(*) FROM message GROUP BY board").then(function(e){var n={},r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value;n[l.board]=l["COUNT(*)"]}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}t(n)})})}},{key:"loadSingleThread",value:function(e,t){var n=this;return new Promise(function(r){var a="\n        SELECT message.*, keyvalue.value AS cert_user_id FROM message\n        LEFT JOIN json AS data_json USING (json_id)\n        LEFT JOIN json AS content_json ON (\n          data_json.directory = content_json.directory AND content_json.file_name = 'content.json'\n        )\n        LEFT JOIN keyvalue ON (keyvalue.key = 'cert_user_id' AND keyvalue.json_id = content_json.json_id)\n        WHERE message.board = '"+e+"' AND\n        (message.hashsum = '"+t+"' OR message.parent = '"+t+"')\n        ORDER BY message.created_at ASC\n      ";n.execute(a).then(function(e){r(e)})})}},{key:"loadMessagesOnBoard",value:function(e){var t=this;return new Promise(function(n){var r="\n        SELECT message.*, keyvalue.value AS cert_user_id FROM message\n        LEFT JOIN json AS data_json USING (json_id)\n        LEFT JOIN json AS content_json ON (\n          data_json.directory = content_json.directory AND content_json.file_name = 'content.json'\n        )\n        LEFT JOIN keyvalue ON (keyvalue.key = 'cert_user_id' AND keyvalue.json_id = content_json.json_id)\n        WHERE message.board = '"+e+"'\n      ";t.execute(r).then(function(e){n(e)})})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Files=function(){function e(){_classCallCheck(this,e),this.optionalOK=!1}return _createClass(e,[{key:"path",value:function(e){return"data/users/"+Nullchan.siteInfo.auth_address+"/"+e}},{key:"checkIfOptionalOK",value:function(){var e=this;return new Promise(function(t){if(1!=e.optionalOK){var n={inner_path:e.path("content.json"),required:!1};Nullchan.cmd("fileGet",n,function(n){n?".*\\.(png|jpg|gif)"==JSON.parse(n).optional?e.setOptional(n).then(function(){t()}):(e.optionalOK=!0,t()):e.publishBasicContentJson().then(function(n){e.setOptional(n).then(function(){t()})})})}else t()})}},{key:"publishBasicContentJson",value:function(){var e=this;return new Promise(function(t){var n=e.path("test.txt");Nullchan.cmd("fileWrite",[n,btoa("fuck this")],function(r){Nullchan.cmd("siteSign",{inner_path:n},function(n){Nullchan.cmd("fileGet",e.path("content.json"),function(e){t(e)})})})})}},{key:"setOptional",value:function(e){var t=this;return new Promise(function(n){var r=t.path("content.json"),a=JSON.parse(e);a.optional=".*\\.(png|jpg|gif)";var o=unescape(encodeURIComponent(JSON.stringify(a,void 0,"\t")));Nullchan.cmd("fileWrite",[r,btoa(o)],function(e){"ok"!=e&&(alert(JSON.stringify(e)),alert("Sorry, still testing this one")),Nullchan.cmd("siteSign",{inner_path:r},function(e){t.optionalOK=!0,n()})})})}},{key:"uploadFile",value:function(e,t,n){var r=this;return new Promise(function(a,o){r.checkIfOptionalOK().then(function(){var i=r.path(t);Nullchan.cmd("fileWrite",[i,e],function(e){"ok"==e?0==n?a(i):Nullchan.cmd("sitePublish",{inner_path:i},function(e){"ok"==e?a(i):o(e)}):o(e)})})})}},{key:"uploadPost",value:function(e){var t=this;return new Promise(function(n,r){Nullchan.cmd("fileGet",{inner_path:t.path("data.json"),required:!1},function(a){if(a)try{a=JSON.parse(a)}catch(e){a={message:[]}}else a={message:[]};e.hashsum=md5(JSON.stringify(e)),e.board=Nullchan.currentBoard.key,a.message.push(e);var o=unescape(encodeURIComponent(JSON.stringify(a,void 0,"  ")));t.uploadFile(btoa(o),"data.json",!0).then(function(){n(e)}).catch(function(e){r(e)})})})}}]),e}();window.Files=new Files;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Images=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"process",value:function(e){return new Promise(function(t,n){if(!e.file)return delete e.file,t(e);if(-1!=["image/jpeg","image/png","image/jpg"].indexOf(e.file.type)){var r=document.createElement("img"),a=new FileReader;a.onload=function(e){r.src=e.target.result},r.onload=function(){var n=document.createElement("canvas"),a=n.getContext("2d");n.width=r.width,n.height=r.height,a.drawImage(r,0,0,r.width,r.height);var o=n.toDataURL(e.file.type,1).split(",")[1],i=r.width,s=r.height;e.attachment=e.file.name.trim(),e.attachment_size=e.file.size,e.attachment_full_height=s,e.attachment_full_width=i,i>s?i>200&&(s*=200/i,i=200):s>200&&(i*=200/s,s=200),n.width=i,n.height=s,e.attachment_thumb_height=s,e.attachment_thumb_width=i,(a=n.getContext("2d")).drawImage(r,0,0,i,s);var l=n.toDataURL("image/jpeg",1).split(",")[1],c=md5(o);""==e.attachment&&(e.attachment=c+".jpg"),Files.uploadFile(o,c+".jpg",!1).then(function(n){Files.uploadFile(l,c+"-thumb.jpg",!1).then(function(r){e.attachment_thumb_path=r,e.attachment_full_path=n,delete e.file,t(e)})})},a.readAsDataURL(e.file)}else n("Only JPEG and PNG files are supported at the moment.")})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Markup=function(){function e(){_classCallCheck(this,e),this.entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},this.expressions=[[/&gt;&gt;(\w+)/gm,function(e,t){var n=Threads.shortMap[t];if(!n)return e;var r=n.parent||n.hashsum;return'<a class="reflink" href="'+Helpers.fixLink("/0chan.bit/?/"+n.board+"/thread/"+r+"/"+t)+'">&gt;&gt;'+t+"</a>"}],[/^\s*&gt;\s{0,1}(.+?)$/gm,function(e,t){var n="";return"\n"==e[0]&&(n="<br />"),n+"<em class='quote'>&gt; "+t+"</em>"}],[/\*\*([\s\S]+?)\*\*/gm,'<em class="bold">$1</em>'],[/\*([\s\S]+?)\*/gm,'<em class="italic">$1</em>'],[/(^|\s|\A)__([\s\S]+?)__(\s|\z|$)/gm,'$1<em class="underline">$2</em>$3'],[/\^([\s\S]+?)\^/gm,function(e,t){return t.match(/^_+$/)?e:"<em class='strike'>"+t+"</em>"}],[/%%([\s\S]+?)%%/gm,'<em class="spoiler">$1</em>'],[/\r?\n/gm,"\n"],[/\n/gm,"<hr/>"],[/(<hr\/>){2,}/gm,"<hr/><hr/>"]]}return _createClass(e,[{key:"render",value:function(e){e=(e=this.escapeHTML(e).trim()).replace(URL_REGEXP,function(e,t){if(e.match("@")||!e.startsWith("http"))return e;var n=e;return n.length>50&&(n=n.substring(0,50)+"..."),n=n.replace("&amp;","&"),"<a href='"+(e=e.replace("&amp;","&"))+"' target='_parent' data-no-push='true'>"+n+"</a>"});var t=!0,n=!1,r=void 0;try{for(var a,o=this.expressions[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;e=e.replace(i[0],i[1])}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e}},{key:"escapeHTML",value:function(e){var t=this;return String(e.trim()).replace(/[&<>"']/g,function(e){return t.entityMap[e]})}}]),e}();window.Markup=new Markup;var _slicedToArray=function(){function e(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SeenCount=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getActualCounter",value:function(){var e=this;return new Promise(function(t){e.actualCounter?t(e.actualCounter):e.updateActualCounter().then(function(){t(e.actualCounter)})})}},{key:"updateActualCounter",value:function(){var e=this;return new Promise(function(t){Database.getMessageCountByBoard().then(function(n){e._actualCounter=n,t()})})}},{key:"setLocalCounter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Promise.all([this.getActualCounter(),this.getLocalCounter()]).then(function(n){var r=_slicedToArray(n,2),a=r[0],o=r[1],i={};o[e]=a[e],t&&(o[e]=o[e]+1);var s=!0,l=!1,c=void 0;try{for(var u,h=Boards.list[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var f=u.value;i["msg_"+f.key]=o[f.key]||0}}catch(e){l=!0,c=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw c}}Nullchan.cmd("wrapperSetLocalStorage",i)})}},{key:"getLocalCounter",value:function(){return new Promise(function(e){Nullchan.cmd("wrapperGetLocalStorage",[],function(t){t||(t={});var n={},r=!0,a=!1,o=void 0;try{for(var i,s=Boards.list[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value;n[l.key]=t["msg_"+l.key]||0}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}e(n)})})}},{key:"getUnread",value:function(){var e=this;return new Promise(function(t){Promise.all([e.getActualCounter(),e.getLocalCounter()]).then(function(e){var n=_slicedToArray(e,2),r=n[0],a=n[1],o={},i=!0,s=!1,l=void 0;try{for(var c,u=Boards.list[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var h=c.value;a[h.key]>0?o[h.key]=r[h.key]-a[h.key]:o[h.key]=0}}catch(e){s=!0,l=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw l}}t(o)})})}},{key:"actualCounter",get:function(){return this._actualCounter}}]),e}();window.SeenCount=new SeenCount;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Threads=function(){function e(){_classCallCheck(this,e),this._shortMap={},this._cachedPosts={}}return _createClass(e,[{key:"cachedPosts",get:function(){return this._cachedPosts}},{key:"shortMap",get:function(){return this._shortMap}},{key:"lastPostTime",get:function(){return this._lastPost?Helpers.timeSince(this._lastPost.created_at):"N/A"}}]),_createClass(e,[{key:"updateLastPost",value:function(){var e=this;return new Promise(function(t){Database.getLastPost().then(function(n){e._lastPost=n,t()})})}},{key:"loadSingle",value:function(e){var t=this;return new Promise(function(n){Database.loadSingleThread(Nullchan.currentBoard.key,e).then(function(e){n(t.buildThreads(e))})})}},{key:"buildThreads",value:function(e){var t={},n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value;this._shortMap[l.hashsum.substring(22,32)]=l;var c=l.parent||l.hashsum;t[c]||(t[c]={opening:null,replies:[]}),null==l.parent?t[c].opening=l:t[c].replies.push(l)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}this._cachedPosts=t;for(var u in this.cachedPosts){var h=this.cachedPosts[u];h.opening&&n.push([h.opening].concat(h.replies.sort(this.sortPosts)))}return n.sort(this.sortThreads)}},{key:"loadAll",value:function(){var e=this;return new Promise(function(t){Database.loadMessagesOnBoard(Nullchan.currentBoard.key).then(function(n){t(e.buildThreads(n))})})}},{key:"appendPost",value:function(e){this._shortMap[e.hashsum.substring(22,32)]=e;var t=e.parent||e.hashsum;if(this.cachedPosts[t]&&(this._cachedPosts[t].replies.push(e),View.rBoardPage.threadMap[t])){var n=this._cachedPosts[t],r=[n.opening].concat(n.replies.sort(this.sortPosts));View.rBoardPage.threadMap[t].setState({posts:r})}}},{key:"sortPosts",value:function(e,t){return e.created_at>t.created_at?1:-1}},{key:"sortThreads",value:function(e,t){return e[e.length-1].created_at>t[t.length-1].created_at?-1:1}}]),e}();window.Threads=new Threads;var URL_REGEXP=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((\:\d+)?(?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_\#\/\?\*\:]*))?)/gm,VERSION="0.2.5",_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),View=function(){function e(){_classCallCheck(this,e);for(var t=["container","header","preloader"],n=0;n<t.length;n++){var r=t[n];this["_"+r]=document.getElementById(r)}}return _createClass(e,[{key:"container",get:function(){return this._container}},{key:"header",get:function(){return this._header}},{key:"preloader",get:function(){return this._preloader}}]),_createClass(e,[{key:"showPreloader",value:function(){var e=this;this.preloader.className="",this.container.style.display="none",setTimeout(function(){e.preloader.className="shown"},600)}},{key:"hidePreloader",value:function(){var e=this;this.preloader.className="",this.preloader.style.display="none",this.container.style.display="block",this.container.className="fadein",setTimeout(function(){e.container.className=""},1e3)}},{key:"renderHeader",value:function(e){this.rHeader=ReactDOM.render(React.createElement(Header,{siteInfo:Nullchan.siteInfo,board:{}}),this.header)}},{key:"updateHeader",value:function(){"main"!=Nullchan.currentPage?this.header.className="with-border":this.header.className="",Nullchan.currentBoard&&this.rHeader&&this.rHeader.setState({board:Nullchan.currentBoard})}},{key:"renderMainPage",value:function(){var e=this;Threads.updateLastPost().then(function(){e.rMainPage=ReactDOM.render(React.createElement(MainPage,{boards:Boards.list,siteInfo:Nullchan.siteInfo,lastPostTime:Threads.lastPostTime}),e.container),e.hidePreloader()})}},{key:"renderBoard",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(null==t?Threads.loadAll():Threads.loadSingle(t)).then(function(t){e.rBoardPage=ReactDOM.render(React.createElement(BoardPage,{formShown:!1,threads:t}),e.container),e.hidePreloader(),"list"==Nullchan.currentPage&&SeenCount.setLocalCounter(Nullchan.currentBoard.key)})}},{key:"renderNotFound",value:function(){ReactDOM.render(React.createElement(NotFound,null),this.container),this.hidePreloader()}},{key:"updateSiteInfo",value:function(e){var t=this;this.rHeader&&this.rHeader.setState({siteInfo:e}),this.rMainPage&&Threads.updateLastPost().then(function(){t.rMainPage.setState({lastPostTime:Threads.lastPostTime,siteInfo:e})}),this.rAuthForm&&this.rAuthForm.setState({userName:Nullchan.shortUserName()})}}]),e}();window.View=new View;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Nullchan=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){this.grepPath(),this.siteInfoUpdatedAt=0,this.currentPage=null,View.showPreloader()}},{key:"reloadSiteInfo",value:function(){var e=this;setTimeout(this.reloadSiteInfo.bind(this),15e3),Helpers.unixTimestamp("now")-this.siteInfoUpdatedAt<30||this.cmd("siteInfo",{},function(t){e.updateSiteInfo(t)})}},{key:"onOpenWebsocket",value:function(){var e=this;this.cmd("siteInfo",{},function(t){e.updateSiteInfo(t),null==e.currentPage&&(View.renderHeader(),e.determineRoute()),e.reloadSiteInfo()})}},{key:"onRequest",value:function(e,t){"setSiteInfo"==e&&this.updateSiteInfo(t)}},{key:"updateSiteInfo",value:function(e){this.siteInfo=e.params||e,this.siteInfoUpdatedAt=Helpers.unixTimestamp("now"),View.updateSiteInfo(this.siteInfo)}},{key:"determineRoute",value:function(){var e=this;Boards.reload().then(function(){if(0==e.currentPath.length)e.currentPage="main",View.renderMainPage();else{var t=Boards.getByKey(e.currentPath[0]);null!=t&&(e.currentBoard=t,1==e.currentPath.length?(e.currentPage="list",View.renderBoard()):"thread"==e.currentPath[1]&&(e.currentPage="thread",View.renderBoard(e.currentPath[2])))}View.updateHeader(),e.currentPage||View.renderNotFound()})}},{key:"shortUserName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.siteInfo.cert_user_id),"sthetz@zeroid.bit"==e?"[dev] sthetz":e?e.split("@")[0]:e}},{key:"grepPath",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,o=window.location.search.substring(1).split("/")[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;i.match("wrapper_nonce")&&(i=i.split("wrapper_nonce")[0]),"&"==(i=i.trim())[i.length-1]&&(i=i.substring(0,i.length-1)),""!=i&&"&"!=i&&e.push(i)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._currentPath=e}},{key:"currentPath",get:function(){return this._currentPath}},{key:"currentPage",get:function(){return this._currentPage},set:function(e){this._currentPage=e}},{key:"currentBoard",get:function(){return this._currentBoard},set:function(e){this._currentBoard=e}},{key:"siteInfo",get:function(){return this._siteInfo},set:function(e){this._siteInfo=e}}]),t}(ZeroFrame);window.Nullchan=new Nullchan;