<section class="content-header">
    <h1>
        视频添加
        <small>
            <a href="{{ url('app/manage') }}">视频管理</a>
        </small>
    </h1>
</section>
<!-- Main content -->
<section class="content">
    <div class="box box-primary">
        <form id="tab" 
              ENCTYPE="multipart/form-data"
        >
            <div class="box-body">
                <div class="form-group">
                    <label> 视频名称： </label>
                    <input name="title" class="form-control input-lg" type="text" placeholder=".input-lg" for="out">
                </div>
                <div class="form-group">
                    <label> 副标题： </label>
                    <input name="subtitle" class="form-control input-lg" type="text" placeholder=".input-lg" for="out">
                </div>
                <div class="form-group">
                    <label>父类</label>
                    <select id="parent_select" class="form-control select2" name="parent_id" for="out">
                        <option value="0">
                            无
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label> 分类:</label>
                    <select id="category_select" multiple="multiple" class="form-control select2" name="category" for="out">
                        <option value="0">
                            无
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label>介绍</label>
                    <textarea class="form-control" name="intro" for="out"></textarea>
                </div>
                <div class="form-group">
                    <label>播放地址</label>
                    <div id="url_input">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" for="out" name="videourl">
                            <span class="input-group-btn">
                                <button type="button" class="addvideo_url btn btn-info btn-flat">新增</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>字幕地址</label>
                    <div id="track_input" class="row">
                        <div class="col-xs-2">
                            <div class="input-group input-group-sm">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown">选择语言<span class="fa fa-caret-down"></span></button>
                                    <ul class="dropdown-menu scrollable-menu" role="menu" id="tracklanguageselect">
                                    </ul>
                                </div><!-- /btn-group -->
                                <input type="text" name="tracklang" class="form-control" for="out">
                            </div>
                        </div>
                        <div >
                            <div class="input-group input-group-sm">
                                <input type="text" class="form-control" for="out" name="trackurl">
                                <span class="input-group-btn">
                                    <button type="button" class="addtrack_url btn btn-info btn-flat">新增</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>截图地址</label>
                    <div id="screen_input">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" for="out" name="screenurl">
                            <span class="input-group-btn">
                                <button type="button" class="addscreen_url btn btn-info btn-flat">新增</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>标签</label>
                    <div id="tag_input">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" for="out" name="tag">
                            <span class="input-group-btn">
                                <button type="button" class="addtag_url btn btn-info btn-flat">新增</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>导演</label>
                    <div id="director_input">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" for="out" name="director">
                            <span class="input-group-btn">
                                <button type="button" class="adddirector_url btn btn-info btn-flat">新增</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>演员</label>
                    <div id="actor_input">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" for="out" name="actor">
                            <span class="input-group-btn">
                                <button type="button" class="addactor_url btn btn-info btn-flat">新增</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label> 国家</label>
                    <div class="input-group input-group-lg">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown">选择地区<span class="fa fa-caret-down"></span></button>
                            <ul class="dropdown-menu scrollable-menu" role="menu" id="countryselect">
                                <!--  li><a href="aa">aa</a></li-->
                            </ul>
                        </div><!-- /btn-group -->
                        <input type="text" name="country" class="form-control" for="out">
                        <!--input name="pid" id="pid" class="form-control input-lg" type="text" placeholder=".input-lg"-->
                    </div>
                </div>
                <div class="form-group">
                    <label>语言</label>
                    <div class="input-group input-group-lg">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown">选择语言<span class="fa fa-caret-down"></span></button>
                            <ul class="dropdown-menu scrollable-menu" role="menu" id="languageselect">
                                <!--li><a href="{{$pid->pid}}">{{$pid->name}}</a></li-->
                            </ul>
                        </div><!-- /btn-group -->
                        <input type="text" name="language" class="form-control" for="out">
                        <!--input name="pid" id="pid" class="form-control input-lg" type="text" placeholder=".input-lg"-->
                    </div>
                </div>


            </div><!-- /.box-body -->
            <div class="box-footer">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div><!-- /.box -->
</section>
<script>
 $(".select2").select2();
 $(".input-group > .input-group-btn > .dropdown-menu > li > a").on('click',function(e) {
     e.preventDefault();
     $this = $(this);
     console.log(this);
     $this.closest(".input-group").find("input").val($this.attr("href"));
 });

 $(".addtag_url").on('click', function(e) {
     e.preventDefault();
     var $pthis = this;
     $("#tag_input").append('<div class="input-group input-group-sm"><input type="text" class="form-control" for="out" name="tag"><span class="input-group-btn"><button type="button" class="deltag_url btn btn-info btn-flat">删除</button></span></div>');
     $(".deltag_url").on('click', function(e) {
         e.preventDefault();
         var $this = $(this);
         $this.parent().parent().remove();
     });
 });


 $(".addactor_url").on('click', function(e) {
     e.preventDefault();
     var $pthis = this;
     $("#actor_input").append('<div class="input-group input-group-sm"><input type="text" class="form-control" for="out" name="actor"><span class="input-group-btn"><button type="button" class="delactor_url btn btn-info btn-flat">删除</button></span></div>');
     $(".delactor_url").on('click', function(e) {
         e.preventDefault();
         var $this = $(this);
         $this.parent().parent().remove();
     });
 });

 $(".adddirector_url").on('click', function(e) {
     e.preventDefault();
     var $pthis = this;
     $("#director_input").append('<div class="input-group input-group-sm"><input type="text" class="form-control" for="out" name="director"><span class="input-group-btn"><button type="button" class="deldirector_url btn btn-info btn-flat">删除</button></span></div>');
     $(".deldirector_url").on('click', function(e) {
         e.preventDefault();
         var $this = $(this);
         $this.parent().parent().remove();
     });
 });

 $(".addscreen_url").on('click', function(e) {
     e.preventDefault();
     var $pthis = this;
     $("#screen_input").append('<div class="input-group input-group-sm"><input type="text" class="form-control" for="out" name="screen"><span class="input-group-btn"><button type="button" class="delscreen_url btn btn-info btn-flat">删除</button></span></div>');
     $(".delscreen_url").on('click', function(e) {
         e.preventDefault();
         var $this = $(this);
         $this.parent().parent().remove();
     });
 });

 $(".addvideo_url").on('click', function(e) {
     e.preventDefault();
     var $pthis = this;
     $("#url_input").append('<div class="input-group input-group-sm"><input type="text" class="form-control" for="out" name="videourl"><span class="input-group-btn"><button type="button" class="delvideo_url btn btn-info btn-flat">删除</button></span></div>');
     $(".delvideo_url").on('click', function(e) {
         e.preventDefault();
         var $this = $(this);
         $this.parent().parent().remove();
     });
 });

 window.admin.getcountry(function(country) {
     $.each(country, function(i, one) {
         $("#countryselect").append('<li><a href="'+one.name+'">'+one.name+'</a></li>');
     });
 });

 window.admin.getlanguage(function(language) {
     $.each(language, function(i, one) {
         $("#languageselect").append('<li><a href="'+one.name+'">'+one.name+'</a></li>');
     });
     $.each(language, function(i, one) {
         $("#tracklanguageselect").append('<li><a href="'+one.name+'">'+one.name+'</a></li>');
     });

 });


 window.admin.getcategory(function(category) {
     $.each(category, function(i, one) {
         $("#category_select").append($("<option/>").attr({value:one.category_id}).text(one.name));
     });
 });
 $("form").submit(function(e) {
     console.log("aaaaa");
     e.preventDefault();
     var obj = {screen:[],tag:[], actor:[], category:[], director:[], videourl:[], title:"", subtitle:"", country:"", language:"", intro:"", parent_id:"", writer:[], track:[]};
     $.each($("input[for='out']"), function(i, one) {
         var $one = $(one);
         var value = $one.val();
         var key = $one.attr("name");
         var type = $one.attr("type");
         if (type == "checkbox") {
             value = $one.is(":checked")?1:0;
         }
         console.log(Array.isArray(obj[key]));
         console.log(key + ";="+value);
         if (Array.isArray(obj[key])) {
             obj[key].unshift(value);
             return;
         }
         obj[key] = value;
     });
     $.each($("select[for='out']"), function(i, one) {
         var $one = $(one);
         var value = $one.val();
         var key = $one.attr("name");
         obj[key] = value;
     });

     console.log(obj);
     //delete(obj['parent']);
     //delete(obj['enable']);
     window.admin.addvideo(obj, function(res) {
         if (res != "ok") {
             alert("error"+res);
         } else {
             $("#video-manage").trigger('click');
         }
     });
 });

</script>
