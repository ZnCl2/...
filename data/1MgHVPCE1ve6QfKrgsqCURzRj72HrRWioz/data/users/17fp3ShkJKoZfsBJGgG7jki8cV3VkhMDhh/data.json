{"next_paste_id":5,"next_comment_id":0,"paste":[{"paste_id":2,"description":"rand() is lame, this is better","body":"\n#include <sys/random.h>\n\n#include <stdbool.h>\n#include <stdint.h>\n\n/* 32-bit random number generator */\nuint32_t get_rand_32(uint32_t, uint32_t);\n\nstatic uint8_t get_rand_total_32(uint32_t, uint32_t);\nstatic uint8_t get_byte_total_32(uint32_t);\nstatic uint8_t get_bit_width_32(uint32_t);\n\n\n/* generate a 32-bit random number in the range [x,y] */\nuint32_t get_rand_32(uint32_t x, uint32_t y) {\n    uint32_t z_rand = 0x0;\n\n    if(x < y) {\n        /* get bit width for both x and y */\n        uint32_t x_bits = get_bit_width_32(x),\n                 y_bits = get_bit_width_32(y);\n\n        if((x_bits > 0x0) && (y_bits > 0x0)) {\n            uint8_t byte_len = get_rand_total_32(x_bits, y_bits);\n\n            /* random number generation */\n            if((byte_len > 0x0) && (byte_len <= 0x8)) {\n                while((z_rand < x) || (z_rand > y))\n                    getrandom(&z_rand, byte_len, GRND_NONBLOCK);\n            }\n        }\n    }\n\n    /* return to random number to caller */\n    return z_rand;\n}\n\n\n/* get random byte total of x and y */\nstatic uint8_t get_rand_total_32(uint32_t x_bits, uint32_t y_bits) {\n    uint8_t byte_total = 0x0;\n\n    if((x_bits > 0x0) && (x_bits <= 0x20) && \n       (y_bits > 0x0) && (y_bits <= 0x20)) {\n\n        if(y_bits >= x_bits) {\n            uint8_t x_bytes = 0x0, y_bytes = 0x0, i = 0x0;\n            char rand_data[0x20] = {0x0};\n            bool rand_loop = true;\n\n            x_bytes = get_byte_total_32(x_bits), \n            y_bytes = get_byte_total_32(y_bits);\n\n            /* equivalent byte lengths can't be randomized (x == y) */\n            if(x_bytes == y_bytes) {\n                byte_total = x_bytes;\n                rand_loop = false;\n            }\n\n            /* \n                get a byte length that sits in the range of [x,y] \n\n                ex: if x is 2-bytes, and y is 6-bytes, then byte length\n                    can be [2,3,4,5,6]\n            */\n            while(rand_loop) {\n                if(getrandom(rand_data, 0x20, GRND_NONBLOCK) == 0x20) {\n                    for(i ^= i; i < 0x20; i++) {\n                        byte_total = rand_data[i] & 0xF;\n\n                        if((byte_total >= x_bytes) && (byte_total <= y_bytes)) {\n                            rand_loop = false;\n                            i = 0x20;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    return byte_total;\n}\n\n/* get total bytes, given bit width */\nstatic uint8_t get_byte_total_32(uint32_t bits) {\n    uint8_t bytes = 0x0;\n\n    if( (bits > 0x0) && (bits <= 0x20) ) {\n        bytes++;\n\n        if( (bits > 0x8) && (bits <= 0x10) )\n           bytes++;\n        else if( (bits > 0x10) && (bits <= 0x18) )\n           bytes += 0x2;\n        else if( (bits > 0x18) && (bits <= 0x20) )\n           bytes += 0x3;\n    }\n\n    return bytes;\n}\n\n\n/* get the width of a 32-bit number */\nstatic uint8_t get_bit_width_32(uint32_t x) {\n    uint8_t bits = 0x0, i = 0x0;\n\n    if(x > 0x0) {\n        uint32_t bit_mask_1 = 0x1,\n                 bit_mask_2 = 0x2,\n                 bit_mask_4 = 0x4,\n                 bit_mask_8 = 0x8;\n\n        for(i ^= i; i < 0x8; i++) {\n            if( (x & bit_mask_1) ||\n                (x & bit_mask_2) ||\n                (x & bit_mask_4) ||\n                (x & bit_mask_8) ) {\n                bits = (i + 0x1);\n            }\n\n            bit_mask_1 <<= 0x4,\n            bit_mask_2 <<= 0x4,\n            bit_mask_4 <<= 0x4,\n            bit_mask_8 <<= 0x4;\n        }\n\n        bits *= 0x4;\n    }\n\n    return bits;\n}","language":"text/plain","encrypted":false,"added":1623339919},{"paste_id":4,"description":"maze runner garlic-onion router (public)","body":"\nAn attempt at garlic/onion routing, this is highly experimental (github will be up soon)\n\nhttps://www.mediafire.com/file/7fl5c0en3x87n7x/maze-runner-public.zip/file","language":"text/plain","encrypted":false,"added":1623579092}],"comment":[]}