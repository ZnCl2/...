{"next_paste_id":6,"next_comment_id":0,"paste":[{"paste_id":3,"description":"ZeroArchive Readme","body":"ZeroArchive\n===========\n\nAutomatic mirroring of websites to ZeroNet.\n\n## Requirements\n\nYou have to install [Python 3](https://www.python.org/), [ZeroNet](https://zeronet.io/) and [HTTrack](https://www.httrack.com/) on your computer.\n\nYou also have to create new empty ZeroNet site which will be used as archive destination. It's recommended that you use one ZeroNet site for each URL you want to archive.\n\n## Usage\n\nRun `main.py` with this arguments:\n\n* `website` - Main website URL and additional HTTrack URLs\n* `--depth` - Link depth for HTTrack (default 5)\n\n* `--zite` - Path to ZeroNet site\n* `--address` - Address of ZeroNet site\n* `--privkey` - Private key of ZeroNet site\n\n* `--zeronet` - Path to ZeroNet installation (file)\n* `--httrack` - Path to HTTrack installation (file)\n\n## Examples\n\nExample command for Windows with ZeroBundle:\n\n    python main.py --zite path/to/ZeroNet/data/12LkrG7Fsptiu4fGveknNwd6r92REdQU2S --address 12LkrG7Fsptiu4fGveknNwd6r92REdQU2S --privkey privateKey --zeronet path/to/ZeroNet/ZeroNet-cli --httrack /path/to/httrack/httrack https://example.com\n\nExample ZeroArchive site:\n\n    http://127.0.0.1:43110/12LkrG7Fsptiu4fGveknNwd6r92REdQU2S","language":"text/plain","encrypted":false,"added":1563205055},{"paste_id":4,"description":"ZeroArchive Main","body":"from urllib.parse import urlparse\nfrom shutil import copyfile\n\nimport subprocess\nimport datetime\nimport argparse\nimport sys\nimport os\nimport re\n\ndef execute(*command, stdout=False, stderr=True):\n    FNULL = open(os.devnull, 'w')\n\n    if stdout: stdout = sys.stdout\n    else: stdout = FNULL\n\n    if stderr: stderr = sys.stderr\n    else: stderr = FNULL\n\n    return subprocess.call(command, stdout=stdout, stderr=stderr)\n\ndef download(httrack, depth, location, cache, url, *args):\n    cmd = [\n        httrack, url, '-O', location + ',' + cache, '-I0', '--depth=' + str(depth),\n        '--display=2', '--timeout=60', '--retries=99', '--sockets=7', '--connection-per-second=5', '--max-rate=250000', '--keep-alive', '--mirror', '--clean', '--robots=0',\n        '--user-agent', '\\'$(httrack --version); ZeroArchive ()\\'',\n        *args\n    ]\n\n    return execute(*cmd)\n\ndef navigation(zite, archive, url):\n    copyfile('template.html', os.path.join(zite, 'index.html'))\n\n    parsed = urlparse(url)\n\n    hostname = parsed.netloc.replace(':', '_')\n    if parsed.path:\n        path = parsed.path[1:] if parsed.path.lower().endswith('.html') or parsed.path.lower().endswith('.htm') else parsed.path[1:] + '.html'\n    else:\n        path = 'index.html'\n\n    with open(os.path.join(zite, 'archives.csv'), 'a') as archives:\n        name = os.path.basename(os.path.normpath(archive))\n        href = os.path.normpath(os.path.join(name, hostname, path)).replace('\\\\', '/')\n        archives.write(name + ',' + href + '\\n')\n\n    pattern = re.compile(r'<title>(.*)<\\/title>')\n\n    for i, line in enumerate(open(os.path.join(archive, hostname, path), encoding='utf8')):\n        for match in re.finditer(pattern, line):\n            title = match.groups()[0]\n            break\n\n    if not 'title' in locals():\n        title = 'Website'\n\n    with open(os.path.join(zite, 'index.html'), 'r', encoding='utf8') as file:\n        index = file.read()\n\n    index = index.replace('%SITE-ORIGINAL%', url)\n    index = index.replace('%SITE-TITLE%', title)\n\n    archives = []\n\n    for line in reversed(list(open(os.path.join(zite, 'archives.csv')))):\n        data = line.strip().split(',')\n\n        try:\n            name = datetime.datetime.strptime(data[0], '%Y%m%d%H%M%S').strftime('%Y-%m-%d %H:%M:%S')\n            href = data[1]\n        except:\n            continue\n\n        archive = '<li><a href=\"' + href + '\">' + name + '</a></li>'\n        archives.append(archive)\n\n    index = index.replace('%SITE-ARCHIVES%', '\\n' + '\\n'.join(archives) + '\\n')\n\n    with open(os.path.join(zite, 'index.html'), 'w', encoding='utf8') as file:\n        file.write(index)\n\ndef sign(zeronet, address, privkey):\n    return execute(zeronet, 'siteSign', address, privkey)\n\ndef publish(zeronet, address):\n    return execute(zeronet, 'sitePublish', address)\n\ndef main():\n    parser = argparse.ArgumentParser(\n        prog=__package__,\n        description='Download website and publish it to ZeroNet'\n    )\n\n    parser.add_argument('website', type=str, nargs='+', help='website URLs to download')\n    parser.add_argument('--depth', type=int, default=5, help='depth to clone')\n\n    parser.add_argument('--zite', required=True, help='path to ZeroNet site')\n    parser.add_argument('--address', required=True, help='address of ZeroNet site')\n    parser.add_argument('--privkey', required=True, help='private key of ZeroNet site')\n\n    parser.add_argument('--zeronet', required=True, help='path to ZeroNet installation')\n    parser.add_argument('--httrack', required=True, help='path to HTTrack installation')\n\n    if len(sys.argv) == 1:\n        parser.print_help(sys.stderr)\n        sys.exit(1)\n\n    args = parser.parse_args()\n    timestamp = datetime.datetime.utcnow().strftime('%Y%m%d%H%M%S')\n\n    print('Downloading website')\n    st = download(args.httrack, args.depth, os.path.join(args.zite, timestamp), os.path.join(args.zite, 'cache'), *args.website)\n    if st:\n        print('Error while downloading website', file=sys.stderr)\n        sys.exit(1)\n\n    print('Creating navigation page')\n    navigation(args.zite, os.path.join(args.zite, timestamp), args.website[0])\n\n    print('Signing site')\n    st = sign(args.zeronet, args.address, args.privkey)\n    if st:\n        print('Error while signing site', file=sys.stderr)\n        sys.exit(1)\n\n    print('Publishing site')\n    st = sign(args.zeronet, args.address, args.privkey)\n    if st:\n        print('Error while publishing site', file=sys.stderr)\n        sys.exit(1)\n\n    print('Done')\n\nmain()\n","language":"text/x-python","encrypted":false,"added":1563205097},{"paste_id":5,"description":"ZeroArchive Template","body":"<!DOCTYPE html>\n\n<html>\n    <head>\n        <title>ZeroArchive for %SITE-TITLE%</title>\n\n        <meta charset=\"utf-8\" />\n        <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\n        <base href=\"\" target=\"_top\" id=\"base\" />\n        <script>base.href = document.location.href.replace(\"/media\", \"\").replace(\"index.html\", \"\").replace(/[&?]wrapper=False/, \"\").replace(/[&?]wrapper_nonce=[A-Za-z0-9]+/, \"\")</script>\n\n        <style type=\"text/css\">\n            body {\n                background-color: #f0f0f2;\n                margin: 0;\n                padding: 0;\n                font-family: \"Open Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n            }\n            div {\n                width: 1500px;\n                margin: 5em auto;\n                padding: 50px;\n                background-color: #fff;\n                border-radius: 1em;\n            }\n            hr {\n                border: 0;\n                border-top: 1px solid #8c8c8c;\n                border-bottom: 1px solid #fff;\n            }\n            a:link, a:visited {\n                color: #38488f;\n                text-decoration: none;\n            }\n            @media (max-width: 1500px) {\n                body {\n                    background-color: #fff;\n                }\n                div {\n                    width: auto;\n                    margin: 0 auto;\n                    border-radius: 0;\n                    padding: 1em;\n                }\n            }\n        </style>\n\n        <div>\n            <h1>ZeroArchive for %SITE-TITLE%</h1>\n\n            <p>This site is ZeroArchive mirror for <a href=\"%SITE-ORIGINAL%\">%SITE-TITLE%</a>.</p>\n            <p>It uses <a href=\"https://www.httrack.com/\">HTTrack</a> for mirroring websites and <a href=\"https://gist.github.com/filips123/eafe298f7b4f1bafefcf494d4ae26e51\">ZeroArchive</a> for publishing them to ZeroNet. Please see ZeroArchive website if you want to create a mirror for your website.</p>\n\n            <hr />\n\n            <p>\n                <strong>Available archives:</strong>\n                <ul>%SITE-ARCHIVES%</ul>\n            </p>\n        </div>\n    </body>\n</html>\n","language":"text/html","encrypted":false,"added":1563205132}],"comment":[]}