{"next_paste_id":2,"next_comment_id":0,"paste":[{"paste_id":0,"description":"","body":"server {\n    server_name zeronet.mydomain.tld;\n\n\tauth_basic \"Protected area: ZeroNet\";\n\tauth_basic_user_file /var/www/.htpasswd;\n\t\n    location ~ \\.(woff2|woff|ttf)$ {\n        auth_basic off;\n\n        proxy_pass http://127.0.0.1:43110;\n        proxy_http_version  1.1;\n        proxy_set_header Host $http_host;\n        proxy_set_header    X-Real-IP   $remote_addr;\n        if_modified_since   before;\n    }\n\n    location / {\n\n        proxy_pass        http://127.0.0.1:43110;\n        proxy_http_version  1.1;\n        proxy_set_header    Host        $host;\n        proxy_set_header    X-Real-IP   $remote_addr;\n        if_modified_since   before;\n\n        proxy_read_timeout  120s;\n        proxy_send_timeout  120s;\n\n        add_header 'Access-Control-Allow-Methods' 'GET,OPTIONS,PUT,DELETE' always;\n        add_header 'Access-Control-Allow-Credentials' 'true' always;\n        add_header 'Access-Control-Allow-Origin' '$http_origin' always;\n        add_header 'Access-Control-Allow-Headers' 'Authorization,DNT,User-Agent,Keep-Alive,Content-Type,accept,origin,X-Requested-With' always;\n\n        if ($request_method = OPTIONS ) {\n            return 200;\n        }\n    }\n\n\n    location /Websocket {\n        proxy_pass http://127.0.0.1:43110;\n        proxy_http_version 1.1;\n        proxy_read_timeout 1h; #for long live websocket connetion\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n    }\n}","language":"text/x-nginx-conf","encrypted":false,"added":1516610798},{"paste_id":1,"description":"","body":"import json, os, time, subprocess, fnmatch, sys, shutil\nimport tagpy\n\nzeromusic_dir = '/path/to/ZeroNet/data/1MusicXkuN2pk5hRdmroeyaCLDJtzTicpB/data/users'\n\n\ndata_dir = '/path/to/ZeroNet/data/1zaC4qeKwZiH2qieDekpqiMUgqTsrEyi7/data/users/1LrDWSzi63MhST9ZNkefSPJGFAuByRMeCx' \n\ndata_json = {'songs': {}}\n\nfor prev_user in os.listdir(zeromusic_dir):\n    p = os.path.join(zeromusic_dir, prev_user, 'data.json')\n    if not os.path.exists(p):\n        continue\n    user_data_json = json.load(open(p))\n    for song in user_data_json['songs']:\n        filename = os.path.basename(song['path'])\n\n        actual_file = os.path.join(zeromusic_dir, prev_user, filename)\n        if not os.path.exists(actual_file):\n            continue\n\n\n        try:\n            audiofile = tagpy.FileRef(actual_file.encode('ascii')).tag()\n            print song['path'], ' - ', audiofile.album\n        except:\n            continue\n\n        if song['track'] == 'unknown':\n            title = song['title']\n        else:\n            title = str(song['track']) + '. ' + song['title']\n\n        new_filename = prev_user + '-' + filename\n\n        new_time = int(time.time()*1000)\n        data_json['songs'][str(new_time)] = {\n            'album': audiofile.album,\n            'artist': song['artist'],\n            'date_added': new_time,\n            'filename': new_filename,\n            'title': title\n        }\n        shutil.copyfile(actual_file, os.path.join(data_dir, new_filename))\n        time.sleep(0.01)\n\n    json.dump(data_json, open(os.path.join(data_dir, 'data.json'), \"w\"), indent=2)\n","language":"text/x-python","encrypted":false,"added":1516800760}],"comment":[]}