/**
 * ojraskatzeronet v0.1.0
 * @author Otto J. Rask
 */
var app=app||{};app.OZNCollection=Backbone.Collection.extend({model:app.OZNModel,dataFile:"",rawdata:void 0,data:void 0,appinst:void 0,site:void 0,url:void 0,initialize:function(t,i){"use strict";_.bindAll(this,"readData","parseData","createModelsFromData"),this.appinst=i.appinst,this.on("data_parsed",this.createModelsFromData),this.readData()},readData:function(t){"use strict";this.data=this.appinst.site.cmd("fileGet",this.dataFile,this.parseData)},parseData:function(t){"use strict";this.data=JSON.parse(t),_.each(this.data,function(t,i){t.appinst=this.appinst}.bind(this)),this.trigger("data_parsed")},createModelsFromData:function(){"use strict";this.add(this.data),this.trigger("models_created")},saveData:function(){"use strict";var t=[];_.each(this.models,function(i){t.push(i.toJSON())}),this.data=t;var i=[],a=JSON.stringify(this.data,function(t,a){if("object"==typeof a&&null!==a){if(-1!==i.indexOf(a))return;i.push(a)}return a});i=void 0,this.appinst.site.cmd("fileWrite",[this.dataFile,btoa(a)],function(t){"ok"!=t?this.appinst.site.cmd("wrapperNotification",["error","Could not write file! Reason: "+t]):this.appinst.site.cmd("wrapperNotification",["done","Data file written!"])}.bind(this))}});