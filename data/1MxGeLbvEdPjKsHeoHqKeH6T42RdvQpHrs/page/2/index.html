<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/avatars/v5.png"><link rel="alternate" type="application/rss+xml" title="王子亭的博客" href="https://jysperm.me/atom.xml"><link rel="stylesheet" href="/styles.css"><title>王子亭的博客</title></head><body><div class="container"><div class="columns page-header"><h1>王子亭的博客</h1></div><div class="columns"><div class="navigation"><nav class="menus-main"><a href="/" class="favicon"><img alt="王子亭的博客" src="/avatars/v5.png"></a><a href="/about">关于精子</a><a href="/resume">简历</a><a href="/links">链接</a><a href="/booklist">推荐书单</a><a href="/list">日志列表</a><a href="/ad">广告</a></nav><nav class="right menus-right"><a href="/atom.xml">RSS</a><a target="_blank" href="https://github.com/jysperm/blog">fork on Github</a></nav></div></div><div class="columns"><div class="block-body column three-fourths"><div class="article-widget">精子新上线了一个名为 &nbsp;<a target="_blank" href="https://stream.pub/">Stream</a>&nbsp; 的服务，希望提供一个基于发布、订阅模型的消息服务，提供 HTTP API 并传输结构化的 JSON 数据。</div><article><header><h2><a href="/2017/01/programming-of-2016/">2016 年度小结（技术方面）</a></h2></header><div class="article-meta clearfix"><time class="left">2017 1 月 7 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tag/summary-of-year/">年度小结</a></li><li><a href="/tag/php/">PHP</a></li><li><a href="/tag/docker/">Docker</a></li></ul></div><div class="markdown-body"><p>今年年初我花了三个月的业余时间用 Laravel 开发了一个项目，在此之前，除了去年换工作准备面试时，我并没有正经地用过什么 PHP 框架。在我看来，Laravel 其实并没有太多的独创性，而只是把其他社区中那些被实践证明非常有价值的东西带到了 PHP 社区，例如自动测试、包管理、依赖注入等等。</p>
<p>回到 PHP 本身，PHP7 无论在语言特性还是性能上都无可挑剔，我觉得限制它的使用的更多的是在异步模型上 —— 或者说它缺少一个好的异步模型。也许有人觉得 Node.js 的事件队列十分难以捉摸，但由于 Node.js 是我在生产环境使用得最多的语言，我十分熟悉 Node.js 的异步模型，对其他「普通」的语言的异步模型却比较难以接受。今年我在 Openresty 中写了一些 Lua 代码，对 Lua 的协程也有了一些简单的了解，同时我也了解到在 Python 中被使用最多的异步模型同样也是基于协程。</p>
<p>协程最大的好处是不会对代码有侵入性 —— 你写代码的时候依然是照常地写同步代码，只需在执行的时候引入协程（对于 Web 服务就是在每收到一个请求的时候启动一个协程）就可以享受轻量级进程的好处，用更低的 CPU 和内存开销来支持更高的并发。相比之下 Node.js 的异步代码则是显式的，需要时刻考虑异步的问题，也很容易出现疏忽和错误。而且异步的函数是有传染性的，如果你调用了一个异步函数，那么后面的代码都要用异步的方式写，虽然我们有 Promise 等异步抽象，但这其实就是侵入性的体现 —— 你必须选择一个异步抽象，这个异步抽象会混入你所有的代码。</p>
<p>那是不是说 Python 的协程就比 Node.js 的事件队列要好呢？其实我觉得大部分的情况下是这样的，但从理论上来说，Node.js 还是会有更好的性能，因为协程虽然比线程要轻量级，但依然是一种封装 —— 需要在协程之间调度，需要保存和恢复执行上下文，而 Node.js 的异步是没有任何的封装的 —— Node.js 里你没有办法去管理异步任务（domain 模块也早就被 deprecated 了），因为异步任务并不是运行在像协程的这样一个容器里的，因此省掉这一层抽象会带来更好的性能。</p>
<p>Laravel 是一个一站式的开发框架，我之前并没有用过这类的框架，在 Node.js 中也不是很流行这样的框架，好处自然就是组件之间有着很好的兼容性和一致的设计，质量也有保证；劣势则是选择的余地比较少（实际上服务容器的概念就是为了弥补一站式框架不便于更换组件的问题），因为这些组件是框架整体的一部分，所以对一些比较小众的需求缺乏支持，这些组件也较少考虑脱离 Laravel 独立地使用。</p>
<hr>
<p>今年我还花了很多时间去了解和使用 InfluxDB 这样的时序数据库，在 Web 后端的开发过程中，有很多日志、监控、统计类的数据都是时序数据 —— 这些数据量会很大、每一条都和一个时间关联、查询时通常也按照时间范围进行查询、查询时我们通常会将一段时间的数据进行分组和聚合。InfluxDB 为了支持基于 Tag 的筛选和分组，采用了按列存储的方式 —— 每个 Tag 的值的组合都被称作一个序列，被独立地存储以备检索。</p>
<p>因为这些数据都和时间关联，同时数据库也提供了比较好的对分组和聚合的支持，所以可以很轻松地使用 Chronograf 或 Grafana 之类的可视化工具画出图表，对这些指标进行监控。实际上去年我做了一个和时序数据库非常相关的项目，即 <a href="https://github.com/leancloud/leanengine-sniper" target="_blank" rel="external">leanengine-sniper</a>，今年我又花了一些时间把这个算是自部署的系统包装成了一个云服务（<a href="https://apm.leanapp.cn" target="_blank" rel="external">LeanEngine APM</a>），实际上这就是一个针对特定场景的、简易的时序数据库和基于时序数据的可视化工具。</p>
<hr>
<p>做一个象棋 AI 是我一直以来的一个想法，于是今年接着 AlphaGo 的热度，我用 TypeScript、React 和 Web Worker 等技术在浏览器中实现了一个非常弱的国际象棋 AI —— <a href="https://jysperm.me/2016/06/wizard-chess/">Wizard Chess</a>。其实只能说是把关键的组件都实现了出来，但实际上 AI 走的每一步棋都很弱。显然这是一个对性能非常敏感的项目，根据我去年的经验要尽可能避免对数据的修改，但在我调研了 Immutable.js 之后我并没有选用它，因为我觉得可能我不需要它提供的那么复杂的数据结构，而是自己在编码时注意不要修改参数、函数总是返回新的对象即可。</p>
<p>在 Wizard Chess 中我也试用了 TypeScript，它给 JavaScript 实现了编译期的类型检查，这会非常有助于在编译期发现和类型有关的错误，但并不能做到真正的静态类型语言的那种程度，尤其 JavaScript 中存在大量取值为 null 或 undefined 的情况，同时需要为所使用的库找到定义文件也是一大痛点。</p>
<p>到目前大家已经普遍认为 TypeScript 比 CoffeeScript 有着更好的前景，CoffeeScript 这个项目也显得有些疏于维护了，这令我非常痛心。虽然 ES2015 已经补齐了 JavaScript 语言本身的一些短板，但我觉得 CoffeeScript 还是有它独特的价值的，比如用缩进区分代码块、更少的括号，以及通过问号进行空值判断。</p>
<hr>
<p>为项目撰写 HTTP API 文档一直是一个很纠结的事情，为了他人阅读和理解容易，应该详细地列出所有参数的细节，但这样又会导致文档有大量重复的内容，维护将会十分困难。用来生成 HTTP API 文档的方案有很多，我最后选择了 RAML —— 这是一个基于 YAML 的用来定义 HTTP API 的语言，它提供了非常多的特性（type、resourceType、trait）来对定义进行复用，你可以根据你的代码的架构去组织这些定义（例如如果几个接口都挂载了同样的中间件，便可以使用一个 trait 来定义这个中间件的行为），最后通过一个编译环节生成可以阅读的 API 文档。</p>
<p>后来我还了解了一下 GraphQL，并实现了一个 <a href="https://jysperm.me/2016/12/leancloud-graphql">在 LeanCloud 上使用 GraphQL</a> 的 Demo，GraphQL 解决了 RESTful API 缺乏范式、类型不够严格、对关系数据支持弱、难以发现等问题。但目前对 GraphQL 的应用仍非常有限，我想大概是为了支持 GraphQL 需要服务器端进行很大的改动，同时引入这样一层复杂的抽象，也会带来很大的性能开销，可能 GraphQL 更适合的场景会是 BaaS 和开放 API 吧。</p>
<hr>
<p>如果说我在番茄土豆学到的是如何开新坑、如何以开放的心态去接受新的技术的话，在 LeanCloud 这一年多则是去长时间地维护一个复杂的系统，在保证兼容性和可用性的前提下，渐进式地对系统进行改进，引入新的技术。之前在番茄土豆的时候，也是因为自己的水平提高得比较快，经常想要进行一次彻底的重构  —— 其实应该称之为重写才对。但往往没有好的结果，因为这种大的重写会花费很多的时间，会导致新版本和原有代码差别越来越大，甚至更换了新的语言或数据库，很难保证和原有代码有着一样的行为。同时因为数据操作的不兼容，在上线时也必须一下子全量上线，结果就是导致最后的上线时间一拖再拖。</p>
<p>今年上半年云引擎也有过一次很大的 <a href="https://blog.leancloud.cn/4292" target="_blank" rel="external">改版</a>，允许用户对实例进行更多的管理以及大量的内部重构，其中我得到的经验就是要进行渐进式的重构  —— 将大的修改划分为若干个小任务，逐步地将这些小修改上线进行测试，而不是一次性上线一个大的修改。让新旧代码混跑一段时间，保证新旧代码对数据的操作是互相兼容的，虽然在开发上需要实现很多过渡代码，在过渡完成后还需要清理这部分代码，但这种出现问题可以随时回滚的能力会让你对上线新的修改非常有信心，反而能够加速整体的重构进程。</p>
<p>今年在 LeanCloud 我也开了几个新坑，的确新的项目在发布或上线之前的进化速度是非常快的，一旦有好的想法就可以立刻实施而不必顾及兼容问题，甚至也可以跳过很多的测试和 Code Review。有句话是说「不要过早的进行优化」，但我有些怀疑这个观点，在正式发布或上线之前很可能是最好的优化时机，至少要考虑到后续的优化并预留出修改的空间。一旦项目上线，那么每个修改都要有充分的理由、都要去顾及兼容性并进行全面的测试，这时再进行优化会是非常低效的，我也的确遇到一些项目是因为最开始的设计失误导致后期几乎没办法去优化。</p>
<hr>
<p>随着 Docker 生态的发展，「微服务」是个比较火热的话题，但大都还是一些方法论，没看到太多具体的实践经验。目前我对微服务的理解主要是两方面，一是对项目进行拆分，减少单个开发者需要接触的代码量；另一方面是对服务进行隔离，缩小故障的影响范围，更好地进行水平拓展。今年我也基于这两个出发点进行了一些实践 —— 项目的不同服务使用同一个代码库，互相共享很大一部分代码，包括自动测试也是在一起运行的。但每个服务有着不同的入口点，会被单独地部署和运行。</p>
<p>大概这是一种不够彻底的微服务吧，我知道当然可以将共同的代码发布为单独的包，来实现更加彻底的拆分。但把一个组件独立为一个包其实是一个很严肃的事情，可能需要它有单独的仓库、文档、版本号，当 API 发生变化时还要考虑兼容。对于一个还没有那么复杂的项目来说，这个开销可能会很大程度上影响迭代速度，所以我还是选择使用同一代码库，这样进行修改时会更加灵活，通过自动测试来保证修改不会引入问题。</p>
<p>如果已有服务化的基础设施，这种服务的拆分其实还是很容易的，但如果从头搭建一套微服务的基础设施则还是需要一些工作的。例如为了管理不同服务的配置，标准化部署过程，你需要一个 CI；为了提供不同服务所需要的环境、在运行时进行隔离，你需要有一个容器引擎；为了管理和调度容器、充分利用资源，你还需要一个集群管理器；为了能够平滑地进行部署，你还需要服务发现和负载均衡；为了收集和检索日志，你还需要一套日志收集和分析器；更别提还有的统计、监控和报警需求了。对于这些基础设施我也有自己的一些实践和看法，我还是比较期待新的一年里能在业余时间按照我自己的选择去搭建一个这样的微服务平台，大概也算是给 RootPanel 划上一个句号。</p>
<hr>
<p>很时候服务不可用都是因为数据库的问题导致的，不同于无状态的负载均衡或应用容器，数据库存储了所有的状态，这意味着你不能简单地重新创建一个数据库实例，而必须要顾及到其中的数据。为了保证数据库的可用性，最简单的办法就是运行多个数据库实例，互相之间同步数据，在故障时切换到另外一个实例。但这样又会引入新的问题，如果发生网络分区怎么办？于是我开始深入地了解 CAP 提出的分布式系统的限制，了解 Paxos 这样的算法如何在分布式的系统中达成共识，也了解了各种数据库提供了怎样的分布式能力和怎样的高可用解决方案，这样在以后为项目选择数据库的时候应该会更加有针对性。</p>
<p>在这个过程中我也读到了「SRE: Google 运维解密」新出版的中文版，书中介绍了作为世界上最大的互联网公司，Google 是如何在规模迅速增长的情况下继续保证服务的可用性的。书中介绍了很多原则和方法，读完这本书让我觉得热血沸腾，相比于写代码实现确定的需求，也许去应对未知的故障会更有趣？但在此之前可能还有很多知识需要学习，首先在一番纠结后，选择了 Ansible 作为配置管理工具，开始尝试将我的服务器上的所有服务都通过定义文件进行描述，这项工作持续了将近三个月的时间，到现在还未全部完成。用一组定义文件去代替对服务器的直接操作，这样的好处是非常明显的 —— 这些文件可以进入版本控制让所有修改有据可查，可以随时应用在新的服务器上，也可以随时在已有的服务器上进行验证和重放，通过 Ansible 这类工具所提供的特性，也可以对这些配置进行高层次的抽象，来管理更复杂的配置和大量的服务器。</p>
<p>我们不光要使用不可变的数据结构来控制可变状态，像服务器这样的基础设施也可以让它们变成「不可变」的。其实 Docker 的容器就是一个很好的例子，所有的容器都是从 Dockerfile 生成出来的，当你需要修改容器中的运行环境的时候，你不是直接在容器内进行修改，而是去修改 Dockerfile —— 因为它是容器的模板。我们也可以总是通过定义文件来描述基础设施，每次修改后都重新验证服务器与定义文件中的描述一致，这样我们便不必关心服务器上的状态了。也不会出现服务器多人维护，配置混乱难以迁移的情况了，它永远看上去和新的一样。</p>
<hr>
<p>此外今年我还公开或半公开地做了五次技术分享，准备每个分享都花了我起码半个月的时间，其中的四次已经被我整理成了文字版本：</p>
<ul>
<li><a href="https://jysperm.me/2016/05/blockchain-slides/">Blockchain 和 Ethereum</a></li>
<li><a href="https://jysperm.me/2016/08/docker-and-containerization">Docker 在共有云上的实践</a></li>
<li><a href="https://jysperm.me/2016/10/nodejs-error-handling/">Node.js 错误处理实践</a></li>
<li><a href="https://jysperm.me/2016/11/behind-atom">Atom 背后的故事</a></li>
</ul>
</div></article><article><header><h2><a href="/2016/12/summary-of-2016/">2016 年度小结</a></h2></header><div class="article-meta clearfix"><time class="left">2016 12 月 31 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tag/live/">生活记录</a></li><li><a href="/tag/summary-of-year/">年度小结</a></li></ul></div><div class="markdown-body"><p>转眼间又一年过去了，说实话，我的 2016 年并不是非常有趣，这一整年我都是一个人住在昆山，显得有些单调，而且因为刚刚写了一篇「20 岁的我在想些什么」，所以可以写在年度小结中的内容实在是不多了。</p>
<p>因为皮蛋豆腐需要照顾，原打算春节就不回家了，但后来计划有变，我提前了一周休假回家，拜托同事帮忙照顾皮蛋豆腐。然后在家待了一周，除夕赶回苏州 —— 再帮忙照顾同事家的两只猫，这也是我第一次一个人过除夕，有了皮蛋豆腐现在并不能很随意的出游算是一个遗憾，虽然自动喂食机和滤水器还是能应付一到两天的。</p>
<p>今年年初皮蛋豆腐分别做了绝育手术，一切也还算顺利。很多人说猫绝育后会变胖，因为我喜欢身手矫健的猫咪，所以我对皮蛋豆腐的体重还是很在意的，于是一整年我都在用厨房秤精确地控制它们的猫粮，最后它们的体重稳定在了 3.5 千克，我还是很满意的。皮蛋豆腐长大成为成年猫咪之后比之前稳重了一些，但依然还是会撕开我的零食、在房间里跳来跳去，所以我还是不得不在一些时候把它们关到阳台上。</p>
<p>今年作息时间规律了一些，虽然依然是晚睡晚起，但相比之前两年还是规律了很多。晚上睡不着觉的问题依旧没什么改善，而第二天早上又要上班，这一度导致在上半年我的平均睡眠时间只有六个半小时；后来下半年因为意识到了视力的重要性，将睡觉时间提前了一些，睡不着就在听一档关于英语学习的播客，效果还不错；今年的最后两个月，我的房子附近开始有非常大的噪音 —— 每天天还没亮就会放半个小时礼炮，令我十分抓狂，如果这种状况持续下去，我可能不得不提前离开苏州了。</p>
<p>三月初和公司一起去了一趟越南芽庄，很久没有这样连续安排一周的行程了，虽然一直在海边，但我除了在水深不超过一米的岸边划了划船之外并没有下水。不过越南的海鲜还是挺好吃的，让我觉得以前不爱吃海鲜大概只是因为没吃到好吃或新鲜的缘故。这也是我第一次离开中国到另外一个国家，让我感到不同国家、不同民族之间，有一些地方是那么地相似，又有一些地方则截然不同。</p>
<p>今年我发现我在线上发展粉丝遇到了一些瓶颈，也很长时间没有结识新朋友了 —— 无论是线上还是线下，这不是一个好现象，于是我尝试去线下活动做演讲来「刷脸」，今年一共在四次线下活动做了技术分享，都是在杭州：Connext、稀土 Meetup，以及 Node Patry 的两次活动。因为之前在公司内部做的几次技术分享，已经有了一些制作幻灯片的经验，但第一次面对台下几十个人的时候还是有点慌，第一次在 Connext 的技术分享效果并不是很好，一方面是我过于紧张，另一方面是选题也显得不是很恰当，但之后的几次活动效果都还不错，也认识了一些新的有趣的朋友。</p>
<p>今年我花了很多时间在听播客上面，我在听 IPN 的「太医来了」、「选美」、「味之道」，也在听「内核恐慌」、「代码时间」、「Teahour」。听着听着总是有自己录一档的冲动，终于在经过了很多的准备工作之后，在八月初将这个想法付诸了行动，也就是后来的「彩排」播客。相比于写文章，录制博客是一种完全不同的体验：你后期修改的空间很小，一旦有错误要么重录要么只能将就，其实彩排的每期博客我都录了三遍以上，以便能剪辑出一个较好的版本；同时它对听众的要求也很高，听众必须拿出相对整块的时间来收听你的博客，而不能像看文章一样语言扫过，而且有听播客习惯的人也相对较少。</p>
<p>在去年年末买了摩卡壶之后，我才意识到咖啡是分成美式和意式的，后来也折腾了不同的咖啡豆，再后来双十二趁着打折还买了一个意式半自动咖啡机。我也花了很多时间在游戏上面，包括年中发布的守望先锋，但更多的还是 Steam 上一些「盖房子」的独立游戏。</p>
</div></article><article><header><h2><a href="/2016/12/leancloud-graphql/">在 LeanCloud 中使用 GraphQL</a></h2></header><div class="article-meta clearfix"><time class="left">2016 12 月 24 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tag/web/">Web</a></li><li><a href="/tag/LeanCloud/">LeanCloud</a></li></ul></div><div class="markdown-body"><p><a href="http://graphql.org/" target="_blank" rel="external">GraphQL</a> 是 FaceBook 开源的一套数据查询语言，也是 <a href="https://facebook.github.io/relay/" target="_blank" rel="external">Relay</a> 钦定的组件，可以在客户端以一种非常灵活的语法来获取数据，但目前支持 GraphQL 的服务还比较少，最近 <a href="http://githubengineering.com/the-github-graphql-api/" target="_blank" rel="external">GitHub 也宣布了其开放 API 支持了 GraphQL</a>。</p>
<p>因为 GraphQL 的支持需要服务器端的更改，因此我选择了在 LeanCloud 的数据服务的基础上用 Node.js 编写一个中间层，运行在云引擎上，将 GraphQL 的查询翻译成对 LeanCloud SDK 的调用，为客户端提供 GraphQL 支持。</p>
<p>我也参考了其他语言和框架的 GraphQL 支持，它们都需要开发者进行很多的开发或配置工作。这是因为无论在 MySQL 还是 MongoDB 中都并没有记录数据之间的关联关系（Id 和 ObjectId 都不会记录指向的表或集合，MySQL 的外键倒是会记录，但可惜用户不多）；而且即使你定义了数据之间的关联，你还是需要去定义权限 —— 哪些用户可以访问哪些数据。</p>
<p>而 LeanCloud 的 Relation 和 Pointer 都记录了所指向的 Class，同时 LeanCloud 本身也有一套基于 sessionToken 和 ACL 的权限控制机制，因此我们完全可以做到从 LeanCloud 的数据服务获取数据之间的管理，然后遵循现有的 ACL 来自动实现对 GraphQL 的支持。</p>
<p><a href="https://github.com/leancloud/leancloud-graphql" target="_blank" rel="external">leancloud-graphql</a> 就是这样的一个项目，你只需将它部署到云引擎上，不需要改动一行代码，便可以用 GraphQL 查询你在 LeanCloud 上的所有数据。</p>
<p>相较于 RESTful 和 SQL，GraphQL 为数据定义了严格的类型，你可以使用这样一个灵活的语言将数据通过关系组合起来，所见即所得地得到你想要的数据。得益于 GraphQL 的类型系统，你还可以在调试工具（<a href="https://graphql.leanapp.cn/" target="_blank" rel="external">graphql.leanapp.cn</a>）中得到精确的错误提示和补全建议。</p>
<p>例如这里我们查询 Todo 这个 Class 中按优先级排序的前两条数据，获取 title、priority，并将 owner 这个 Pointer 展开：</p>
<pre><code class="graphql">query {
  Todo(ascending: priority, limit: 2) {
    title, priority, owner {
      username
    }
  }
}
</code></pre>
<p>结果：</p>
<pre><code class="javascript">{
  Todo: [{
    title: &quot;紧急 Bug 修复&quot;,
    priority: 0,
    owner: {
      username: &quot;someone&quot;
    }
  }, {
    title: &quot;打电话给 Peter&quot;,
    priority: 5,
    owner: {
      username: &quot;someone&quot;
    }
  }]
}
</code></pre>
<p>目前 leancloud-graphql 已经实现了 LeanCloud 中大部分的查询参数和查询条件，你可以任意地组合这些条件。例如我们可以查询优先级大于 5 且存在 content 属性的数据：</p>
<pre><code class="graphql">query {
  Todo(exists: {content: true}, greaterThan: {priority: 5}) {
    title, content, priority
  }
}
</code></pre>
<p>GraphQL 最大的亮点还是对关系查询的支持，无论是 Relation 还是 Pointer 你都可以任意地展开，而不必受到 LeanCloud RESTful API 只能展开一层的限制。例如我们查询所有的 TodoFolder 中的 Todo（Relation）并展开 owner（Pointer）：</p>
<pre><code class="graphql">query {
  TodoFolder {
    name,
    containedTodos {
      title, owner {
        username, email
      }
    }
  }
}
</code></pre>
<p>结果（省略了一部分）：</p>
<pre><code class="javascript">{
  TodoFolder: [{
    name: &quot;工作&quot;,
    containedTodos: [{
      title: &quot;紧急 Bug 修复&quot;,
      owner: {
        username: &quot;someone&quot;,
        email: &quot;test@example.com&quot;
      }
    }, // ...
    ]
  }, // ...
  ]
}
</code></pre>
<p>你也可以在关系查询上附加查询参数或条件。例如我们查询所有 TodoFolder 中优先级最高的一个 Todo：</p>
<pre><code class="graphql">query {
  TodoFolder {
    name, containedTodos(limit: 1, ascending: priority) {
      title, priority
    }
  }
}
</code></pre>
<p>结果：</p>
<pre><code class="javascript">{
  TodoFolder: [{
    name: &quot;工作&quot;,
    containedTodos: [
      {title: &quot;紧急 Bug 修复&quot;, priority: 0}
    ]
  },
    name: &quot;购物清单&quot;,
    containedTodos: [
      {title: &quot;买酸奶&quot;, priority: 10}
    ]
  }, {
    name: &quot;someone&quot;,
    containedTodos: [
      {title: &quot;紧急 Bug 修复&quot;, priority: 0}
    ]
  }]
}
</code></pre>
<p>在实现一对多关系时，我们经常会在「多」上面保存一个到「一」的指针，例如一个 Todo 会有一个叫 owner 的 Pointer 指向用户表。在这时，leancloud-graphql 会自动在用户表上添加一个叫 ownerOfTodo 的属性用来表示这个反向关系，你可以像展开一个 Relation 一样展开这个反向关系，例如我们查询每个用户的 Todo 并展开 title：</p>
<pre><code class="graphql">query {
  _User {
    username, ownerOfTodo {
      title
    }
  }
}
</code></pre>
<p>结果：</p>
<pre><code class="javascript">{
  _User: [{
    username: &quot;someone&quot;,
    ownerOfTodo: [
      {title: &quot;紧急 Bug 修复&quot;},
      {title: &quot;打电话给 Peter&quot;},
      {title: &quot;还信用卡账单&quot;},
      {title: &quot;买酸奶&quot;}
    ]
  }]
}
</code></pre>
<p>对 <a href="https://github.com/leancloud/leancloud-graphql" target="_blank" rel="external">leancloud-graphql</a> 的简单介绍就到这里，更多使用方法和功能介绍可以在项目的 GitHub 主页上看到，这个项目本身也是开源的。</p>
</div></article><div class="archive-pagination"><div class="paginator"><a class="extend prev" rel="prev" href="/">&laquo;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/71/">71</a><a class="extend next" rel="next" href="/page/3/">&raquo;</a></div></div></div><div class="block-sidebar column one-fourth"><div class="widget text-content"><p>精子生于 1995.11.25, 21 岁，英文 ID jysperm.</p>
<ul>
<li>有一个 <a href="https://jybox.net">精子粉丝团</a></li>
<li><a href="http://pidan.cat">皮蛋</a> 和 <a href="http://doufu.cat">豆腐</a> 的主人</li>
<li>创建了 <a href="https://atom-china.org">Atom 中文社区</a></li>
<li>坚持十余年的 <a href="https://jysperm.me">独立博客</a> 作者</li>
<li>高中退学，就职于 <a href="https://leancloud.cn">LeanCloud</a></li>
<li>在 <a href="https://github.com/jysperm">Github</a> 上积极参与开源社区</li>
</ul>
</div><div class="widget text-content"><h2>订阅推送</h2><p>通过邮件订阅精子的博客日志、产品和项目的最新动态，精子承诺每一封邮件都会认真撰写（<a href="http://us13.campaign-archive1.com/home/?u=f4c7c26ec1a5dc400a7a7373e&amp;id=e2136d8929">历史邮件</a>），有想和精子说的话也可以直接回复邮件。</p><div id="mc_embed_signup"><form id="mc-embedded-subscribe-form" action="//jybox.us13.list-manage.com/subscribe/post?u=f4c7c26ec1a5dc400a7a7373e&amp;id=e2136d8929" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate="" class="validate"><div id="mc_embed_signup_scroll" class="input-group"><input id="mce-EMAIL" type="email" value="" name="EMAIL" placeholder="email address" required="" class="form-control"/><input type="hidden" name="b_f4c7c26ec1a5dc400a7a7373e_e2136d8929" value=""/><span class="input-group-button"><div class="form-actions"><button id="mc-embedded-subscribe" type="submit" value="Subscribe" name="subscribe" class="btn">订阅</button></div></span></div></form></div></div><div class="widget tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tag/atom/">Atom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/cpp/">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/cpp-ppt/">C++讲稿</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/golang/">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/html/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/javascript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/LeanCloud/">LeanCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/lightphp/">LightPHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/mongodb/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/nodejs/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/php/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/rpvhost/">RP主机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/rootpanel/">RootPanel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/sicp/">SICP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/idea/">idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/traditional-medicine/">中医</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/internet/">互联网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/news/">互联网资讯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/values/">价值观</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/works/">作品</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/information-security/">信息安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/cold-knowledge/">冷知识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/blockchain/">区块链</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/unit-test/">单元测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/blog/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/去中心化/">去中心化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/doraemon/">哆啦A梦</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/school-weekly/">学校周记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/exam/">学校考试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/cryptography/">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/xiaolu/">小璐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/summary-of-year/">年度小结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/caipai/">彩排</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/xuxueli/">徐雪丽</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/summary/">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/technology/">技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/tutorials/">教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/education/">教育</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/server-side/">服务器端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/bitcoin/">比特币</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/physical/">物理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/live/">生活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/live/">生活记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/movie/">电影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/science/">科普</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/reading-notes/">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/story-of-sperm/">精子的故事</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/programming/">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/programming-language/">编程语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/computer-science/">计算机科学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/network/">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/reading/">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/shopping/">购物</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/software-engineering/">软件工程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/note/">随笔</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/zeroms/">零毫秒</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/hacker/">黑客</a></li></ul></div><div class="widget archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/2017/02/">二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2017/01/">一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/12/">十二月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/11/">十一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/10/">十月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/06/">六月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/04/">四月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/12/">十二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/11/">十一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/08/">八月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/06/">六月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/05/">五月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/04/">四月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/03/">三月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/02/">二月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2015/01/">一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/12/">十二月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/11/">十一月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/10/">十月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/09/">九月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/08/">八月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/07/">七月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/06/">六月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/05/">五月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/04/">四月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/03/">三月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/02/">二月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2014/01/">一月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/12/">十二月 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/11/">十一月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/10/">十月 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/09/">九月 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/08/">八月 2013</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/07/">七月 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/06/">六月 2013</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/05/">五月 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/04/">四月 2013</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/03/">三月 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2013/02/">二月 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/12/">十二月 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/11/">十一月 2012</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/10/">十月 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/09/">九月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/08/">八月 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/06/">六月 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/05/">五月 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/04/">四月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/03/">三月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/02/">二月 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2012/01/">一月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/12/">十二月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/11/">十一月 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/10/">十月 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/09/">九月 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/08/">八月 2011</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/07/">七月 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/06/">六月 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/05/">五月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2011/03/">三月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2010/05/">五月 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2010/01/">一月 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2008/01/">一月 2008</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2007/10/">十月 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2007/09/">九月 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2007/02/">二月 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2006/08/">八月 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2005/08/">八月 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2005/01/">一月 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2003/11/">十一月 2003</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2003/10/">十月 2003</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2003/08/">八月 2003</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/2002/08/">八月 2002</a><span class="archive-list-count">1</span></li></ul></div><div class="widget text-content"><p>该博客使用基于 &nbsp;<a href="http://hexo.io">Hexo</a>&nbsp; 的 &nbsp;<a href="https://github.com/jysperm/hexo-theme-simpleblock">simpleblock</a>&nbsp; 主题。博客内容使用 &nbsp;<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn">CC BY-NC-SA 3.0</a>&nbsp; 授权发布。最后生成于 2017-03-13.</p></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49193300-1', 'auto');
ga('send', 'pageview');
</script></body></html>