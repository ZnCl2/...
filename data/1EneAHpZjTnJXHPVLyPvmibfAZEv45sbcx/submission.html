
<!DOCTYPE html>

<html>
<head>
 <title>New ZeroNet site!</title>
 <meta charset="utf-8">
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <base href="" target="_top" id="base">
 <script>base.href = document.location.href.replace("/media", "").replace("index.html", "").replace(/[&?]wrapper=False/, "").replace(/[&?]wrapper_nonce=[A-Za-z0-9]+/, "")</script>
 <style>

body { background-color: white; }

#submissions td
{
  font-size:1em;
  border:1px solid #eee;
  padding:3px 7px 2px 7px;
}
#submissions b { color: #3F51B5; }  
#submissions tr { background-color: #F9FAFD; }
</style>
 </head>

<body>

<center>
	<table width="85%"> 
		<tbody>
			<tr align="center" class="hd" valign="top">
				<th><a href="./">Home</a></th>
				<th><a href="./discuss.html">Discuss</a></th>
				<th><a href="./problem.html">Problem</a></th>
				<th><a href="./submission.html">Submission</a></th>
				<th><a href="#Select+user" id="select_user" onclick='return page.selectUser()'>Login</a></th>
			</tr>
		</tbody>
	</table>
</center>


<table id="submissions" align="center">

</table>
<script type="text/javascript" src="js/ZeroFrame.js"></script>

<script>
class ZeroSubmission extends ZeroFrame {

    loadSubmissions () {
        this.cmd("dbQuery", ["SELECT * FROM submission ORDER BY date_added DESC"], (submissions) => {
            document.getElementById("submissions").innerHTML = "<tbody>"  
			document.getElementById("submissions").innerHTML +="<tr><th>Submit Time</th><th>Problem</th><th>User</th><th>Result</th></tr>"
            for (var i=0; i < submissions.length; i++) {
                this.addSubmission(submissions[i].user, submissions[i].result,submissions[i].pub,submissions[i].date_added)
            }
			document.getElementById("submissions").innerHTML += "</tbody>"
        })
    }
    first(s,c){
		var ans="";
		if(s.length>=c){
			for(var i=0;i<c;i++){
				ans+=s[i];
			}
		}else{
			ans=s;
			for(var i=s.length;i<c;i++){
				ans+=" ";
			}
		}
		return ans;
	}
    selectUser () {
        this.cmd("certSelect", {accepted_domains: ["zeroid.bit"]})
        return false
    }
    onRequest (cmd, message) {
        if (cmd == "setSiteInfo") {
            if (message.params.cert_user_id)
                document.getElementById("select_user").innerHTML = message.params.cert_user_id
            else
                document.getElementById("select_user").innerHTML = "Select user"
            this.site_info = message.params  // Save site info data to allow access it later
        }
    }	
	getdate(now) {
        var y = now.getFullYear(),
            m = ("0" + (now.getMonth() + 1)).slice(-2),
            d = ("0" + now.getDate()).slice(-2);
        return y + "-" + m + "-" + d + " " + now.toTimeString().substr(0, 8);
    }
    addSubmission (username, result,pub,time) {
        var result_escaped = result.replace(/</g, "&lt;").replace(/>/g, "&gt;")  // Escape html tags in the message
		var submitTime=this.getdate(new Date(time));
		
		
        document.getElementById("submissions").innerHTML += "<tr> <td> <center>" + submitTime +" </center></td> <td><center>"+this.first(pub,8) + "</center></td> "+ "<td> <center><b>"+ username + " </b></center></td> "+ "<td> <center><font color="+(result_escaped=="Accepted"?"\"green\"" : "\"red\"")+">"+result_escaped + "</font></center></td> "+ "</tr>"
    }
	
    onOpenWebsocket () {
        this.cmd("siteInfo", {}, (site_info) => {
            if (site_info.cert_user_id)
                document.getElementById("select_user").innerText = site_info.cert_user_id
            this.site_info = site_info
        })		
    }
}

page = new ZeroSubmission()
page.loadSubmissions()
</script>
</body>

</html>