<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      
<title>JSON Hacks - Random Thoughts</title>


      <!-- CSS -->
      <link rel="stylesheet" href="&#x2F;1CiDoBP8RiWziqiBGEd8tQMy66A6fmnw2V/print.css" media="print">
      <link rel="stylesheet" href="&#x2F;1CiDoBP8RiWziqiBGEd8tQMy66A6fmnw2V/poole.css">
      <link rel="stylesheet" href="&#x2F;1CiDoBP8RiWziqiBGEd8tQMy66A6fmnw2V/hyde.css">
      <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> -->

      

      
      
    </head>

    <body class="theme-base-08 ">
        
            <div class="sidebar">
                <div class="container sidebar-sticky">
                    <div class="sidebar-about">
                        
                            <!-- <a href="&#x2F;1CiDoBP8RiWziqiBGEd8tQMy66A6fmnw2V" target="_top"><h1>Random Thoughts</h1></a> -->
                            
                        
                    </div>

                    <ul class="sidebar-nav">
                        
                            <li><a href="https:&#x2F;&#x2F;github.com&#x2F;MuxZeroNet" target="_top">GitHub</a></li>
                            <li><a href="https:&#x2F;&#x2F;ieji.de&#x2F;@zeromux" target="_top">Mastodon</a></li>
                            <br>

                            
<li><a href="&#x2F;1CiDoBP8RiWziqiBGEd8tQMy66A6fmnw2V" target="_top">Home</a></li>
<li><a href="&#x2F;1CiDoBP8RiWziqiBGEd8tQMy66A6fmnw2V/categories" target="_top">Categories</a></li>

                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
<div class="post">
  <h1 class="post-title">JSON Hacks</h1>
  <span class="post-date">2018-01-20</span>
  <p>It's <a href="json.jpg">not a good idea</a> to store digital sigantures in JSON. In JSON, an arbitrary amount of whitespaces may be present between any token; binary data must be stored in base 64 or escaped encoding; serialization is non-deterministic due to dict implementation.</p>
<h3 id="gnupg-and-libsodium">GnuPG and libsodium</h3>
<p>The format of a &quot;signed file&quot; is defined by the crypto library, not the client. After you call <code>verify(signed)</code>, the crypto library parses the signed file, verifies the signature in it, and finally, returns the message.</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#cb4b16;">import</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">nacl</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#657b83;">encoding</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#cb4b16;">import</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">nacl</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#657b83;">signing</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signing_key</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">nacl</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#657b83;">signing</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#657b83;">SigningKey</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">generate</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signed</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signing_key</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">sign</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">Attack at Dawn</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">verify_key</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signing_key</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#657b83;">verify_key</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">verify_key</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">verify</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">signed</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">Attack at Dawn</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre>
<p>It is also interesting to see how crypto libraries format a &quot;signed file.&quot; A digital signature is either prepended before or appended after the message stream. Sometimes, a digital signature is saved as a separate file.</p>
<p>In GnuPG, the signature is either appended after the message stream <code>--clearsign</code>, or saved as a separate file <code>--detach-sig</code>.</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">alice% gpg --clearsign doc
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">You need a passphrase to unlock the secret key for
</span><span style="background-color:#fdf6e3;color:#657b83;">user: &quot;Alice (Judge) &lt;alice@cyb.org&gt;&quot;
</span><span style="background-color:#fdf6e3;color:#657b83;">1024-bit DSA key, ID BB7576AC, created 1999-06-04
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">-----BEGIN PGP SIGNED MESSAGE-----
</span><span style="background-color:#fdf6e3;color:#657b83;">Hash: SHA1
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">[...]
</span><span style="background-color:#fdf6e3;color:#657b83;">-----BEGIN PGP SIGNATURE-----
</span><span style="background-color:#fdf6e3;color:#657b83;">Version: GnuPG v0.9.7 (GNU/Linux)
</span><span style="background-color:#fdf6e3;color:#657b83;">Comment: For info see http://www.gnupg.org
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">iEYEARECAAYFAjdYCQoACgkQJ9S6ULt1dqz6IwCfQ7wP6i/i8HhbcOSKF4ELyQB1
</span><span style="background-color:#fdf6e3;color:#657b83;">oCoAoOuqpRqEzr4kOkQqHRLE/b8/Rw2k
</span><span style="background-color:#fdf6e3;color:#657b83;">=y6kj
</span><span style="background-color:#fdf6e3;color:#657b83;">-----END PGP SIGNATURE-----
</span></pre>
<p>In libsodium, the signature is prepended before the message stream. To verify a message, libsodium will:</p>
<ol>
<li>
<p>load the signature from the beginning of the byte array <code>signed</code> (the signature is a fixed-length binary string)</p>
</li>
<li>
<p>construct a hasher, read the rest of the byte array signed as the message, hash the message, and check the signature against the hash</p>
</li>
</ol>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signed</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\xa1</span><span style="background-color:#fdf6e3;color:#2aa198;">=b</span><span style="background-color:#fdf6e3;color:#dc322f;">\xd8</span><span style="background-color:#fdf6e3;color:#2aa198;">v </span><span style="background-color:#fdf6e3;color:#dc322f;">\xb2</span><span style="background-color:#fdf6e3;color:#dc322f;">\xbf</span><span style="background-color:#fdf6e3;color:#dc322f;">\t</span><span style="background-color:#fdf6e3;color:#dc322f;">\x01</span><span style="background-color:#fdf6e3;color:#dc322f;">\x93</span><span style="background-color:#fdf6e3;color:#2aa198;">2</span><span style="background-color:#fdf6e3;color:#dc322f;">\xc7</span><span style="background-color:#fdf6e3;color:#dc322f;">\x00</span><span style="background-color:#fdf6e3;color:#dc322f;">\xac</span><span style="background-color:#fdf6e3;color:#dc322f;">\xd6</span><span style="background-color:#fdf6e3;color:#dc322f;">\xb0</span><span style="background-color:#fdf6e3;color:#2aa198;">I</span><span style="background-color:#fdf6e3;color:#dc322f;">\xea</span><span style="background-color:#fdf6e3;color:#2aa198;">Q</span><span style="background-color:#fdf6e3;color:#dc322f;">\x82</span><span style="background-color:#fdf6e3;color:#dc322f;">\xe7</span><span style="background-color:#fdf6e3;color:#2aa198;">,</span><span style="background-color:#fdf6e3;color:#dc322f;">\xb3</span><span style="background-color:#fdf6e3;color:#dc322f;">\x8d</span><span style="background-color:#fdf6e3;color:#dc322f;">\xd6</span><span style="background-color:#fdf6e3;color:#2aa198;">x</span><span style="background-color:#fdf6e3;color:#dc322f;">\x1f</span><span style="background-color:#fdf6e3;color:#dc322f;">\xbf</span><span style="background-color:#fdf6e3;color:#2aa198;">S0</span><span style="background-color:#fdf6e3;color:#dc322f;">\x08</span><span style="background-color:#fdf6e3;color:#dc322f;">\x06</span><span style="background-color:#fdf6e3;color:#dc322f;">\xe2</span><span style="background-color:#fdf6e3;color:#dc322f;">\xfc</span><span style="background-color:#fdf6e3;color:#2aa198;">Du</span><span style="background-color:#fdf6e3;color:#dc322f;">\xc8</span><span style="background-color:#fdf6e3;color:#2aa198;">Og6</span><span style="background-color:#fdf6e3;color:#dc322f;">\xf8</span><span style="background-color:#fdf6e3;color:#2aa198;">S</span><span style="background-color:#fdf6e3;color:#dc322f;">\x81</span><span style="background-color:#fdf6e3;color:#dc322f;">\xd2</span><span style="background-color:#fdf6e3;color:#2aa198;">O</span><span style="background-color:#fdf6e3;color:#dc322f;">\x83</span><span style="background-color:#fdf6e3;color:#dc322f;">\xde</span><span style="background-color:#fdf6e3;color:#dc322f;">\xd6</span><span style="background-color:#fdf6e3;color:#2aa198;">I</span><span style="background-color:#fdf6e3;color:#dc322f;">\xee</span><span style="background-color:#fdf6e3;color:#2aa198;">~&amp;</span><span style="background-color:#fdf6e3;color:#dc322f;">\xf2</span><span style="background-color:#fdf6e3;color:#dc322f;">\n</span><span style="background-color:#fdf6e3;color:#dc322f;">\xbe</span><span style="background-color:#fdf6e3;color:#2aa198;">g</span><span style="background-color:#fdf6e3;color:#dc322f;">\xbf</span><span style="background-color:#fdf6e3;color:#2aa198;">*</span><span style="background-color:#fdf6e3;color:#dc322f;">\xd2</span><span style="background-color:#fdf6e3;color:#2aa198;">A</span><span style="background-color:#fdf6e3;color:#dc322f;">\x98</span><span style="background-color:#fdf6e3;color:#2aa198;">&quot;</span><span style="background-color:#fdf6e3;color:#dc322f;">\t</span><span style="background-color:#fdf6e3;color:#2aa198;">Attack at Dawn</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre>
<p>A good crypto library stores the digital signature in its own way. Chances are, as a client, you need not think about how the signature is stored.</p>
<p>However, not all crypto libraries follow this convention.</p>
<h3 id="polyglot">Polyglot</h3>
<p>Write once, parse everywhere.</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#93a1a1;">&lt;!--</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#ec9489;color:#93a1a1;">-----</span><span style="background-color:#fdf6e3;color:#93a1a1;">BEGIN PGP SIGNED MESSAGE</span><span style="background-color:#ec9489;color:#93a1a1;">-----</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">Hash: SHA512
</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">comment </span><span style="background-color:#fdf6e3;color:#93a1a1;">--&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">&lt;</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#93a1a1;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">This</span><span style="background-color:#fdf6e3;color:#93a1a1;">&lt;/</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#93a1a1;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> is a polyglot. It is both an HTML page and a GPG signed file.
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">&lt;!--</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#ec9489;color:#93a1a1;">-----</span><span style="background-color:#fdf6e3;color:#93a1a1;">BEGIN PGP SIGNATURE</span><span style="background-color:#ec9489;color:#93a1a1;">-----</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">Version: GnuPG v2
</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">iQIcBAEBCgAGBQJaZO8nAAoJEJ4fhDcqATHciH0P/AxF7vkPVr6Im4+6xIdIYKmI
</span><span style="background-color:#fdf6e3;color:#93a1a1;">VvSKCD4ZE0RCnxNYyuywzkclM6UFdFIzkPSCczk5J9y8O6puGkwTqPMPoBFDJG5b
</span><span style="background-color:#fdf6e3;color:#93a1a1;">fsJ6oEPkpJEQc0Dir4BYDkQikG9Gj8QnmgEU4ydoDqIxTp2pb7OR8qOIrtuZ6f1w
</span><span style="background-color:#fdf6e3;color:#93a1a1;">H4TO1nby+URP65M6sngac14UaIedrZR26gGBR749Bsg9xek9FU5QtK8HJ/GzEMCz
</span><span style="background-color:#fdf6e3;color:#93a1a1;">UZDIhrwshG2IIuNpXDrUKL1gBdYl0sXMf7h5u/rMFdkLzZdeZ3vnzrCfoJDIl0FF
</span><span style="background-color:#fdf6e3;color:#93a1a1;">bTTyPjoIXN1Z7ADd7UrbabozUeKMh14E6KqE878Msai3QybwUvEwPFWV4emfG4YZ
</span><span style="background-color:#fdf6e3;color:#93a1a1;">fL6csS4zZSDDzzk4PHigFiYjiN+/jdFlM6gtKYPXIayzL1NDHlvbJTgRJ1MAYLF3
</span><span style="background-color:#fdf6e3;color:#93a1a1;">EXDdaatKlws2XwwEtabtP7pGO1LWsVQx22e3BYMXfVmHkarxKZ2CO3QsGUN6HtfB
</span><span style="background-color:#fdf6e3;color:#93a1a1;">nfGBSGdowUv4pJF9XoK0UFBLls7w8xC6AS5fheoWUBXHVrs4RnCY5lIIDL6nmzQ3
</span><span style="background-color:#fdf6e3;color:#93a1a1;">62Y1lSoMoEqV/7ViPqjidaJIBtfEDzw+aturCghvVVFoBbVziWEp9zVR055C0PgY
</span><span style="background-color:#fdf6e3;color:#93a1a1;">PHMfz7iUIkpRH2xgmIsRWJqYkgQmHU1q/XrDGH/DD1BiuohMbOEx0BIwGFJjSLtJ
</span><span style="background-color:#fdf6e3;color:#93a1a1;">58DfjAjru2S45vqqrGUT
</span><span style="background-color:#fdf6e3;color:#93a1a1;">=5JfQ
</span><span style="background-color:#ec9489;color:#93a1a1;">-----</span><span style="background-color:#fdf6e3;color:#93a1a1;">END PGP SIGNATURE</span><span style="background-color:#ec9489;color:#93a1a1;">-----</span><span style="background-color:#fdf6e3;color:#93a1a1;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">--&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre><h3 id="json-polyglot-good-for-text-editors">JSON polyglot (good for text editors)</h3>
<p>JSON itself is unfit for storing digital signatures. Why not borrow some ideas from libsodium?</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#839496;">&quot;</span><span style="background-color:#fdf6e3;color:#2aa198;">00.HHhuRMSXE8S8yzeRfK7+t13kcolpjj0OU+BB9CsKWVFGP1okf7xFr6DQ8j1V2yVjqQhgUN1z9/rXYaoLBEIf+AE=</span><span style="background-color:#fdf6e3;color:#839496;">&quot;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#839496;">&quot;</span><span style="background-color:#fdf6e3;color:#2aa198;">k</span><span style="background-color:#fdf6e3;color:#839496;">&quot;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#839496;">&quot;</span><span style="background-color:#fdf6e3;color:#2aa198;">v</span><span style="background-color:#fdf6e3;color:#839496;">&quot;</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre>
<p>The string as a whole is not valid JSON, but it is still human readable, and computer parsable. This is how it works:</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">version || signature_base64 || end_quote || message
</span></pre><table><thead><tr><th> Field     </th><th> Description </th></tr></thead><tbody>
<tr><td> <code>version</code> </td><td> a fixed-length (4 bytes) ASCII string. </td></tr>
<tr><td> <code>signature_base64</code> </td><td> the signature, base64 encoded, still a fixed-length string, length depending on the algorithm. </td></tr>
<tr><td> <code>end_quote</code> </td><td> a quotation mark. </td></tr>
<tr><td> <code>message</code> </td><td>the JSON text. </td></tr>
</tbody></table>
<p>Therefore, the polyglot decodes as the following:</p>
<table><thead><tr><th align="center"> version </th><th align="center"> signature_base64 </th><th> end_quote </th><th> message        </th></tr></thead><tbody>
<tr><td align="center"> <code>&quot;00.</code>  </td><td align="center"> <code>HHhuRMSXE8S</code>... </td><td align="center"> <code>&quot;</code>       </td><td align="center"> <code>\n{&quot;k&quot;: &quot;v&quot;}</code> </td></tr>
</tbody></table>
<p>Although it is not valid JSON, it has several advantages:</p>
<ul>
<li>It is human readable.</li>
<li>Quotation marks are added so that syntax highlighters won't freak out.</li>
<li>It reads perfectly in both binary mode and unicode mode. The version, signature and end quote are both valid ASCII and valid UTF-8.</li>
<li>You are free to choose between <code>LF</code> and <code>CRLF</code>. It doesn't care what line break characters you use. Line break characters, if present after the <code>end_quote</code>, are considered part of the <code>message</code>.</li>
</ul>
<h3 id="msgpack-hacks">MsgPack hacks</h3>
<p>Unlike JSON, MsgPack can store binary data directly. However, due to dict implementation, the serialization of MsgPack is non-deterministic.</p>
<p>Thanks to the recursive structure of MsgPack, here is a way to make it suitable for signing:</p>
<ol>
<li>Pack the message into a byte array. Sign the byte array.</li>
<li>Pack the version string and the signature into a key (key as in a dictionary).</li>
<li>Write a header. Write the key. Write the message.</li>
</ol>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#cb4b16;">import</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">struct</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#cb4b16;">import</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">version</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">00</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">message</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">dumps</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">anything</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#6c71c4;">1</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signature</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">S</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">*</span><span style="background-color:#fdf6e3;color:#6c71c4;">64</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">key_len</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">struct</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">pack</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">&gt;B</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">,</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#859900;">len</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">version</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#859900;">len</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">signature</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">key_len</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">B</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\x81</span><span style="background-color:#fdf6e3;color:#dc322f;">\xC4</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">key_len</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">b</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">version</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signature</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">message</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">loads</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">b</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">00SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">anything</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#6c71c4;">1</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre><table><thead><tr><th align="center"> dict header </th><th> str header    </th><th> str len   </th><th> str                 </th><th> message  </th></tr></thead><tbody>
<tr><td align="left"> <code>\x81</code>      </td><td align="left"> <code>\xC4</code> (bin8) </td><td align="left"> <code>B</code> (=66) </td><td align="center"> version + signature </td><td align="center"> anything </td></tr>
</tbody></table>
<p>Or simply:</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">dumps</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#657b83;">version</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">signature</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">message</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre><h3 id="bonus">Bonus</h3>
<p>The following byte array <code>b</code> consists of a <strong>header</strong>, a <strong>message</strong>, a <strong>signature header</strong> and a <strong>signature</strong>. When the message is a MsgPack payload, <code>b</code> also retains the MsgPack format.</p>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\x83</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA1</span><span style="background-color:#fdf6e3;color:#2aa198;">v</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA2</span><span style="background-color:#fdf6e3;color:#2aa198;">00</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA1</span><span style="background-color:#fdf6e3;color:#2aa198;">m</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">sig_header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA1</span><span style="background-color:#fdf6e3;color:#2aa198;">s</span><span style="background-color:#fdf6e3;color:#dc322f;">\xD9</span><span style="background-color:#fdf6e3;color:#dc322f;">\x40</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#cb4b16;">import</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">message</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">dumps</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">anything</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#6c71c4;">1</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">sig</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">S</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">*</span><span style="background-color:#fdf6e3;color:#6c71c4;">64</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">b</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">message</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">sig_header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">+</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">sig</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;">&gt;</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">msgpack</span><span style="background-color:#fdf6e3;color:#657b83;">.</span><span style="background-color:#fdf6e3;color:#268bd2;">loads</span><span style="background-color:#fdf6e3;color:#657b83;">(</span><span style="background-color:#fdf6e3;color:#657b83;">b</span><span style="background-color:#fdf6e3;color:#657b83;">)</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">v</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">00</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">,</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">m</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">{</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">anything</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#6c71c4;">1</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">,</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">s</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">:</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">}</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre>
<p>Explanation:</p>
<table><thead><tr><th align="center"> dict header </th><th> key     </th><th> str header       </th><th> version  </th><th> key     </th><th> message  </th></tr></thead><tbody>
<tr><td align="left"> <code>\x83</code>      </td><td align="left"> <code>\xA1v</code> </td><td align="left"> <code>\xA2</code> (str5)    </td><td align="left"> <code>00</code>     </td><td align="left"> <code>\xA1m</code> </td><td align="center"> anything </td></tr>
</tbody></table>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">     dict        str
</span><span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">   header  key   header
</span><span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">        |   |    |
</span><span style="background-color:#fdf6e3;color:#657b83;">head</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\x83</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA1</span><span style="background-color:#fdf6e3;color:#2aa198;">v</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA2</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">version</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">00</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">             key
</span><span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">              |
</span><span style="background-color:#fdf6e3;color:#657b83;">after_head</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA1</span><span style="background-color:#fdf6e3;color:#2aa198;">m</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre><table><thead><tr><th> key     </th><th> str header    </th><th> str len      </th><th> signature </th></tr></thead><tbody>
<tr><td align="left"> <code>\xA1s</code> </td><td align="left"> <code>\xD9</code> (str8) </td><td align="left"> <code>\x40</code> (=64) </td><td align="center"> 64 bytes  </td></tr>
</tbody></table>
<pre style="background-color:#fdf6e3">
<span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">                  str
</span><span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">             key head len
</span><span style="background-color:#fdf6e3;color:#93a1a1;">#</span><span style="background-color:#fdf6e3;color:#93a1a1;">              |    |   |
</span><span style="background-color:#fdf6e3;color:#657b83;">sig_header</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#dc322f;">\xA1</span><span style="background-color:#fdf6e3;color:#2aa198;">s</span><span style="background-color:#fdf6e3;color:#dc322f;">\xD9</span><span style="background-color:#fdf6e3;color:#dc322f;">\x40</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">
</span><span style="background-color:#fdf6e3;color:#657b83;">sig</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#657b83;">=</span><span style="background-color:#fdf6e3;color:#657b83;"> </span><span style="background-color:#fdf6e3;color:#268bd2;">b</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#2aa198;">S</span><span style="background-color:#fdf6e3;color:#839496;">&#39;</span><span style="background-color:#fdf6e3;color:#657b83;">*</span><span style="background-color:#fdf6e3;color:#6c71c4;">64</span><span style="background-color:#fdf6e3;color:#657b83;">
</span></pre>
<p>I hope this bonus section will help you understand MsgPack better.</p>

</div>

        </div>

    </body>

</html>
