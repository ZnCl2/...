{"cert_user_id": "jsinghrai@github", "next_topic_id": 2, "topic": [{"topic_id": 1604066990, "title": "Content Signing Error when creating a database", "body": "### Step 1: Please describe your environment\r\n\r\n  * ZeroNet version: 0.6.4-1\r\n  * Operating system: Arch Linux\r\n  * Web browser: Firefox Developer\r\n  * Tor status: not available\r\n  * Opened port: yes\r\n  * Special configuration: ____\r\n\r\n### Step 2: Describe the problem:\r\nI'm learning how to create the database for my zeronet site. I'm following imachug's guide (\"https://github.com/imachug/The-Truth-about-ZeroNet\"). After I created the data.json and dbschema.json files, I tried to sign and publish content.json file. I get this huge error: \"Content signing error\r\nOperationalError: unable to open database file in UiWebsocket.py line 451 > ContentManager.py line 663 > MergerSitePlugin.py line 292 > ContentFilterPlugin.py line 173 > SiteStorage.py line 291 > SiteStorage.py line 82 > Db.py line 166 > Db.py line 132 > Db.py line 62\"\r\nI don't know what to do next.\r\n#### Steps to reproduce:\r\n\r\n  1. Create a new site\r\n  2. create a data folder in your site folder and create admin folder in that data folder.\r\n  3. In admin folder create a file called data.json which will contain the data for one of your tables.\r\n  4. Then create the dbschema.json file your site folder.\r\n  5. Try to sign and publish content.json\r\n\r\n#### Observed Results:\r\n\r\n  * What happened? This could be a screenshot, a description, log output (you can send log/debug.log file to hello@zeronet.io if necessary), etc.\r\nWhen I try to sign and publish the content.json. Content signing error shows up. I checked the /var/log/zeronet/debug.log\r\n\r\n[2018-11-26 19:02:45,933] DEBUG    Db:ContentDb Optional size: 0.0MB/16614.1MB, Need delete: -16614.1MB                                                                                                                                                                    \r\n 21 [2018-11-26 19:02:46,077] DEBUG    SiteManager Saved sites in 0.00s (generate: 0.00s, write: 0.00s)                                                                                                                                                                        \r\n 20 [2018-11-26 19:02:46,078] DEBUG    SiteManager Updated merger sites in 0.000s                                                                                                                                                                                              \r\n 19 [2018-11-26 19:02:46,218] DEBUG    Site:154VXD..mbbB Need connections: 0, Current: 0, Total: 0                                                                                                                                                                             \r\n 18 [2018-11-26 19:02:47,220] DEBUG    Site:1Name2..hM9F Need connections: 6, Current: 6, Total: 159                                                                                                                                                                           \r\n 17 [2018-11-26 19:02:47,859] DEBUG    Site:154VXD..mbbB Signing: content.json                                                                                                                                                                                                 \r\n 16 [2018-11-26 19:02:47,859] INFO     Site:154VXD..mbbB Opening site data directory: var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/...                                                                                                                                   \r\n 15 [2018-11-26 19:02:47,859] INFO     Site:154VXD..mbbB - index.html                                                                                                                                                                                                          \r\n 14 [2018-11-26 19:02:47,860] INFO     Site:154VXD..mbbB - dbschema.json                                                                                                                                                                                                       \r\n 13 [2018-11-26 19:02:47,860] INFO     Site:154VXD..mbbB - [SKIPPED] content.json                                                                                                                                                                                              \r\n 12 [2018-11-26 19:02:47,860] INFO     Site:154VXD..mbbB - js/ZeroFrame.js                                                                                                                                                                                                     \r\n 11 [2018-11-26 19:02:47,861] INFO     Site:154VXD..mbbB - data/admin/data.json                                                                                                                                                                                                \r\n 10 [2018-11-26 19:02:47,861] DEBUG    Site:154VXD..mbbB Changed files: [u'content.json', u'dbschema.json']                                                                                                                                                                    \r\n  9 [2018-11-26 19:02:47,861] DEBUG    Db:mydatabase /var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/data/mydatabase.db closed in 0.000s, opened: 5                                                                                                                        \r\n  8 [2018-11-26 19:02:47,861] DEBUG    Site:154VXD..mbbB No database, waiting for dbschema.json...                                                                                                                                                                             \r\n  7 [2018-11-26 19:02:47,861] INFO     Site:154VXD..mbbB Creating tables...                                                                                                                                                                                                    \r\n  6 [2018-11-26 19:02:47,862] DEBUG    Db:mydatabase Db file not exist yet: /var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/data/mydatabase.db                                                                                                                             \r\n  5 [2018-11-26 19:02:47,862] ERROR    - Unhandled exception                                                                                                                                                                                                                   \r\n  4 Traceback (most recent call last):                                                                                                                                                                                                                                         \r\n  3   File \"src/gevent/greenlet.py\", line 716, in gevent._greenlet.Greenlet.run                                                                                                                                                                                                \r\n  2   File \"/opt/zeronet/src/Site/SiteStorage.py\", line 137, in rebuildDb                                                                                                                                                                                                      \r\n  1   \u250a db.checkTables()                                                                                                                                                                                                                                                       \r\n850   File \"/opt/zeronet/src/Db/Db.py\", line 166, in checkTables                                                                                                                                                                                                               \r\n  1   \u250a cur = self.getCursor()                                                                                                                                                                                                                                                 \r\n  2   File \"/opt/zeronet/src/Db/Db.py\", line 132, in getCursor                                                                                                                                                                                                                 \r\n  3   \u250a self.connect()                                                                                                                                                                                                                                                         \r\n  4   File \"/opt/zeronet/src/Db/Db.py\", line 62, in connect                                                                                                                                                                                                                    \r\n  5   \u250a self.conn = sqlite3.connect(self.db_path, check_same_thread=False)                                                                                                                                                                                                     \r\n  6 OperationalError: unable to open database file                                                                                                                                                                                                                             \r\n  7 [2018-11-26 19:02:47,863] DEBUG    Db:mydatabase Db file not exist yet: /var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/data/mydatabase.db                                                                                                                             \r\n  8 [2018-11-26 19:02:47,863] ERROR    Site:154VXD..mbbB Site sign error: content.json: OperationalError: unable to open database file in UiWebsocket.py line 451 > ContentManager.py line 663 > MergerSitePlugin.py line 292 > ContentFilterPlugin.py line 173 > SiteStorage.\u21b7\r\n  9 [2018-11-26 19:02:49,221] DEBUG    ConnServer Site announce tracker done in 3.003s, sleeping for 146.997s...                                                                                                                                                               \r\n~                                                                                                                                                                                                                                                                              \r\n~                                                                                                                                                                                                                                                                              \r\n~                                                                                                                                                                                                                                                                            \r\n\r\n#### Expected Results:\r\n\r\n  * What did you expect to happen?\r\nI'm expecting it would create mydatabase.db file in my data folder.\r\n", "parent_topic_uri": "1604062980_users_1Cy3ntkN2GN9MH6EaW6eHpi4YoRS2nK5Di", "added": 1543277201, "modified": 1543333765, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1789", "source_type": "github"}], "next_comment_id": 5, "comment": {"1604066990_mirrored_jsinghrai_github": [{"comment_id": 1, "body": "my data.json file contains:\r\n{\r\n&nbsp;\"posts\": [\r\n&nbsp;                {\r\n               &nbsp;&nbsp;         \"id\": 1,\r\n               &nbsp;&nbsp;         \"title\": \"Post 1\",\r\n             &nbsp; &nbsp;          \"content\": \"Post 1\"\r\n                &nbsp;},\r\n               &nbsp; {\r\n               &nbsp; &nbsp;        \"id\": 2,\r\n               &nbsp;&nbsp;         \"title\": \"Post 2\",\r\n               &nbsp;&nbsp;         \"content\": \"Post 2\"\r\n                &nbsp;}\r\n        ]\r\n}\r\n\r\n\r\nmy dbschema.json contains:\r\n{\r\n&nbsp;        \"db_name\": \"mydatabase\",\r\n&nbsp;        \"db_file\": \"data/mydatabase.db\",\r\n&nbsp;        \"version\": 2,\r\n&nbsp;        \"maps\": {},\r\n&nbsp;        \"tables\": {\r\n&nbsp; &nbsp;               \"json\": {\r\n   &nbsp; &nbsp;&nbsp;                    \"cols\": [\r\n &nbsp; &nbsp;&nbsp;   &nbsp;                           [\"json_id\", \"INTEGER PRIMARY KEY AUTOINCREMENT\"],\r\n &nbsp;  &nbsp;&nbsp;&nbsp;                             [\"directory\", \"TEXT\"],\r\n &nbsp; &nbsp;&nbsp;   &nbsp;                           [\"file_name\", \"TEXT\"]\r\n &nbsp;&nbsp;&nbsp;                       ],\r\n&nbsp;   &nbsp;&nbsp;                     \"indexes\": [\"CREATE UNIQUE INDEX path ON json(directory, file_name)\"],\r\n &nbsp;   &nbsp;&nbsp;                    \"schema_changed\": 1\r\n&nbsp;                },\r\n &nbsp; &nbsp;              \"posts\": {\r\n &nbsp;  &nbsp;&nbsp;                     \"cols\": [\r\n &nbsp;  &nbsp;&nbsp;&nbsp;                             [\"id\", \"integer\"],\r\n&nbsp;  &nbsp;&nbsp;&nbsp;                              [\"title\", \"text\"],\r\n&nbsp;  &nbsp;&nbsp;&nbsp;                              [\"content\", \"text\"],\r\n&nbsp;   &nbsp;&nbsp;&nbsp;                             [\"json_id\", \"integer references json(json_id)\"]\r\n &nbsp; &nbsp;&nbsp;                      ],\r\n &nbsp; &nbsp;&nbsp;                      \"indexes\": [\"CREATE UNIQUE INDEX post_id ON posts(id)\"],\r\n  &nbsp;&nbsp;&nbsp;                      \"schema_changed\": 1\r\n &nbsp; &nbsp;              }\r\n &nbsp;       }\r\n}\r\n", "added": 1543277623, "modified": 1543277623, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1789#issuecomment-441884397", "source_type": "github"}, {"comment_id": 2, "body": "localhost# ls -al /var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/data \r\ntotal 12\r\ndrwxr-xr-x 3 root    root    4096 Nov 26 18:34 .\r\ndrwxr-xr-x 4 zeronet zeronet 4096 Nov 26 18:58 ..\r\ndrwxr-xr-x 2 root    root    4096 Nov 26 18:37 admin\r\n", "added": 1543327915, "modified": 1543327915, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1789#issuecomment-442140102", "source_type": "github"}, {"comment_id": 3, "body": "> Looks like a permission issue for me, does zeronet has access to write to /var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/data/ dir?\r\n> \r\n> Can you please run the command `ls -al /var/lib/zeronet/154VXDsMR9cbjd6nw8g4ryh48kYGstmbbB/data/`?\r\n\r\nYou were right. I changed the ownership from root to zeronet. Now I don't see that error and I get my database.", "added": 1543329264, "modified": 1543329264, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1789#issuecomment-442148125", "source_type": "github"}, {"comment_id": 4, "body": "I'm not sure how to close this issue. \r\nEdit: Nvm", "added": 1543333721, "modified": 1543333765, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1789#issuecomment-442172635", "source_type": "github"}]}}