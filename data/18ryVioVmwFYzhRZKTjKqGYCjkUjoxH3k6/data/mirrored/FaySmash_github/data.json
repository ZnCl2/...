{"cert_user_id": "FaySmash@github", "next_topic_id": 2, "topic": [{"topic_id": 1604066482, "title": "[issue] Zeronet ignores tor = always if started through systemd", "body": "### Step 1: Please describe your environment\r\n\r\n  * ZeroNet version: 0.6.2 (3408)\r\n  * Operating system: Raspbian Stretch\r\n  * Web browser: Waterfox 56.1.0\r\n  * Tor status: always\r\n  * Opened port: no\r\n  * Special configuration: \r\n\r\n### Step 2: Describe the problem:\r\nIf I start zeronet by a systemd unit on bootup, it doesn't connect to Tor.\r\n\r\n\r\n#### Steps to reproduce:\r\n\r\n  1. create a zeronet.service file at /lib/systemd/system/\r\n  2. put in this\r\n```\r\n[Unit]\r\nDescription=Zeronet daemon\r\nWants=tor.service\r\nAfter=network.target tor.service\r\n\r\n[Service]\r\nEnvironmentFile=/home/pi/ZeroNet-master/zeronet.conf\r\nExecStart=/home/pi/ZeroNet-master/zeronet.py --tor always\r\nUser= <YOURLINUXUSER>\r\nTimeoutStopSec=30min\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\n```\r\n\r\n  3. execute\r\n```\r\nsudo systemctl daemon-reload\r\nsudo systemctl enable zeronet.service\r\nsudo reboot\r\n```\r\n\r\n\r\n#### Observed Results:\r\n\r\n It displays this \r\n![grafik](https://user-images.githubusercontent.com/30392780/38772669-b5652842-403c-11e8-897a-9e85d4d6c8c9.png)\r\nerror message in the top right corner but it's working fine. It just connects to the zeronet without tor and. The errorlog states:\r\n```\r\n[2018-04-14 15:57:15,386] WARNING  TorManager Tor controller connect error: error: [Errno 111] Connection refused in TorManager.py line 170 > _socket2.py line 228\r\n[2018-04-14 15:57:15,386] INFO     TorManager Starting self-bundled Tor, due to Tor proxy port 127.0.0.1:9050 check error: No connection\r\n```\r\n\r\n#### Expected Results:\r\n\r\nZeronet shouldn't establish any connection when Tor isn't reachable and should try to reconnect to Tor if it wasn't available during the initialization.\r\n", "parent_topic_uri": "1604062980_users_1Cy3ntkN2GN9MH6EaW6eHpi4YoRS2nK5Di", "added": 1523731442, "modified": 1523739994, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1387", "source_type": "github"}], "next_comment_id": 3, "comment": {"1604066482_mirrored_FaySmash_github": [{"comment_id": 1, "body": "@skwerlman I probably should have mentioned that this config works totally fine if I start it manually through systemctl start zeronet.service. Tor is correctly configured. The firewall is set to accept everything (turned off).\r\nThe problem seems to be that zeronet simply starts before tor and because tor hasn't finished initialization yet zeronet just starts without it. The proper way would be to check when tor is ready to connect and if the connection fails for a period of time zeronet should just abort the startup. Running without tor even if it's set to always only because tor wasn't ready during zeronets initialization is a terrible configuration.\r\n\r\nI've already tried the --config_path parameter but it's unnecessary anyway, zeronet.py looks for the zeronet.conf in the same folder during the initialization anyway. The EnviromentFile variable is unnecessary.\r\n\r\nFor more discussion of this topic: https://www.reddit.com/r/zeronet/comments/8bjyht/start_and_end_zeronet_per_initd/", "added": 1523737545, "modified": 1523737545, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1387#issuecomment-381367829", "source_type": "github"}, {"comment_id": 2, "body": "@skwerlman my zeronet.service now looks like this\r\n\r\n```\r\n[Unit]\r\nDescription=Zeronet daemon\r\nRequires=tor.service\r\nAfter=network.target tor.service\r\n\r\n[Service]\r\nEnvironmentFile=/home/pi/ZeroNet-master/zeronet.conf\r\nExecStart=/home/pi/ZeroNet-master/zeronet.py --ui_host 10.0.0.252:43110 misconline.zapto.org\r\nUser=pi\r\nTimeoutStopSec=30min\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\n\r\n```\r\nbut zeronet still boots up before tor is ready. Also the main part of this opened issue is, that zeronet just connects without tor, even if it's set to always. If I set it to always I want it to only use tor, otherwise stop and disconnect", "added": 1523739994, "modified": 1523739994, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/1387#issuecomment-381369619", "source_type": "github"}]}}