{"cert_user_id": "kasv@github", "next_topic_id": 2, "topic": [{"topic_id": 1604065645, "title": "FileServer Trying to open port using UpnpPunch... - Unhandled exception", "body": "$ pwd\r\n~/downloads/ZeroBundle/ZeroNet/src/util\r\n\r\n$ ~/downloads/ZeroBundle/Python/python ./UpnpPunch.py\r\nOpening port...\r\nDEBUG:root:Trying to open port 15443.\r\nDEBUG:root:Found local ips: ['192.168.0.8']\r\nDEBUG:root:Trying using local ip: 192.168.0.8\r\nTraceback (most recent call last):\r\n  File \"./UpnpPunch.py\", line 342, in <module>\r\n    print ask_to_open_port(15443, \"ZeroNet\", retries=3, protos=[\"TCP\"])\r\n  File \"./UpnpPunch.py\", line 320, in ask_to_open_port\r\n    protos=protos)\r\n  File \"./UpnpPunch.py\", line 299, in _communicate_with_igd\r\n    _orchestrate_soap_request(local_ip, port, fn, desc, protos)\r\n  File \"./UpnpPunch.py\", line 274, in _orchestrate_soap_request\r\n    idg_data = _collect_idg_data(ip)\r\n  File \"./UpnpPunch.py\", line 258, in _collect_idg_data\r\n    _retrieve_igd_profile(idg_data['location']))\r\n  File \"./UpnpPunch.py\", line 104, in _parse_igd_profile\r\n    dom = parseString(profile_xml)\r\n  File \"/home/kasv/downloads/ZeroBundle/lib/python2.7/xml/dom/minidom.py\", line 1928, in parseString\r\n    return expatbuilder.parseString(string)\r\n  File \"/home/kasv/downloads/ZeroBundle/lib/python2.7/xml/dom/expatbuilder.py\", line 940, in parseString\r\n    return builder.parseString(string)\r\n  File \"/home/kasv/downloads/ZeroBundle/lib/python2.7/xml/dom/expatbuilder.py\", line 223, in parseString\r\n    parser.Parse(string, True)\r\nxml.parsers.expat.ExpatError: not well-formed (invalid token): line 2, column 442\r\n\r\nSee attachment\r\n[answer.xml.txt](https://github.com/HelloZeroNet/ZeroNet/files/677114/answer.xml.txt)\r\n\r\n", "parent_topic_uri": "1604062980_users_1Cy3ntkN2GN9MH6EaW6eHpi4YoRS2nK5Di", "added": 1483006153, "modified": 1488289501, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/725", "source_type": "github"}], "next_comment_id": 4, "comment": {"1604065645_mirrored_kasv_github": [{"comment_id": 1, "body": "Hi @sirMackk, Your version utf8 python script result:\r\n$ ../Python/python ./UpnpPunch_utf8.py \r\nOpening port...\r\nDEBUG:root:Trying to open port 15443.\r\nDEBUG:root:Found local ips: ['192.168.0.8']\r\nDEBUG:root:Trying using local ip: 192.168.0.8\r\nTraceback (most recent call last):\r\n  File \"./UpnpPunch_utf8.py\", line 346, in <module>\r\n    print ask_to_open_port(15443, \"ZeroNet\", retries=3, protos=[\"TCP\"])\r\n  File \"./UpnpPunch_utf8.py\", line 324, in ask_to_open_port\r\n    protos=protos)\r\n  File \"./UpnpPunch_utf8.py\", line 303, in _communicate_with_igd\r\n    _orchestrate_soap_request(local_ip, port, fn, desc, protos)\r\n  File \"./UpnpPunch_utf8.py\", line 278, in _orchestrate_soap_request\r\n    idg_data = _collect_idg_data(ip)\r\n  File \"./UpnpPunch_utf8.py\", line 262, in _collect_idg_data\r\n    _retrieve_igd_profile(idg_data['location']))\r\n  File \"./UpnpPunch_utf8.py\", line 86, in _retrieve_igd_profile\r\n    return urllib2.urlopen(url.geturl(), timeout=5).read().decode('utf-8')\r\n  File \"/home/kasv/\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0438/ZeroBundle/lib/python2.7/encodings/utf_8.py\", line 16, in decode\r\n    return codecs.utf_8_decode(input, errors, True)\r\nUnicodeDecodeError: 'utf8' codec can't decode byte 0xcd in position 465: invalid continuation byte\r\n\r\nMy version (patched, [UpnpPunch.py.txt](https://github.com/HelloZeroNet/ZeroNet/files/701766/UpnpPunch.py.txt)) result:\r\n$ ../Python/python ./UpnpPunch.py \r\nOpening port...\r\nDEBUG:root:Trying to open port 15443.\r\nDEBUG:root:Found local ips: ['192.168.0.8']\r\nDEBUG:root:Trying using local ip: 192.168.0.8\r\nDEBUG:root:Sending UPnP request to 192.168.0.1:1024...\r\nDEBUG:root:500\r\nDEBUG:root:<s:Envelope xmlns:s=\"http://schemas.xmlsoap.org/soap/envelope/\" s:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"><s:Body><s:Fault><faultcode>s:Client</faultcode><faultstring>UPnPError</faultstring><detail><UPnPError xmlns=\"urn:schemas-upnp-org:control-1-0\"><errorCode>718</errorCode><errorDescription>ConflictInMappingEntry</errorDescription></UPnPError></detail></s:Fault></s:Body></s:Envelope>\r\nDEBUG:root:Upnp request using \"192.168.0.8\" failed: SOAP request error: 718 - ConflictInMappingEntry\r\nDEBUG:root:Trying using local ip: 192.168.0.8\r\nDEBUG:root:Sending UPnP request to 192.168.0.1:1024...\r\nDEBUG:root:500\r\nDEBUG:root:<s:Envelope xmlns:s=\"http://schemas.xmlsoap.org/soap/envelope/\" s:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"><s:Body><s:Fault><faultcode>s:Client</faultcode><faultstring>UPnPError</faultstring><detail><UPnPError xmlns=\"urn:schemas-upnp-org:control-1-0\"><errorCode>718</errorCode><errorDescription>ConflictInMappingEntry</errorDescription></UPnPError></detail></s:Fault></s:Body></s:Envelope>\r\nDEBUG:root:Upnp request using \"192.168.0.8\" failed: SOAP request error: 718 - ConflictInMappingEntry\r\nDEBUG:root:Trying using local ip: 192.168.0.8\r\nDEBUG:root:Sending UPnP request to 192.168.0.1:1024...\r\nDEBUG:root:500\r\nDEBUG:root:<s:Envelope xmlns:s=\"http://schemas.xmlsoap.org/soap/envelope/\" s:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"><s:Body><s:Fault><faultcode>s:Client</faultcode><faultstring>UPnPError</faultstring><detail><UPnPError xmlns=\"urn:schemas-upnp-org:control-1-0\"><errorCode>718</errorCode><errorDescription>ConflictInMappingEntry</errorDescription></UPnPError></detail></s:Fault></s:Body></s:Envelope>\r\nDEBUG:root:Upnp request using \"192.168.0.8\" failed: SOAP request error: 718 - ConflictInMappingEntry\r\nTraceback (most recent call last):\r\n  File \"./UpnpPunch.py\", line 351, in <module>\r\n    print ask_to_open_port(port, desc, retries=3, protos=[\"TCP\"])\r\n  File \"./UpnpPunch.py\", line 328, in ask_to_open_port\r\n    protos=protos)\r\n  File \"./UpnpPunch.py\", line 319, in _communicate_with_igd\r\n    port, retries))\r\n__main__.UpnpError: Failed to communicate with igd using port 15443 on local machine after 3 tries.\r\n\r\n\r\n", "added": 1484216307, "modified": 1484216307, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/725#issuecomment-272160823", "source_type": "github"}, {"comment_id": 2, "body": "I tried different ports and always get this error.\n\n2017-01-12 16:37 GMT+03:00 sirMackk <notifications@github.com>:\n\n> Thanks @kasv <https://github.com/kasv> , this is a big help in\n> pinpointing the issue. I'll look into how to best make the code handle\n> multiple encodings.\n>\n> In the second case, it appears that your router is telling you that port\n> 15433 is already open. This shouldnt be an error (500), which can be\n> confusing. I'll see how this can be handled in a friendlier fashion.\n>\n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/HelloZeroNet/ZeroNet/issues/725#issuecomment-272164632>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABdO9cFOnjbz1ePL2O3gVL89oouc0Fjjks5rRix8gaJpZM4LXklK>\n> .\n>\n", "added": 1484217666, "modified": 1484217666, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/725#issuecomment-272165543", "source_type": "github"}, {"comment_id": 3, "body": "Does not work(\r\nThe test script (taken from [http://nullege.com/codes/show/src@p@y@pyethereum-HEAD@pyethereum@tcpserver.py/33/miniupnpc](http://nullege.com/codes/show/src@p@y@pyethereum-HEAD@pyethereum@tcpserver.py/33/miniupnpc)) result:\r\nINFO:root:TCP server started 192.168.0.8:15554\r\nDEBUG:root:Setting UPNP\r\nDEBUG:root:1 UPNP device(s) detected\r\nDEBUG:root:external ip: 10.0.50.131\r\nDEBUG:root:status: ('Connected', 866834, 'ERROR_NONE'), connection type: IP_Routed\r\nDEBUG:root:trying to redirect 10.0.50.131 port 15554 TCP => 192.168.0.8 port 15554 TCP\r\nDEBUG:root:upnp failed: ConflictInMappingEntry\r\nINFO:root:my public address is b'178.155.5.26':15554\r\n[tcpserver.py.txt](https://github.com/HelloZeroNet/ZeroNet/files/701979/tcpserver.py.txt)\r\n", "added": 1484221761, "modified": 1484221761, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/725#issuecomment-272182032", "source_type": "github"}]}}