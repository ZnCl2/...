{"cert_user_id": "TwinLizzie@github", "next_topic_id": 2, "topic": [{"topic_id": 1604067751, "title": "ZeroFrame.monkeyPatchAjax() not working. Documentation needed!", "body": "### Step 1: Please describe your environment\r\n\r\n  * ZeroNet version: 0.7.1 (rev4253)\r\n  * Operating system: Ubutu 18.04\r\n  * Web browser: Firefox (Latest)\r\n  * Tor status: available\r\n  * Opened port: Closed\r\n  * Special configuration: None\r\n\r\n### Step 2: Describe the problem:\r\n\r\nCORS errors when trying to read files using XMLHttpRequest,\r\n\r\n#### Steps to reproduce:\r\n\r\nhttp://127.0.0.1:43110/142uPiiSkemLEviQsYwYtvLvLW7H8mpZWs\r\n```\r\n<!DOCTYPE html>\r\n\r\n<html>\r\n\r\n<head>\r\n\r\n <title>New ZeroNet site!</title>\r\n\r\n <meta charset=\"utf-8\">\r\n\r\n <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\" />\r\n\r\n <base href=\"\" target=\"_top\" id=\"base\">\r\n\r\n <script>base.href = document.location.href.replace(\"/media\", \"\").replace(\"index.html\", \"\").replace(/[&?]wrapper=False/, \"\").replace(/[&?]wrapper_nonce=[A-Za-z0-9]+/, \"\")</script>\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n  <input type=\"file\" id=\"button\">\r\n\r\n\r\n  <div class=\"viewer\">\r\n\r\n      <span>3d Preview</span>\r\n\r\n    <div id=\"viewer\"></div>\r\n\r\n  </div>\r\n\r\n<div id=\"out\"></div>\r\n\r\n<script type=\"text/javascript\" src=\"js/ZeroFrame.js\"></script>\r\n\r\n<script>\r\n\r\nclass Page extends ZeroFrame {\r\n    setSiteInfo(site_info) {\r\n        var out = document.getElementById(\"out\")\r\n        out.innerHTML =\r\n            \"Page address: \" + site_info.address +\r\n            \"<br>- Peers: \" + site_info.peers +\r\n\r\n            \"<br>- Size: \" + site_info.settings.size +\r\n\r\n            \"<br>- Modified: \" + (new Date(site_info.content.modified*1000))\r\n\r\n    }\r\n\r\n    onOpenWebsocket() {\r\n        this.cmd(\"siteInfo\", [], function(site_info) {\r\n            page.setSiteInfo(site_info)\r\n        })\r\n    }\r\n\r\n    onRequest(cmd, message) {\r\n        if (cmd == \"setSiteInfo\")\r\n            this.setSiteInfo(message.params)\r\n        else\r\n            this.log(\"Unknown incoming message:\", cmd)\r\n    }\r\n}\r\npage = new Page()\r\n\r\n\r\n</script>\r\n\r\n<script type=\"text/javascript\">(new ZeroFrame).monkeyPatchAjax();     </script>\r\n\r\n  <script src=\"js/Detector.js\"></script>\r\n\r\n  <script src=\"js/three.min.js\"></script>\r\n\r\n  <script src=\"js/STLLoader.js\"></script>\r\n\r\n  <script src=\"js/TrackballControls.js\"></script>\r\n\r\n  <script src=\"js/viewer.js\"></script>\r\n\r\n\r\n<script type=\"text/javascript\">  \r\n\r\n\r\n    var loader = new THREE.STLLoader();\r\n      loader.addEventListener( 'load', function ( event ) {\r\n\r\n         var geometry = event.content;\r\n          scene.add( new THREE.Mesh( geometry ) );\r\n\r\n     } );\r\n      loader.load( '/stl/Demo.stl' );\r\n</script>  \r\n\r\n\r\n</body>\r\n\r\n</html>\r\n```\r\n#### Observed Results:\r\n```\r\nCross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://127.0.0.1:43110/stl/Demo.stl?ajax_key=undefined. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 missing).\r\n```\r\n\r\n#### Expected Results:\r\n\r\nNeed to retreive STL 3d model using XMLHttpRequest in order for Javascript to load it onto a preview screen, which already works outside of ZeroNet.", "parent_topic_uri": "1604062980_users_1Cy3ntkN2GN9MH6EaW6eHpi4YoRS2nK5Di", "added": 1578695608, "modified": 1579158489, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2392", "source_type": "github"}], "next_comment_id": 5, "comment": {"1604067751_mirrored_TwinLizzie_github": [{"comment_id": 1, "body": "Hey there. Seems like it's now recognized the ajax key, but still getting errors.. and it only seems to try to load stl when I trigger something like the Update or Publish.\r\n\r\n```\r\nCross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://127.0.0.1:43110/stl/Demo.stl?ajax_key=eb90ebf142302f4d0cb27bb2cb876e348c4b312774078529947ba783d5bcdf65. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 missing).\r\n```", "added": 1578712153, "modified": 1578712153, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2392#issuecomment-573286256", "source_type": "github"}, {"comment_id": 2, "body": "My bad. I can see the 3d model now, although it still only shows up after I push some kind of zite update like Update content.json or Publsh to peers. I'll have to closely take a look at the code and try to connect the dots.\r\n\r\nThanks a lot! ", "added": 1578712580, "modified": 1578712580, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2392#issuecomment-573286811", "source_type": "github"}, {"comment_id": 3, "body": "Thanks. Seems smoother, but still only loads on page Update.", "added": 1578715046, "modified": 1578715046, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2392#issuecomment-573289095", "source_type": "github"}, {"comment_id": 4, "body": "Thanks. The solution from the previous post works perfectly!", "added": 1579131082, "modified": 1579131082, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2392#issuecomment-574952501", "source_type": "github"}]}}