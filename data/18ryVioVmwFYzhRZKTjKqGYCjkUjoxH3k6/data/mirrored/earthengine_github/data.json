{"cert_user_id": "earthengine@github", "next_topic_id": 3, "topic": [{"topic_id": 1604067929, "title": "all.js didn't load in Firefox Nightly when UiPassword enabled", "body": "### My Environment\r\n  * ZeroNet version: 0.7.1 (rev4206)\r\n  * Operating system: Windows\r\n  * Web browser: Firefox Nightly 77.0a1 (2020-04-30)\r\n  * Tor status: not available\r\n  * Opened port: yes\r\n  * Special configuration: UiPassword Turned on\r\n\r\n### The problem:\r\nWhen the UiPassword turned on, the login form will set a session cookie. Firefox Nightly downloads the all.js file, but later when it opens the websocket it violates the Content Security Policy set by Mozilla.\r\n\r\nChrome  81.0.4044.129 instead, shows a warning message in the delovper console:\r\n\r\n>A cookie associated with a cross-site resource at http://127.0.0.1/ was set without the `SameSite` \r\n> attribute. A future release of Chrome will only deliver cookies with cross-site requests if they are \r\n> set with `SameSite=None` and `Secure`. You can review cookies in developer tools under \r\n> Application>Storage>Cookies and see more details at https://www.chromestatus.com/feature/5088147346030592 and https://www.chromestatus.com/feature/5633521622188032.\r\n\r\n#### Steps to reproduce:\r\n\r\n  1. Download and install the given version of Firefox\r\n  2. Download and install ZeroNet\r\n  3. Enable plugin UiPassword\r\n  4. Open http://127.0.0.1:43110 in Firefox and enter the password\r\n\r\n#### Observed Results:\r\nA blank page with only the ZeroNet icon in the right top corner.\r\n\r\n#### Expected Results:\r\nA fully functional page like in Chrome  81.0.4044.129.", "parent_topic_uri": "1604062980_users_1Cy3ntkN2GN9MH6EaW6eHpi4YoRS2nK5Di", "added": 1588319165, "modified": 1589905254, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2544", "source_type": "github"}, {"topic_id": 1604067931, "title": "Add SameSite flag to work with Firefox Nightly", "body": "A quick fix for #2544.\r\n\r\nTested in my own computer with doing the same to the `UiPasswordPlugin.py` file.", "parent_topic_uri": "1604062980_users_1Cy3ntkN2GN9MH6EaW6eHpi4YoRS2nK5Di", "added": 1588325348, "modified": 1588327155, "source_link": "https://github.com/HelloZeroNet/ZeroNet/pull/2545", "source_type": "github"}], "next_comment_id": 6, "comment": {"1604067929_mirrored_earthengine_github": [{"comment_id": 1, "body": "Firefox Nightly didn't allow sessions tracking in a HTTP site, even it is in localhost. To workaround, people need to use [local-ssl-proxy](https://www.npmjs.com/package/local-ssl-proxy) or similar.\r\n\r\nZeroNet should consider provide things like that out of box.", "added": 1588373157, "modified": 1588373157, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2544#issuecomment-622651131", "source_type": "github"}, {"comment_id": 2, "body": "@HelloZeroNet I have tried your workaround and get errors:\r\n\r\n```\r\nErr: AttributeError: 'UiRequest' object has no attribute 'isWrapperNecessary' in UiServer.py line 106 > UiPassword/UiPasswordPlugin.py line 67 > UiRequest.py line 163 > UiPluginManager/UiPluginManagerPlugin.py line 33 > UiPassword/UiPasswordPlugin.py line 70\r\n```\r\n\r\nI think there are other changes needed - I am running a stable version.\r\n\r\n(I do cloned and developed the github PR, but I didn't do distribution tests - I only test updating the UiPasswordPlugin.py in my Zeronet folder, and apply the change in the git repo, I don't know how to use a Github version in windows)", "added": 1588671026, "modified": 1588671026, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2544#issuecomment-624026570", "source_type": "github"}, {"comment_id": 3, "body": "Hi @HelloZeroNet \r\n\r\nI confirmed that your fixes works by patching my stable release with those commits.\r\n\r\n- The test site shows the proper result: the fonts were loaded.\r\n\r\n![image](https://user-images.githubusercontent.com/2227031/82315452-aa8fec80-9a0e-11ea-8688-1657829e8e55.png)\r\n(test result of Firefox Nightly 78.0a1 (2020-05-18) (64-bit))\r\n\r\nCheers.", "added": 1589872910, "modified": 1589873105, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2544#issuecomment-630729174", "source_type": "github"}, {"comment_id": 4, "body": "Although this is closed but I got to inform that there is one remaining issue of the commit on [36d96d4](https://github.com/HelloZeroNet/ZeroNet/commit/36d96d484ed8dc3370c2dab9b50b714af702a2c4). This bug causes \r\n\r\n```\r\nServer error\r\nErr: AttributeError: 'UiRequest' object has no attribute 'cleanup' in UiServer.py line 106 > UiPassword/UiPasswordPlugin.py line 61\r\n```\r\nwhen the session was expired. The fix is to change the code in line 61 from\r\n\r\n```python\r\nself.cleanup()\r\n```\r\nto\r\n```python\r\nself.sessionCleanup()\r\n```\r\nIt is late for my day, so I leave this fix with you.", "added": 1589882246, "modified": 1589882246, "source_link": "https://github.com/HelloZeroNet/ZeroNet/issues/2544#issuecomment-630798932", "source_type": "github"}], "1604067931_mirrored_earthengine_github": [{"comment_id": 5, "body": "This is not working yet. It fixed in Firefox Nightly but breaks Chrome.\r\n\r\nThe test result is: if we set \"SameSite=None\" only, it works in Chrome. But in Firefox Nightly it stops the user from logging in (keep showing the login page). On the other hand, if we set \"SameSite=None;secure\", Firefox Nightly likes it but Chrome (and Edge) keep showing the login page.\r\n\r\nI don't know what the correct solution should be; but I think ZeroNet will have to implement HTTPS and so \"SameSite=None;secure\" will work on both if using HTTPS.", "added": 1588326094, "modified": 1588327155, "source_link": "https://github.com/HelloZeroNet/ZeroNet/pull/2545#issuecomment-622372333", "source_type": "github"}]}}