<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Clearnet -&gt; Onion Website :: MH Site — A simple Homepage</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Say we like to share an onion site on the clearnet. It&amp;rsquo;s address is a1b2c3d4e5f6.onion and you are on a linux server.
First install nginx and tor.
apt install -y nginx tor systemctl start tor lets change the nginx config:
echo &#39;server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; server_name _; location / { proxy_pass http://127.0.0.1:8283; proxy_set_header Host &amp;quot;a1b2c3d4e5f6.onion&amp;quot;; proxy_set_header Accept-Encoding &amp;quot;&amp;quot;; proxy_set_header Via &amp;quot;$host&amp;quot;; subs_filter &#39;a1b2c3d4e5f6.onion&#39; &amp;quot;$host&amp;quot;; } }&#39; &amp;gt; /etc/nginx/sites-enabled/default and extend the tor config &amp;hellip;"/>
<meta name="keywords" content="Homepage 6543"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/post/proxy-clearnet-2-onion/" />




<link rel="stylesheet" href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/assets/style.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Clearnet -&gt; Onion Website :: MH Site — A simple Homepage" />
<meta name="twitter:description" content="Say we like to share an onion site on the clearnet. It&amp;rsquo;s address is a1b2c3d4e5f6.onion and you are on a linux server.
First install nginx and tor.
apt install -y nginx tor systemctl start tor lets change the nginx config:
echo &#39;server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; server_name _; location / { proxy_pass http://127.0.0.1:8283; proxy_set_header Host &amp;quot;a1b2c3d4e5f6.onion&amp;quot;; proxy_set_header Accept-Encoding &amp;quot;&amp;quot;; proxy_set_header Via &amp;quot;$host&amp;quot;; subs_filter &#39;a1b2c3d4e5f6.onion&#39; &amp;quot;$host&amp;quot;; } }&#39; &amp;gt; /etc/nginx/sites-enabled/default and extend the tor config &amp;hellip;" />
<meta name="twitter:site" content="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/" />
<meta name="twitter:creator" content="MH" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Clearnet -&gt; Onion Website :: MH Site — A simple Homepage">
<meta property="og:description" content="Say we like to share an onion site on the clearnet. It&amp;rsquo;s address is a1b2c3d4e5f6.onion and you are on a linux server.
First install nginx and tor.
apt install -y nginx tor systemctl start tor lets change the nginx config:
echo &#39;server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; server_name _; location / { proxy_pass http://127.0.0.1:8283; proxy_set_header Host &amp;quot;a1b2c3d4e5f6.onion&amp;quot;; proxy_set_header Accept-Encoding &amp;quot;&amp;quot;; proxy_set_header Via &amp;quot;$host&amp;quot;; subs_filter &#39;a1b2c3d4e5f6.onion&#39; &amp;quot;$host&amp;quot;; } }&#39; &amp;gt; /etc/nginx/sites-enabled/default and extend the tor config &amp;hellip;" />
<meta property="og:url" content="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/post/proxy-clearnet-2-onion/" />
<meta property="og:site_name" content="Clearnet -&gt; Onion Website" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-07-08 12:00:00 &#43;0200 CEST" />











</head>
<body class="">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/">
  <div class="logo">
    [MH @ Obermui ~]#
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/about">About</a></li>
        
      
        
          <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/post">Posts</a></li>
        
      
        
          <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/projects">Projects</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/services">Services</a></li>
              
            
              
                <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/index.xml">RSS</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/about">About</a></li>
      
    
      
        <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/post">Posts</a></li>
      
    
      
        <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/projects">Projects</a></li>
      
    
      
        <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/services">Services</a></li>
      
    
      
        <li><a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/index.xml">RSS</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/post/proxy-clearnet-2-onion/">Clearnet -&gt; Onion Website</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2019-07-08
    </span>
    
    
    <span class="post-author">::
      MH
    </span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/tags/tor/">Tor</a>&nbsp;
    
    #<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/tags/setup/">Setup</a>&nbsp;
    
    #<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/tags/concept/">Concept</a>&nbsp;
    
    #<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/tags/proxy/">Proxy</a>&nbsp;
    
    #<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/tags/socat/">socat</a>&nbsp;
    
    #<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/tags/nginx/">nginx</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <p>Say we like to share an onion site on the clearnet.
It&rsquo;s address is <code>a1b2c3d4e5f6.onion</code> and you are on a linux server.</p>
<p>First install nginx and tor.</p>
<pre><code>apt install -y nginx tor
systemctl start tor
</code></pre><p>lets change the nginx config:</p>
<pre><code>echo 'server {
    listen 80 default_server;
    listen [::]:80 default_server;
    root /var/www/html;
    server_name _;
    location / {
        proxy_pass http://127.0.0.1:8283;
        proxy_set_header Host &quot;a1b2c3d4e5f6.onion&quot;;
        proxy_set_header Accept-Encoding &quot;&quot;;
        proxy_set_header Via &quot;$host&quot;;
        subs_filter 'a1b2c3d4e5f6.onion' &quot;$host&quot;;
    }
}' &gt; /etc/nginx/sites-enabled/default
</code></pre><p>and extend the tor config &hellip;</p>
<pre><code>echo 'DNSPort 53
AutomapHostsOnResolve 1' &gt;&gt; /etc/torrc
</code></pre><p>change the dns servert to localhost:</p>
<pre><code>echo 'nameserver 127.0.0.1' &gt; /etc/resolv.conf
</code></pre><p>Then create a script caled <code>/opt/http2socks.sh</code>:</p>
<pre><code>#!/bin/bash
onion=&quot;a1b2c3d4e5f6.onion:80&quot;
proxy_http_2_socks5.sh:socat tcp4-LISTEN:8283,reuseaddr,fork,keepalive,bind=127.0.0.1 SOCKS4A:127.0.0.1:&quot;$onion&quot;,socksport=9050 &amp;
</code></pre><p>add this script to the startup by add an line with <code>crontab -e</code>:</p>
<pre><code>@reboot /opt/http2socks.sh
</code></pre><p>now start it all:</p>
<pre><code>systemctl restart tor
/opt/http2socks.sh
systemctl restart nginx
</code></pre><p>now you shoud have the hidden service on your 80 port visible for everyone.
of course you can extend the nginx config to ask for a login before:</p>
<p>add</p>
<pre><code>auth_basic &quot;Restricted Content&quot;;
auth_basic_user_file /etc/nginx/.htpasswd;
</code></pre><p>to the <code>location / {...}</code> block</p>
<pre><code>and enerate the password file:
echo -n 'user:' &gt;&gt; /etc/nginx/.htpasswd
openssl passwd -apr1 &gt;&gt; /etc/nginx/.htpasswd

systemctl restart ngin
</code></pre><p>These are just ideas why I&rsquo;m not responsible if someone has questionable content now available on the net. :D</p>

  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      
      <span class="button next">
        <a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/post/wireguard-vps-android/">
          <span class="button__text">Wireguard Gateway &amp; Android</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    <div class="copyright">
      
        <span>Copyright CC-By-NC-4.0</span>
        <span>::
      
      Powered by <a href="http://gohugo.io">Hugo</a></span>
      <span>&nbsp;::&nbsp;Theme by <a href="https://twitter.com/panr">panr</a></span>
      <span>&nbsp;::&nbsp;<a href="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/contact">Impressum</a></span>
    </div>
  </div>
</footer>

<script src="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/assets/main.js"></script>
<script src="/15VuKHSRKpgyGAX87mCHYF2L95vad33SPY/assets/prism.js"></script>

  
</div>

</body>
</html>
