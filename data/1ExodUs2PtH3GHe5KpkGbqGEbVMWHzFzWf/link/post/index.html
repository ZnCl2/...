<!DOCTYPE html>

<html lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>
  
  <title>Posta e delega parte del tuo guadagno ad uno o più steemians</title>
 <link rel="stylesheet" type="text/css" href="./js/bootstrap.min.css">
  
  <link rel="stylesheet" type="text/css" href="./js/foundation.min.css">
  <link rel="stylesheet" type="text/css" href="./js/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="./js/style.css">

  <style>
  .lateral-menu {
      z-index: 9999;
	  }
	  </style>
  <meta name="theme-color" content="#ffffff">

  <!-- per visualizzare l'anteprima del post -->
 

</head>
<body ng-controller="editorCtrl" squeeze="" class="ng-scope squeezed-body" style="position: absolute; transition-duration: 0.5s; transition-property: top, bottom, left, right; left: 300px;">

  <!-- avvisi e stato della pubblicazione, in caso di errore vi apparirà un log dettagliato  -->
<div id="successalert" class="alert alert-success" style="display:none">
        <strong>Pubblicato!</strong> Il tuo post ora è presente su Steem-Blockchain.
      </div>

      <div id="infoalert" class="alert alert-info" style="display:none">
        <strong>Trasferimento dati su blockchain in corso...</strong> Attendere...
      </div>

      <div id="erroralert" class="alert alert-danger" style="display:none">
        <strong>Errore! Comunica in chat il problema. <a href="https://discord.gg/FWdGWp"> https://discord.gg/FWdGWp </a></strong> <span id="errormessage"></span>
      </div>
    </div>
	
		
		
		
		
		
		
		
  <div id="editor-wrapper" class="container">

    <textarea id="editor" data-ng-model="text"  class="ng-pristine ng-untouched ng-valid"></textarea>
    
  </div>
  

  <!-- modal -->
  <div ng-hide="!showModal" class="modal-wrapper ng-hide" style="">
    <div class="modal-inner" aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
      <div class="modal-topbar">
        <span><i>&nbsp;&nbsp;Limited to 1000 characters</i></span><a class="modal-close-btn" aria-label="Close" ng-click="showModal = false"><i class="fa fa-lg fa-close"></i></a>
      </div>
      <div class="link-area">
        <textarea id="dlnk" style="resize: none;" disabled class="ng-binding"></textarea>
      </div>
    </div>
  </div>
  <!-- end modal -->

  
  


<div style=" position: fixed; width: 300px; height: 100%; overflow: hidden; transition-duration: 0.5s; transition-property: width, height; top: 0px; bottom: 0px; left: 0px;">
    <div class="lateral-menu-content" style="display: block;">
      <div class="title">Berith Post v0.10</div>
      <div class="lateral-menu-content-inner">
 <form class="form-horizontal" id="post">
        <fieldset>

       
        
        <!-- Titolo -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="title">Titolo</label>  
          <div class="col-md-4">
          <input id="title" name="title" type="text" placeholder="" class="form-control input-md" required="">
          </div>
        </div>

        <!-- link permanente -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="permlink">Permlink</label>  
          <div class="col-md-4">
          <input id="permlink" name="permlink" type="text" placeholder="" class="form-control input-md"  required="">
          </div>
        </div>

		
		
       
		
		<!-- Video IPFS -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="ipfshash">Video IPFS</label>  
          <div class="col-md-4">
          <input id="ipfshash" name="ipfshash" type="text" placeholder="" class="form-control input-md"  >
          </div>
        </div>

        <!-- Tags -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="tags">Tags</label>  
          <div class="col-md-4">
          <input id="tags" name="tags" type="text" placeholder="" class="form-control input-md" value="exodus " required="">
          <span class="help-block">Usa spazio per separare le tags</span>
          </div>
        </div>

        <!-- Nome utente -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="author">Nome utente Steem</label>  
          <div class="col-md-4">
          <input id="author" name="author" type="text" placeholder="" class="form-control input-md" required="">
		  
          </div>
        </div>

        <!-- Posting Key-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="privatekey">Posting Key</label>  
          <div class="col-md-4">
          <input id="privatekey" name="privatekey" type="text" placeholder="" class="form-control input-md" required="">
		  
          <span class="help-block">Puoi trovarla in Wallet -&gt; Permessi su steemit.com</span>  
          </div>
        </div>

        
		
		

        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="sbdpercent">Steem Dollars %</label>  
          <div class="col-md-4">
          <input id="sbdpercent" name="sbdpercent" type="number" placeholder="" class="form-control input-md" required="" min="0" max="100" value="50" step="1">
          <span class="help-block">Seleziona 0% se vuoi avere 100% power up.</span>  
          </div>
        </div>



        <!-- Text input-->
        <div class="form-group" style="display: none;" >
          <label class="col-md-4 control-label" for="maxpayout">Max SBD Payout</label>  
          <div class="col-md-4">
          <input id="maxpayout" name="maxpayout" type="number" placeholder="" class="form-control input-md" required="" min="0" max="1000000" value="1000000" step="1">
          <span class="help-block">Seleziona 0 se vuoi rifiutare il pagamento.</span>  
          </div>
        </div>
		
		<div class="form-group">
          <label class="col-md-4 control-label" style="font-size: 25px;"  for="privatekey">
            Delega<br>
            <button type="button" id="addbenef" name="addbenef" style="font-size: 16px;" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#benefModal"> Attiva</button>
          </label>
		    <div class="col-md-4">
          <ul class="input-md" style="font-size: 18px;" id="beneflist">
          </ul>
		 
		   
          </div>
        </div>

        <!-- Button -->
        <div class="form-group" >
          <label class="col-md-4 control-label" for="post"></label>
          <div class="col-md-4">
            <button id="post" name="post"  class="btn btn-primary">Pubblica</button>
          </div>
        </div>

        </fieldset>
      </form>

      <!-- Modal -->
      <div class="modal fade" id="benefModal" role="dialog" style=" display: none;">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">×</button>
              <h4 class="modal-title">Delega</h4>
            </div>
            <div class="modal-body">
              <form class="form-horizontal" id="post">
                <fieldset>


                <!-- Text input-->
                <div class="form-group">
                  <label class="col-md-4 control-label" for="benefusername">Exodus Project</label>  
                  <div class="col-md-4">
                  <input id="benefusername" name="benefusername" type="text" placeholder="" class="form-control input-md" required=""  value="project-exodus" style="display: none;">
                  <span class="help-block">Puoi creare 1 post ogni 144 minuti.</span>  
                  </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                  <label class="col-md-4 control-label" for="benefshare">Percentuale</label>  
                  <div class="col-md-4">
                  <input id="benefshare" name="benefshare" type="number" placeholder="" class="form-control input-md" required=""  min="20" max="100" value="25" step="1" style="display: none;">
                  <span class="help-block">Delega il 25% a project-exodus</span>  
                  </div>
                </div>

                </fieldset>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-success" data-dismiss="modal" id="benefadd">Delega</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Annulla</button>
            </div>
          </div>
        </div>
      </div>
      
    	<center>
    
    
  </center>
        
      </div>
    </div>
  </div>
  
  
  <script src="./js/jquery.min.js"></script>
<script src="./js/jquery.query-object.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script src="./js/Chart.min.js"></script>    <script src="https://cdn.steemjs.com/lib/latest/steem.min.js"></script>
<!-- Modifica questo codice se vuoi inserire voci personalizzate nel json-->
    <script type="text/javascript">
      beneficiaries = []
      weightRemaining = 10000
      tags = []

      $('#title').keydown(function() {
        var permlink = $(this).val().toLowerCase()
          .replace(/ /g,'-')
          .replace(/[^\w-]+/g,'')
        $('#permlink').val(permlink)
      })
	  
	  
	   $('#markdown').keydown(function() {
        var anteprima = $(this).val()
         
        $('#anteprima').innerHTML(anteprima)
      })
	  

      $('#tags').keydown(function() {
        tags = $(this).val().split(' ')
      })

      $('#benefadd').click(function() {
        for (var i = beneficiaries.length - 1; i >= 0; i--) {
          if (beneficiaries[i].account == $('#benefusername').val()) {
            weightRemaining += beneficiaries[i].weight;
            beneficiaries.splice(i,1);
          }
        };
        beneficiaries.push({
          account: $('#benefusername').val(),
          weight: 100*$('#benefshare').val()
        })
        weightRemaining -= 100*$('#benefshare').val()
        displayBenefs()
      })

      function displayBenefs() {
        $('#beneflist').empty()
        for (var i = beneficiaries.length - 1; i >= 0; i--) {
          var html = 'Attivato: '+beneficiaries[i].account+' ('+beneficiaries[i].weight/100+'%) '
          $('#beneflist').append(html)
		  
		  
        };
        $('#weightRemaining')[0].innerHTML = weightRemaining/100;
		
        $('.removeBenef').click(function(e) {
          console.log($(this).data('account'))
          for (var i = beneficiaries.length - 1; i >= 0; i--) {
            if (beneficiaries[i].account == $(this).data('account')) {
              weightRemaining += beneficiaries[i].weight;
              beneficiaries.splice(i,1);
              displayBenefs()
            }
          };
        })
      }

      $('#post').submit(function(event) {
        event.preventDefault();
        $('#infoalert').show()
        $('#successalert').hide()
        $('#erroralert').hide()
        var title = $('#title').val();
        var permlink = $('#permlink').val();
        var markdown = $('#editor').val();
        var author = $('#author').val();
        var privatekey = $('#privatekey').val();
        var sbdpercent = 100*$('#sbdpercent').val();
        var maxpayout = parseInt($('#maxpayout').val());
        var ipfshash = $('#ipfshash').val();
        var operations = [
          ['comment',
            {
              parent_author: '',
              parent_permlink: tags[0],
              author: author,
              permlink: permlink,
              title: title,
              body: markdown,
              json_metadata : JSON.stringify({
                video : {
				info : {
				title : title,
				author : author,
				permlink : permlink
				
				},
				content : {
				videohash : ipfshash
				},
				},
				tags: tags,
                app: 'EXODUS-Media'
              })
            }
          ],
          ['comment_options', {
            author: author,
            permlink: permlink,
            max_accepted_payout: maxpayout+'.000 SBD',
            percent_steem_dollars: sbdpercent,
            allow_votes: true,
            allow_curation_rewards: true,
            extensions: [
              [0, {
                beneficiaries: beneficiaries
              }]
            ]
          }]
        ];

        if (beneficiaries.length == 0) {
          operations[1][1].extensions = []
        }

        console.log(operations)
        steem.broadcast.send(
          { operations: operations, extensions: [] },
          { posting: privatekey },
          function(e, r) {
            $('#infoalert').hide()
            if (e) {
              $('#errormessage').html(e.message)
              $('#erroralert').show()
            } else {
              $('#successalert').show()
            }
            console.log(e,r)
          }
        )
      });
    </script>
	
  </body></html>