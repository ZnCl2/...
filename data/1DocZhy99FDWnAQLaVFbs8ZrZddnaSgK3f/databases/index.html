



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>数据库 - 零网事实</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="零网事实" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                零网事实
              </span>
              <span class="md-header-nav__topic">
                数据库
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="零网事实" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    零网事实
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security/" title="安全" class="md-nav__link">
      安全
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cloning-zites/" title="站点克隆" class="md-nav__link">
      站点克隆
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../creating-static-zite/" title="静态站点" class="md-nav__link">
      静态站点
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../zeroframe/" title="站点框架" class="md-nav__link">
      站点框架
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        数据库
      </label>
    
    <a href="./" title="数据库" class="md-nav__link md-nav__link--active">
      数据库
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="创建站点" class="md-nav__link">
    创建站点
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="概览" class="md-nav__link">
    概览
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="数据源" class="md-nav__link">
    数据源
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajson" title="data.json" class="md-nav__link">
    data.json
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="数据库模式" class="md-nav__link">
    数据库模式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" title="json 表" class="md-nav__link">
    json 表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="添加表" class="md-nav__link">
    添加表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="映射表" class="md-nav__link">
    映射表
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to_table" title="to_table" class="md-nav__link">
    to_table
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="数据库的读权限" class="md-nav__link">
    数据库的读权限
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../changing-tables/" title="操作数据库" class="md-nav__link">
      操作数据库
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dbschema/" title="数据库模式" class="md-nav__link">
      数据库模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../user-content/" title="用户数据" class="md-nav__link">
      用户数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../editing-user-data/" title="编辑用户数据" class="md-nav__link">
      编辑用户数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../merger-sites/" title="聚合站" class="md-nav__link">
      聚合站
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mergxed-sites/" title="聚合后的数据" class="md-nav__link">
      聚合后的数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ugly-things/" title="补充" class="md-nav__link">
      补充
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      高阶教程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        高阶教程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../extra/TheBasics/" title="基础" class="md-nav__link">
      基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extra/StaticZite/" title="静态站点" class="md-nav__link">
      静态站点
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extra/TipsAndTricks/" title="一些技巧" class="md-nav__link">
      一些技巧
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extra/UsersAndDatabasesInZeroNet/" title="用户和数据库" class="md-nav__link">
      用户和数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extra/WriteAPlugin/" title="写个插件" class="md-nav__link">
      写个插件
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="创建站点" class="md-nav__link">
    创建站点
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="概览" class="md-nav__link">
    概览
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="数据源" class="md-nav__link">
    数据源
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajson" title="data.json" class="md-nav__link">
    data.json
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="数据库模式" class="md-nav__link">
    数据库模式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" title="json 表" class="md-nav__link">
    json 表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="添加表" class="md-nav__link">
    添加表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="映射表" class="md-nav__link">
    映射表
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to_table" title="to_table" class="md-nav__link">
    to_table
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="数据库的读权限" class="md-nav__link">
    数据库的读权限
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">创建数据库</h1>
<p>今天咱建个博客站。</p>
<h2 id="_2">创建站点</h2>
<p>我推荐直接创建新站点，因为更改一个写好的站点的数据库配置比较难调试。我还是会照常给你两种代码格式：一个用 ZeroFrame，另一个用我的库。</p>
<h2 id="_3">概览</h2>
<p>零网内置 SQLite。当然，你自己也可以创建一个数据库，这不是很难。咱开始创建数据库吧。</p>
<h2 id="_4">数据源</h2>
<p>零网中只有 <em>SELECT</em> 语句是允许的，数据库是由 JSON 文件导入而成的，所以现在就写点 JSON 文件吧。</p>
<h3 id="datajson"><code>data.json</code></h3>
<p>依据传统，用户数据都放在 <code>data/*/data.json</code>文件。现在咱写个<code>data/admin/data.json</code>吧。创建一个数组<code>posts</code>，里面有几行数据。</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;posts&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Post 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Post 1&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Post 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Post 2&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<h2 id="_5">数据库模式</h2>
<p><code>dbschema.json</code> 是个简单的 JSON 文件，下面是个空数据库：</p>
<div class="codehilite"><pre><span></span>{
    &quot;db_name&quot;: &quot;mydatabase&quot;,
    &quot;db_file&quot;: &quot;data/mydatabase.db&quot;,
    &quot;version&quot;: 2,
    &quot;maps&quot;: {},
    &quot;tables&quot;: {}
}
</pre></div>


<ul>
<li><code>db_name</code> 指数据库名，只用于调试。一个站点不能有多个数据库。</li>
<li><em>SQLite</em> 是单个文件，<code>db_file</code> 是其路径。</li>
<li><code>version</code> 不是 <em>SQLite</em> 版本，是零网的数据库的版本。</li>
<li><code>maps</code> 数据库和文件之间的映射关系。</li>
<li><code>tables</code> 表结构。</li>
</ul>
<p>把 <code>dbschema.json</code> 复制到站点根目录。</p>
<h3 id="json"><code>json</code> 表</h3>
<p>对于每个注册用户（站长或者是 ZeroID 用户），在<code>json</code>表里都有一条记录。零网需要这个表，否则会报错。</p>
<p>现在往文件里加点内容。</p>
<p><code>dbschema.json</code>:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;db_name&quot;</span><span class="p">:</span> <span class="s2">&quot;mydatabase&quot;</span><span class="p">,</span>
    <span class="nt">&quot;db_file&quot;</span><span class="p">:</span> <span class="s2">&quot;data/mydatabase.db&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nt">&quot;maps&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="nt">&quot;tables&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;cols&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">[</span><span class="s2">&quot;json_id&quot;</span><span class="p">,</span> <span class="s2">&quot;INTEGER PRIMARY KEY AUTOINCREMENT&quot;</span><span class="p">],</span>
                <span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">],</span>
                <span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">]</span>
            <span class="p">],</span>
            <span class="nt">&quot;indexes&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;CREATE UNIQUE INDEX path ON json(directory, file_name)&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;schema_changed&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="_6">添加表</h3>
<p>再添加<code>posts</code>表</p>
<p>先设置表名</p>
<div class="codehilite"><pre><span></span>    <span class="p">{</span>
        <span class="nt">&quot;db_name&quot;</span><span class="p">:</span> <span class="s2">&quot;mydatabase&quot;</span><span class="p">,</span>
        <span class="nt">&quot;db_file&quot;</span><span class="p">:</span> <span class="s2">&quot;data/mydatabase.db&quot;</span><span class="p">,</span>
        <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nt">&quot;maps&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="nt">&quot;tables&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;cols&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">[</span><span class="s2">&quot;json_id&quot;</span><span class="p">,</span> <span class="s2">&quot;INTEGER PRIMARY KEY AUTOINCREMENT&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">]</span>
                <span class="p">],</span>
                <span class="nt">&quot;indexes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CREATE UNIQUE INDEX path ON json(directory, file_name)&quot;</span><span class="p">],</span>
                <span class="nt">&quot;schema_changed&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="nt">&quot;posts&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="err">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>


<p>看 <code>json</code> 表的格式，每个表都由 <code>cols</code>, <code>indexes</code> 和 <code>schema_changed</code>组成。 <code>schema_changed</code> 就是表的版本，改变表后要增加这个值，这样每个节点才会重建数据库。</p>
<div class="codehilite"><pre><span></span>    <span class="s2">&quot;posts&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;cols&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="err">...</span>
        <span class="p">],</span>
        <span class="nt">&quot;indexes&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="err">...</span>
        <span class="p">],</span>
        <span class="nt">&quot;schema_changed&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
</pre></div>


<p><code>cols</code> 是列（column）的数组，每个列的第一个数组元素是列名 (SQL 关键字, 如<code>GROUP</code> 和 <code>UPDATE</code>是不允许的). 第二个是 <em>SQLite</em> 列的类型 - <code>integer</code>, <code>float</code> 或 <code>text</code>.</p>
<div class="codehilite"><pre><span></span>    <span class="s2">&quot;posts&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;cols&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;json_id&quot;</span><span class="p">,</span> <span class="s2">&quot;integer references json(json_id)&quot;</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="nt">&quot;indexes&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="err">...</span>
        <span class="p">],</span>
        <span class="nt">&quot;schema_changed&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
</pre></div>


<p>注意到 <code>json_id</code> 列了吗? 这是 <code>dbschema.json</code> 中又一个奇怪的事情， 每个表都要有这个列。</p>
<p><code>indexes</code>数组里列出了索引，<code>CREATE INDEX</code>可以放在那里，索引名并不代表什么。</p>
<div class="codehilite"><pre><span></span>    <span class="s2">&quot;posts&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;cols&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;json_id&quot;</span><span class="p">,</span> <span class="s2">&quot;integer references json(json_id)&quot;</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="nt">&quot;indexes&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;CREATE UNIQUE INDEX post_id ON posts(id)&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;schema_changed&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
</pre></div>


<p>现在我们有了一个数据库，签名 <code>content.json</code>.然后就会出来一个新文件 <code>data/mydatabase.db</code> (依据 <code>dbschema.json</code>里 <code>db_file</code> 指定的文件名). 这是 <em>SQLite</em> 数据库 ，我推荐用 <em>SQLiteStudio</em> 浏览、编辑数据库。现在你只能看到空的 <code>json</code> 和 <code>post</code> 表,已经一个特殊的 <code>keyvalue</code> 表，这是零网的内部表，不要动它。</p>
<blockquote>
<p>译者注：<em>SQLiteStudio</em> 太老了，用<a href="http://sqlitebrowser.org/">DB Browser for SQLite </a>吧。</p>
</blockquote>
<h3 id="_7">映射表</h3>
<h4 id="to_table"><code>to_table</code></h4>
<p>现在只有空表，空表有啥用呢？用<code>data/admin/data.json</code>填充<code>posts</code>表吧。</p>
<p>还记得<code>dbschema.json</code>的 <code>maps</code> 对象吗 ?</p>
<div class="codehilite"><pre><span></span>    <span class="err">...</span>
    <span class="s2">&quot;version&quot;</span><span class="err">:</span> <span class="mi">2</span><span class="err">,</span>
    <span class="s2">&quot;maps&quot;</span><span class="err">:</span> <span class="p">{}</span><span class="err">,</span>
    <span class="s2">&quot;tables&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="err">...</span>
</pre></div>


<p>改掉。</p>
<div class="codehilite"><pre><span></span>    <span class="s2">&quot;maps&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;admin/data.json&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;to_table&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;posts&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;posts&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>


<p>键名 <code>admin/data.json</code> 是 <strong>正则表达式</strong>，符合此表达式的文件都会被导入到这个表。目前只有 <code>to_table</code>
，这意味着每个符合该正则表达式的 JSON 文件的<code>posts</code>对象都会被导入到数据库的<code>posts</code>表中。</p>
<p>签名 <code>content.json</code>，再查看一下数据库，看到变化了吗? 嗯，<code>posts</code>表中的<code>json_id</code>对应着<code>json</code>表中的<code>json_id</code> 。每个 json 文件都在<code>json</code>表中有记录，你可能觉得没有什么必要，但以后可能就会用到。</p>
<h2 id="_8">数据库的读权限</h2>
<p>创建新文件 <code>js/index.js</code>，并在<code>index.html</code> 中引入它和<code>js/ZeroFrame.js</code>。</p>
<p>记得怎么用 ZeroFrame 吧? 调用 <code>dbQuery</code>:</p>
<div class="codehilite"><pre><span></span>+-------------------------------------------------------------------------+
|                                 dbQuery                                 |
+-------------------------------------------------------------------------+
| Run a query on the sql cache                                            |
+-------------------------+-----------------------------------------------+
| Parameter               | Description                                   |
+-------------------------+-----------------------------------------------+
| query                   | Sql query command                             |
+-------------------------+-----------------------------------------------+
| Return: Result of query as array or object with &quot;error&quot; property        |
+-------------------------------------------------------------------------+

var zeroFrame = new ZeroFrame();

zeroFrame.cmd(&quot;dbQuery&quot;, [&quot;SELECT * FROM posts&quot;], function(posts) {
    if(posts.error) {
        console.warn(posts.error);
        return;
    }

    console.log(posts);
});
</pre></div>


<p>打开控控制台并刷新，你就能看到:</p>
<div class="codehilite"><pre><span></span>Array [ Object, Object ]
        Object {
            content: &quot;Post 1&quot;,
            id: 1,
            json_id: 1,
            title: &quot;Post 1&quot;
        }
</pre></div>


<p>以后会讲如何动态编辑数据。至于现在，你手动编辑就是，给文件签名，然后刷新，看看有哪些变化。</p>
<p>We'll cover dynamic data changing and design in the following parts. For now, you can directly change <code>data/admin/data.json</code>, sign <code>content.json</code> and reload zite to see what changes.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../zeroframe/" title="站点框架" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                站点框架
              </span>
            </div>
          </a>
        
        
          <a href="../changing-tables/" title="操作数据库" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                操作数据库
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>