



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>用户和数据库 - 零网事实</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="零网事实" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                零网事实
              </span>
              <span class="md-header-nav__topic">
                用户和数据库
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="零网事实" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    零网事实
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../security/" title="安全" class="md-nav__link">
      安全
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cloning-zites/" title="站点克隆" class="md-nav__link">
      站点克隆
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../creating-static-zite/" title="静态站点" class="md-nav__link">
      静态站点
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../zeroframe/" title="站点框架" class="md-nav__link">
      站点框架
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases/" title="数据库" class="md-nav__link">
      数据库
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changing-tables/" title="操作数据库" class="md-nav__link">
      操作数据库
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dbschema/" title="数据库模式" class="md-nav__link">
      数据库模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user-content/" title="用户数据" class="md-nav__link">
      用户数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../editing-user-data/" title="编辑用户数据" class="md-nav__link">
      编辑用户数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../merger-sites/" title="聚合站" class="md-nav__link">
      聚合站
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../mergxed-sites/" title="聚合后的数据" class="md-nav__link">
      聚合后的数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ugly-things/" title="补充" class="md-nav__link">
      补充
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14" checked>
    
    <label class="md-nav__link" for="nav-14">
      高阶教程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        高阶教程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../TheBasics/" title="基础" class="md-nav__link">
      基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../StaticZite/" title="静态站点" class="md-nav__link">
      静态站点
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TipsAndTricks/" title="一些技巧" class="md-nav__link">
      一些技巧
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        用户和数据库
      </label>
    
    <a href="./" title="用户和数据库" class="md-nav__link md-nav__link--active">
      用户和数据库
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#users" title="Users" class="md-nav__link">
    Users
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-certificate-authorities-work" title="How Certificate Authorities Work" class="md-nav__link">
    How Certificate Authorities Work
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centralized-method" title="Centralized Method" class="md-nav__link">
    Centralized Method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decentralized-method" title="Decentralized Method" class="md-nav__link">
    Decentralized Method
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-in-zites" title="Use In Zites" class="md-nav__link">
    Use In Zites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-ids" title="Verifying IDs" class="md-nav__link">
    Verifying IDs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases" title="Databases" class="md-nav__link">
    Databases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbschema-file" title="Dbschema File" class="md-nav__link">
    Dbschema File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-permissions" title="User Permissions" class="md-nav__link">
    User Permissions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-file-and-updates" title="Data File and Updates" class="md-nav__link">
    Data File and Updates
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../WriteAPlugin/" title="写个插件" class="md-nav__link">
      写个插件
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#users" title="Users" class="md-nav__link">
    Users
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-certificate-authorities-work" title="How Certificate Authorities Work" class="md-nav__link">
    How Certificate Authorities Work
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centralized-method" title="Centralized Method" class="md-nav__link">
    Centralized Method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decentralized-method" title="Decentralized Method" class="md-nav__link">
    Decentralized Method
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-in-zites" title="Use In Zites" class="md-nav__link">
    Use In Zites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-ids" title="Verifying IDs" class="md-nav__link">
    Verifying IDs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases" title="Databases" class="md-nav__link">
    Databases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbschema-file" title="Dbschema File" class="md-nav__link">
    Dbschema File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-permissions" title="User Permissions" class="md-nav__link">
    User Permissions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-file-and-updates" title="Data File and Updates" class="md-nav__link">
    Data File and Updates
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>用户和数据库</h1>
                
                <h2 id="introduction">Introduction</h2>
<p>This tutorial provides a basic overview of how Databases and Users in ZeroNet are handled so that both users and developers will understand them as a fundamental part of all zites on ZeroNet. Not only will this tutorial cover the purpose of Databases and Users in general, but also how each one is handled within each zite, how they connect to each other, and how they are fundamental in each other's functioning.</p>
<p>First we will start with Users, then we will move onto Databases.</p>
<hr />
<h2 id="users">Users</h2>
<p>ZeroNet uses Certificate Authorities to manage and verify users. With this, there is no need to remember or manage passwords, which makes the network stronger and safer as a whole. We will discover not only the way in which ZeroNet achieves a simple yet strong system, but how it allows zites to associate a certain level of trustworthiness by the use of Certificate Authorities (known as ID Providers within the network). We will also learn about the different methods employed by these Certificate Authorities and how they are used within zites to associate data with a user ID. Finally, we will go over how ZeroNet is able to very easily verify that a user belongs to a given ID Provider, which is in turn then used to verify the data of that user.</p>
<h2 id="how-certificate-authorities-work">How Certificate Authorities Work</h2>
<p>In ZeroNet, everything is signed using Bitcoin keys. A certificate authority associates memorizable ID names with Bitcoin addresses. There are currently five main ID Providers for ZeroNet:</p>
<ul>
<li>ZeroId - Official, names <em>are</em> unique, must access the clearnet to verify name uniqueness</li>
<li>KaffieId - Names are <em>not</em> unique, fully decentralized</li>
<li>CryptoId - Names are <em>not</em> unique, fully decentralized</li>
<li>PolarId - Names are <em>not</em> unique, users verified by Google Account</li>
<li>PeakId - Names <em>are</em> unique, users verified by Google Account</li>
</ul>
<p>A certificate is created for each user ID. The body of the certificate consists of a user's authentication address, portal type, and username. The user's authentication address and its private key are determined by the authentication address automatically assigned when you downloaded the ID provider's zite.</p>
<p>The signature is generated by the certificate authority based on the body of the certificate. This signature is generated by encrypting the certificate body with a private key. How this encryption is done varies based on the method by which the CA uses, <em>centralized</em> (ZeroId, PolarId, and PeakId) or <em>decentralized</em> (KaffieId and CryptoId).</p>
<h3 id="centralized-method">Centralized Method</h3>
<p>For the centralized method, the certificate authority uses a <em>central server</em> to generate the signature. This is so that the server can verify certain things, such as usernames meeting specific character requirements, overall length, and uniqueness. The server also generates the signature with a private key. By using a server, the private key is only known to the owner of the ID provider. ZeroId, PolarId, and PeakId all employ this method, but PolarId does <em>not</em> enforce unique usernames.</p>
<h3 id="decentralized-method">Decentralized Method</h3>
<p>In contrast, the decentralized method does <em>not</em> rely on a central server. Instead, the client generates the signature by using a publicly available private key. Because the private key is available, there is no way to ensure usernames meet specific requirements. This is why it is possible to create non-unique usernames with this method. KaffieId and CryptoId use this method, which is why they do not enforce unique usernames.</p>
<p>With KaffieId, a private key that is separate from the zite's private key is used to ensure people are not able to edit the zite. This also means that the public key is different from the zite's address.</p>
<p>Once registration is done, the certificate contents of your new ID will be stored in the <code>zeronet_root/data/users.json</code> file, including the signature given by the ID provider (this is done via the <code>certAdd</code> command).</p>
<h2 id="use-in-zites">Use In Zites</h2>
<p>In order to allow users to sign-in and add their own content to a zite, the zite owner must allow certain ID providers. This can be done by setting rules in a <code>content.json</code> file on the zite, providing it with the public key and a friendly name (usually a .bit address) of the ID provider.</p>
<p>For ZeroId, the public key is the address of the ZeroId zite. However, since KaffieId's private key is public, the private key, and therefore public key, is <em>not</em> the same as the zite's address. This is to ensure nobody can edit the KaffieId website. For this reason, it is the public key associated with the private key used to create user ID signatures that should be used, not the public key of KaffieId's zite.</p>
<p>When a user logs in and posts content to the zite for the first time, a directory, named based on the user's public address, is created. This directory is used to store important files for the user, including any images, audio, video, etc. that the user may post to a zite. A <code>content.json</code> file is created within this directory, that stores the user's certificate information (username, portal type, public key, and the signature from the ID provider they signed up with).</p>
<h2 id="verifying-ids">Verifying IDs</h2>
<p>The verification process for user IDs is very simple. ZeroNet is able to get the information of a user's certificate by reading their own <code>content.json</code> file in their directory. The signature is decrypted based on the public key given in the zite's <code>content.json</code> file. If the signature matches the certificate information stored in the user's <code>content.json</code> file, then the user is valid and ZeroNet continues to download and check the rest of the files in the user's directory.</p>
<hr />
<h2 id="databases">Databases</h2>
<p>Now that we have gone over Users, it is time to detail Databases, which have a direct link to Users.</p>
<p>ZeroNet makes use of SQLite3 databases. The usage of databases in ZeroNet are very different from databases used on the clearnet. The main reason being ZeroNet is decentralized. This decentralization also requires that receiving updates from users should not be instant. Not only is there a waiting period of 30 seconds between content publishes, but there is also a waiting period for all of the changes to be spread across all peers of the network. Keeping this in mind, ZeroNet needs a way to ensure that databases are not overwritten when two people publish changes at the same time. In order to do this, ZeroNet creates separate json files for each user that will store all the information that should aggregate into the database. With this, a user only affects his own json file, meaning that these files should never be overwritten by someone else.</p>
<h2 id="dbschema-file">Dbschema File</h2>
<p>All zites that use a database must have a <code>dbschema.json</code> file. This is a json file that simply details all the tables and columns of the database. It will also tell ZeroNet which json files should be aggregated into which tables inside the database.</p>
<h2 id="user-permissions">User Permissions</h2>
<p>Typically a user's files, including their json file used for the database, are stored within the <code>data/users/[auth_address]/</code> directory of the zite's root directory. In order for the zite's owner to be able to control what the user can put inside this directory, they use a <code>content.json</code> file located in the <code>data/users/</code> directory. This file controls which ID Provider users can use to add to the zite, as well as which files are allowed within their user directory and the file size limit. Users also get their own <code>content.json</code> file located within their user directory that will tell ZeroNet what files they've uploaded and their respective size and hashes. This is used to verify that the correct user files are being downloaded.</p>
<h2 id="data-file-and-updates">Data File and Updates</h2>
<p>Usually, zite's use the <code>data.json</code> filename for the file that will store all of the user information that should be aggregated into the zite's database. Whenever the zite updates user content (which can only be done by the user using the zite on their own computer), the updated information is added to this file.</p>
<p>Once this file updates, zites will usually instruct ZeroNet to sign the user directory's contents, which will add the hashes of all the files, including <code>data.json</code>, to the user's <code>content.json</code> file. Then, it will add a signature to the file. This signature is generated by creating a hash of the <code>content.json</code> file and encrypting that with the user's private key (which is located in the <code>zeronet_root/data/users.json</code> file). This is very similar to how a zite owner signs his own zite.</p>
<p>Finally, the zite will publish the changes, which will give to at most 6 peers, the new <code>content.json</code> file. These peers will verify the user using the methods described in the first half of this tutorial. Then, they will ask for the other files. Once they have been downloaded, they will verify these files using the hashes provided in the <code>content.json</code> file and publish the <code>content.json</code> file to more peers until there are no peers left that need the file.</p>
<p>Once a client receives a new <code>data.json</code> file, it will add the new information into the database and send a request to the zite. A zite could then respond to this request and reload the contents on the screen with the updated information by requerying the database.</p>
<hr />
<p>Previous Tutorial: <a href="./?/tutorials/users_databases_in_zeronet">Users and Databases In ZeroNet</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../TipsAndTricks/" title="一些技巧" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                一些技巧
              </span>
            </div>
          </a>
        
        
          <a href="../WriteAPlugin/" title="写个插件" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                写个插件
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9e1f3b71.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>