



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>一些技巧 - 零网事实</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#onpopstate-wont-work-whats-going-on" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="零网事实" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                零网事实
              </span>
              <span class="md-header-nav__topic">
                一些技巧
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="零网事实" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    零网事实
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../security/" title="安全" class="md-nav__link">
      安全
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cloning-zites/" title="站点克隆" class="md-nav__link">
      站点克隆
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../creating-static-zite/" title="静态站点" class="md-nav__link">
      静态站点
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../zeroframe/" title="站点框架" class="md-nav__link">
      站点框架
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases/" title="数据库" class="md-nav__link">
      数据库
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changing-tables/" title="操作数据库" class="md-nav__link">
      操作数据库
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dbschema/" title="数据库模式" class="md-nav__link">
      数据库模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user-content/" title="用户数据" class="md-nav__link">
      用户数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../editing-user-data/" title="编辑用户数据" class="md-nav__link">
      编辑用户数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../merger-sites/" title="聚合站" class="md-nav__link">
      聚合站
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../mergxed-sites/" title="聚合后的数据" class="md-nav__link">
      聚合后的数据
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ugly-things/" title="补充" class="md-nav__link">
      补充
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14" checked>
    
    <label class="md-nav__link" for="nav-14">
      高阶教程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        高阶教程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../TheBasics/" title="基础" class="md-nav__link">
      基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../StaticZite/" title="静态站点" class="md-nav__link">
      静态站点
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        一些技巧
      </label>
    
    <a href="./" title="一些技巧" class="md-nav__link md-nav__link--active">
      一些技巧
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#onpopstate-wont-work-whats-going-on" title="Onpopstate won't work. What's going on?" class="md-nav__link">
    Onpopstate won't work. What's going on?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#can-a-zite-owner-modify-a-users-datajson-file" title="Can A Zite Owner Modify A User's data.json File?" class="md-nav__link">
    Can A Zite Owner Modify A User's data.json File?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-browsers-do-i-need-to-support-for-my-zite" title="What Browsers Do I Need To Support For My Zite?" class="md-nav__link">
    What Browsers Do I Need To Support For My Zite?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoincrement-issue-in-database" title="AUTOINCREMENT Issue in Database" class="md-nav__link">
    AUTOINCREMENT Issue in Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reloading-list-when-database-changes" title="Reloading List When Database Changes" class="md-nav__link">
    Reloading List When Database Changes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-datajson-file-thats-not-user-specific" title="Using A Data.json File That's Not User-specific" class="md-nav__link">
    Using A Data.json File That's Not User-specific
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../UsersAndDatabasesInZeroNet/" title="用户和数据库" class="md-nav__link">
      用户和数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../WriteAPlugin/" title="写个插件" class="md-nav__link">
      写个插件
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#onpopstate-wont-work-whats-going-on" title="Onpopstate won't work. What's going on?" class="md-nav__link">
    Onpopstate won't work. What's going on?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#can-a-zite-owner-modify-a-users-datajson-file" title="Can A Zite Owner Modify A User's data.json File?" class="md-nav__link">
    Can A Zite Owner Modify A User's data.json File?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-browsers-do-i-need-to-support-for-my-zite" title="What Browsers Do I Need To Support For My Zite?" class="md-nav__link">
    What Browsers Do I Need To Support For My Zite?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoincrement-issue-in-database" title="AUTOINCREMENT Issue in Database" class="md-nav__link">
    AUTOINCREMENT Issue in Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reloading-list-when-database-changes" title="Reloading List When Database Changes" class="md-nav__link">
    Reloading List When Database Changes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-datajson-file-thats-not-user-specific" title="Using A Data.json File That's Not User-specific" class="md-nav__link">
    Using A Data.json File That's Not User-specific
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>一些技巧</h1>
                
                <p>This tutorial has common tips and tricks for things that aren't readily apparent. Some of these will probably be expanded into full tutorials.</p>
<h2 id="onpopstate-wont-work-whats-going-on">Onpopstate won't work. What's going on?</h2>
<p>Since zeronet displays all zites in an iframe, the onpopstate is actually using the iframe's address. Therefore, you cannot use onpopstate. But don't worry, there's a way around this. It turns out that the ZeroFrame API has a way of hooking into onpopstate. The wrapper passes the onpopstate event into the inner iframe and you can catch it using <code>onRequest</code>. Here's how I'm doing it on this zite (and in my ZeroFrame Router):</p>
<div class="codehilite"><pre><span></span><span class="nx">onRequest</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span> <span class="o">==</span> <span class="s2">&quot;wrapperPopState&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">message</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\?/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Don&#39;t worry too much about this, it&#39;s just a function</span>
            <span class="c1">// in my ZeroFrame Router to navigate to a route.</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\//</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="can-a-zite-owner-modify-a-users-datajson-file">Can A Zite Owner Modify A User's data.json File?</h2>
<p>Yes they can. All you have to do is modify the file, then manually put the path to the <code>content.json</code> file in the sidebar beside the <code>Sign</code> button and click <code>Sign</code> and <code>Publish</code>. Usually the path will be something like: <code>data/users/[user's id key folder]/content.json</code>.</p>
<h2 id="what-browsers-do-i-need-to-support-for-my-zite">What Browsers Do I Need To Support For My Zite?</h2>
<p>You only need to support browser versions that support Web Socket's because that is a requirement for ZeroNet. This means you <em>do not</em> have to support any version of IE <em>before</em> version 10. Here's a link showing browser support for Web Sockets: <a href="https://caniuse.com/#search=websockets">https://caniuse.com/#search=websockets</a>.</p>
<h2 id="autoincrement-issue-in-database">AUTOINCREMENT Issue in Database</h2>
<p>There is an interesting thing that happens with <code>AUTOINCREMENT</code>. Everytime you rebuild the database for your zite, any columns that use <code>AUTOINCREMENT</code> will not be reset back to 1, but will instead start at the next integer after the integer of the last row, which was deleted during the rebuild along with the rows before it. I'm unsure if this is intended or not. If you are manually updating your json file, a way around this is to just hardcode the integer's, incrementing them yourself. This is currently what I do for the tutorial id's on this zite.</p>
<h2 id="reloading-list-when-database-changes">Reloading List When Database Changes</h2>
<p>If you would like to reload a list, whose items were gotten from a database, whenever the database changes (for example, reloading comments when someone posts a new comment), all you need to do is add this to your <code>onRequest</code> function:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file_done&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">loadComments</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>The <code>file done</code> message is sent whenever a json file was changed, the new version has been downloaded, and the database has reloaded/updated.</p>
<h2 id="using-a-datajson-file-thats-not-user-specific">Using A Data.json File That's Not User-specific</h2>
<p>You can use a <code>data.json</code> file that only <em>you</em> can sign and isn't stored in a users folder. This is what I use to store the tutorials list for this zite. First, you need to make sure it isn't ignored in your <code>content.json</code> file. Next, create the file in the data folder. Below, this will be called <code>tutorials.json</code> since it stores tutorials. Then, in your <code>dbschema.json</code> file, add this:</p>
<p>In <code>maps</code> section:</p>
<div class="codehilite"><pre><span></span><span class="s2">&quot;tutorials.json&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;to_table&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorials&quot;</span><span class="p">,</span>
            <span class="nt">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorials&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<p>This tells ZeroNet that in the <code>tutorials.json</code> file, you have an array called <code>tutorials</code> whose data should be mapped into the <code>tutorials</code> table in the sqlite database.</p>
<p>In <code>tables</code> section:</p>
<div class="codehilite"><pre><span></span><span class="s2">&quot;tutorials&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;cols&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;INTEGER PRIMARY KEY&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT NOT NULL&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT NOT NULL&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT NOT NULL&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT NOT NULL&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;json_id&quot;</span><span class="p">,</span> <span class="s2">&quot;INTEGER REFERENCES json (json_id)&quot;</span><span class="p">]</span>
    <span class="p">],</span>
    <span class="nt">&quot;indexes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CREATE UNIQUE INDEX tutorial_key ON tutorials(id, json_id)&quot;</span><span class="p">,</span> <span class="s2">&quot;CREATE UNIQUE INDEX tutorials_slug ON tutorials(slug)&quot;</span><span class="p">,</span> <span class="s2">&quot;CREATE INDEX tutorial_file ON tutorials(slug)&quot;</span><span class="p">,</span> <span class="s2">&quot;CREATE INDEX tutorial_title ON tutorials(title)&quot;</span><span class="p">],</span>
    <span class="nt">&quot;schema_changed&quot;</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">}</span>
</pre></div>


<p>This tells ZeroNet all of the columns and indexes of the <code>tutorials</code> table. The columns should directly relate to what's in your <code>data.json</code> file.</p>
<p><strong>Make sure you add <code>["json_id", "INTEGER REFERENCES json (json_id)"]</code> otherwise none of this will work.</strong></p>
<p>Whenever you change a table in your <code>dbschema.json</code> file, <em>make sure you update the <code>schema_changed</code> field</em> so ZeroNet knows to reload that table. Now all you need to do is press <code>Reload</code> and <code>Rebuild</code> on the sidebar on your zite.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../StaticZite/" title="静态站点" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                静态站点
              </span>
            </div>
          </a>
        
        
          <a href="../UsersAndDatabasesInZeroNet/" title="用户和数据库" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                用户和数据库
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9e1f3b71.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>