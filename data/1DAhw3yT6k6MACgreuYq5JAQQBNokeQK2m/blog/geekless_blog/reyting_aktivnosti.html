<!DOCTYPE html>
<html>

<head>
	<title>Рейтинг активности пользователей на форумах</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../../css/global.css">
</head>

<body>
	
<header>
  <a href="../../index.html"><img src="../../img/logo.png" width="55"></a><br>ChronCache	
</header>
	
<nav>
	<hr>
  <p><a href="../../blog.html">архив</a> <tt>|</tt> <a href="../../help.html">помощь</a> <tt>|</tt> <a href="/1Q9LVNLD1ghusGxpiwjYnVjPsxD5xGTGc7/donate/index.html">донат</a></p>
	<hr>
</nav>

<article>
	
<acide><p>Это резервная страница от 21.03.2020 / <a href="/1BLoGBTid3NhGu8ts3fAfHJprnbrH3wfTV/?Post:25">оригинал</a></p></acide>

<section>
	<h1>Рейтинг активности пользователей на форумах</h1>
	<p>Зачем-то написал скрипт, отображающий статистику о пользователях форумов, работающих на движке ZeroTalk. В рейтинге активности учитываются даты постов и комментариев, их количество, количество лайков и общий размер данных.</p>
	<div class="code">
		<code>#!/bin/sh

zite="$1"

min_date="`
(
    cd "$zite"
    for d in data/users/*/data.json ; do
        jq '.topic[].added / 86400' "$d"
        jq '.comment[][].added / 86400' "$d"
    done
) | sort -n | head -1`"

(
    cd "$zite"

    echo "rating user last_activity data_size topics comments topic_votes comment_votes"

    (for f in data/users/*/content.json ; do
        d="${f%content.json}data.json"
        user="`jq -r '.cert_user_id' "$f"`"
        modified="`jq -r '.modified' "$f"`"
        size="`jq -r '.files["data.json"].size' "$f"`"

        date_rating=
        topics=
        comments=
        topic_votes=
        comment_votes=

        if [ -f "$d" ] ; then
            comments="`jq '.comment' "$d" | grep '"comment_id"' | wc -l`"
            topics="`jq '.topic | length' "$d"`"
            topic_votes="`jq '.topic_vote | length' "$d"`"
            comment_votes="`jq '.comment_vote | length' "$d"`"

            date_rating="`
            (
                jq ".topic[].added  / 86400 - $min_date" "$d"
                jq ".comment[][].added  / 86400 - $min_date" "$d"
            ) | paste -sd+ | bc`"
        fi

        date_rating="${date_rating:-0}"
        topics="${topics:-0}"
        comments="${comments:-0}"
        topic_votes="${topic_votes:-0}"
        comment_votes="${comment_votes:-0}"

        rating="`echo "sqrt($date_rating)/1 + sqrt($size / 1000)/1 + 10 * $topics + 5 * $comments + $topic_votes + $comment_votes" | bc`"

        echo "$rating $user `date +%Y-%m-%d -u --date=@"$modified"` $size $topics $comments $topic_votes $comment_votes"
    done) | sort -rn
) | column -t -s' '</code>
	</div>
	<p>Примеры отчётов:</p>
	<p><a href="/1Apr5ba6u9Nz6eFASmFrefGvyBKkM76QgE/">Форум Ru-ZeroTalk:</a></p>
	<div class="code">
		<code>rating  user                         last_activity  data_size  topics  comments  topic_votes  comment_votes
2989    shift@zeroid.bit             2017-08-14     217709     13      379       14           23
2768    balancer73@zeroid.bit        2018-05-01     256990     4       350       2            4
2597    nippletwister@zeroid.bit     2017-08-27     153478     8       329       8            21
2122    vlad20012@zeroid.bit         2017-05-11     139813     2       264       9            6
1597    splitfire@zeroid.bit         2016-08-11     61611      0       192       0            0
1441    kostanew@zeroid.bit          2016-03-19     94947      7       147       6            59
1342    wrewolf@zeroid.bit           2017-02-27     49021      1       151       3            7
1052    zalex@zeroid.bit             2018-04-23     41453      1       96        17           62
1042    gomzik@zeroid.bit            2017-11-14     44076      1       104       1            5
...     ...                          ...            ...        ...     ...       ...          ...</code>
	</div>
	<p><a href="/1BpFtPez7mSiShtXfb4wPfMT1dZTuRybfZ/">Форум LOR.Talks:</a></p>
	<div class="code">
		<code>rating  user                         last_activity  data_size  topics  comments  topic_votes  comment_votes
1185    balancer73@zeroid.bit        2018-05-01     148994     9       176       2            1
372     morin@zeroid.bit             2018-03-26     29816      2       51        0            0
247     geekless@zeroid.bit          2018-05-02     20063      2       22        1            1
221     pozya@zeroid.bit             2018-04-20     16016      0       24        0            1
154     zerro@zeroid.bit             2016-10-13     30081      1       25        1            2
146     tomfloyer@zeroid.bit         2018-05-01     5670       0       12        1            1
145     promusik@zeroid.bit          2018-04-15     5262       1       11        1            1
142     deepstrelok@zeroid.bit       2018-04-29     5901       1       10        0            1
138     radjah@zeroid.bit            2017-09-10     5856       1       12        1            0
...     ...                          ...            ...        ...     ...       ...          ...</code>
	</div>
	<p><a href="/1F4WVHDpQYxuJL6xEY3EZTYkZds9TTjVHC/">Форум Infonesy.Talks:</a></p>
	<div class="code">
		<code>rating  user                      last_activity  data_size  topics  comments  topic_votes  comment_votes
1769    balancer73@zeroid.bit     2018-04-29     233365     39      217       1            3
248     matiskynav@zeroid.bit     2018-04-29     16843      0       25        0            1
218     karmide@zeroid.bit        2017-08-27     18023      0       25        0            0
197     pozya@zeroid.bit          2018-04-23     11109      1       20        0            2
197     anotherneko@zeroid.bit    2018-04-29     11864      0       19        0            0
159     geekless@zeroid.bit       2018-04-29     8813       0       14        0            0
122     stre10k@zeroid.bit        2018-04-28     5981       0       9         2            3
118     varakin@zeroid.bit        2017-06-25     13825      0       12        2            3
118     nippletwister@zeroid.bit  2017-08-27     9545       0       11        1            0
...     ...                       ...            ...        ...     ...       ...          ...</code>
	</div>
	<p><a href="/Talk.ZeroNetwork.bit/">Форум ZeroTalk:</a></p>
	<div class="code">
		<code>rating  user                         last_activity  data_size  topics  comments  topic_votes  comment_votes
6792    nofish@zeroid.bit            2018-04-30     436304     6       1138      165          182
5086    kai0@zeroid.bit              2018-04-30     256055     135     591       0            0
3968    kaffie@zeroid.bit            2018-04-20     470095     13      603       23           171
3290    krixano@zeroid.bit           2018-04-17     284896     33      387       78           322
3290    akito@zeroid.bit             2018-04-15     215806     14      442       97           225
2663    styromaniac@zeroid.bit       2018-05-01     271249     34      271       117          296
2595    gitcenter@zeroid.bit         2018-04-13     154729     2       298       129          422
2344    p2p@zeroid.bit               2018-04-30     183890     18      332       63           49
2266    ssdifnskdjfnsdjk@zeroid.bit  2018-05-02     162389     44      230       31           125
...     ...                          ...            ...        ...     ...       ...          ...</code>
	</div><br>
</section>

<hr><p>Комментарии:</p>
	
<section class="com">
	<div>
		<p><b>zeronetix:</b> <tt>(May 02, 2018)</tt><br>Вау, класно. Можна десь використати (навіть з'явилась ідея написати таке на JS).</p>
	</div>
	<div>
		<p><b>deepstrelok:</b> <tt>(May 02, 2018)</tt><br>Очень длинный пост вышел. В блогах разве нельзя как-то скрыть часть информации под hide?</p>
	</div>
	<div>
		<p><b>geekless:</b> <tt>(May 02, 2018)</tt><br><em><b>deepstrelok:</b> Очень длинный пост вышел. В блогах разве нельзя как-то скрыть часть информации под hide?</em><br>Вроде, нет. В принципе, можно реализовать spoiler на CSS и вставить html-теги в код поста. Но тут конвертёр кривой, и портит HTML-разметку внутри markdown. (<a href="/1ysjnZzsz5YYXhTNBxELnY4ftz42QupMg/?Post:5">Например.</a>) Лень проверять, сохранит ли он div-ы или span-ы</p>
	</div>
	<div>
		<p><b>zeroout:</b> <tt>(May 05, 2018)</tt><br>Здорово!</p>
	</div>
</section>
	
<p class="dr">May 02, 2018 / Geekless.Blog</p>
	
</article>		
		
</body>
</html>