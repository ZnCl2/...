<!DOCTYPE html>
<html>

<head>
	<title>Копаем в глубь ZeroFrame. Часть 1. certSelect</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../../css/global.css">
</head>

<body>
	
<header>
  <a href="../../index.html"><img src="../../img/logo.png" width="55"></a><br>ChronCache	
</header>
	
<nav>
	<hr>
  <p><a href="../../blog.html">архив</a> <tt>|</tt> <a href="../../help.html">помощь</a> <tt>|</tt> <a href="/1Q9LVNLD1ghusGxpiwjYnVjPsxD5xGTGc7/donate/index.html">донат</a></p>
	<hr>
</nav>

<article>
	
<acide><p>Это резервная страница от 18.02.2019 / <a href="/1CpGZyfbUBBV5uXUoY653wVoqZFRojbEzd/?Post:4">оригинал</a></p></acide>

<section>
	<h1>Копаем в глубь ZeroFrame. Часть 1. certSelect.</h1>
	<p>Вроде бы рассматривать по одной команде API за раз как-то маловато, зато с другой стороны можно выдать выжимки кода и все разложить по полочкам. В общем прошу под кат, сегодня у нас на повестке дня команда <a href="https://zeronet.readthedocs.org/en/latest/site_development/zeroframe_api_reference/#certselect-accepted_domains" target="_blank">certSelect</a>.</p>
	<p>Вообще, сначала я должен сделать некоторое лирическое отступление. Я уже ругался на выбор CoffeScript в первом своем посте, поэтому рассказываю, что и как мы будем делать.</p>
	<p>Во первых, у нас тут Bleeding edge, используем ES6! Достигается это довольно просто, если использовать <a href="https://babeljs.io/" target="_blank">Babel.js</a>. Однако babeljs это всего-лишь транслятор. Для полного комфорта и автоматической сборки кода мы возьмем <a href="https://webpack.github.io/" target="_blank">webpack</a></p>
	<p>Так же хочу отметить, что я очень большой любитель такого прекрасного фреймворка как <a href="http://vuejs.org/" target="_blank">Vue.js</a>, так что буду использовать его.</p>
	<p>О том, как я организую проект, я чуть позже выпущу отдельную статью.</p>
	<p>Однако я очень буду стараться давать описание, не привязанное к фреймворку.</p>
	<p>Вернемся к нашим баранам.</p>
	<p>certSelect очень простая команда, которая отображает пользователю что-то вроде местного окошка логина. Вот если зайти на какой-нибудь <a href="/Talk.ZeroNetwork.bit">ZeroTalk</a> и попробовать написать пост или даже в этом блоге написать комментарий, вас непременно попросят войти. Справа в углу появется плашечка, где вы сможете выбрать идентификатор. На текущий момент там выбор из двух пунктов. По факту - один из них анонимус, второй - зарегестрированный аккаунт на сайте <a href="/zeroid.bit">ZeroID</a>. Вообще говоря, таких "точек идентификации" как ZeroID может быть много, только неувязочка в том, что сайт, который запрашивает информацию у вас о логине должен принудительно сказать, какие именно домены он принимает в качестве id. На текущий момент мне не известны другие "точки идентификации", да и вряд ли скоро появятся (хотя ради академического интереса - можно).</p>
	<p>Мы таким образом подошли к параметрам команды certSelect. А именно, certSelect принимает всего один параметр, называется он accepted_domains. Значение accepted_domains это массив со списком доменов "точек идентификации" и так как он у нас пока один единственный, то это массив из одного элемента. Конкретного. <code>'zeroid.bit'</code></p>
	<p>Итого, конструкция вполне конкретная:</p>
	<div class="code">
		<code>class ZeroSite extends ZeroFrame {}
let zeroSite = new ZeroFrame()
zeroSite.cmd('certSelect', {
    accepted_domains: ['zeroid.bit']
})</code>
	</div>
	<p><i>конечно же это дело упрощено, полный листинг ниже</i></p>
	<p>Данный код покажет пользователю знакомую плашку с выбором идентификатора и все вроде бы хорошо. Вот только как получить результат всего этого?</p>
	<p>А вот тут немного интереснее. Дело в том, что стандартный ZeroFrame позволяет вам добавить callback к вызову <code>zeroSite.cmd</code>, однако добавив его к certSelect мы ничего не получим. Потому что ответа на это дело нет. Однако ZeroNet оповещает наш сайт отдельным сообщением, которое называется <code>setSiteInfo</code>. Каждый раз, когда там что-то меняется, к нам приходит новое сообщение.</p>
	<p>Данное сообщение глубже мы рассматривать будем чуть позже, однако кое-что нас оттуда таки интересует. В параметрах сообщения можно найти поле <code>cert_user_id</code> которое будет равно null, если выбран анонимный пользователь и строке с идентификатором в ином случае. Т.е. если я выберу zeroid.bit идентификатор, то поле <code>cert_user_id</code> будет равно <code>'gomzik@zeroid.bit'</code></p>
	<p>Там есть еще несколько параметров, в том числе и намекающих на авторизацию, но об этом опять же, позже.</p>
	<p>Полный листинг вы найдете здесь: <a href="https://github.com/GomZik/ZeroNet-TestSite/tree/step01.certSelect.tutorial" target="_blank">GitHub</a>, а потыкать можно <a href="/1AQj7DF45w5DK2Ga486YT8QaYhpedgE5tR">тут</a></p>
	<p>Не серчайте, повторюсь, что обязательно расскажу более подробно, как у меня устроен проект чуть позже</p>
	<p>Почему меня везде просят авторизоваться?</p>
	<p>Что ж, чтобы ответить на этот вопрос, нужно понимать специфику сети. Дело в том, что чтобы сайты были динамическими, каждому пользователю нужен приватный ключ, чтобы использовать его для публикации своих изменений на сайте и чтобы быть уверенным, что именно этот пользователь эти изменения и сделал. В общем и целом этот ключ есть и у анонимного пользователя, однако я так понимаю, что сделано так нарочно, чтобы повысить секьюрность, препятствовать спаму и разрастанию сайта до необъятных размеров за счет неправомерных пользователей. Если я ошибаюсь, напишите пожалуйста в комментариях более подробно, буду рад.</p>
</section>	
	
<hr><p>Комментарии:</p>
	
<section class="com">
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br>Чего-то честно говоря, я запарился сегодня статью писать :)</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br>неплохо=) прочитал на одном дыхании, точно на хабр просится</p>
	</div>
	<div>
		<p><b>nippletwister:</b> <tt>(Feb 12, 2016)</tt><br>Кстати, уже запилиkb зеркало ZeroNet Docs: <u>http://127.0.0.1:43110/17Kom2G5qNDc6NaQwv445h1gFzxkY3ZtZe/</u></p>
		<p>Можно ссылаться сразу туда.</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br><em><b>nippletwister:</b> Кстати, уже запилиkb зеркало...</em><br>Да, я в целом видел, почему не сослался - не знаю :)</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br>как же круто насколько тут шустро всё работает</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br>Ссылка на поиграться работает?</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br><em><b>gomzik:</b> Ссылка на поиграться работает?</em><br>у меня NO PEERS FOUND</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br><em><b>shift:</b></em>]<br>беда :( Может потому что я не могу открыть порт? У нас в Беларуси суровый нат без поддержки upnp</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br><em><b>gomzik:</b> ... Может потому что я не могу открыть порт?..</em><br>вполне вероятно, а внешних IP у вас нет?</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br><em><b>shift:</b> ... а внешних IP у вас нет?</em><br>На работе мне точно его не увидеть, дома за отдельную плату.</p>
		<p>З.Ы. Всем мегабайт текста на моем блоге!</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br>так, а блог же твой как-то прогрузился</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br>Если вдруг откроется, скажите, просит ли оно больше квот? А то у меня просило, но у меня сначала вся внутрянка попала, которая не должна раздаваться.</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br>ты проверь командой verify что у тебя всё ок с ним и сделай publish принудительно</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br>А теперь:</p>
		<p>СONTENT.JSON DOWNLOAD FAILED</p>
		<p>PEERS FOUND: 1</p>
		<p>Так, что копай в сторону кривой подписи</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br><em><b>shift:</b> А теперь...</em><br>еще раз</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br><em><b>gomzik:</b> еще раз</em><br>пока еще failed но пиров уже 3</p>
	</div>
	<div>
		<p><b>nippletwister:</b> <tt>(Feb 12, 2016)</tt><br>Это я присоединился плюс, через проксю попробовал)</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br>И еще раз?</p>
	</div>
	<div>
		<p><b>nippletwister:</b> <tt>(Feb 12, 2016)</tt><br>Тянем потянем, вытянуть не можем!)</p>
	</div>
	<div>
		<p><b>gomzik</b> <tt>(Feb 12, 2016)</tt><br>Напомните сайт прокси то</p>
	</div>
	<div>
		<p><b>nippletwister:</b> <tt>(Feb 12, 2016)</tt><br>bit.no.com, Zero.pags.to и еще какой-то был.</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br>хм... Действительно что-то беда с вытягиванием</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br>Ну я бы тебе рекомендовал взять себе сервер (например с digital ocean) сможешь сайты как человек разливать ну и VPN который полезен и у вас и у нас</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br><em><b>shift:</b> Ну я бы тебе рекомендовал взять себе сервер...</em><br>Займусь этим в ближайшем будущем.</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br><em><b>gomzik:</b> Займусь этим в ближайшем будущем</em><br>если будешь на DO делать (сервак с SSD от 5$) то черкани в местную почту - дам реферальную ссылку там и тебе и мне что-то около 10$ приедет</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br>Заработало!</p>
	</div>
	<div>
		<p><b>gomzik:</b> <tt>(Feb 12, 2016)</tt><br><em><b>shift:</b> если будешь на DO делать...</em><br>У меня уже есть сервак на DO</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Feb 12, 2016)</tt><br><em><b>gomzik:</b> У меня уже есть сервак...</em><br>Продать рефералку не получилось :D<br>У меня к слову тоже заработало</p>
	</div>
	<div>
		<p><b>nippletwister:</b> <tt>(Feb 12, 2016)</tt><br>Подтверждаю, вытянулось.</p>
	</div>
	<div>
		<p><b>grez:</b> <tt>(May 01, 2016)</tt><br><em>На текущий момент мне не известны другие "точки идентификации"...</em><br>Появился: <u>http://127.0.0.1:43110/zeroverse.bit</u></p>
	</div>
	<div>
		<p><b>alexum:</b> <tt>(Sep 14, 2019)</tt><br>Спасибо автору за статью. Меня вот интересует вопрос, использования одного и того же аккаунта на разных устройствах. Я так подозреваю, что нужно будет ключи таскать между устройствами. Или я ошибаюсь?</p>
	</div>
</section>
	
<p class="dr">Feb 12, 2016 / GomZik's Blog</p>
	
</article>		
		
</body>
</html>