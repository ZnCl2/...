<!DOCTYPE html>
<html>

<head>
	<title>Мои соображения о хранении истории правок в Вики для ZN</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../../css/global.css">
</head>

<body>
	
<header>
  <a href="../../index.html"><img src="../../img/logo.png" width="55"></a><br>ChronCache	
</header>
	
<nav>
	<hr>
  <p><a href="../../blog.html">архив</a> <tt>|</tt> <a href="../../help.html">помощь</a> <tt>|</tt> <a href="/1Q9LVNLD1ghusGxpiwjYnVjPsxD5xGTGc7/donate/index.html">донат</a></p>
	<hr>
</nav>

<article>
	
<acide><p>Это резервная страница от 04.06.2019 <tt>(12.11.2020)</tt> / <a href="/1ysjnZzsz5YYXhTNBxELnY4ftz42QupMg/?Post:35">оригинал</a></p></acide>

<section>
	<h1>Мои соображения о хранении истории правок в Вики для ZN</h1>
	<ul>
		<li>Каждая версия документа подписана ключем автора версии.
		<li>Если версия документа основана на другой версии, то в неё вписывается идентификатор родительской версии и её подпись.
		<li>История правок документа отображается в виде направленного графа от дочерних версий к родительским.
		<li>Узлы графа отсортированы по времени, но сам граф не обязан быть связным. Он может представлять собой, например, несколько независимых друг от друга субграфов.
		<li>Движок должен нормально обрабатывать ситуацию (и визуально обозначать её), когда отсылка на родительскую версию есть, а сама она не найдена — автор родительской версии мог удалить или подменить данные.
		<li>Для экономии места хранятся не полные версии документов, а diff-ы. Однако diff вычисляется не от родительской версии (которая может принадлежать другому пользователю), а от одной из существующих версий этого же пользователя. Необходимо обеспечить сохранность данных пользователя вне зависимости от действий других пользователей, поэтому мы не можем полагаться на целостность чужих данных.
		<li>Исходная версия для diff-а может быть любой, лишь бы в графе diff-ов не образовывалось циклов. Можно автоматически подбирать исходную версию, чтобы diff был минимальным. (Таковой не обязательно будет предыдущая по времени.)
		<li>Движок может накладывать ограничения на длину цепочки diff-ов, чтобы не слишком нагружать компьютер при отображении контента. Чтобы не превышать длину цепочки, версии могут ветвиться подобно кусту. Если нет ветви, к которой можно пристроиться, не нарушая ограничения на длину и при этом экономя достаточно байт, сохраняется полная версия. Еще раз уточню, что все это имеет отношение не к истории правок, а только к компактному хранению.
		<li>Пользователь может удалить любые свои версии документа. Если версия служит родительской для любой другой версии, он получает предупреждение-вопрос, но всё равно может удалить версию. (Он всегда имеет возможность удалить данные вручную, так что нет смысла создавать ему препятствия в интерфейсе.) Дерево diff-ов при этом пересчитывается, чтобы сохранить целостность данных.
		<li>Diff-ы между родительским узлом и дочерним вычисляются на лету при отображении. В diff-ам хранения они не имеют отношения.
	</ul>
	<p>В ZeroWiki ничего этого нет, понятно. Как в движке Kiwipedia by @gitcenter организовано хранение, не смотрел.</p>
	<p>Очень хочется форкнуть ZeroWiki и покопаться в коде, но нет времени.</p>
</section>
	
<hr><p>Комментарии</p>
	
<section class="com">
	<div>
		<p><b>gitcenter:</b> <tt>(Oct 18, 2020)</tt><br>Я вас поздравляю -- вы изобрели git. Там даже абсолютно такая же delta-encoding. Думаю, копать стоит в сторону интеграции гита, как плагин к ZN или через wasm к конкретному сайту.</p>
	</div>
	<div>
		<p><b>geekless:</b> <tt>(Oct 26, 2020)</tt><br><em><b>gitcenter:</b> Я вас поздравляю -- вы изобрели git...</em><br>Статью не читай, сразу отвечай...</p>
	</div>
	<div>
		<p><b>gitcenter:</b> <tt>(Oct 26, 2020)</tt><br><em><b>geekless:</b> Статью не читай, сразу отвечай...</em><br>По сути -- эта система прекрасно ложится на Git. Если ее реализовывать, то взять за основу его же будет логичным шагом.</p>
	</div>
	<div>
		<p><b>geekless</b> <tt>(Oct 27, 2020)</tt><br><em><b>gitcenter:</b> По сути -- эта система прекрасно ложится на Git...</em><br>В гит есть постоянная история, а в сабже нет.<br>В гит коммиты всегда имеют родителя, а в сабже нет.<br>В гит в рамках ветки один объект имеет линейную историю, а в сабже нет.<br>И т.п</p>
		<p>Очень разные вещи.</p>
	</div>
	<div>
		<p><b>gitcenter:</b> <tt>(Oct 27, 2020)</tt><br><em><b>geekless:</b> В гит есть постоянная история, а в сабже нет.</em><br>А это как? У вас каждый коммит ссылается на родителя, a la blockchain. Или вы про то, что старую историю можно удалять?<br><em>В гит коммиты всегда имеют родителя, а в сабже нет.</em><br>Ну вот нет.<br><em>В гит в рамках ветки один объект имеет линейную историю, а в сабже нет.</em><br>В git, в отличие от hg, вообще нет веток. В git есть указатели, refs/heads, а не ветки. У git'а же тоже DAG, как у вас -- так пользуйтесь ветками исключительно как метками, не надо рассматривать их как часть истории.<br><em>Очень разные вещи.</em><br>Идейно -- одно и то же.</p>
	</div>
	<div>
		<p><b>geekless:</b> <tt>(Oct 27, 2020)</tt><br><em><b>gitcenter:</b> А это как? У вас каждый коммит ссылается на родителя...</em><br>В тексте выше всё написано же.</p>
		<ol>
			<li>Невозможно гарантировать сохранность истории, поэтому нет смысла её сохранять. История приводится лишь для справки "кто следом за кем писал".
			<li>Пользователь совершенно точно будет удалять старые или неудачные коммиты, чтобы освободить место. Поэтому надо хранить его коммиты максимально сжато, чтобы ему реже приходилось отвлекаться на нехватку места. Хранение дельт решает эту узкую задачу, а не задачу истории.
			<li>Дельты в истории (той, которая "для справки") вычисляются на лету, а не хранятся. Это другие дельты.
		</ol>
	</div>
	<div>
		<p><b>gitcenter:</b> <tt>(Oct 27, 2020)</tt><br><em><b>geekless:</b> Невозможно гарантировать сохранность истории...</em><br>Аналогия в git -- shallow clone.<br><em>Пользователь совершенно точно будет удалять старые...</em><br>Кто спорит?<br><em>Дельты в истории (той, которая "для справки")...</em><br>Это я понял, благо за справкой в известное место не приходится ездить.</p>
	</div>
</section>
	
<p class="dr">Oct 12, 2018 / Geekless.Twitter</p>
	
</article>		
		
</body>
</html>