<!DOCTYPE html>
<html>

<head>
	<title>Как работает ZeroID</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../../css/global.css">
</head>

<body>
	
<header>
  <a href="../../index.html"><img src="../../img/logo.png" width="55"></a><br>ChronCache	
</header>
	
<nav>
	<hr>
  <p><a href="../../talk.html">архив</a> <tt>|</tt> <a href="../../help.html">помощь</a> <tt>|</tt> <a href="/1Q9LVNLD1ghusGxpiwjYnVjPsxD5xGTGc7/donate/index.html">донат</a></p>
	<hr>
</nav>

<article>
	
<acide><p>Это резервная страница от 10.02.2019 / <a href="/1Apr5ba6u9Nz6eFASmFrefGvyBKkM76QgE/?Topic:1_14nEeyHKvuhBchZp4N4eSwYVNAzvYfwKQF/">оригинал</a>&#160;&#8226;&#160;<a href="/1RuZntipLvXcLKFEjT6Fr7ZA3GuywYfr5/?Topic:1_14nEeyHKvuhBchZp4N4eSwYVNAzvYfwKQF/">копия</a></p></acide>

<section>
	<h1>Авторизация через соцсети</h1>
	<p><b>vlad20012:</b> <tt>(Mar 07, 2016)</tt><br>Скажу сразу, я не рассматриваю <code>ZeroNet</code> с точки зрения анонимности вообще. Кто хочет анонимности - вам в <code>I2P</code> или <code>FreeNet</code> (кстати архитектурно очень похожий на ZeroNet, но с совершенно параноидальной ставкой на анонимность). Кроме того, анонимности можно легко добиться и в обычном интернете. У децентрализованных сетей же есть огромные преимущества, не связанные с анонимностью, которые, в том числе, достаточно подробно изложены @shift в одной из его статей на хабре <u>https://habrahabr.ru/post/239225/</u><br><b>Мотивация</b><br>Так зачем авторизация через соцсети? Основная причина - повышение доверия к аккаунтам. Зарегистрировать аккаунт на ZeroID ужасающе легко, это можно делать скриптом, получать аккаунты пачками. Отсюда отсутствие возможности модерации, отсюда анархия. Благодаря авторизации через соцсети мы по сути делегируем регистрацию аккаунта соцети. Если в соцсети можно регистрировать аккаунты пачками и скриптом, хммм, по крайней мере это уже не наши проблемы. Таким образом, юзеры, авторизованные через доверенные ресурсы (напр. гугл) получают и больше доверия на ресурсах ZeroNet. Это может быть выражено, например, в ограничении дискового пространства.<br><b>Планы реализации</b><br>Как работает авторизация в ZeroNet я описал здесь <u>http://127.0.0.1:43110/1Apr5ba6u9Nz6eFASmFrefGvyBKkM76QgE/?Topic:1_1LJP7tDoGnWNppUGJoNS8cJbmYTS1TecCC/+ZeroID</u><br>Для упрощения будем рассматривать только авторизацию через гугл.<br>Для авторизации в любом случае нужен внешний ресурс, т.е. обычный сервер и обычный же домен. Далее просто <code>сервер</code>. И конечно же нужен ресурс внутри ZeroNet с namecoin доменом. Далее просто <code>сайт</code></p>
	<ol>
		<li>Юзер заходит на <code>сайт</code>
		<li>Так же как на ZeroID, если у юзера не найден сертификат данного сайта, появляется кнопка с предложением регистраци.
		<li>Кнопка является прямой ссылкой к accounts.google.com со всеми необходимыми параметрами
		<li>Гугл просит юзера подтвердить авторизацию (с этого момента начинается OAuth2, но все равно распишу подробно)
		<li>После подтверждения юзер перенаправляется на <code>сервер</code>, в URL параметре присутствует код потверждения авториазции
		<li>Сервер отправляет код на сервера гугла, подтверждая авторизацию, и получает данные о пользователе. (На данном этапе мы по сути авторизовались через гугл на казалось бы стороннем, не связанным с ZeroNet сайтом)
		<li>Здесь у нас откуда-то должен появиться юзернейм. Можно бы взять адрес почты (и снести @gmail.com), но это как-то уж... даже по моим меркам, просто так палить почту... А можно вернуть юзеру форму для указания юзернейма. Тогда придется еще и установить куки.
		<li>После получения юзернейма все идет по тривиальной схеме, так же как на ZeroID (читать по ссылке выше).
	</ol>
	<p>Остаются некоторые нерешенные вопросы.</p>
	<ol>
		<li>Можно ли на один юзернейм вешать несколько ключей? Что если, например, юзер авторизируется с дргуго устройства (с другим ключом)? Может ли юзер заменить сертификат (например, при утере ключа)?
		<li>Должен ли сервер хранить сопоставление юзернейма и гугл аккаунта? Очевидно, если он не будет хранить эти данные, какое-либо дальнейшее управление аккаунтом (напр. добалвение ключей) будет невозможным. Если будет, то как он должен их использовать?
	</ol>
	<p>Далее, если добавить в схему другие соцсети. Это должны быть разные ресурсы для разных соцсетей, или один ресурс, но в зависимости от соцсети в сертификат будет записывать разный auth_type? Если второй вариант, то получается один неймспейс для всех юзернеймов (непонятно, плюс это или минус). Если юзер авторизируется через несколько соцсетей сразу, можно ли комбинировать auth_type (указывать несколько, через сепаратор)? По идее это немного усложнит регэкспы, но должно работать (надо бы с разрабом ZeroNet'а побазарить по поводу "стандартизации" такой мультиавторизации).<br>#<br>Предлагаю обсудить все пункты, особенно спорные вопросы. Также я открыт для любых предложений.<br>#<br><b>UPD1:</b><br>В общем, изучил, что будет, если выписать себе несколько сертификатов. Это было довольно предсказуемо. Предположим, у юзера был публичный ключ 111, и он выписывает себе новый сертификат для 222 на тот же юзернейм. Соответственно, раньше файлы юзера хранились в data/users/111, теперь будут в data/users/222. ZeroNet-ноде вообще пофигу, что у них одинаковый юзернейм, она будет считать их разными пользователями. Например, лимит занятого пространства будет считаться с нуля. Так что выдавать 2 сертификата никак нельзя. Но что если юзер потерял приватный ключ? Т.е. что получается, гугл аккаунт привязан к чему-то, юзернейм есть, а использовать его нельзя. Отозвать сертификат невозможно: выдан однажды - выдан навсегда. По-моему потеря ключа - достаточно правдоподобный сценарий. Нужно придумать какую-от схему отзыва сертификата. Естественно, это невозможно без поддержки со стороны ZeroNet. Any ideas?</p>
</section>	
	
<hr><p>Комментарии:</p>
	
<section class="com">
	<div>
		<p><b>shift:</b> <tt>(Mar 08, 2016)</tt><br><em>Можно ли на один юзернейм вешать несколько ключей? Что если, например, юзер авторизируется с дргуго устройства (с другим ключом)? Может ли юзер заменить сертификат (например, при утере ключа)?</em><br>Я считаю да, но сделать опциональным, включенным по умолчанию, но можно и отключить для большей безопастности.<br><em>Должен ли сервер хранить сопоставление юзернейма и гугл аккаунта?..</em><br>Не понял вопроса, но считаю что хранить должен для дальнейшей верификации.<br><em>... Если юзер авторизируется через несколько соцсетей сразу, можно ли комбинировать auth_type...</em><br>Ну имхо на 1 юзернейм должна быть возможность вешать много соц-сетей, алгоритм примерно такой -<br>Если пользователь уже авторизован, скажем, через гугл то он может подвязать другие OATH сети для авторизации, ну а если он вышел из аккаунта и подвязывает другую соц-сеть то создавать новый username<br><em><b>gomzik</b></em><br>Ты против соц-авторизации?</p>
	</div>
	<div>
		<p><b>vlad20012:</b> <tt>(Mar 08, 2016)</tt><br>Читаем первый апдейт</p>
	</div>
	<div>
		<p><b>vlad20012:</b> <tt>(Mar 08, 2016)</tt><br><em><b>shift:</b> Ну имхо на 1 юзернейм должна быть возможность вешать много соц-сетей...</em><br>Тут я имел в виду вот что. На сайте в data/users/content.json прописываются правила в т.ч. для способа авторизации (<code>auth_type</code>). Вот пример с этого сайта</p>
		<p><span class="code"><code>"bitid/.*@zeroid.bit": { "max_size": 40000 },<br>"bitmsg/.*@zeroid.bit": { "max_size": 15000 }</code></span></p>
		<p>Хз что такое bitid (таких юзеров нет), но вот при авторизации на zeroid через bitmsg к юзеру доверия меньше - меньше и пространства выделяется. У себя я предполагаю ставить <code>auth_type</code> в соответствие с соцсетью, через которую юзер регистрируется. google, facebook, twitter и т.п. Но вот вопрос, а что если юзер привязывает к аккаунту несколько соцсетей? Теоретически мне ничто не мешает записать в <code>auth_type</code> строку вида <code>"google;facebook;twitter"</code>, но в связи с этим сильно меняются регэкспы правил. Хотелось бы это дело как-то "стандартизировать", обговорить с разрабом ZeroNet то есть.</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Mar 08, 2016)</tt><br><em><b>vlad20012:</b> Тут я имел в виду вот что...</em><br>А приватный ключ получить мы не можем?<br>т.е брать у пользователя его приватный ключ шифруя его у него же и зашифрованный вариант передавать на сервер ну или весь приватный ключ. Да это не очень секурно но существуют же биткоин кошельки в вебе которые хронят у себя приватный ключ, и метод авторизации в сети не единственный....</p>
	</div>
	<div>
		<p><b>vlad20012:</b> <tt>(Mar 08, 2016)</tt><br><em><b>shift:</b> А приватный ключ получить мы не можем?..</em><br>Как твое сообщение связано с тем, что ты процитировал? =D<br>Обычным способом приватный ключ не вытащить. Только если просить пользователя открыть конфиг и скопипастить.</p>
	</div>
	<div>
		<p><b>shift:</b> <tt>(Mar 08, 2016)</tt><br><em><b>vlad20012:</b> ... Обычным способом приватный ключ не вытащить...</em><br>Грустно, тогда может стоит делать просто сайт на котором пользователь авторизуется через свой ID (zeroid) или другой а уже он навешивает на него информация о том, что с этим ID асоциирована вот эта запись, получится не как авторизация а как паспорт в вебмани т.е сугубо для повышения доверия.</p>
		<p>Таким образом я это вижу так:<br>1) Пользователь получает ID на любом zeroid сайте (основной или другие, когда появятся)<br>2) Пользователь авторизуется на твоем сайте со своим ID<br>3) Если проверка пройдена успешно - пользователю выдается еще один ID - trust_%old_id_name% иаким образом сайты очень просто смогут отличать какой пользователь к ним пришел проверянный или нет.</p>
	</div>
	<div>
		<p><b>vlad20012:</b> <tt>(Mar 08, 2016)</tt><br>Это никак не решает проблему =)</p>
	</div>
	<div>
		<p><b>cypher:</b> <tt>(Mar 08, 2016)</tt><br>Может немного оффтоп, и все же. Хорошо бы сделать так, чтобы по клику на никнейм открывалось что-то типа профиля с координатами - внутренней почтой, блогом если есть ит.д. Но видимо нужно ждать, пока разработчик допилит поддержку соцсетей.</p>
	</div>
</section>
	
<p class="dr">Mar 07, 2016 / Ru-ZeroTalk</p>
	
</article>		
		
</body>
</html>