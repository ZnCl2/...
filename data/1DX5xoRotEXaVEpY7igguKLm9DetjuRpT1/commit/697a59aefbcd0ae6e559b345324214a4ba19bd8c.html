<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Always include sticky topics to sql result - 0git - 0git - a list of git repositories on ZeroNet
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="0git.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>0git</h1><span class="desc">0git - a list of git repositories on ZeroNet
</span></td></tr><tr class="url"><td></td><td>git clone <a href="http://127.0.0.1:43110/0git.bit/0git.git">http://127.0.0.1:43110/0git.bit/0git.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/697a59aefbcd0ae6e559b345324214a4ba19bd8c.html">697a59aefbcd0ae6e559b345324214a4ba19bd8c</a>
<b>parent</b> <a href="../commit/fa41328a3c45c68592ee8d87a729a43821cbbc9d.html">fa41328a3c45c68592ee8d87a729a43821cbbc9d</a>
<b>Author:</b> HelloZeroNet &lt;<a href="mailto:hello@noloop.me">hello@noloop.me</a>&gt;
<b>Date:</b>   Fri Apr 15 19:22:09 +0200

Always include sticky topics to sql result

<b>Diffstat:</b>
<table><tr><td><a href="#h0">js/TopicList.coffee</a></td><td> | </td><td class="num">10</td><td><span class="i">+++++++</span><span class="d">---</span></td></tr>
</table>1 file changed, 7 insertions(+), 3 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/js/TopicList.coffee.html">js/TopicList.coffee</a> b/<a href="../file/js/TopicList.coffee.html">js/TopicList.coffee</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -119,6 +119,8 @@ class TopicList extends Class
</a> 			where = &quot;WHERE topic.type IS NULL AND topic.parent_topic_uri IS NULL&quot;
 		last_elem = $(&quot;.topics-list .topic.template&quot;)
 
<a href="#h0-0-3" id="h0-0-3" class="i">+		sql_sticky = (&quot;WHEN &apos;#{topic_uri}&apos; THEN 1&quot; for topic_uri in Page.site_info.content.settings.topic_sticky_uris).join(&quot; &quot;)
</a><a href="#h0-0-4" id="h0-0-4" class="i">+
</a> 		query = &quot;&quot;&quot;
 			SELECT
 			 COUNT(comment_id) AS comments_num, MAX(comment.added) AS last_comment, topic.added as last_added, CASE WHEN MAX(comment.added) IS NULL THEN topic.added ELSE MAX(comment.added) END as last_action,
<a href="#h0-1" id="h0-1" class="h">@@ -127,7 +129,8 @@ class TopicList extends Class
</a> 			 topic_creator_content.directory AS topic_creator_address,
 			 topic.topic_id || &apos;_&apos; || topic_creator_content.directory AS row_topic_uri,
 			 NULL AS row_topic_sub_uri,
<a href="#h0-1-3" id="h0-1-3" class="d">-			 (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || &apos;_&apos; || topic_creator_content.directory)+1 AS votes
</a><a href="#h0-1-4" id="h0-1-4" class="i">+			 (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || &apos;_&apos; || topic_creator_content.directory)+1 AS votes,
</a><a href="#h0-1-5" id="h0-1-5" class="i">+			 CASE topic.topic_id || &apos;_&apos; || topic_creator_content.directory #{sql_sticky} ELSE 0 END AS sticky
</a> 			FROM topic
 			LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id)
 			LEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = &apos;content.json&apos;)
<a href="#h0-2" id="h0-2" class="h">@@ -150,7 +153,8 @@ class TopicList extends Class
</a> 				 topic_creator_content.directory AS topic_creator_address,
 				 topic.topic_id || &apos;_&apos; || topic_creator_content.directory AS row_topic_uri,
 				 topic_sub.topic_id || &apos;_&apos; || topic_sub_creator_content.directory AS row_topic_sub_uri,
<a href="#h0-2-3" id="h0-2-3" class="d">-				 (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || &apos;_&apos; || topic_creator_content.directory)+1 AS votes
</a><a href="#h0-2-4" id="h0-2-4" class="i">+				 (SELECT COUNT(*) FROM topic_vote WHERE topic_vote.topic_uri = topic.topic_id || &apos;_&apos; || topic_creator_content.directory)+1 AS votes,
</a><a href="#h0-2-5" id="h0-2-5" class="i">+				 CASE topic.topic_id || &apos;_&apos; || topic_creator_content.directory #{sql_sticky} ELSE 0 END AS sticky
</a> 				FROM topic
 				LEFT JOIN json AS topic_creator_json ON (topic_creator_json.json_id = topic.json_id)
 				LEFT JOIN json AS topic_creator_content ON (topic_creator_content.directory = topic_creator_json.directory AND topic_creator_content.file_name = &apos;content.json&apos;)
<a href="#h0-3" id="h0-3" class="h">@@ -165,7 +169,7 @@ class TopicList extends Class
</a> 			&quot;&quot;&quot;
 
 		if not @list_all and not @parent_topic_uri
<a href="#h0-3-3" id="h0-3-3" class="d">-			query += &quot; ORDER BY last_action DESC LIMIT 30&quot;
</a><a href="#h0-3-4" id="h0-3-4" class="i">+			query += &quot; ORDER BY sticky DESC, last_action DESC LIMIT 30&quot;
</a> 
 
 		Page.cmd &quot;dbQuery&quot;, [query], (topics) =&gt;
</pre>
</div>
</body>
</html>
